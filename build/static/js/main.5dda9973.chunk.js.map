{"version":3,"sources":["components/simulator/Simulator.module.scss","components/translator/TranslatorTab.module.scss","components/simulator/LogEvent.module.scss","components/dialog/Dialog.module.scss","components/flow/actions/action/Action.module.scss","components/flow/exit/Exit.module.scss","components/simulator/ContextExplorer.module.scss","components/sticky/Sticky.module.scss","components/flow/node/Node.module.scss","components/shared.module.scss","components/flow/routers/case/CaseElement.module.scss","components/revisions/RevisionExplorer.module.scss","components/flow/actions/sendmsg/SendMsgForm.module.scss","components/flow/routers/webhook/WebhookRouterForm.module.scss","components/flow/routers/result/ResultRouterForm.module.scss","components/titlebar/TitleBar.module.scss","components/poptab/PopTab.module.scss","components/form/FormElement.module.scss","components/issues/IssuesTab.module.scss","components/flow/actions/sendbroadcast/SendBroadcastForm.module.scss","components/flow/actions/sendmsg/SendMsg.module.scss","components/flow/routers/sequence/SequenceForm.module.scss","components/mediaplayer/MediaPlayer.module.scss","components/flow/actions/sendbroadcast/SendBroadcast.module.scss","components/flow/routers/localization/RouterLocalizationForm.module.scss","components/draghelper/DragHelper.module.scss","components/index.module.scss","components/form/checkbox/CheckboxElement.module.scss","components/flow/routers/airtime/currency/CurrencyElement.module.scss","components/flow/routers/random/RandomRouterForm.module.scss","components/flow/routers/subflow/SubflowRouterForm.module.scss","components/button/Button.module.scss","components/pill/Pill.module.scss","components/flow/routers/caselist/CaseList.module.scss","components/flow/routers/menu/MenuRouterForm.module.scss","components/form/timeout/TimeoutControl.module.scss","components/canvas/Canvas.module.scss","components/languageselector/LanguageSelector.module.scss","variables.module.scss","components/flow/actions/sendemail/SendEmailForm.module.scss","components/flow/actions/setrunresult/SetRunResultForm.module.scss","components/flow/actions/startsession/StartSession.module.scss","components/counter/Counter.module.scss","components/mountscroll/MountScroll.module.scss","temba/TembaSelect.module.scss","components/form/textinput/TextInputElement.module.scss","components/flow/actions/addurn/AddURNForm.module.scss","components/flow/actions/saymsg/SayMsg.module.scss","components/flow/actions/transferairtime/TransferAirtime.module.scss","components/form/optionaltext/OptionalTextInput.module.scss","components/form/ValidationFailures.module.scss","components/flow/routers/field/FieldRouterForm.module.scss","components/flow/routers/ticket/TicketRouterForm.module.scss","components/canvas/CanvasDraggable.module.scss","static/images/map.jpg","components/form/assetselector/AssetSelector.module.scss","components/nodeeditor/TypeList.module.scss","components/flow/actions/changegroups/removegroups/RemoveGroupsForm.module.scss","components/loading/Loading.module.scss","components/flow/actions/updatecontact/UpdateContactForm.module.scss","components/flow/routers/airtime/AirtimeRouterForm.module.scss","components/flow/routers/digits/DigitsRouterForm.module.scss","components/flow/routers/resthook/ResthookRouterForm.module.scss","components/flow/routers/wait/WaitRouterForm.module.scss","components/flow/routers/classify/ClassifyRouterForm.module.scss","components/flow/Flow.module.scss","global.module.scss","flowTypes.ts","services/Localization.ts","components/button/Button.tsx","utils/index.tsx","components/dialog/Dialog.tsx","store/constants.ts","components/fixy/Fixy.tsx","store/flowContext.ts","config/interfaces.ts","store/currencies.ts","external/index.ts","components/flow/actions/helpers.tsx","components/flow/props.ts","config/ConfigProvider.tsx","components/flow/actions/addlabels/AddLabels.tsx","components/form/FormElement.tsx","config/i18n/index.js","temba/TembaSelect.tsx","components/form/assetselector/helpers.ts","components/form/assetselector/AssetSelector.tsx","config/helpers.ts","components/nodeeditor/TypeList.tsx","store/validators.ts","store/nodeEditor.ts","components/flow/actions/addlabels/AddLabelsForm.tsx","components/flow/actions/addlabels/helpers.ts","components/flow/actions/addurn/helpers.ts","components/form/textinput/TextInputElement.tsx","components/flow/actions/addurn/AddURN.tsx","components/form/select/SelectElement.tsx","components/form/textinput/helpers.tsx","components/flow/actions/addurn/AddURNForm.tsx","components/flow/actions/callresthook/CallResthook.tsx","components/flow/actions/callwebhook/CallWebhook.tsx","components/flow/actions/changegroups/helpers.ts","components/flow/actions/changegroups/addgroups/AddGroupsForm.tsx","components/flow/actions/changegroups/addgroups/helpers.ts","components/flow/actions/changegroups/ChangeGroups.tsx","components/form/checkbox/CheckboxElement.tsx","components/flow/actions/changegroups/removegroups/RemoveGroupsForm.tsx","components/flow/actions/changegroups/removegroups/helpers.ts","components/flow/helpers.ts","components/flow/actions/localization/KeyLocalizationForm.tsx","components/flow/actions/localization/helpers.ts","components/pill/Pill.tsx","components/uploadbutton/UploadButton.tsx","components/flow/actions/localization/MsgLocalizationForm.tsx","components/flow/actions/missing/Missing.tsx","components/flow/actions/playaudio/PlayAudio.tsx","components/flow/actions/playaudio/PlayAudioForm.tsx","components/flow/actions/playaudio/helpers.ts","components/mediaplayer/MediaPlayer.tsx","components/flow/actions/saymsg/SayMsg.tsx","components/flow/actions/saymsg/SayMsgForm.tsx","components/flow/actions/saymsg/helpers.ts","components/flow/actions/sendbroadcast/SendBroadcast.tsx","components/flow/actions/sendbroadcast/helpers.ts","components/loading/Loading.tsx","components/flow/actions/sendbroadcast/SendBroadcastForm.tsx","components/flow/actions/sendemail/SendEmail.tsx","utils/reactselect.ts","components/form/select/tags/TaggingElement.tsx","components/flow/actions/sendemail/SendEmailForm.tsx","components/flow/actions/sendemail/helpers.ts","components/flow/actions/sendmsg/SendMsg.tsx","components/flow/actions/sendmsg/helpers.ts","components/form/multichoice/MultiChoice.tsx","components/flow/actions/sendmsg/SendMsgForm.tsx","components/flow/actions/setrunresult/SetRunResult.tsx","components/flow/actions/setrunresult/SetRunResultForm.tsx","components/flow/actions/setrunresult/helpers.ts","components/flow/actions/startflow/StartFlow.tsx","components/flow/actions/startsession/StartSession.tsx","components/flow/routers/constants.ts","components/flow/actions/startsession/StartSessionForm.tsx","components/flow/actions/startsession/helpers.ts","components/flow/actions/transferairtime/TransferAirtime.tsx","components/flow/actions/updatecontact/UpdateContact.tsx","components/helpers.ts","components/flow/routers/helpers.ts","components/flow/node/helpers.ts","store/mutators.ts","components/flow/actions/updatecontact/UpdateContactForm.tsx","components/flow/routers/airtime/currency/CurrencyElement.tsx","components/form/optionaltext/OptionalTextInput.tsx","components/flow/routers/widgets.tsx","components/form/ValidationFailures.tsx","components/flow/routers/airtime/helpers.ts","components/flow/routers/airtime/AirtimeRouterForm.tsx","config/operatorConfigs.ts","components/flow/routers/case/helpers.ts","components/flow/routers/case/CaseElement.tsx","components/flow/routers/caselist/helpers.ts","components/flow/routers/caselist/CaseList.tsx","components/flow/routers/expression/ExpressionRouterForm.tsx","components/flow/routers/digits/DigitsRouterForm.tsx","components/flow/routers/digits/helpers.ts","components/nodeeditor/constants.ts","components/flow/routers/field/FieldRouterForm.tsx","components/flow/routers/expression/helpers.ts","components/flow/routers/field/helpers.ts","components/flow/routers/groups/helpers.ts","components/flow/routers/localization/helpers.ts","components/flow/routers/groups/GroupsRouterForm.tsx","components/flow/routers/localization/RouterLocalizationForm.tsx","components/flow/routers/menu/helpers.ts","components/flow/routers/menu/MenuRouterForm.tsx","components/flow/routers/random/helpers.ts","components/flow/routers/random/RandomRouterForm.tsx","components/flow/routers/response/helpers.ts","components/flow/routers/response/ResponseRouterForm.tsx","components/form/timeout/TimeoutControl.tsx","components/flow/routers/resthook/helpers.ts","components/flow/routers/resthook/ResthookRouterForm.tsx","components/flow/routers/result/helpers.ts","components/flow/routers/result/ResultRouterForm.tsx","components/flow/routers/subflow/SubflowRouterForm.tsx","components/flow/routers/subflow/helpers.ts","components/flow/routers/wait/helpers.ts","components/flow/routers/webhook/helpers.ts","components/flow/routers/wait/WaitRouterForm.tsx","components/flow/routers/webhook/header/HeaderElement.tsx","components/flow/routers/webhook/WebhookRouterForm.tsx","components/flow/actions/callclassifier/CallClassifier.tsx","config/index.ts","components/flow/routers/classify/helpers.ts","components/flow/routers/classify/ClassifyRouterForm.tsx","components/flow/routers/scheme/helpers.ts","components/flow/routers/scheme/SchemeRouterForm.tsx","components/flow/routers/ticket/helpers.ts","components/flow/routers/ticket/TicketRouterForm.tsx","components/flow/actions/openticket/OpenTicket.tsx","components/flow/routers/sequence/SequenceForm.tsx","components/flow/routers/sequence/helpers.ts","components/flow/routers/sequence/Sequence.tsx","config/typeConfigs.ts","components/flow/actions/updatecontact/helpers.ts","store/editor.ts","store/thunks.ts","store/helpers.ts","components/canvas/CanvasDraggable.tsx","components/canvas/helpers.ts","components/canvas/Canvas.tsx","components/counter/Counter.tsx","components/titlebar/TitleBar.tsx","components/mountscroll/MountScroll.tsx","components/flow/actions/action/Action.tsx","components/draghelper/DragHelper.tsx","components/flow/exit/helpers.ts","components/Portal.tsx","components/flow/exit/Exit.tsx","components/flow/node/Node.tsx","components/simulator/LogEvent.tsx","components/modal/Modal.tsx","components/nodeeditor/NodeEditor.tsx","components/simulator/helpers.ts","components/simulator/Simulator.tsx","components/simulator/ContextExplorer.tsx","components/sticky/Sticky.tsx","services/Plumber.ts","utils/debug.ts","components/flow/Flow.tsx","components/translator/helpers.ts","components/languageselector/LanguageSelector.tsx","components/poptab/PopTab.tsx","components/revisions/RevisionExplorer.tsx","components/issues/IssuesTab.tsx","store/rootReducer.ts","store/state.ts","store/createStore.ts","components/translator/TranslatorTab.tsx","components/index.tsx","serviceWorker.js","index.js"],"names":["module","exports","DependencyType","FlowIssueType","RouterTypes","WaitTypes","HintTypes","ContactProperties","ValueType","StartFlowArgs","StartFlowExitNames","WebhookExitNames","TransferAirtimeExitNames","SPEC_VERSION","ButtonTypes","LocalizedObject","object","id","name","localizedKeys","localizedObject","localized","iso","language","this","key","value","Object","assign","Array","isArray","length","Localization","translations","uuid","values","keys","forEach","addTranslation","SNAKED_CHARS","GRID_SIZE","parseInt","variables","grid_size","NODE_SPACING","node_spacing","NODE_PADDING","node_padding","snapToGrid","left","top","leftAdjust","topAdjust","Math","max","snapPositionToGrid","position","right","bottom","snakify","toLowerCase","trim","replace","titleCase","str","s","charAt","toUpperCase","substr","hasErrorType","errors","exps","error","exp","match","createClickHandler","onClick","shouldCancelClick","onMouseDown","event","onMouseUp","getLocalization","obj","localization","translate","emphasize","text","className","ellipsize","renderIf","predicate","then","otherwise","isRealValue","undefined","set","val","$set","merge","$merge","unset","$unset","push","arr","$push","splice","$splice","createUUID","generateUUID","range","start","end","from","v","k","hasString","names","find","item","throttle","func","timeout","ready","setTimeout","onNextRender","fn","window","bool","prop","HeaderStyle","Button","props","state","active","bindCallbacks","include","setState","onRef","type","disabled","leftSpacing","topSpacing","iconName","ref","style","marginLeft","marginTop","handleMouseDown","handleMouseUp","styles","btn","paddingRight","React","Constants","Dialog","tabFocus","primaryButton","activeTab","index","foundTab","tabs","tab","hasErrors","shiftKey","preventDefault","stopPropagation","target","blur","click","focus","console","log","document","addEventListener","handleKey","capture","clearTimeout","removeEventListener","rightButtons","buttons","primary","secondary","tertiary","handlePrimaryButton","leftButtons","headerClasses","header","clickable","headerClass","shared","headerIcon","iconed","headerStyle","BARBER","barber","activeClasses","dialog","getButtons","join","map","evt","icon","tab_icon","checked","header_overlay","header_icon","title_container","title","subtitle","noPadding","content","body","children","footer","left_buttons","gutter","right_buttons","Fixy","ele","fixed","scrollY","handleScroll","getBoundingClientRect","AssetType","FlowTypes","ContactStatus","Types","Operators","FeatureFilter","PopTabType","REMOVE_VALUE_ASSET","Remove","DEFAULT_LANGUAGE","Language","initialState","definition","baseLanguage","metadata","dependencies","results","waiting_exit_uuids","parent_refs","issues","contactFields","nodes","assetStore","updateDefinition","UPDATE_DEFINITION","payload","updateNodes","UPDATE_NODES","updateIssues","UPDATE_ISSUES","updateMetadata","UPDATE_METADATA","updateAssets","assets","store","querySelector","setKeyedAssets","items","UPDATE_ASSET_MAP","combineReducers","action","UPDATE_BASE_LANGUAGE","UPDATE_CONTACT_FIELDS","currencies","ARS","Currency","AUD","BIF","BRL","CAD","CDF","CLP","COP","DJF","DOP","DZD","EUR","GBP","GHS","GNF","KES","LBP","LKR","LRD","MWK","MXN","NAD","NPR","NZD","PHP","PKR","RUB","RWF","SDG","SGD","SLL","SOS","SRD","SVC","TND","TRY","TZS","UGX","USD","UYU","UZS","VEF","XCD","YER","ZAR","ZMW","ZWL","HIDDEN","NONE","VOICE","SURVEY","TEXT_TYPES","MESSAGE","ONLINE","axios","defaults","headers","post","responseType","saveRevision","endpoint","csrf","getCookie","patch","release","spec_version","split","Promise","resolve","reject","response","status","data","catch","cookie","idx","indexOf","fetchAsset","getAssets","asset","getAssetPage","url","get","result","resultToAsset","order","next","a","pageUrl","assetPage","concat","idKey","assetType","Flow","label","isMatch","input","shouldExclude","inputLower","includes","createAssetStore","endpoints","channels","getURL","Channel","classifiers","Classifier","languages","flows","fields","Field","globals","Global","groups","Group","revisions","Revision","labels","Label","Result","recipients","Contact","URN","resthooks","Resthook","templates","Template","ticketers","Ticketer","prefetched","validateMedia","ValidateMedia","fetches","storeId","assetListToMap","all","getFunctions","getCompletionSchema","getFlowDetails","revisionToLoad","Error","details","path","endsWith","startsWith","location","protocol","hostname","port","getBaseURL","showHelpArticle","link","open","renderIssues","issueProps","helpArticles","padding","issue","num","node_uuid","action_uuid","margin","display","fontSize","color","marginRight","renderIssue","message","description","MISSING_DEPENDENCY","i18nKey","dependency","INVALID_REGEX","regex","LEGACY_EXTRA","article","issue_help","getActionUUID","nodeSettings","currentType","originalAction","getRecipients","selected","group","contacts","contact","missing","legacy_vars","expression","renderAssetList","reduce","elements","renderAsset","assetBody","node_group","node_label","e","href","editor","rel","node_asset","getAllErrors","entry","validationFailures","getExpressions","filter","getRecipientsByAsset","NAME_PROPERTY","Name","ContactProperty","CHANNEL_PROPERTY","LANGUAGE_PROPERTY","STATUS_PROPERTY","Status","fakePropType","isRequired","ConfigProvider","tembaStore","createElement","completionsEndpoint","config","completion","functionsEndpoint","functions","fieldsEndpoint","globalsEndpoint","appendChild","count","only","childContextTypes","assetService","AddLabelsComp","context","contextTypes","cx","classNames","bind","FormElement","showLabel","helpText","help_text","hideError","getValidationErrors","failure","send_msg_error","sendMsgError","arrow_up","error_list","getName","getHelpText","errorsToDisplay","getErrors","border","invalid","__className","resources","translation","en","es","pt","i18n","use","LanguageDetector","initReactI18next","init","fallbackLng","interpolation","prefix","suffix","TembaSelectStyle","TembaSelect","selectbox","option","nameKey","valueKey","b","getValue","select","createPrefix","createArbitraryOption","options","setOptions","sortFunction","resolved","tags","op","onChange","multi","focused","selectedArray","JSON","stringify","normal","data-testid","onFocus","cacheKey","expressions","hideErrors","placeholder","searchable","clearable","queryParam","sortByName","localeCompare","hasUseableTranslation","template","AssetSelector","lastCreation","defaultOptions","query","additionalOptions","search","matches","searchAssetMap","valueClearable","isLoading","toCreate","arbitrary","handleCreateOption","now","Date","getTime","createAssetFromInput","postNewAsset","onAssetCreated","non_field_errors","fallbackPlaceholder","t","toLocaleLowerCase","handleChanged","nextProps","prevState","existing","isOnlineFlowType","flowType","filterVisibility","filters","visibility","findIndex","ft","excludeTypes","excludeOperators","TypeList","typeConfigs","initialType","handleChangeType","configsToDisplay","type_list","getTypeConfigs","mergeForm","form","toMerge","toRemove","updated","isEntry","hasOwnProperty","existingIdx","mutate","remove","removeKeys","valid","typeConfig","userAddingAction","settings","updateNodeEditorSettings","UPDATE_NODE_EDITOR_SETTINGS","updateUserAddingAction","UPDATE_USER_ADDING_ACTION","UPDATE_TYPE_CONFIG","REGEX_URL","RegExp","fromRegex","inputAsString","test","failures","validate","validators","allFailures","validateFunc","validation","Required","MoreThan","amount","checkName","parseFloat","shouldRequireIf","required","validateIf","HeaderName","headerUtils","MaxOfTenItems","StartIsNonNumeric","ValidURL","Numeric","Alphanumeric","NumOrExp","AddLabelsForm","add_input_labels","formState","handleLabelsChanged","newAction","updateAction","onClose","submitting","updates","handleSave","addAsset","onTypeChange","data-spec","handleCreateAssetFromInput","handleLabelCreated","Count","TextInputStyle","getSchemeObject","scheme","SCHEMES","getSchemeSelectOption","schemeToSelectOption","AddURNComp","schemeObject","schemeName","SelectElement","TextInputElement","initial","currentTarget","charCount","SMS","optional","textarea","counter","wrapper","handleChange","autocomplete","onInput","onBlur","maxLength","session","createTextInput","AddURNForm","add_contact_urn","initializeForm","handlePathChanged","alignItems","scheme_selection","handleSchemeChanged","CallResthookComp","resthook","CallWebhookComp","excludeDynamicGroups","AddGroupsForm","add_contact_groups","name_match","handleGroupsChanged","noOptionsMessage","handleGroupAdded","getContentMarkup","remove_contact_groups","GroupNameMatch","specId","getRemoveAllMarkup","ChangeGroupsComp","getChangeGroupsMarkup","CheckboxElement","checkboxIcon","labelClassName","checkboxClassName","description_solo","LABEL","REMOVE_FROM_ALL","REMOVE_FROM_ALL_DESC","RemoveGroupsForm","removeAll","all_groups","groupValidators","handleUpdate","checkbox","handleRemoveAllUpdate","determineTypeConfig","renderNode","originalNode","node","getTypeConfig","actions","getType","router","hasIssues","translating","KeyLocalizationForm","keyValues","localizations","getObject","localizeableKeys","initializeLocalizedKeyForm","updateLocalizations","base","slice","translate_from","handleKeyUpdate","Pill","substring","pillStyles","pill","large","data-advanced","advanced","UploadButton","filePicker","onUploadChanged","files","FormData","append","handleUploadFile","removeText","handleRemoveUpload","uploadText","TYPE_OPTIONS","MsgLocalizationForm","quickReplies","templateVariables","templating","attachments","audio","send_msg","say_msg","isLocalized","audio_url","quick_replies","attachmentString","splitPoint","attachment","initializeLocalizedForm","handleQuickRepliesUpdate","newQuickReply","newReplies","reply","updatedText","url_attachment","type_choice","small","handleAttachmentRemoved","renderAttachment","emptyOption","renderAttachments","hasLocalizedValue","variable","handleTemplateVariableChanged","audioButton","handleAudioChanged","handleMessageUpdate","MissingComp","PlayAudioComp","PlayAudioForm","play_audio","handleAudioUpdate","MediaPlayer","stroke","radius","radiusNormalized","circumference","PI","durationSeconds","currentSeconds","playing","progress","currentTime","duration","ended","floor","triggered","handleTogglePlay","pause","play","prevProps","strokeDashoffset","player","height","width","handleRef","onTimeUpdate","handleTimeUpdate","src","circles","circle_background","fill","strokeWidth","r","cy","circle_foreground","strokeDasharray","button","PLACEHOLDER","SayMsgComp","recording","SayMsgForm","handleUploadChanged","SendBroadcastComp","to","line","icons","whatsapp","stateToAction","templatingUUID","send_broadcast","hexToRgb","hex","exec","g","Loading","loading","size","units","borderRadius","square","animationDelay","background","SendBroadcastForm","finalState","validAttachment","attachmentError","uploaded","msgTemplate","handleTemplateChanged","is_valid","toString","handleAxios","templateTranslation","variable_count","handleShouldExcludeTemplate","formClearable","template_text","crossIcon","renderTemplateConfig","checkAttachmentErrors","handleRecipientsChanged","SendEmailComp","subject","tagging","control","borderColor","boxShadow","transition","caretColor","marginBottom","multiValue","maxHeight","minHeight","lineHeight","backgroundColor","TaggingElement","tag","optionsToTags","onCheckValid","tagsToOptions","handleUpdateTags","isMulti","isSearchable","isValidNewOption","handleCheckValid","prompt","formatCreateLabel","createPrompt","Component","EMAIL_PATTERN","SendEmailForm","send_email","addresses","handleSubjectChanged","handleBodyChanged","SendMsgComp","replies","topic","facebook","summary","TOPIC_OPTIONS","all_urns","sendAll","SendMsgForm","quickReplyEntry","stateToForm","upload","remove_upload","renderUpload","handleTopicUpdate","handleSendAllUpdate","hasFeature","HAS_WHATSAPP","class","SetRunResultComp","getSavePlaceholder","getClearPlaceholder","SetRunResultForm","set_run_result","category","snaked","handleNameUpdate","resultFormat","handleValueUpdate","handleCategoryUpdate","StartFlowComp","flow","StartSessionComp","create_contact","contact_query","DefaultExitNames","START_TYPE_ASSETS","START_TYPE_CREATE","START_TYPE_QUERY","START_TYPE_OPTIONS","StartSessionForm","start_session","startType","contactQuery","handleStartTypeChanged","handleContactQueryChanged","handleFlowChanged","TransferAirtimeComp","transfer","amounts","code","require","withEmph","emph","renderSetText","emphasizeName","UpdateContactComp","set_contact_field","field","set_contact_channel","setContactAction","channel","set_contact_language","getLanguageForCode","set_contact_status","set_contact_name","getDraggedFrom","ghostNode","ghost","exitUUIDs","inboundConnections","exitUUID","nodeUUID","ONLINE_PROPERTIES","OFFLINE_PROPERTIES","getContactProperties","WAIT_LABEL","GROUP_LABEL","createRenderNode","exits","uiConfig","ui","hasCases","cases","createCaseProps","categories","getCategories","parse","kase","matchingCategory","category_uuid","isRelativeDate","caseConfig","arguments","categoryName","operatorType","has_date_eq","has_date_gt","has_date_lt","isCategoryMatch","cat","categorizeCases","newCases","originalRouter","previousCategories","newCase","getSwitchRouter","previousCase","previousCategory","previousExit","exit","exit_uuid","switch","getDefaultRoute","defaultCategoryName","defaultCategory","default_category_uuid","defaultExit","getTimeoutRoute","timeoutCategory","timeoutExit","wait","No_Response","resolveRoutes","hasTimeout","resolvedDefaultCategory","Other","All_Responses","createWebhookBasedNode","useCategoryTest","previousRouter","destination_uuid","Success","Failure","has_category","has_only_text","operand","result_name","splitType","split_by_webhook","call_resthook","split_by_resthook","open_ticket","split_by_ticket","transfer_airtime","split_by_airtime","getCategoriesForExit","isGroupSplit","split_by_groups","getResultName","switchRouter","random","call_webhook","uniquifyNode","newNode","removeResultFromStore","resultName","reference","filteredRefs","references","actionUUID","removeResultReference","addResult","addRevision","revision","updateConnection","fromNodeUUID","fromExitUUID","destinationNodeUUID","updatedNodes","fromNode","getNode","exitIdx","getExitIndex","previousDestination","mergeNode","removeNode","spliceInAction","previousNode","otherExit","getDefaultExit","destination","execute_actions","remap","nodeToRemove","detectLoops","updatePosition","snap","adjusted","updateStickyNotePosition","stickyUUID","_ui","stickies","lastPos","updateStickyNote","sticky","CONTACT_STATUS_ACTIVE","ACTIVE","CONTACT_STATUS_BLOCKED","BLOCKED","CONTACT_STATUS_STOPPED","STOPPED","CONTACT_STATUS_ARCHIVED","ARCHIVED","CONTACT_STATUS_OPTIONS","UpdateContactForm","fieldValue","selection","dispatch","getState","flowContext","assetMap","mutators","handlePropertyChange","handleLanguageUpdate","handleChannelUpdate","onUpdated","handleStatusUpdate","handleFieldValueUpdate","value_type","sortFieldsAndProperties","handleFieldAdded","getValueWidget","CurrencyElement","isNaN","Number","currency","amountInput","handleAmountChanged","removeIco","onRemove","form_element","exclude","airtime","handleCurrencyChanged","OptionalTextInput","editing","handleTextChanged","toggle_link","handleEditingChanged","toggleText","optional_text_input","createResultNameInput","ValidationFailures","getOriginalAction","AirtimeRouterForm","nodeToState","updateRouter","stateToNode","handleTransferChanged","handleRemoved","renderAmount","renderAmounts","handleUpdateResultName","intentOperatorList","has_top_intent","verboseName","operands","has_intent","operatorConfigList","has_any_word","has_all_words","has_phrase","has_only_phrase","has_beginning","has_text","has_number","has_number_between","has_number_lt","has_number_lte","has_number_eq","has_number_gte","has_number_gt","has_date","has_time","has_group","has_phone","has_email","has_state","has_district","has_ward","has_error","has_value","has_pattern","has_media","has_audio","has_image","has_video","has_file","has_location","operatorConfigMap","operatorConfig","getOperatorConfig","pre","validateCase","classifier","exitEdited","exitName","min","argument","district","intentValidators","intents","intent","confidence","categoryNameEdited","getCategoryName","today","inDays","abs","words","firstWord","CaseElement","operators","arg1","arg2","previousProps","filterOperators","getArgumentArray","getCaseProps","handleIntentChanged","handleMinChanged","divider","data-draggable","handleMaxChanged","onMenuOpen","handleIntentMenuOpened","onMenuClose","handleIntentMenuClosed","handleConfidenceChanged","handleStateChanged","handleDistrictChanged","relative_date","handleArgumentChanged","kaseError","dnd_icon","choice","getOperators","handleOperatorChanged","multi_operand","single_operand","renderArguments","categorize_as","handleExitChanged","showInvalid","remove_icon","handleRemoveClicked","DragCursor","SortableItem","SortableElement","row","caseProps","list","handleRemoveCase","handleUpdateCase","CaseList","sortableList","SortableContainer","case_list","currentCases","shouldCancelStart","hasEmptyCase","createEmptyCase","ensureEmptyCase","removeCase","onCasesUpdated","oldIndex","newIndex","arrayMove","case_list_container","scrolling","tabIndex","onSortEnd","handleSortEnd","HTMLElement","dataset","draggable","InputToFocus","DigitsRouterForm","initialCases","wait_for_digits","optionalRouter","msg","hint","digits","wait_for_response","lead_in","handleCasesUpdated","renderEdit","ExpressionRouterForm","split_by_expression","handleOperandUpdated","getRoutableFields","Scheme","FieldRouterForm","split_by_contact_field","operandConfig","field_select","handleFieldChanged","LocalizedType","extractGroups","groupsToCases","GroupsRouterForm","getLocalizedObjects","localizedType","filtered","Case","hasLocalizableCases","original","RouterLocalizationForm","Category","arg","originalCase","orginalArgument","translating_operator_container","translating_operator","translating_from","translating_to","handleUpdateCaseArgument","originalCategory","translating_category","handleUpdateCategoryName","renderCases","renderCategories","menuToCases","menu","previousCases","c","MenuRouterForm","i","wait_for_menu","originalCases","menu_option","digit","handleMenuChanged","renderOption","renderMenu","BUCKET_OPTIONS","getOption","bucketOption","fillOutCategories","buckets","RandomRouterForm","split_by_random","bucketChoice","newExit","bucket_name","handleBucketNameChanged","OPTIONS","bucket_select","handleBucketsChanged","bucket_list","renderBucketNames","TIMEOUT_OPTIONS","DEFAULT_TIMEOUT","TimeoutControl","entries","isChecked","onChanged","timeout_control_container","left_section","getInstructions","handleChecked","drop_down","getSelected","handleTimeoutChanged","ResponseRouterForm","seconds","invalidCase","handleUpdateTimeout","ResthookRouterForm","resthookAsset","handleResthookChanged","FIELD_NUMBER_OPTIONS","DELIMITER_OPTIONS","getDelimiterOption","ResultRouterForm","fieldNumber","delimiter","shouldDelimit","split_by_run_result","split_by_run_result_delimited","handleResultChanged","nodeType","non_delimited","result_select","delimited","field_number","handleFieldNumberChanged","lead_in_sub","result_select_delimited","handleDelimiterChanged","should_delimit","handleShouldDelimitChanged","renderFieldDelimited","renderField","SubflowRouterForm","params","split_by_subflow","enter_flow","setRunResult","hasFieldErrors","startFlowAction","Complete","Expired","setResultAction","info","param","param_name","param_input","handleParamChanged","onFilter","handleFilter","Methods","WaitRouterForm","wait_for_audio","wait_for_image","image","wait_for_location","wait_for_video","video","NAME_PLACEHOLDER","VALUE_PLACEHOLDER","HeaderElement","getHeader","remove_ico","handleRemove","getRemoveIco","header_name","handleChangeName","header_value","handleChangeValue","GET_METHOD","GET","METHOD_OPTIONS","POST","PUT","DELETE","HEAD","PATCH","getDefaultBody","method","isValidJson","o","WebhookRouterForm","sort","ensureEmptyHeader","oldMethod","newMethod","existingContentTypeHeader","lastHeader","removeHeader","needsHeader","handleCreateHeader","headerElements","handleHeaderRemoved","handleHeaderUpdated","body_form","req_body","handleBodyUpdate","handleMethodUpdate","handleUrlUpdate","instructions","example","CallClassifierComp","call_classifier","routes","hiddenCases","route","existingCasePosition","every","existingCase","ensureRoute","routerResultName","actionResultName","split_by_intent","ClassifyRouterForm","showTab","handleClassifierUpdated","getChannelTypeOptions","excludeFromSplit","extractSchemes","schemes","selectOptions","schemesToCases","SchemeRouterForm","split_by_scheme","orginalCases","handleSchemesChanged","TicketRouterForm","ticketer","handleTicketerUpdate","handleSubjectUpdate","handleResultNameUpdate","OpenTicketComp","SequenceForm","delayNode","days","hours","minutes","delay","delayInSeconds","actionToState","wait_for_time","delay_container","Sequence","noOfDays","noOfHours","noOfMinutes","waitForTime","typeConfigList","component","massageForDisplay","aliases","HAS_RESTHOOK","HAS_TICKETER","HAS_AIRTIME","HAS_CLASSIFIER","dedupeTypeConfigs","typeConfigMap","alias","originalType","fieldAction","channelAction","languageAction","statusAction","nameAction","aType","bType","aName","bName","lang","EMPTY_DRAG_STATE","dragStartTime","dragDownPosition","dragActive","dragNodeUUID","dragGroup","dragSelection","completionSchema","types","root","currentRevision","simulating","fetchingFlow","debug","warnings","popped","activity","segments","liveActivity","activityInterval","visible","scrollToNode","scrollToAction","editorState","UPDATE_EDITOR_STATE","markDirty","lastDirtyAttemptTimeout","postingRevision","lastDirtyMillis","lastSuccessfulMillis","NETWORK_ERROR","createSaveMonitor","setInterval","mergeEditorState","modalMessage","saving","createDirty","revisionsEndpoint","quiet","newDefinition","getCurrentDefinition","createFlowIssueMap","updatedAssets","errorMessage","changes","updateEditorState","createNewRevision","loadFlowDefinition","currentTop","guessNodeType","components","getFlowComponents","mergeAssetMaps","renderNodeMap","fetchFlow","forceSave","fetchFlowActivity","triggerActivityUpdate","handleLanguageChange","currentLanguage","isEqual","onUpdateLocalizations","newDef","normalizedTranslations","prev","updateExitDestination","disconnectExit","source","removeAction","actionIdx","getActionIndex","moveActionUp","actionAbove","handleTypeConfigChange","updateTypeConfig","resetNodeEditingState","onUpdateAction","nodeEditor","updateContactFields","onAddToNode","showAdvanced","onRemoveNodes","uuids","updatedDefinition","didNodes","didDef","onUpdateCanvasPositions","positions","updatedNodePosition","updatedStickyPosition","onConnectionDrag","sourceId","resultCount","createEmptyNode","updateSticky","onUpdateRouter","newRouterNode","previousAction","previousPosition","originalResultName","actionToSplice","topNode","bottomNode","topActions","bottomActions","onOpenNodeEditor","actionToTranslate","getLocalizations","updateTranslationFilters","translationFilters","translation_filters","activityTimeout","hasLoopSplit","hasWait","toNodeUUID","toNode","sendMsgAction","nodeMap","includeUI","renderNodes","getOrderedNodes","uiNodes","sorted","diff","suggestedResultNameCount","emptyNode","replyType","replyAction","actionType","pointerMap","groupUUID","groupsToChange","resultAction","pointers","toAdd","previousIssues","issueMap","nodeIssues","activityEndpoint","flowUUID","getActivity","CanvasDraggable","updateDimensions","clientWidth","clientHeight","nativeEvent","which","onDragStop","tagName","onDragStart","pageX","pageY","classes","onTransitionEnd","onAnimated","elementCreator","collides","fudge","getFirstCollision","changed","sortedDraggables","getOrderedDraggables","current","j","other","cascaded","setTop","newTop","Canvas","isScrolling","reflowTimeout","lastX","lastY","justSelected","onDragThrottled","onDragging","onMouseThrottled","handleMouseMove","documentElement","draggables","dragUUID","windowHeight","handleWindowResize","handleKeyDown","onLoaded","updatedPositions","drag","startX","startY","currentX","currentY","drag_selection","mutable","offset","isClickOnCanvas","draggingNew","updateStateWithScroll","clientY","updatePositions","box","collisions","getDraggablesInBox","speed","scrollBy","dimensions","pos","newPosition","markReflow","reflowPositions","newPositions","attempts","collision","cascade","cascadeTop","reflow","onUpdatePositions","doReflow","windowY","otherState","viewportHeight","clearInterval","scrollCanvas","startPosition","xd","yd","lowestNode","delta","addPosition","DRAG_THRESHOLD","getSelectedPositions","onDoubleClick","canvas_container","onMouseMove","handleMouseUpCapture","handleDoubleClick","canvas_background","canvas","newDragElement","handleAnimated","handleUpdateDimensions","handleDragStart","handleDragStop","dragOnAdd","renderSelectionBox","PureComponent","Counter","handleScrollIntoView","keepVisible","scrollTo","behavior","callback","handleMouseEvent","onMouseEnter","onMouseLeave","containerStyle","handleClick","handleMouseEnter","handleMouseLeave","countStyle","TitleBar","confirmationTimeout","confirmingRemoval","handleConfirmRemoval","showMove","up_button","onMoveUp","remove_button","showRemoval","confirmation","remove_confirm","titletext","onRemoval","getConfirmationEl","moveArrow","getMoveArrow","getRemove","titlebar","MountScroll","pulse","handleScrollCompleted","timer","innerHeight","scrollHeight","ActionWrapper","attributes","getAttribute","missingLocalization","notLocalizable","has_router","not_localizable","missing_localization","getClasses","actionToInject","getAction","titleBarClass","actionClass","first","events","handleActionClicked","handleRemoval","handleMoveUp","render","overlay","pulseAfterScroll","ConnectedActionWrapper","connect","bindActionCreators","forwardRef","DragHelper","drag_helper","arrow","tail","head","bold","getExitActivityKey","Portal","el","portalRoot","getElementById","ReactDOM","createPortal","ExitComp","hideDragHelper","pendingMessageFetch","confirmDelete","recentMessages","fetchingRecentMessages","showDragHelper","plumberMakeSource","getSourceId","handleDisconnect","plumberUpdateClass","plumberRemove","plumberConnectExit","recentsEndpoint","cancel","recents","sent","segmentCount","handleShowRecentMessages","handleHideRecentMessages","delim","hasRecents","recentStyles","recent_messages","no_recents","canvasOffset","rect","scrollX","recentMessage","moment","fromNow","nameStyle","connected","dragNodeClasses","confirm","confirm_x","onDisconnect","dragging","exitClasses","unnamed_exit","confirm_delete","getSegmentCount","getRecentMessages","ConnectedExit","EMPTY","NodeComp","firstAction","clicking","handleShouldCancelClick","parentElement","canvasBounds","plumberMakeTarget","ghostListener","getGhostListener","plumberRecalculate","getSelection","createRange","selectNodeContents","removeAllRanges","addRange","execCommand","textContent","Exit","onlyNode","startingNode","showUUIDs","handleUUIDClicked","actionList","firstRef","actionConfig","filterIssuesForAction","ActionComponent","Action","anyAction","enterAnimation","leaveAnimation","easing","addActions","save_result","save_as","add","handleAddToNode","getExits","flow_start","isStartNodeVisible","isSelected","immutable","renderDebug","flow_start_message","activeCount","onActivityClicked","cropped","exit_table","node_container","eleRef","Direction","scrollNode","scrollAction","Modal","customStyles","outline","ariaHideApp","isOpen","show","onAfterOpen","onModalOpen","onRequestClose","shouldCloseOnOverlayClick","contentLabel","NodeEditor","canceled","dragPoint","LocalizationForm","localizationProps","close","Form","formProps","handleAddAsset","mins","getMinutes","minStr","getHours","isMessage","isMT","MAP_THUMB","DrawerType","getStyleForDirection","direction","MO","msg_received","renderError","renderInfo","dangerouslySetInnerHTML","__html","renderMessage","attaches","audio_attachment","media_player","audio_text","alt","cursor","textDecoration","video_attachment","controls","msg_text","LogEvent","detailsVisible","showDetails","parts","groups_added","renderValueList","groups_removed","renderClickable","email","email_details","webhook","webhook_details","request","http_logs","renderHTTPRequest","element","step_uuid","has_detail","event_viewer","classification","extra","toFixed","entities","entity","renderClassification","MT","renderGroupsChanged","renderEmailSent","base_language","service","renderWebhook","renderLabelsAdded","actual_amount","recipient","urn","renderLogEvent","EXCLUDED_PATHS","legacy_extra","ContextExplorer","opened","messageVisible","showEmpty","openState","prevPath","navigator","clipboard","writeText","openPath","shift","closing","newPath","valueType","hasChildren","arrowStyles","arrow_right","has_children","keyStyles","keySummary","handleCopyPath","handlePathClick","key_summary","str_value","renderProperties","renderContextNode","contents","pruneEmpty","messageStyle","context_explorer","panel","empty_toggle","handleToggleHide","IMAGE_A","IMAGE_B","IMAGE_C","VIDEO_A","VIDEO_A_THUMB","Simulator","currentFlow","inputBox","drawerEle","urns","keypadEntry","drawerHeight","time","waitingForHint","drawerOpen","attachmentOptionsVisible","contextExplorerVisible","sprinting","bottomRef","inputBoxRef","activeFlow","lastExit","paths","runs","run","finalStep","step","pathCount","lastKey","flow_uuid","simulatedMessages","messages","messageFound","fromUUID","toUUID","created_on","unshift","newState","update","scrollToBottom","updateEvents","runContext","wasJustActive","toISOString","newlyRecentMessages","newEvents","drawerType","videos","images","hasQuickReplies","updateActivity","handleFocusUpdate","trigger","environment","date_format","time_format","timezone","triggered_on","simulateStart","updateRunContext","resume","resumed_on","simulateResume","startFlow","scrollIntoView","newVisible","onToggled","SIMULATOR","drawer_items","drawer_item","sendAttachment","map_thumb","audio_picker","audio_icon","audio_message","quick_reply","multiple","handleKeyPress","keypad","keypad_entry","getKeyRow","getLocationDrawer","getAudioDrawer","getImageDrawer","getVideoDrawer","getQuickRepliesDrawer","getKeypadDrawer","zIndex","paddingBottom","handleDrawerRef","drawer","drawer_visible","forced","getDrawerContents","showAttachmentDrawer","attachment_buttons","handleHideAttachments","getAttachmentButton","handleContextExplorerClose","handleHideAttachmentDrawer","String","hidden","simHidden","sim_hidden","tabHidden","tab_hidden","messagesStyle","sim_container","simulator","getContextExplorer","screen","onToggle","float","clear","onKeyUp","show_attachments_button","getAttachmentOptions","getDrawer","show_context_button","reset","inactive","onReset","simulator_tab","simulator_tab_icon","simulator_tab_text","STICKY_TITLE","STICKY_BODY","COLOR_OPTIONS","yellow","blue","green","purple","gray","Sticky","debounceTextChanges","showConfirmation","DEFUALT_TITLE","DEFUALT_BODY","finalPos","onUpdateText","handleSelectForValue","color_chooser_container","color_chooser","handleChangeColor","color_option","titleClasses","title_wrapper","removal","containerClasses","sticky_container","stickyClasses","colorChooser","getColorChooser","handleClickRemove","handleChangeTitle","onFocusCapture","handleTitleFocused","body_wrapper","handleChangeBody","handleBodyFocused","importDefaults","jsPlumb","TARGET_DEFAULTS","anchor","shape","faces","cssClass","hoverClass","dropOptions","tolerance","isTarget","dragAllowedWhenFull","deleteEndpointsOnEmpty","SOURCE_DEFAULTS","maxConnections","isSource","getAnchor","sourceEle","targetEle","defaultConnector","stub","midpoint","alwaysRespectStubs","gap","cornerRadius","Plumber","pendingConnections","pendingConnectionTimeout","animateInterval","onLoadFunction","DragOptions","DropOptions","Endpoint","EndpointStyle","strokeStyle","PaintStyle","ConnectionsDetachable","Connector","ConnectionOverlays","setSourceEnabled","makeSource","makeTarget","connectExit","setDragSelection","clearDragSelection","removeFromDragSelection","cancelDurationRepaint","handlePendingConnections","checkForPendingConnections","repaint","recalculate","updateClass","rerouteAnchors","containerId","setContainer","enabled","connection","addClass","removeClass","addToDragSelection","targets","batch","slot","totalSlots","anchors","delete","fireEvent","connector","detachable","onLoad","onEvent","recalculateOffsets","repaintEverything","unmakeSource","deleteConnectionsForElement","connections","getConnections","setAnchor","revalidate","closure","debounce","Debug","isDraggingBack","suspendedElementId","targetId","nodeContainerUUID","fe","beforeConnectionDrag","onConnectorDrop","onBeforeConnectorDrop","triggerLoaded","offsetLeft","offsetTop","dispatchEvent","Event","stickyMap","Node","handleNodeCreation","handleStickyCreation","ghostRef","nodeEditorSettings","help","empty_flow","querySelectorAll","getNodes","getStickies","getEmptyFlow","getSimulator","getNodeEditor","getDragNode","handleDragging","handleCanvasLoaded","TranslationState","LanguageSelector","handleLanguageSort","separator","language_link","handleLanguageChanged","PopTab","poppedEle","offsetWidth","onShow","onHide","pop_wrapper","tab_wrapper","handleTabClick","handlePoppedRef","handleClose","header_label","RevisionExplorer","onRevisionClicked","onRevertClicked","remoteAssets","REVISION_HISTORY","handleUpdateRevisions","mask","handleTabClicked","explorer_wrapper","explorer","selectedClass","publish","dateFormat","utc","user","getIssueKey","getRenderObjects","renderAction","IssuesTab","selectedIssue","issueDetails","buildIssueDetails","issueDetail","renderObjects","nodeDifference","ISSUES_TAB","onIssueClicked","onIssueOpened","issueCount","lastLanguage","languageHeader","handleIssueClicked","issues_code","issues_wrapper","middlewares","thunk","TranslationType","getMergedByType","bundle","COMPLETE","MISSING","findTranslations","localizable","attribute","getFriendlyAttribute","i18next","getBundleKey","TranslatorTab","selectedTranslation","translationBundles","optionsVisible","pctComplete","rules","handleUpdateTranslations","CATEGORY","CASE","translated","PROPERTY","counts","total","complete","round","bundles","TRANSLATOR_TAB","onTranslationFilterChanged","from_text","onTranslationClicked","onTranslationOpened","onChangeLanguage","showChangeButton","optionsClasses","options_visible","change_visible","filledClasses","filled","hundredpct","wrapperClasses","translations_wrapper","translate_block","handleTranslationClicked","needs_translation","type_name","renderMissing","toggleOptions","progress_bar","toggle","checkboxes","toggleCategories","toggleRules","pct_complete","changeLanguage","handleChangeLanguageClick","PageVisibility","default","hotStore","createStore","rootReducer","composeWithDevTools","applyMiddleware","FlowEditor","forceSaveOnLoad","dataStr","encodeURIComponent","downloadAnchorNode","setAttribute","downloadJSON","alert_modal","alert_body","showDownload","download_button","handleDownloadClicked","handleLanguageSetting","handleScrollToNode","handleVisibilityChanged","getFooter","getAlertModal","getSavingIndicator","handleScrollToTranslation","handleOpenTranslation","handleTabPopped","handleScrollToIssue","handleOpenIssue","ConnectedFlowEditor","FlowEditorContainer","Boolean","customElements","showFlowEditor","millis","httpTimeout","serviceWorker","registration","unregister"],"mappings":"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","file":"static/js/main.5dda9973.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"sim_container\":\"Simulator_sim_container__1D_GD\",\"simulator\":\"Simulator_simulator__kEtZB\",\"sim_hidden\":\"Simulator_sim_hidden__3DxXk\",\"screen\":\"Simulator_screen__1lSML\",\"header\":\"Simulator_header__2bryh\",\"close\":\"Simulator_close__YVDOt\",\"time\":\"Simulator_time__2Jwh3\",\"battery\":\"Simulator_battery__14sNc\",\"wifi\":\"Simulator_wifi__13hpW\",\"footer\":\"Simulator_footer__1ydh4\",\"show_context_button\":\"Simulator_show_context_button__29MfK\",\"reset\":\"Simulator_reset__1z4sX\",\"inactive\":\"Simulator_inactive__3ntWD\",\"active\":\"Simulator_active__1x5Ur\",\"messages\":\"Simulator_messages__RrW25\",\"controls\":\"Simulator_controls__3FZv1\",\"show_attachments_button\":\"Simulator_show_attachments_button__3OKcn\",\"attachment_buttons\":\"Simulator_attachment_buttons__39gAv\",\"visible\":\"Simulator_visible__20IMf\",\"drawer\":\"Simulator_drawer__14OvR\",\"drawer_visible\":\"Simulator_drawer_visible__AQaIa\",\"forced\":\"Simulator_forced__11gvJ\",\"drawer_header\":\"Simulator_drawer_header__3MvfJ\",\"map_thumb\":\"Simulator_map_thumb__1OXvJ\",\"audio_picker\":\"Simulator_audio_picker__sVxRC\",\"audio_icon\":\"Simulator_audio_icon___RIET\",\"audio_message\":\"Simulator_audio_message__1_ohW\",\"keypad\":\"Simulator_keypad__3EAQP\",\"keypad_entry\":\"Simulator_keypad_entry__3Adax\",\"keys\":\"Simulator_keys__3x3ks\",\"row\":\"Simulator_row__2XR-8\",\"key\":\"Simulator_key__1nQ7y\",\"drawer_items\":\"Simulator_drawer_items__3dpJF\",\"drawer_item\":\"Simulator_drawer_item__g_TYd\",\"simulator_tab\":\"Simulator_simulator_tab__XOhQZ\",\"tab_hidden\":\"Simulator_tab_hidden__wHSXf\",\"simulator_tab_icon\":\"Simulator_simulator_tab_icon__1irfz\",\"simulator_tab_text\":\"Simulator_simulator_tab_text__1XmbH\",\"detail_webhook_called\":\"Simulator_detail_webhook_called__ErM3O\",\"quick_replies\":\"Simulator_quick_replies__3tGue\",\"quick_reply\":\"Simulator_quick_reply__2C0zD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"hidden\":\"TranslatorTab_hidden__1m1pY\",\"message\":\"TranslatorTab_message__3oZlC\",\"header\":\"TranslatorTab_header__1ZsB0\",\"translations_wrapper\":\"TranslatorTab_translations_wrapper__1TK9m\",\"complete\":\"TranslatorTab_complete__1TOiH\",\"language\":\"TranslatorTab_language__3DTNp\",\"options\":\"TranslatorTab_options__wHcXb\",\"options_visible\":\"TranslatorTab_options_visible__1XGi8\",\"filters\":\"TranslatorTab_filters__2_tpM\",\"pct_complete\":\"TranslatorTab_pct_complete__2IEgV\",\"toggle\":\"TranslatorTab_toggle__1P-e2\",\"change_visible\":\"TranslatorTab_change_visible__1ZtKQ\",\"changeLanguage\":\"TranslatorTab_changeLanguage__1GkYy\",\"progress_bar\":\"TranslatorTab_progress_bar__2v7F_\",\"filled\":\"TranslatorTab_filled__gh95S\",\"hundredpct\":\"TranslatorTab_hundredpct__PL_5X\",\"checkboxes\":\"TranslatorTab_checkboxes__3hYnX\",\"translate_block\":\"TranslatorTab_translate_block__2uxLQ\",\"item\":\"TranslatorTab_item__3gEu5\",\"text\":\"TranslatorTab_text__37_mT\",\"from_text\":\"TranslatorTab_from_text__2EChX\",\"to_text\":\"TranslatorTab_to_text__1Ub0_\",\"needs_translation\":\"TranslatorTab_needs_translation__W6eDM\",\"type_name\":\"TranslatorTab_type_name__1AmSK\",\"attribute\":\"TranslatorTab_attribute__1ccH-\",\"translated\":\"TranslatorTab_translated__2ZTU5\",\"check\":\"TranslatorTab_check__1Bg7M\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"evt\":\"LogEvent_evt__tIthe\",\"fadein\":\"LogEvent_fadein__2RUIN\",\"msg_text\":\"LogEvent_msg_text__2HoTH\",\"ivr_msg\":\"LogEvent_ivr_msg__3Wdtx\",\"send_msg\":\"LogEvent_send_msg__2OvZW\",\"msg_received\":\"LogEvent_msg_received__3y9zX\",\"image_attachment\":\"LogEvent_image_attachment__2pKYG\",\"error\":\"LogEvent_error__4fEAj\",\"info\":\"LogEvent_info__Zgy5W\",\"email\":\"LogEvent_email__1a0Xu\",\"webhook\":\"LogEvent_webhook__FZKey\",\"video_attachment\":\"LogEvent_video_attachment__UNrkk\",\"audio_attachment\":\"LogEvent_audio_attachment__3NyTY\",\"media_player\":\"LogEvent_media_player__3NUR4\",\"audio_text\":\"LogEvent_audio_text__14DX0\",\"email_details\":\"LogEvent_email_details__1i4Ke\",\"to\":\"LogEvent_to__2NvWB\",\"subject\":\"LogEvent_subject__1cLs9\",\"body\":\"LogEvent_body__Y5A0W\",\"webhook_details\":\"LogEvent_webhook_details__skSfT\",\"response\":\"LogEvent_response__zb4-P\",\"event_viewer\":\"LogEvent_event_viewer__1p37S\",\"has_detail\":\"LogEvent_has_detail__35YwE\",\"classification\":\"LogEvent_classification__3YX1u\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"clickable\":\"Dialog_clickable__2aUJd\",\"dialog\":\"Dialog_dialog__3y_m2\",\"header\":\"Dialog_header__iHzkL\",\"header_overlay\":\"Dialog_header_overlay__3U51b\",\"header_icon\":\"Dialog_header_icon__3vLaW\",\"title\":\"Dialog_title__3OCJF\",\"barber\":\"Dialog_barber__2OWIB\",\"iconed\":\"Dialog_iconed__18cM2\",\"title_container\":\"Dialog_title_container__2DAvE\",\"content\":\"Dialog_content__2rdNS\",\"footer\":\"Dialog_footer__kLQRy\",\"gutter\":\"Dialog_gutter__2w_nY\",\"buttons\":\"Dialog_buttons__2Cxoo\",\"left_buttons\":\"Dialog_left_buttons__-KwMO\",\"right_buttons\":\"Dialog_right_buttons__1BWU8\",\"tabs\":\"Dialog_tabs__D_yah\",\"tab\":\"Dialog_tab__1z0S1\",\"tab_icon\":\"Dialog_tab_icon__16ScL\",\"active\":\"Dialog_active__2CXgg\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"action\":\"Action_action__2E2Hi\",\"has_router\":\"Action_has_router__340x_\",\"body\":\"Action_body__2RsfN\",\"add_contact_urn\":\"Action_add_contact_urn__1_EWr\",\"add_input_labels\":\"Action_add_input_labels__VsRua\",\"send_msg\":\"Action_send_msg__26N5Z\",\"set_contact_field\":\"Action_set_contact_field__3Fri3\",\"set_contact_name\":\"Action_set_contact_name__36Bip\",\"call_webhook\":\"Action_call_webhook__1WmcL\",\"call_resthook\":\"Action_call_resthook__rq5oG\",\"set_contact_language\":\"Action_set_contact_language__3xcjV\",\"set_contact_status\":\"Action_set_contact_status__3ETpp\",\"set_contact_channel\":\"Action_set_contact_channel__2_fqG\",\"add_contact_groups\":\"Action_add_contact_groups__1-tlV\",\"remove_contact_groups\":\"Action_remove_contact_groups__31Lu0\",\"play_audio\":\"Action_play_audio__14tqv\",\"say_msg\":\"Action_say_msg__2EYDG\",\"set_run_result\":\"Action_set_run_result__30dh5\",\"send_email\":\"Action_send_email__1-fQ8\",\"send_broadcast\":\"Action_send_broadcast__2mFMp\",\"transfer_airtime\":\"Action_transfer_airtime__3Q1dZ\",\"open_ticket\":\"Action_open_ticket__2m0as\",\"missing\":\"Action_missing__29LHL\",\"wait_for_time\":\"Action_wait_for_time__1aHyq\",\"enter_flow\":\"Action_enter_flow__3yfvy\",\"call_classifier\":\"Action_call_classifier__2PBp1\",\"start_session\":\"Action_start_session__35L38\",\"not_localizable\":\"Action_not_localizable__6Cji0\",\"overlay\":\"Action_overlay__2E3Fi\",\"immutable\":\"Action_immutable__1VNFT\",\"translate_from\":\"Action_translate_from__dt3Nq\",\"translate_to\":\"Action_translate_to__2l1ON\",\"translating\":\"Action_translating__s_a2X\",\"missing_localization\":\"Action_missing_localization__19FkT\",\"localized\":\"Action_localized__2t0df\",\"url_attachment\":\"Action_url_attachment__3CkWj\",\"remove_upload\":\"Action_remove_upload__hfPYT\",\"url\":\"Action_url__1hlRc\",\"remove\":\"Action_remove__1Dxgt\",\"type_choice\":\"Action_type_choice__1Z7oL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"exit\":\"Exit_exit__MDgVO\",\"translating\":\"Exit_translating__1mOk6\",\"unnamed_exit\":\"Exit_unnamed_exit__16ZHq\",\"endpoint\":\"Exit_endpoint__2Vw_f\",\"missing_localization\":\"Exit_missing_localization__3IEyT\",\"name\":\"Exit_name__T5cCt\",\"confirm_delete\":\"Exit_confirm_delete__o-TLV\",\"activity\":\"Exit_activity__6C9cy\",\"count\":\"Exit_count__s0UjM\",\"confirm_x\":\"Exit_confirm_x__3KI2x\",\"recent_messages\":\"Exit_recent_messages__3J4yC\",\"no_recents\":\"Exit_no_recents__gUpqP\",\"title\":\"Exit_title__Ul7sI\",\"loading\":\"Exit_loading__1TN0z\",\"message\":\"Exit_message__1iCEA\",\"text\":\"Exit_text__1n05R\",\"sent\":\"Exit_sent__3hHqL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"context_explorer\":\"ContextExplorer_context_explorer__38YL_\",\"visible\":\"ContextExplorer_visible__2Jary\",\"panel\":\"ContextExplorer_panel__2B090\",\"close_button\":\"ContextExplorer_close_button__3MXAk\",\"row\":\"ContextExplorer_row__F_O0e\",\"arrow_right\":\"ContextExplorer_arrow_right__2Ni6a\",\"has_children\":\"ContextExplorer_has_children__31qWV\",\"open\":\"ContextExplorer_open__2uS-W\",\"key\":\"ContextExplorer_key__1Mo4R\",\"clipboard\":\"ContextExplorer_clipboard__3olmn\",\"key_summary\":\"ContextExplorer_key_summary__GBJkL\",\"colon\":\"ContextExplorer_colon__2fJn7\",\"str_value\":\"ContextExplorer_str_value__3X2a-\",\"footer\":\"ContextExplorer_footer__2Spg6\",\"hide_checkbox\":\"ContextExplorer_hide_checkbox__zOg0w\",\"help\":\"ContextExplorer_help__3Dwyu\",\"empty_toggle\":\"ContextExplorer_empty_toggle__u_GVz\",\"message\":\"ContextExplorer_message__UhbrC\",\"expression\":\"ContextExplorer_expression__2LeFf\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"yellow\":\"Sticky_yellow__RrMi9\",\"color_option\":\"Sticky_color_option__3Kpg1\",\"sticky\":\"Sticky_sticky__zfZcS\",\"blue\":\"Sticky_blue__2bMet\",\"purple\":\"Sticky_purple__2zA18\",\"gray\":\"Sticky_gray__2hcrw\",\"green\":\"Sticky_green__1FN9Z\",\"color_chooser_container\":\"Sticky_color_chooser_container__244aX\",\"color_chooser\":\"Sticky_color_chooser__18dts\",\"sticky_container\":\"Sticky_sticky_container__rfntK\",\"selected\":\"Sticky_selected__2B9bW\",\"removal\":\"Sticky_removal__zyJuc\",\"title_wrapper\":\"Sticky_title_wrapper__3KICL\",\"remove_button\":\"Sticky_remove_button__H_zJ-\",\"title\":\"Sticky_title__37d_3\",\"confirmation\":\"Sticky_confirmation__2CCkS\",\"body_wrapper\":\"Sticky_body_wrapper__1Wb_h\",\"body\":\"Sticky_body__3-6Y6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"node_container\":\"Node_node_container__2mwml\",\"uuid\":\"Node_uuid__2Kkq7\",\"ghost\":\"Node_ghost__3XNeP\",\"nondragged\":\"Node_nondragged__aKbzT\",\"selected\":\"Node_selected__15xET\",\"node\":\"Node_node__3REeD\",\"immutable\":\"Node_immutable__ko4fJ\",\"save_as\":\"Node_save_as__lDgdg\",\"save_result\":\"Node_save_result__2YT-E\",\"result_name\":\"Node_result_name__7nMjt\",\"cropped\":\"Node_cropped__3Sprl\",\"exit_table\":\"Node_exit_table__1owtC\",\"exits\":\"Node_exits__2pUbU\",\"add\":\"Node_add__1rUvZ\",\"drag_group\":\"Node_drag_group__1L9gN\",\"flow_start\":\"Node_flow_start__vIfWK\",\"flow_start_message\":\"Node_flow_start_message__Vtmjx\",\"active\":\"Node_active__REKWO\",\"pulse\":\"Node_pulse__nmh6I\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"random\":\"shared_random__2R2Xi\",\"issues\":\"shared_issues__kV6-y\",\"header\":\"shared_header__3-0eg\",\"icon\":\"shared_icon__2JqsG\",\"title\":\"shared_title__1XGj9\",\"summary\":\"shared_summary__3B2nd\",\"issue_help\":\"shared_issue_help__2iSqj\",\"wait_for_audio\":\"shared_wait_for_audio__1QZqK\",\"wait_for_image\":\"shared_wait_for_image__1EY_1\",\"wait_for_video\":\"shared_wait_for_video__2IsqV\",\"wait_for_location\":\"shared_wait_for_location__1Vwqb\",\"wait_for_menu\":\"shared_wait_for_menu__2psku\",\"wait_for_digits\":\"shared_wait_for_digits__hXjTa\",\"wait_for_response\":\"shared_wait_for_response__27CpV\",\"wait_for_time\":\"shared_wait_for_time__3Ah-2\",\"add_contact_groups\":\"shared_add_contact_groups__9UCYb\",\"remove_contact_groups\":\"shared_remove_contact_groups__3csOA\",\"send_email\":\"shared_send_email__3nx2e\",\"send_broadcast\":\"shared_send_broadcast__1zl2w\",\"msg\":\"shared_msg__1O5N7\",\"say_msg\":\"shared_say_msg__10JKX\",\"send_msg\":\"shared_send_msg__1KKsV\",\"open_ticket\":\"shared_open_ticket__2zgQX\",\"transfer_airtime\":\"shared_transfer_airtime__4QsU9\",\"enter_flow\":\"shared_enter_flow__2ttWY\",\"start_session\":\"shared_start_session__2cr_u\",\"set_run_result\":\"shared_set_run_result__2vBio\",\"add_input_labels\":\"shared_add_input_labels__1bud0\",\"add_contact_urn\":\"shared_add_contact_urn__2tiCA\",\"set_contact_name\":\"shared_set_contact_name__AtzcN\",\"set_contact_field\":\"shared_set_contact_field__2DEDn\",\"set_contact_language\":\"shared_set_contact_language__3-PNy\",\"set_contact_status\":\"shared_set_contact_status__O3Hxt\",\"set_contact_channel\":\"shared_set_contact_channel__242ms\",\"play_audio\":\"shared_play_audio__2NOUa\",\"missing\":\"shared_missing__rxcv1\",\"missing_asset\":\"shared_missing_asset__fgen3\",\"call_classifier\":\"shared_call_classifier__1bKDV\",\"split_by_random\":\"shared_split_by_random__3VFjv\",\"split_by_expression\":\"shared_split_by_expression__116pK\",\"split_by_groups\":\"shared_split_by_groups__1UTuu\",\"split_by_contact_field\":\"shared_split_by_contact_field__3kuF2\",\"split_by_intent\":\"shared_split_by_intent__298Xs\",\"split_by_run_result\":\"shared_split_by_run_result__brpbX\",\"split_by_scheme\":\"shared_split_by_scheme__4m2qu\",\"call_resthook\":\"shared_call_resthook__szySJ\",\"call_webhook\":\"shared_call_webhook__3KNCR\",\"breaks\":\"shared_breaks__wHkaC\",\"url\":\"shared_url__LCNlk\",\"node_asset\":\"shared_node_asset__PTZig\",\"node_group\":\"shared_node_group__U53bi\",\"node_label\":\"shared_node_label__2vl9I\",\"advanced_title\":\"shared_advanced_title__2Jboh\",\"alert\":\"shared_alert__1cTM-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"group\":\"CaseElement_group__yDNNX\",\"divider\":\"CaseElement_divider__1mWEr\",\"kase\":\"CaseElement_kase__35-mt\",\"has_intent\":\"CaseElement_has_intent__3HnI7\",\"choice\":\"CaseElement_choice__21FMn\",\"has_top_intent\":\"CaseElement_has_top_intent__3ONDp\",\"multi_operand\":\"CaseElement_multi_operand__2azHo\",\"form_group\":\"CaseElement_form_group__1rUOs\",\"single_operand\":\"CaseElement_single_operand__1v7Xs\",\"categorize_as\":\"CaseElement_categorize_as__2W1k6\",\"category\":\"CaseElement_category__3ZaaR\",\"remove_icon\":\"CaseElement_remove_icon__3LZFx\",\"dnd_icon\":\"CaseElement_dnd_icon__2co_h\",\"relative_date\":\"CaseElement_relative_date__1zVx0\",\"empty\":\"CaseElement_empty__3QCAW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"hidden\":\"RevisionExplorer_hidden__7MGLA\",\"mask\":\"RevisionExplorer_mask__2ycoo\",\"visible\":\"RevisionExplorer_visible__17zGw\",\"explorer_wrapper\":\"RevisionExplorer_explorer_wrapper__tXuwp\",\"explorer\":\"RevisionExplorer_explorer__1bH3g\",\"revisions\":\"RevisionExplorer_revisions__2WBJK\",\"revision\":\"RevisionExplorer_revision__2Sd7q\",\"selected\":\"RevisionExplorer_selected__GMnWd\",\"button\":\"RevisionExplorer_button__1IK1I\",\"current\":\"RevisionExplorer_current__1YF_0\",\"publish\":\"RevisionExplorer_publish__axXGE\",\"created_on\":\"RevisionExplorer_created_on__281Kh\",\"email\":\"RevisionExplorer_email__1ZzGd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"checkbox\":\"SendMsgForm_checkbox__1Tsii\",\"quick_reply_summary\":\"SendMsgForm_quick_reply_summary__2YjSD\",\"type_choice\":\"SendMsgForm_type_choice__3OyLK\",\"loading\":\"SendMsgForm_loading__1ibK4\",\"crossIcon\":\"SendMsgForm_crossIcon__1Y_Og\",\"error\":\"SendMsgForm_error__3Q5sT\",\"url_attachment\":\"SendMsgForm_url_attachment__1f5BY\",\"remove_upload\":\"SendMsgForm_remove_upload__1lR5m\",\"url\":\"SendMsgForm_url__2zWTn\",\"remove\":\"SendMsgForm_remove__3cUZO\",\"existing_quick_replies\":\"SendMsgForm_existing_quick_replies__M_8bP\",\"existing_quick_reply\":\"SendMsgForm_existing_quick_reply__3EvPl\",\"add_quick_replies\":\"SendMsgForm_add_quick_replies__PRjC-\",\"template_text\":\"SendMsgForm_template_text__3Os91\",\"variable\":\"SendMsgForm_variable__3HnNS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"link\":\"WebhookRouterForm_link__a11lC\",\"info\":\"WebhookRouterForm_info__4Xx0y\",\"method\":\"WebhookRouterForm_method__fHBr6\",\"url\":\"WebhookRouterForm_url__3_2An\",\"code\":\"WebhookRouterForm_code__2IFVL\",\"instructions\":\"WebhookRouterForm_instructions__26ZII\",\"headers_title\":\"WebhookRouterForm_headers_title__VURaC\",\"remove_ico\":\"WebhookRouterForm_remove_ico__2PcK5\",\"example\":\"WebhookRouterForm_example__bfAmo\",\"header\":\"WebhookRouterForm_header__4Hx2E\",\"header_name\":\"WebhookRouterForm_header_name__1wNx_\",\"header_value\":\"WebhookRouterForm_header_value__1dySu\",\"body_form\":\"WebhookRouterForm_body_form__140k6\",\"req_body\":\"WebhookRouterForm_req_body__2qNy9\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"delimited\":\"ResultRouterForm_delimited__16hRV\",\"non_delimited\":\"ResultRouterForm_non_delimited__Zl1bc\",\"lead_in_sub\":\"ResultRouterForm_lead_in_sub__2hU7C\",\"result_select\":\"ResultRouterForm_result_select__2uGT9\",\"result_select_delimited\":\"ResultRouterForm_result_select_delimited__1sBq_\",\"should_delimit\":\"ResultRouterForm_should_delimit__1zZeV\",\"field_number\":\"ResultRouterForm_field_number__1BNBn\",\"delimiter\":\"ResultRouterForm_delimiter__nltmQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"titlebar\":\"TitleBar_titlebar__3lr-P\",\"titletext\":\"TitleBar_titletext__Ai9Rr\",\"normal\":\"TitleBar_normal__1ZLMg\",\"remove_confirm\":\"TitleBar_remove_confirm__3q2Bc\",\"remove_button\":\"TitleBar_remove_button__15dJ5\",\"up_button\":\"TitleBar_up_button__eImp0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"pop_wrapper\":\"PopTab_pop_wrapper__1-OeQ\",\"visible\":\"PopTab_visible__7DKuZ\",\"popped\":\"PopTab_popped__3Be3Z\",\"tab_wrapper\":\"PopTab_tab_wrapper__QtDPH\",\"tab\":\"PopTab_tab__2ub34\",\"label\":\"PopTab_label__3PEkD\",\"icon\":\"PopTab_icon__11cte\",\"header\":\"PopTab_header__3dzGD\",\"header_label\":\"PopTab_header_label__3G6Fe\",\"close\":\"PopTab_close__3tjZX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"ele\":\"FormElement_ele__3p0RX\",\"border\":\"FormElement_border__Sg-QR\",\"error_list\":\"FormElement_error_list__Dr7I4\",\"error\":\"FormElement_error__253GK\",\"arrow_up\":\"FormElement_arrow_up__3MxzJ\",\"send_msg_error\":\"FormElement_send_msg_error__48ZlU\",\"label\":\"FormElement_label__256qc\",\"invalid\":\"FormElement_invalid__1izKE\",\"help_text\":\"FormElement_help_text__2sROe\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"hidden\":\"IssuesTab_hidden__1lAeb\",\"message\":\"IssuesTab_message__1-rjr\",\"header\":\"IssuesTab_header__37ESt\",\"issues_wrapper\":\"IssuesTab_issues_wrapper__2tqVF\",\"language\":\"IssuesTab_language__15YSY\",\"mask\":\"IssuesTab_mask__udMS7\",\"visible\":\"IssuesTab_visible__1AVPn\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"template_text\":\"SendBroadcastForm_template_text__3v1Q1\",\"variable\":\"SendBroadcastForm_variable__2EeMG\",\"crossIcon\":\"SendBroadcastForm_crossIcon__1z0GN\",\"error\":\"SendBroadcastForm_error__1HE-N\",\"url_attachment\":\"SendBroadcastForm_url_attachment__3kaZb\",\"remove_upload\":\"SendBroadcastForm_remove_upload__1Y_j3\",\"url\":\"SendBroadcastForm_url__16Lwe\",\"remove\":\"SendBroadcastForm_remove__3dc8z\",\"type_choice\":\"SendBroadcastForm_type_choice__3uH0s\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"quick_replies\":\"SendMsg_quick_replies__282pQ\",\"attachment\":\"SendMsg_attachment__1z2Cb\",\"summary\":\"SendMsg_summary__YnqI1\",\"whatsapp\":\"SendMsg_whatsapp__3ZIia\",\"facebook\":\"SendMsg_facebook__30M-Y\",\"line\":\"SendMsg_line__4QAhs\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"title\":\"SequenceForm_title__3qBoX\",\"delay_container\":\"SequenceForm_delay_container__3cwZg\",\"input\":\"SequenceForm_input__iY2O3\",\"error\":\"SequenceForm_error__2sEzO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"player\":\"MediaPlayer_player__3yZ8V\",\"playing\":\"MediaPlayer_playing__3tBdb\",\"button\":\"MediaPlayer_button__bCgjE\",\"circles\":\"MediaPlayer_circles__2bdkI\",\"circle_background\":\"MediaPlayer_circle_background__2WdQu\",\"circle_foreground\":\"MediaPlayer_circle_foreground__2TlEZ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"recipients\":\"SendBroadcast_recipients__2bZnO\",\"attachment\":\"SendBroadcast_attachment__3bs-w\",\"whatsapp\":\"SendBroadcast_whatsapp__1HhwD\",\"node\":\"SendBroadcast_node__2_CTl\",\"to\":\"SendBroadcast_to__3DJCo\",\"name\":\"SendBroadcast_name__gjS6r\",\"icon\":\"SendBroadcast_icon__1wUdB\",\"more\":\"SendBroadcast_more__3fAEP\",\"message\":\"SendBroadcast_message__2SsEV\",\"icons\":\"SendBroadcast_icons__2dWxB\",\"line\":\"SendBroadcast_line__2rWNv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"translating_categories\":\"RouterLocalizationForm_translating_categories__H4XH6\",\"translating_category\":\"RouterLocalizationForm_translating_category__3-dYz\",\"translating_from\":\"RouterLocalizationForm_translating_from__3AcCU\",\"translating_to\":\"RouterLocalizationForm_translating_to__7Xskh\",\"translating_operator_title\":\"RouterLocalizationForm_translating_operator_title__1P6TH\",\"translating_operator_instructions\":\"RouterLocalizationForm_translating_operator_instructions__FEGKg\",\"translating_operator_container\":\"RouterLocalizationForm_translating_operator_container__3PKT_\",\"translating_operator\":\"RouterLocalizationForm_translating_operator__3bk0_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"drag_helper\":\"DragHelper_drag_helper__28Ay7\",\"visible\":\"DragHelper_visible__2X9kV\",\"arrow\":\"DragHelper_arrow__24gl9\",\"tail\":\"DragHelper_tail__3VpIi\",\"help_text\":\"DragHelper_help_text__2b3FP\",\"head\":\"DragHelper_head__1c9O5\",\"bold\":\"DragHelper_bold__2B5h-\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"editor\":\"components_editor__o13TO\",\"translating\":\"components_translating__vJZzb\",\"footer\":\"components_footer__gNxPa\",\"download_button\":\"components_download_button__2Y-VI\",\"alert_body\":\"components_alert_body__Ln7L8\",\"alert_modal\":\"components_alert_modal__2-LWm\",\"saving\":\"components_saving__3zjxk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"label\":\"CheckboxElement_label__j4UjX\",\"title\":\"CheckboxElement_title__3TOaH\",\"description\":\"CheckboxElement_description__SaEXo\",\"description_solo\":\"CheckboxElement_description_solo__2-Ugv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"form_element\":\"CurrencyElement_form_element__3CYA7\",\"transfer\":\"CurrencyElement_transfer__1GPGT\",\"currency\":\"CurrencyElement_currency__35han\",\"amount\":\"CurrencyElement_amount__XtmgS\",\"remove\":\"CurrencyElement_remove__3APVy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"options\":\"RandomRouterForm_options__2fIR-\",\"bucket_select\":\"RandomRouterForm_bucket_select__t1CEn\",\"bucket_list\":\"RandomRouterForm_bucket_list__RtNgs\",\"bucket_name\":\"RandomRouterForm_bucket_name__3trj0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"params\":\"SubflowRouterForm_params__310u_\",\"param\":\"SubflowRouterForm_param__3RbZE\",\"param_name\":\"SubflowRouterForm_param_name__3Nf-g\",\"param_input\":\"SubflowRouterForm_param_input__1_RDM\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"btn\":\"Button_btn__NrY-I\",\"disabled\":\"Button_disabled__1a-Ww\",\"primary\":\"Button_primary__3Xkl9\",\"active\":\"Button_active__2r_SA\",\"secondary\":\"Button_secondary__39XWk\",\"tertiary\":\"Button_tertiary__1b1CD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"pill\":\"Pill_pill__3zR1n\",\"clickable\":\"Pill_clickable__3Kiux\",\"icon\":\"Pill_icon__2I3Bm\",\"large\":\"Pill_large__1mzK4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"case_list_container\":\"CaseList_case_list_container__v_N81\",\"scrolling\":\"CaseList_scrolling__1KJ6k\",\"case_list\":\"CaseList_case_list__2iw-5\",\"kase\":\"CaseList_kase__1aOlI\",\"dnd_icon\":\"CaseList_dnd_icon__Snssi\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"lead_in\":\"MenuRouterForm_lead_in__1sVvD\",\"digit\":\"MenuRouterForm_digit__34KZA\",\"category\":\"MenuRouterForm_category__3a2ID\",\"menu\":\"MenuRouterForm_menu__2TOFV\",\"menu_option\":\"MenuRouterForm_menu_option__1pN2J\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"timeout_control_container\":\"TimeoutControl_timeout_control_container__14tH3\",\"left_section\":\"TimeoutControl_left_section__3o1Ez\",\"label\":\"TimeoutControl_label__3X3Dc\",\"checkbox\":\"TimeoutControl_checkbox__11cwW\",\"drop_down\":\"TimeoutControl_drop_down__3S8X_\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"canvas_container\":\"Canvas_canvas_container__2K6Qq\",\"canvas_background\":\"Canvas_canvas_background__1Z3_x\",\"canvas\":\"Canvas_canvas__3HVE6\",\"drag_selection\":\"Canvas_drag_selection__1rUVg\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"language\":\"LanguageSelector_language__BprSZ\",\"language_link\":\"LanguageSelector_language_link__3t4co\",\"active\":\"LanguageSelector_active__3gFNS\",\"separator\":\"LanguageSelector_separator__3ypfv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"ele\":\"SendEmailForm_ele__113fm\",\"subject\":\"SendEmailForm_subject__2Z5GO\",\"message\":\"SendEmailForm_message__pPtlE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"form\":\"SetRunResultForm_form__2gyx0\",\"name\":\"SetRunResultForm_name__3WQJs\",\"value\":\"SetRunResultForm_value__c_2FO\",\"category\":\"SetRunResultForm_category__n5-uq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"node\":\"StartSession_node__1A6NT\",\"to\":\"StartSession_to__1R4tw\",\"name\":\"StartSession_name__teDrE\",\"icon\":\"StartSession_icon__1XIcW\",\"more\":\"StartSession_more__1bDR4\",\"message\":\"StartSession_message__2CfcH\",\"flow\":\"StartSession_flow__2h3dI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"counter\":\"Counter_counter__JqA-T\",\"visible\":\"Counter_visible__1Ds8g\",\"clickable\":\"Counter_clickable__3t4EI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"MountScroll_wrapper__1Xxtr\",\"pulse\":\"MountScroll_pulse__1ING3\",\"pulse_animation\":\"MountScroll_pulse_animation__2BqRD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"small\":\"TembaSelect_small__2PJq3\",\"normal\":\"TembaSelect_normal__3QsiC\",\"error\":\"TembaSelect_error__3vVib\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"small\":\"TextInputElement_small__2sfbz\",\"option_list\":\"TextInputElement_option_list__3LifC\",\"option_summary\":\"TextInputElement_option_summary__1aEs9\",\"option_signature\":\"TextInputElement_option_signature__3jYa9\",\"option\":\"TextInputElement_option__2Rfie\",\"selected\":\"TextInputElement_selected__39avz\",\"first_option\":\"TextInputElement_first_option__21kfK\",\"fn_marker\":\"TextInputElement_fn_marker__2nkzw\",\"function_help\":\"TextInputElement_function_help__3xl67\",\"completion_container\":\"TextInputElement_completion_container__1TQ9B\",\"options_wrapper\":\"TextInputElement_options_wrapper__1Uu63\",\"fn_container\":\"TextInputElement_fn_container__3zm4M\",\"option_name\":\"TextInputElement_option_name__3xUbo\",\"option_examples\":\"TextInputElement_option_examples__1-4mX\",\"example_header\":\"TextInputElement_example_header__pA_P2\",\"example\":\"TextInputElement_example__3dz4l\",\"fn_signature\":\"TextInputElement_fn_signature__1eZSt\",\"wrapper\":\"TextInputElement_wrapper__3geX7\",\"help\":\"TextInputElement_help__2KT-W\",\"hidden\":\"TextInputElement_hidden__1Tq4g\",\"textinput\":\"TextInputElement_textinput__W6OgR\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"scheme_selection\":\"AddURNForm_scheme_selection__CKqeg\",\"path\":\"AddURNForm_path__sK_hj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"text\":\"SayMsg_text__bGcCX\",\"recording\":\"SayMsg_recording__SF7Tp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"code\":\"TransferAirtime_code__31YJy\",\"amount\":\"TransferAirtime_amount__1_wgI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"optional_text_input\":\"OptionalTextInput_optional_text_input__Lus8a\",\"toggle_link\":\"OptionalTextInput_toggle_link__1MriU\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"errors\":\"ValidationFailures_errors__33ris\",\"error\":\"ValidationFailures_error__1swpJ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"lead_in\":\"FieldRouterForm_lead_in__1Mm8O\",\"field_select\":\"FieldRouterForm_field_select__WjcN6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"subject\":\"TicketRouterForm_subject__28Anf\",\"body\":\"TicketRouterForm_body__1gUsm\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"draggable\":\"CanvasDraggable_draggable__2iMHV\",\"selected\":\"CanvasDraggable_selected__2D7Um\"};","module.exports = __webpack_public_path__ + \"static/media/map.5e547148.jpg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"message\":\"AssetSelector_message__apuzj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"type_list\":\"TypeList_type_list__2DdD1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"checkbox\":\"RemoveGroupsForm_checkbox__2nMpd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"loading\":\"Loading_loading__1obkW\",\"pulse\":\"Loading_pulse__25SOz\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"value\":\"UpdateContactForm_value__1aUdX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"result_name\":\"AirtimeRouterForm_result_name__3mOy1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"lead_in\":\"DigitsRouterForm_lead_in__awX5b\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"result_name\":\"ResthookRouterForm_result_name__1yNY7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"result_name\":\"WaitRouterForm_result_name__1IqZA\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"link\":\"ClassifyRouterForm_link__192g4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"empty_flow\":\"Flow_empty_flow__3YkaY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"grid_size\":\"20\",\"node_spacing\":\"13\",\"node_padding\":\"3\",\"background-size\":\"13\",\"proper\":\"global_proper__Tu4Dq\"};","import { Attachment } from 'components/flow/actions/sendmsg/SendMsgForm';\nimport { Methods } from 'components/flow/routers/webhook/helpers';\nimport { FlowTypes, Operators, Types, ContactStatus } from 'config/interfaces';\n\n// we don't concern ourselves with patch versions\nexport const SPEC_VERSION = '13.1';\n\nexport interface Languages {\n  [iso: string]: string;\n}\n\nexport interface Language {\n  name: string;\n  iso: string;\n}\n\nexport interface Environment {\n  date_format: string;\n  time_format: string;\n  timezone: string;\n  languages: string[];\n}\n\nexport interface Endpoints {\n  attachments: string;\n  resthooks: string;\n  recents: string;\n  fields: string;\n  globals: string;\n  groups: string;\n  recipients: string;\n  flows: string;\n  revisions: string;\n  activity: string;\n  labels: string;\n  channels: string;\n  classifiers: string;\n  ticketers: string;\n  environment: string;\n  languages: string;\n  templates: string;\n  completion: string;\n  functions: string;\n  simulateStart: string;\n  simulateResume: string;\n  editor: string;\n  validateMedia: string;\n}\n\nexport interface FlowEditorConfig {\n  localStorage: boolean;\n  endpoints: Endpoints;\n  flow: string;\n  flowType: FlowTypes;\n  showTemplates?: boolean;\n  showDownload?: boolean;\n  mutable?: boolean;\n  debug?: boolean;\n  path?: string;\n  headers?: any;\n  onLoad?: () => void;\n  onActivityClicked?: (uuid: string) => void;\n  onChangeLanguage?: (code: string, name: string) => void;\n\n  // help links\n  help: { [key: string]: string };\n\n  // whether to force a save on load\n  forceSaveOnLoad?: boolean;\n\n  filters?: string[];\n\n  excludeTypes?: string[];\n\n  excludeOperators?: string[];\n}\n\nexport interface LocalizationMap {\n  [lang: string]: {\n    [uuid: string]: any;\n  };\n}\n\nexport interface Result {\n  key: string;\n  name: string;\n  categories: string[];\n  node_uuids: string[];\n}\n\nexport enum DependencyType {\n  channel = 'channel',\n  classifier = 'classifier',\n  contact = 'contact',\n  field = 'field',\n  flow = 'flow',\n  group = 'group',\n  label = 'label',\n  template = 'template'\n}\n\nexport interface Dependency {\n  uuid?: string;\n  key?: string;\n  name: string;\n  type: DependencyType;\n  missing?: boolean;\n  nodes: { [uuid: string]: string[] };\n}\n\nexport interface FlowMetadata {\n  dependencies: Dependency[];\n  waiting_exit_uuids: string[];\n  results: Result[];\n  parent_refs: string[];\n  issues: FlowIssue[];\n}\n\nexport enum FlowIssueType {\n  MISSING_DEPENDENCY = 'missing_dependency',\n  LEGACY_EXTRA = 'legacy_extra',\n  INVALID_REGEX = 'invalid_regex'\n}\n\nexport interface FlowIssue {\n  type: FlowIssueType;\n  node_uuid: string;\n  action_uuid: string;\n  description: string;\n  dependency?: Dependency;\n  language?: string;\n  regex?: string;\n}\n\nexport interface FlowDetails {\n  definition: FlowDefinition;\n  metadata: FlowMetadata;\n}\n\nexport interface FlowDefinition {\n  localization: LocalizationMap;\n  language: string;\n  name: string;\n  nodes: FlowNode[];\n  uuid: string;\n  revision: number;\n  spec_version: string;\n  _ui: UIMetaData;\n}\n\nexport interface FlowNode {\n  uuid: string;\n  actions: Action[];\n  exits: Exit[];\n  router?: Router;\n}\n\nexport interface Exit {\n  uuid: string;\n  destination_uuid?: string;\n}\n\nexport enum RouterTypes {\n  switch = 'switch',\n  random = 'random'\n}\n\nexport interface Router {\n  type: RouterTypes;\n  result_name?: string;\n  categories: Category[];\n  wait?: Wait;\n}\n\nexport interface Channel {\n  uuid: string;\n  name: string;\n}\n\nexport interface Case {\n  uuid: string;\n  type: Operators;\n  category_uuid: string;\n  arguments?: string[];\n  omit_operand?: boolean;\n}\n\nexport interface Category {\n  uuid: string;\n  name: string;\n  exit_uuid: string;\n}\n\nexport interface TemplateTranslation {\n  language: string;\n  status: string;\n  content: string;\n}\n\nexport interface Template {\n  created_on: Date;\n  modified_on: Date;\n  translations: TemplateTranslation[];\n}\n\nexport interface SwitchRouter extends Router {\n  cases: Case[];\n  operand: string;\n  default_category_uuid: string;\n}\n\nexport enum WaitTypes {\n  msg = 'msg'\n}\n\nexport enum HintTypes {\n  digits = 'digits',\n  audio = 'audio',\n  image = 'image',\n  video = 'video',\n  location = 'location'\n}\n\nexport interface Hint {\n  type: HintTypes;\n  count?: number;\n}\n\nexport interface Timeout {\n  category_uuid: string;\n  seconds: number;\n}\n\nexport interface Wait {\n  type: WaitTypes;\n  timeout?: Timeout;\n  hint?: Hint;\n}\n\nexport interface Group {\n  uuid?: string;\n  name?: string;\n  name_match?: string;\n}\n\nexport interface Contact {\n  uuid: string;\n  name: string;\n}\n\nexport interface ChangeGroups extends Action {\n  groups: Group[];\n}\n\nexport interface RemoveFromGroups extends ChangeGroups {\n  all_groups: boolean;\n}\n\nexport interface Field {\n  key: string;\n  name: string;\n}\n\nexport interface Label {\n  uuid: string;\n  name: string;\n}\n\nexport interface Flow {\n  uuid: string;\n  name: string;\n}\n\nexport interface Action {\n  type: Types;\n  uuid: string;\n}\n\nexport interface SetContactField extends Action {\n  field: Field;\n  value: string;\n}\n\nexport interface SetContactName extends Action {\n  type: Types.set_contact_name;\n  name: string;\n}\n\nexport interface SetContactLanguage extends Action {\n  type: Types.set_contact_language;\n  language: string;\n}\n\nexport interface SetContactChannel extends Action {\n  type: Types.set_contact_channel;\n  channel: Channel;\n}\n\nexport interface SetContactStatus extends Action {\n  type: Types.set_contact_status;\n  status: ContactStatus;\n}\n\nexport type SetContactProperty =\n  | SetContactName\n  | SetContactLanguage\n  | SetContactChannel\n  | SetContactStatus;\n\nexport type SetContactAttribute = SetContactField | SetContactProperty;\n\n// tslint:disable-next-line:no-empty-interface\nexport interface Missing extends Action {}\n\nexport interface RecipientsAction extends Action {\n  contacts: Contact[];\n  groups: Group[];\n  legacy_vars?: string[];\n}\n\nexport interface TemplateTranslation {\n  channel: Channel;\n  content: string;\n  language: string;\n  status: string;\n  variable_count: number;\n}\n\nexport interface TemplateOptions {\n  translations: TemplateTranslation[];\n}\n\nexport interface MsgTemplate {\n  name: string;\n  uuid: string;\n}\n\nexport interface MsgTemplating {\n  uuid: string;\n  template: MsgTemplate;\n  variables: string[];\n}\n\nexport interface SendMsg extends Action {\n  text: string;\n  all_urns?: boolean;\n  quick_replies?: string[];\n  attachments?: string[];\n  topic?: string;\n  templating?: MsgTemplating;\n}\n\nexport interface Delay extends Action {\n  delay: string;\n}\n\nexport interface SayMsg extends Action {\n  text: string;\n  audio_url?: string;\n}\n\nexport interface PlayAudio extends Action {\n  audio_url: string;\n}\n\nexport interface BroadcastMsg extends RecipientsAction {\n  text: string;\n  attachments?: string[];\n  templating?: MsgTemplating;\n}\n\nexport interface AddLabels extends Action {\n  labels: Label[];\n}\n\nexport interface AddURN extends Action {\n  scheme: string;\n  path: string;\n}\n\nexport interface SetPreferredChannel extends Action {\n  language: string;\n}\n\nexport interface SendEmail extends Action {\n  subject: string;\n  body: string;\n  addresses: string[];\n}\n\nexport interface SetRunResult extends Action {\n  name: string;\n  value: string;\n  category?: string;\n}\n\nexport interface Headers {\n  [name: string]: string;\n}\n\nexport interface Classifier {\n  uuid: string;\n  name: string;\n}\n\nexport interface Ticketer {\n  uuid: string;\n  name: string;\n}\n\nexport interface TransferAirtime extends Action {\n  amounts: { [name: string]: number };\n  result_name: string;\n}\n\nexport interface CallClassifier extends Action {\n  classifier: Classifier;\n  input: string;\n  result_name: string;\n}\n\nexport interface CallResthook extends Action {\n  resthook: string;\n  result_name: string;\n}\n\nexport interface CallWebhook extends Action {\n  url: string;\n  method: Methods;\n  result_name: string;\n  body?: string;\n  headers?: Headers;\n}\n\nexport interface OpenTicket extends Action {\n  ticketer: Ticketer;\n  subject: string;\n  body: string;\n  result_name: string;\n}\n\nexport interface StartFlow extends Action {\n  flow: Flow;\n}\n\nexport interface StartSession extends RecipientsAction {\n  flow: Flow;\n  create_contact?: boolean;\n  contact_query?: string;\n}\n\nexport interface UIMetaData {\n  nodes: { [key: string]: UINode };\n  languages: { [iso: string]: string }[];\n  translation_filters?: { categories: boolean; rules: boolean };\n}\n\nexport interface FlowPosition {\n  left: number;\n  top: number;\n  right?: number;\n  bottom?: number;\n}\n\nexport interface Dimensions {\n  width: number;\n  height: number;\n}\n\nexport interface UIConfig {\n  [key: string]: any;\n}\n\nexport interface UINode {\n  position: FlowPosition;\n  // ui type, used for split by expression, contact field, etc\n  type?: Types;\n  config?: UIConfig;\n}\n\nexport interface StickyNote {\n  position: FlowPosition;\n  title: string;\n  body: string;\n  color?: string;\n}\n\nexport interface UIMetaData {\n  nodes: { [key: string]: UINode };\n  stickies: { [key: string]: StickyNote };\n}\n\nexport type AnyAction =\n  | Action\n  | ChangeGroups\n  | SetContactField\n  | SetContactName\n  | SetRunResult\n  | SendMsg\n  | SetPreferredChannel\n  | SendEmail\n  | CallClassifier\n  | CallWebhook\n  | StartFlow\n  | StartSession\n  | Delay;\n\nexport enum ContactProperties {\n  UUID = 'uuid',\n  'Created By' = 'created_by',\n  'Modified By' = 'modified_by',\n  Org = 'org',\n  Name = 'name',\n  Language = 'language',\n  Status = 'status',\n  Timezone = 'timezone',\n  Channel = 'channel',\n  Email = 'email',\n  Mailto = 'mailto',\n  Phone = 'phone',\n  Groups = 'groups'\n}\n\nexport enum ValueType {\n  text = 'text',\n  numeric = 'numeric',\n  datetime = 'datetime',\n  state = 'state',\n  district = 'district',\n  ward = 'ward'\n}\n\nexport interface CreateOptions {\n  promptTextCreator?: any;\n  newOptionCreator?: any;\n  isValidNewOption?: any;\n  isOptionUnique?: any;\n  createNewOption?: any;\n  createPrompt?: string;\n}\n\nexport enum StartFlowArgs {\n  Complete = 'C',\n  Expired = 'E'\n}\n\nexport enum StartFlowExitNames {\n  Complete = 'Complete',\n  Expired = 'Expired'\n}\n\nexport enum WebhookExitNames {\n  Success = 'Success',\n  Failure = 'Failure'\n}\n\nexport enum TransferAirtimeExitNames {\n  Success = 'Success',\n  Failure = 'Failed'\n}\n","import { Action, Case, Category, Language, MsgTemplating } from 'flowTypes';\r\nimport { Asset } from 'store/flowContext';\r\n\r\nexport class LocalizedObject {\r\n  public localizedKeys: { [key: string]: boolean } = {};\r\n\r\n  private localizedObject: Action | Category | Case | any;\r\n  private localized: boolean = false;\r\n  private iso: string;\r\n  private name: string;\r\n  private language: Language;\r\n\r\n  constructor(object: Action | Category | Case | MsgTemplating, { id, name }: Asset) {\r\n    this.localizedObject = object;\r\n    this.iso = id;\r\n    this.language = { iso: this.iso, name };\r\n  }\r\n\r\n  public getLanguage(): Language {\r\n    if (!this.language) {\r\n      if (this.iso) {\r\n        this.language = { iso: this.iso, name: this.name };\r\n      }\r\n    }\r\n\r\n    return this.language;\r\n  }\r\n\r\n  public hasTranslation(key: string): boolean {\r\n    return key in this.localizedKeys;\r\n  }\r\n\r\n  // We use explicit any here to make this generic across all actions,\r\n  // note this means we'll attempt to set any property in our localization\r\n  // dictionary regardless of the object type\r\n  public addTranslation(key: string, value: any): void {\r\n    // localization shouldn't side-affect the original object\r\n    if (!this.localized) {\r\n      this.localizedObject = Object.assign({}, this.localizedObject);\r\n      this.localized = true;\r\n    }\r\n\r\n    if (Array.isArray(this.localizedObject[key])) {\r\n      this.localizedObject[key] = value;\r\n    } else {\r\n      if (value.length === 1) {\r\n        this.localizedObject[key] = value[0];\r\n      }\r\n    }\r\n\r\n    this.localizedKeys[key] = true;\r\n  }\r\n\r\n  public isLocalized(): boolean {\r\n    return this.localized;\r\n  }\r\n\r\n  public getObject(): Action | Case | Category | MsgTemplating {\r\n    return this.localizedObject;\r\n  }\r\n}\r\n\r\nexport default class Localization {\r\n  public static translate(\r\n    object: Action | Category | Case | MsgTemplating,\r\n    language: Asset,\r\n    translations?: { [uuid: string]: any }\r\n  ): LocalizedObject {\r\n    const localized: LocalizedObject = new LocalizedObject(object, language);\r\n\r\n    if (translations) {\r\n      if (object.uuid in translations) {\r\n        const values = translations[object.uuid];\r\n        // We don't want to side affect our action\r\n        Object.keys(values).forEach(key => {\r\n          return localized.addTranslation(key, values[key]);\r\n        });\r\n      }\r\n    }\r\n\r\n    return localized;\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport * as React from 'react';\r\nimport { renderIf } from 'utils';\r\n\r\nimport styles from './Button.module.scss';\r\n\r\nexport enum ButtonTypes {\r\n  primary = 'primary',\r\n  secondary = 'secondary',\r\n  tertiary = 'tertiary'\r\n}\r\nexport interface ButtonProps {\r\n  name: string;\r\n  onClick: any;\r\n  disabled?: boolean;\r\n  type?: ButtonTypes;\r\n  leftSpacing?: boolean;\r\n  topSpacing?: boolean;\r\n  iconName?: string;\r\n  onRef?: (ele: any) => void;\r\n}\r\n\r\ninterface ButtonState {\r\n  active: boolean;\r\n}\r\n\r\nexport default class Button extends React.Component<ButtonProps, ButtonState> {\r\n  constructor(props: ButtonProps) {\r\n    super(props);\r\n    this.state = {\r\n      active: false\r\n    };\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^handle/]\r\n    });\r\n  }\r\n\r\n  private handleMouseDown(event: React.MouseEvent<HTMLDivElement>): void {\r\n    this.setState({ active: true });\r\n  }\r\n\r\n  private handleMouseUp(event: React.MouseEvent<HTMLDivElement>): void {\r\n    this.setState({ active: false });\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const { onRef, name, onClick, type, disabled, leftSpacing, topSpacing, iconName } = this.props;\r\n\r\n    return (\r\n      <div\r\n        ref={onRef}\r\n        style={{\r\n          marginLeft: leftSpacing ? 10 : 0,\r\n          marginTop: topSpacing ? 10 : 0\r\n        }}\r\n        onClick={onClick}\r\n        onMouseDown={this.handleMouseDown}\r\n        onMouseUp={this.handleMouseUp}\r\n        className={`${styles.btn} ${styles[type!]} ${disabled ? styles.disabled : ''} ${\r\n          this.state.active ? styles.active : ''\r\n        }`}\r\n      >\r\n        {renderIf(iconName != null)(<span style={{ paddingRight: 4 }} className={iconName} />)}\r\n        {name}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import {\n  Action,\n  Case,\n  Category,\n  ContactProperties,\n  FlowPosition,\n  LocalizationMap\n} from 'flowTypes';\nimport { Query } from 'immutability-helper';\nimport * as React from 'react';\nimport Localization, { LocalizedObject } from 'services/Localization';\nimport { Asset, Assets } from 'store/flowContext';\nimport { FormEntry } from 'store/nodeEditor';\nimport { v4 as generateUUID } from 'uuid';\nimport variables from 'variables.module.scss';\n\nexport const V4_UUID = /^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i;\nconst LABEL_CHARS = /^[a-zA-Z0-9-][a-zA-Z0-9- ]*$/;\nconst MAX_LABEL_LENGTH = 36;\nconst SNAKED_CHARS = /\\s|-+(?=\\S)/g;\n\nexport const MAX_REFLOW_ATTEMPTS = 100;\nexport const ACTIVITY_INTERVAL = 5000;\nexport const COLLISION_FUDGE = 5;\nexport const GRID_SIZE: number = parseInt(variables.grid_size, 10) || 20;\nexport const NODE_SPACING: number = parseInt(variables.node_spacing, 10) || 10;\nexport const NODE_PADDING: number = parseInt(variables.node_padding, 10) || 10;\nexport const QUIET_NOTE = 2000;\nexport const CONFIRMATION_TIME = 2000;\n\nexport interface BoolMap {\n  [key: string]: boolean;\n}\n\ninterface Bounds {\n  left: number;\n  top: number;\n  right: number;\n  bottom: number;\n}\n\nexport type LabelIdCb = (label?: string, labelKey?: string, valueKey?: string) => string;\n\n/**\n * Adjusts the left and top offsets to a grid\n * @param left horizontal offset\n * @param top vertical offset\n */\nexport const snapToGrid = (left: number, top: number): { left: number; top: number } => {\n  let leftAdjust = left % GRID_SIZE;\n  let topAdjust = top % GRID_SIZE;\n\n  if (leftAdjust > GRID_SIZE / 3) {\n    leftAdjust = GRID_SIZE - leftAdjust;\n  } else {\n    leftAdjust = leftAdjust * -1;\n  }\n\n  if (topAdjust > GRID_SIZE / 3) {\n    topAdjust = GRID_SIZE - topAdjust;\n  } else {\n    topAdjust = topAdjust * -1;\n  }\n\n  return {\n    left: Math.max(left + leftAdjust, 0),\n    top: Math.max(top + topAdjust, 0)\n  };\n};\n\n/**\n * Adjusts the position offsets to a grid\n */\nexport const snapPositionToGrid = (position: FlowPosition): FlowPosition => {\n  let leftAdjust = position.left % GRID_SIZE;\n  let topAdjust = position.top % GRID_SIZE;\n\n  if (leftAdjust > GRID_SIZE / 3) {\n    leftAdjust = GRID_SIZE - leftAdjust;\n  } else {\n    leftAdjust = leftAdjust * -1;\n  }\n\n  if (topAdjust > GRID_SIZE / 3) {\n    topAdjust = GRID_SIZE - topAdjust;\n  } else {\n    topAdjust = topAdjust * -1;\n  }\n\n  const left = Math.max(position.left + leftAdjust, 0);\n  const top = Math.max(position.top + topAdjust, 0);\n  const right = left + position.right - position.left;\n  const bottom = top + position.bottom - position.top;\n\n  return {\n    left,\n    top,\n    right,\n    bottom\n  };\n};\n\n/**\n * Turns a string array into a bool map for constant lookup\n * @param {string[]} array - an array of strings, e.g. contact fields\n * @returns {object} A map of each string\n */\nexport const toBoolMap = (array: string[]): BoolMap =>\n  array.reduce(\n    (map: BoolMap, item: string) => ({\n      ...map,\n      [item]: true\n    }),\n    {}\n  );\n\n/**\n * Inserts commas into numbers where appropriate for better readability\n * @param {number} value - A number, e.g. 10000\n * @returns {string} A comma-separated string, e.g. 10,000\n */\nexport const addCommas = (value: number): string =>\n  value.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\n/**\n * Replaces spaces with underscores\n * @param {string} value - A space-separated string to be snaked, e.g. a raw flow field name ('my flow field')\n * @returns {string} A snaked string, e.g. 'my_flow_field'\n */\nexport const snakify = (value: string): string =>\n  value\n    .toLowerCase()\n    .trim()\n    .replace(SNAKED_CHARS, '_');\n/**\n * Returns true if a given UUID matches v4 format\n * @param {string} uuid - A version 4 UUID (no braces, uppercase OK)\n * @returns {boolean}\n */\nexport const validUUID = (uuid: string): boolean => V4_UUID.test(uuid);\n\n/**\n * Returns a given string in title case, e.g. 'full name' becomes 'Full Name'\n * @param {string} str - string to be title-cased\n * @returns {string} Title-cased string\n */\nexport const titleCase = (str: string): string =>\n  str.replace(/\\b\\w+/g, s => s.charAt(0).toUpperCase() + s.substr(1).toLowerCase());\n\nexport const getSelectClassForEntry = (entry: FormEntry): string => {\n  if (entry && entry.validationFailures && entry.validationFailures.length > 0) {\n    return 'select-invalid';\n  }\n  return '';\n};\n\nexport const getSelectClass = (errors: number): string => {\n  if (errors === 0) {\n    return 'react-select select-base';\n  }\n  // We use a global selector here for react-select\n  return 'react-select select-base select-invalid';\n};\n\nexport const reorderList = (list: any[], startIndex: number, endIndex: number): any[] => {\n  const [removed] = list.splice(startIndex, 1);\n\n  list.splice(endIndex, 0, removed);\n\n  return list;\n};\n\n/**\n * Compares basic objects (no methods and DOM nodes; property order important)\n * @param {object} objA - basic object\n * @param {object} objB - basic object\n * @returns {boolean}\n */\nexport const jsonEqual = (objA: {}, objB: {}): boolean =>\n  JSON.stringify(objA) === JSON.stringify(objB);\n\n/**\n * Checks whether any of a list of error strings contain one or more queries.\n * Used to determine whether a particular error has been encountered.\n */\nexport const hasErrorType = (errors: string[], exps: RegExp[]): boolean => {\n  if (!errors.length) {\n    return false;\n  }\n  for (const error of errors) {\n    for (const exp of exps) {\n      if (error.match(exp)) {\n        return true;\n      }\n    }\n  }\n  return false;\n};\n\nexport const getLocalizedObject = (localizations: LocalizedObject[]) => {\n  if (localizations && localizations.length) {\n    return localizations[0];\n  }\n};\n\nexport interface ClickHandler {\n  // onClick: (event: React.MouseEvent<HTMLDivElement>) => void;\n  onMouseDown: (event: React.MouseEvent<HTMLDivElement>) => void;\n  onMouseUp: (event: React.MouseEvent<HTMLDivElement>) => void;\n}\n\n/**\n * Creates a simple click handler via onMouseDown and onMouseUp.\n * This is a necessity in order to let jsPlumb manage our element dragging.\n * @param onClick\n */\nexport const createClickHandler = (\n  onClick: (event: React.MouseEvent<HTMLElement>) => void,\n  shouldCancelClick: () => boolean = null,\n  onMouseDown?: (event: React.MouseEvent<HTMLElement>) => void\n): any => {\n  return {\n    onMouseDown: (event: React.MouseEvent<HTMLElement>) => {\n      if (onMouseDown) {\n        onMouseDown(event);\n      }\n    },\n    onMouseUp: (event: React.MouseEvent<HTMLElement>) => {\n      if (!shouldCancelClick || !shouldCancelClick()) {\n        onClick(event);\n      }\n    }\n  };\n};\n\nexport const getLocalization = (\n  obj: Action | Category | Case,\n  localization: LocalizationMap,\n  language: Asset\n) => Localization.translate(obj, language, localization[language.id]);\n\n/** istanbul ignore next */\nexport const dump = (thing: any) => console.log(JSON.stringify(thing, null, 4));\n\n/**\n * Apply emphasis style\n */\nexport const emphasize = (text: string) => <span className=\"emphasize\">{text}</span>;\nexport const ellipsize = (text: string, max: number = 250) => {\n  if (text.length > max) {\n    return text.substr(0, max) + '...';\n  }\n  return text;\n};\n\n/**\n * Does property exist in our ContactProperties enum?\n * @param {string} propertyToCheck - 'name' key on react-select AutoCompleteOption\n */\nexport const propertyExists = (propertyToCheck: string) => {\n  for (const property of Object.keys(ContactProperties)) {\n    if (property.toLowerCase() === propertyToCheck.toLowerCase().trim()) {\n      return true;\n    }\n  }\n  return false;\n};\n\n/**\n * Should x element be rendered?\n */\nexport const renderIf = (predicate: boolean) => (then: JSX.Element, otherwise?: JSX.Element) =>\n  predicate ? then : otherwise ? otherwise : null;\n\n/**\n * Does the label meet our length requirements?\n * @param {string} label - label created by react-select\n */\nexport const properLabelLength = (label: string = '') =>\n  label.length > 0 && label.length <= MAX_LABEL_LENGTH;\n\n/**\n * Does the label meet our character requirements?\n * @param {string} label\n */\nexport const containsOnlyLabelChars = (label: string = '') => LABEL_CHARS.test(label);\n\n/**\n * Does the label meet our length, character requirements?\n * @param {string} label - label created by react-select\n */\nexport const isValidLabel = (label: string) =>\n  properLabelLength(label) && containsOnlyLabelChars(label);\n\nexport const isRealValue = (obj: any) => obj !== null && obj !== undefined;\n\n/* istanbul ignore next */\nexport const timeStart = (name: string) =>\n  process.env.NODE_ENV === 'development' && console.time(name);\n\n/* istanbul ignore next */\nexport const timeEnd = (name: string) =>\n  process.env.NODE_ENV === 'development' && console.timeEnd(name);\n\nexport const log = (...message: any[]) =>\n  process.env.NODE_ENV === 'development' && console.log(...message);\n\nexport const capitalize = (str: string) =>\n  str.replace(/(?:^|\\s)\\S/g, captured => captured.toUpperCase());\n\nexport const set = (val: any): Query<any> => ({ $set: val });\n\nexport const setTrue = (): Query<true> => set(true);\n\nexport const setFalse = (): Query<false> => set(false);\n\nexport const setNull = (): Query<null> => set(null);\n\nexport const setEmpty = (): Query<string> => set('');\n\nexport const merge = (val: any): Query<any> => ({ $merge: val });\n\nexport const unset = (val: any): Query<any> => ({ $unset: val });\n\nexport const push = (arr: any[]): Query<any[]> => ({ $push: arr });\n\n// tslint:disable-next-line:array-type\nexport const splice = (arr: Array<Array<any>>): Query<Array<Array<any>>> => ({\n  $splice: arr\n});\n\nexport const optionExists = (newOptName: string, options: any[]) =>\n  options.find(({ name }) => name.toLowerCase().trim() === newOptName.toLowerCase().trim())\n    ? true\n    : false;\n\n/* export const isOptionUnique: IsOptionUniqueHandler = ({ option, options, labelKey, valueKey }) =>\n    !propertyExists(option.name) && !optionExists(option.name, options);\n\nexport const isValidNewOption: IsValidNewOptionHandler = ({ label }) => isValidLabel(label);\n*/\n/* export const composeCreateNewOption = ({\n    idCb,\n    type\n}: {\n    idCb: LabelIdCb;\n    type: AssetType;\n}): NewOptionCreatorHandler => ({ label, labelKey, valueKey }) => ({\n    id: idCb(label, labelKey, valueKey),\n    name: label,\n    type,\n    isNew: true\n});*/\n\n/**\n * Deduplicate values in an array.\n * Pass it a key to deduplicate based on obj key.\n */\nexport const uniqueBy = (a: any[], key: string): any[] => {\n  const seen: any = {};\n  return a.filter((item: any) => {\n    const k = item[key];\n    return seen.hasOwnProperty(k) ? false : (seen[k] = true);\n  });\n};\n\nexport const downloadJSON = (obj: any, name: string): void => {\n  const dataStr =\n    'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(obj, null, 2));\n  const downloadAnchorNode = document.createElement('a');\n  downloadAnchorNode.setAttribute('href', dataStr);\n  downloadAnchorNode.setAttribute('download', name + '.json');\n  document.body.appendChild(downloadAnchorNode); // required for firefox\n  downloadAnchorNode.click();\n  downloadAnchorNode.remove();\n};\n\nexport const fetchAsset = (asset: Asset) => (assets: Assets, id: string): Promise<Asset> => {\n  return new Promise<Asset>((resolve, reject) => {\n    resolve(asset);\n  });\n};\n\nexport let createUUID = (): string => {\n  return generateUUID();\n};\n\nexport const seededUUIDs = (seed: number = 1): any => {\n  let current = seed;\n  const randomNext = () => {\n    const x = Math.sin(current++) * 10000;\n    return x - Math.floor(x);\n  };\n\n  const random = (min: number, max: number): number => {\n    return Math.floor(randomNext() * (max - min) + min);\n  };\n\n  return () => {\n    const randomSeed: number[] = [];\n    for (let idx = 0; idx < 16; idx++) {\n      randomSeed.push(random(0, 250));\n    }\n    return generateUUID({ random: randomSeed });\n  };\n};\n\nexport const range = (start: number, end: number) =>\n  Array.from({ length: end - start }, (v: number, k: number) => k + start);\n\nexport const pluralize = (count: number, noun: string, suffix: string = 's'): string =>\n  `${noun}${count !== 1 ? suffix : ''}`;\n\nexport const hasString = (names: string[], key: string): boolean =>\n  !!names.find((item: string) => item === key);\n\nexport const scalarArrayEquals = (a: any[], b: any[]) =>\n  a.every((value, index) => value === b[index]);\n\nexport const getURNPath = (urn: string) => {\n  return urn.split(':')[1];\n};\n\nexport const copyToClipboard = (text: string) => {\n  navigator.clipboard.writeText(text);\n};\n\nexport const throttle = (func: any, timeout: any) => {\n  let ready: boolean = true;\n\n  return (...args: any) => {\n    if (!ready) {\n      return;\n    }\n\n    ready = false;\n    func(...args);\n    setTimeout(() => {\n      ready = true;\n    }, timeout);\n  };\n};\n\nexport const traceUpdate = (component: any, prevProps: any, prevState?: any) => {\n  const messages: string[] = [];\n  Object.entries(component.props).forEach(\n    ([key, val]) => prevProps[key] !== val && messages.push(`Prop: '${key}' changed`)\n  );\n  if (prevState && component.state) {\n    Object.entries(component.state).forEach(\n      ([key, val]) => prevState[key] !== val && messages.push(`State: '${key}' changed`)\n    );\n  }\n\n  if (messages.length > 0) {\n    log('****  ' + component._reactInternalFiber.type.name + ' changed');\n    messages.forEach((message: string) => {\n      log(message);\n    });\n  }\n};\n\nexport const debounce = (fn: any, quiet: number, closure: any = null) => {\n  if (fn.timeout) {\n    window.clearTimeout(fn.timeout);\n  }\n  fn.timeout = window.setTimeout(closure || fn, quiet);\n};\n\nexport const onNextRender = (fn: any) => {\n  window.setTimeout(fn, 0);\n};\n\nexport const desnake = (text: string): string => {\n  if (!text) {\n    return text;\n  }\n  return text\n    .split('_')\n    .join(' ')\n    .toLowerCase();\n};\n\nexport const bool = (prop: boolean) => {\n  return prop ? 'true' : null;\n};\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport Button, { ButtonProps, ButtonTypes } from 'components/button/Button';\r\nimport shared from 'components/shared.module.scss';\r\nimport * as React from 'react';\r\nimport { renderIf } from 'utils';\r\n\r\nimport styles from './Dialog.module.scss';\r\n\r\nexport enum HeaderStyle {\r\n  NORMAL = 'normal',\r\n  BARBER = 'barber'\r\n}\r\n\r\nexport interface ButtonSet {\r\n  primary: ButtonProps;\r\n  secondary?: ButtonProps;\r\n  tertiary?: ButtonProps;\r\n}\r\n\r\nexport interface Tab {\r\n  name: string;\r\n  body: JSX.Element;\r\n  hasErrors?: boolean;\r\n  icon?: string;\r\n  checked?: boolean;\r\n}\r\n\r\ninterface Buttons {\r\n  leftButtons: JSX.Element[];\r\n  rightButtons: JSX.Element[];\r\n}\r\n\r\nexport interface DialogProps {\r\n  title: string;\r\n  subtitle?: string;\r\n  headerIcon?: string;\r\n  headerClass?: string;\r\n  headerStyle?: HeaderStyle;\r\n  buttons?: ButtonSet;\r\n  gutter?: JSX.Element;\r\n  noPadding?: boolean;\r\n  tabs?: Tab[];\r\n  className?: string;\r\n}\r\n\r\nexport interface DialogState {\r\n  activeTab: number;\r\n}\r\n\r\n/**\r\n * A component that has a front and back and can flip back and forth between them\r\n */\r\nexport default class Dialog extends React.Component<DialogProps, DialogState> {\r\n  private tabFocus: any = null;\r\n  private primaryButton: any = null;\r\n\r\n  constructor(props: DialogProps) {\r\n    super(props);\r\n    this.state = {\r\n      activeTab: -1\r\n    };\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^handle/, /^get/]\r\n    });\r\n  }\r\n\r\n  public showTab(index: number): void {\r\n    this.setState({ activeTab: index });\r\n  }\r\n\r\n  private handlePrimaryButton(onClick: any): void {\r\n    onClick();\r\n\r\n    this.tabFocus = window.setTimeout(() => {\r\n      let foundTab = false;\r\n      // focus on a tab with errors\r\n      (this.props.tabs || []).forEach((tab: Tab, index: number) => {\r\n        if (tab.hasErrors) {\r\n          this.setState({ activeTab: index });\r\n          foundTab = true;\r\n          return;\r\n        }\r\n      });\r\n\r\n      if (!foundTab) {\r\n        // or focus on the main content\r\n        this.setState({ activeTab: -1 });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  private handleKey(event: KeyboardEvent): void {\r\n    if (event.key === 'Enter' && event.shiftKey) {\r\n      if (this.primaryButton) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        (event.target as any).blur();\r\n        this.primaryButton.click();\r\n        (event.target as any).focus();\r\n      } else {\r\n        console.log('No primary button!');\r\n      }\r\n    }\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    window.document.addEventListener('keydown', this.handleKey, {\r\n      capture: true\r\n    });\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    window.clearTimeout(this.tabFocus);\r\n    window.document.removeEventListener('keydown', this.handleKey, {\r\n      capture: true\r\n    });\r\n  }\r\n\r\n  private getButtons(): Buttons {\r\n    const rightButtons: JSX.Element[] = [];\r\n    const buttons = this.props.buttons || {\r\n      primary: null,\r\n      secondary: null,\r\n      tertiary: null\r\n    };\r\n\r\n    if (buttons.secondary) {\r\n      rightButtons.push(<Button key={0} type={ButtonTypes.secondary} {...buttons.secondary} />);\r\n    }\r\n\r\n    if (buttons.primary) {\r\n      rightButtons.push(\r\n        <Button\r\n          key={'button_' + buttons.primary.name}\r\n          onRef={(ref: any) => {\r\n            this.primaryButton = ref;\r\n          }}\r\n          onClick={() => {\r\n            this.handlePrimaryButton(buttons.primary.onClick);\r\n          }}\r\n          leftSpacing={true}\r\n          name={buttons.primary.name}\r\n          disabled={buttons.primary.disabled}\r\n          type={ButtonTypes.primary}\r\n        />\r\n      );\r\n    }\r\n\r\n    const leftButtons: JSX.Element[] = [];\r\n\r\n    // Our left most button if we have one\r\n    if (buttons.tertiary) {\r\n      leftButtons.push(<Button key={0} type={ButtonTypes.tertiary} {...buttons.tertiary} />);\r\n    }\r\n\r\n    return {\r\n      leftButtons,\r\n      rightButtons\r\n    };\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const headerClasses = [styles.header];\r\n\r\n    if (this.state.activeTab > -1) {\r\n      headerClasses.push(styles.clickable);\r\n    }\r\n\r\n    if (this.props.headerClass) {\r\n      headerClasses.push(shared[this.props.headerClass]);\r\n    }\r\n\r\n    if (this.props.headerIcon) {\r\n      headerClasses.push(styles.iconed);\r\n    }\r\n\r\n    if (this.props.headerStyle === HeaderStyle.BARBER) {\r\n      headerClasses.push(styles.barber);\r\n    }\r\n\r\n    const activeClasses = [styles.dialog];\r\n    const { leftButtons, rightButtons } = this.getButtons();\r\n\r\n    if (this.props.className) {\r\n      activeClasses.push(this.props.className);\r\n    }\r\n\r\n    return (\r\n      <div className={activeClasses.join(' ')}>\r\n        {(this.props.tabs || []).length > 0 ? (\r\n          <div className={styles.tabs}>\r\n            {(this.props.tabs || []).map((tab: Tab, index: number) => (\r\n              <div\r\n                key={'tab_' + tab.name}\r\n                className={styles.tab + ' ' + (index === this.state.activeTab ? styles.active : '')}\r\n                onClick={(evt: React.MouseEvent<HTMLDivElement>) => {\r\n                  evt.stopPropagation();\r\n                  this.setState({ activeTab: index });\r\n                }}\r\n              >\r\n                {tab.name} {tab.icon ? <span className={styles.tab_icon + ' ' + tab.icon} /> : null}\r\n                {tab.checked ? <span className={styles.tab_icon + ' fe-check'} /> : null}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : null}\r\n        <div\r\n          onClick={() => {\r\n            this.setState({ activeTab: -1 });\r\n          }}\r\n          className={headerClasses.join(' ')}\r\n        >\r\n          {this.state.activeTab > -1 ? <div className={styles.header_overlay} /> : null}\r\n          {renderIf(this.props.headerIcon !== undefined)(\r\n            <span className={`${styles.header_icon} ${this.props.headerIcon}`} />\r\n          )}\r\n          <div className={styles.title_container}>\r\n            <div className={styles.title}>{this.props.title}</div>\r\n            <div className={styles.subtitle}>{this.props.subtitle}</div>\r\n          </div>\r\n        </div>\r\n        <div className={this.props.noPadding ? '' : styles.content}>\r\n          {this.state.activeTab > -1\r\n            ? this.props.tabs![this.state.activeTab].body\r\n            : this.props.children}\r\n        </div>\r\n\r\n        <div className={styles.footer}>\r\n          <div className={styles.buttons}>\r\n            {renderIf(leftButtons.length > 0)(\r\n              <div className={styles.left_buttons}>{leftButtons}</div>\r\n            )}\r\n            {renderIf(this.props.gutter != null)(\r\n              <div className={styles.gutter}>{this.props.gutter}</div>\r\n            )}\r\n            <div className={styles.right_buttons}>{rightButtons}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","enum Constants {\r\n  UPDATE_EDITOR_STATE = 'UPDATE_EDITOR_STATE',\r\n  UPDATE_NODE_EDITOR_SETTINGS = 'UPDATE_NODE_EDITOR_SETTINGS',\r\n  UPDATE_TRANSLATING = 'UPDATE_TRANSLATING',\r\n  UPDATE_BASE_LANGUAGE = 'UPDATE_BASE_LANGUAGE',\r\n  UPDATE_LANGUAGES = 'UPDATE_LANGUAGES',\r\n  UPDATE_LANGUAGE = 'UPDATE_LANGUAGE',\r\n  UPDATE_FETCHING_FLOW = 'FETCHING_FLOW',\r\n  UPDATE_DEFINITION = 'UPDATE_DEFINITION',\r\n  UPDATE_NODE_DRAGGING = 'UPDATE_NODE_DRAGGING',\r\n  UPDATE_FLOWS = 'UPDATE_FLOWS',\r\n  UPDATE_PENDING_CONNECTIONS = 'UPDATE_PENDING_CONNECTIONS',\r\n  REMOVE_PENDING_CONNECTION = 'REMOVE_PENDING_CONNECTION',\r\n  UPDATE_COMPONENTS = 'UPDATE_COMPONENTS',\r\n  UPDATE_CONTACT_FIELDS = 'UPDATE_CONTACT_FIELDS',\r\n  UPDATE_GROUPS = 'UPDATE_GROUPS',\r\n  UPDATE_RESULT_MAP = 'UPDATE_RESULT_MAP',\r\n  UPDATE_ASSET_MAP = 'UPDATE_ASSET_MAP',\r\n  UPDATE_NODES = 'UPDATE_NODES',\r\n  UPDATE_ISSUES = 'UPDATE_ISSUES',\r\n  UPDATE_METADATA = 'UPDATE_METADATA',\r\n  UPDATE_EXITS = 'UPDATE_EXITS',\r\n  UPDATE_NODE_EDITOR_OPEN = 'UPDATE_NODE_EDITOR_OPEN',\r\n  UPDATE_CREATE_NODE_POSITION = 'UPDATE_CREATE_NODE_POSITION',\r\n  UPDATE_DRAG_GROUP = 'UPDATE_DRAG_GROUP',\r\n  UPDATE_TYPE_CONFIG = 'UPDATE_TYPE_CONFIG',\r\n  UPDATE_USER_ADDING_ACTION = 'UPDATE_USER_ADDING_ACTION',\r\n  INCREMENT_SUGGESTED_RESULT_NAME_COUNT = 'INCREMENT_SUGGESTED_RESULT_NAME_COUNT'\r\n}\r\n\r\nexport default Constants;\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport * as React from 'react';\r\n\r\n// tslint:disable-next-line: no-empty-interface\r\ninterface FixyProps {}\r\n\r\ninterface FixyState {\r\n  top: number;\r\n  fixed: boolean;\r\n}\r\n\r\nexport class Fixy extends React.PureComponent<FixyProps, FixyState> {\r\n  private ele!: HTMLDivElement | null;\r\n\r\n  constructor(props: FixyProps) {\r\n    super(props);\r\n    this.state = {\r\n      top: 0,\r\n      fixed: false\r\n    };\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^handle/]\r\n    });\r\n  }\r\n\r\n  private handleScroll(): void {\r\n    const fixed = window.scrollY > this.state.top;\r\n    this.setState({ fixed });\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    window.removeEventListener('scroll', this.handleScroll);\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    const top = this.ele!.getBoundingClientRect().top + window.scrollY;\r\n    const fixed = window.scrollY > top;\r\n    this.setState({ top, fixed });\r\n    window.addEventListener('scroll', this.handleScroll);\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    let styles: React.CSSProperties = { position: 'absolute' };\r\n    if (this.state.fixed) {\r\n      styles = {\r\n        position: 'fixed',\r\n        top: 0\r\n      };\r\n    }\r\n\r\n    return (\r\n      <div\r\n        ref={ele => {\r\n          this.ele = ele;\r\n        }}\r\n        style={styles}\r\n      >\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { FlowDefinition, FlowNode, UINode, FlowMetadata, FlowIssue } from 'flowTypes';\nimport { combineReducers, Action } from 'redux';\nimport ActionTypes, {\n  UpdateAssetsAction,\n  UpdateBaseLanguageAction,\n  UpdateContactFieldsAction,\n  UpdateDefinitionAction,\n  UpdateNodesAction,\n  UpdateMetadataAction,\n  UpdateIssuesAction\n} from 'store/actionTypes';\nimport Constants from 'store/constants';\nimport { Type } from 'config/interfaces';\nimport { TembaStore } from 'temba-components';\n\n// tslint:disable:no-shadowed-variable\nexport interface RenderNodeMap {\n  [uuid: string]: RenderNode;\n}\n\nexport interface FlowIssueMap {\n  [uuid: string]: FlowIssue[];\n}\n\nexport interface RenderNode {\n  ui: UINode;\n  node: FlowNode;\n  inboundConnections: { [nodeUUID: string]: string };\n  ghost?: boolean;\n}\n\nexport interface RenderAction {\n  action: Action;\n  config: Type;\n  index?: number;\n}\n\nexport interface FunctionExample {\n  template: string;\n  output: string;\n}\n\nexport interface CompletionOption {\n  name?: string;\n  summary: string;\n\n  // functions\n  signature?: string;\n  detail?: string;\n  examples?: FunctionExample[];\n}\n\nexport interface ContactFields {\n  [snakedFieldName: string]: string;\n}\n\nexport enum AssetType {\n  Channel = 'channel',\n  Classifier = 'classifier',\n  Contact = 'contact',\n  ContactProperty = 'property',\n  Currency = 'currency',\n  Environment = 'environment',\n  Expression = 'expression',\n  Field = 'field',\n  Flow = 'flow',\n  Global = 'global',\n  Group = 'group',\n  GroupNameMatch = 'group_match',\n  Label = 'label',\n  Language = 'language',\n  Remove = 'remove',\n  Resthook = 'resthook',\n  Result = 'result',\n  Revision = 'revision',\n  Scheme = 'scheme',\n  Template = 'template',\n  Ticketer = 'ticketer',\n  URN = 'urn',\n  ValidateMedia = 'validate'\n}\n\nexport interface Reference {\n  nodeUUID: string;\n  actionUUID?: string;\n}\n\nexport interface Asset {\n  id: string;\n  name: string;\n  type: AssetType;\n\n  order?: number;\n  references?: Reference[];\n  isNew?: boolean;\n  content?: any;\n}\n\nexport const REMOVE_VALUE_ASSET = {\n  id: AssetType.Remove,\n  name: 'Remove Value',\n  type: AssetType.Remove\n};\n\nexport const DEFAULT_LANGUAGE = {\n  id: 'base',\n  name: 'Default',\n  type: AssetType.Language\n};\n\nexport interface AssetStore {\n  [assetType: string]: Assets;\n}\n\nexport interface AssetMap {\n  [id: string]: Asset;\n}\n\nexport interface Assets {\n  // our local cache of assets\n  items: AssetMap;\n\n  type: AssetType;\n\n  // an optional endpoint to search for more\n  endpoint?: string;\n\n  // option name for the id when fetching remotely\n  id?: string;\n\n  // have our assets already been loaded\n  prefetched?: boolean;\n}\n\nexport interface FlowContext {\n  metadata: FlowMetadata;\n  baseLanguage: Asset;\n  contactFields: ContactFields;\n  definition: FlowDefinition;\n  nodes: { [uuid: string]: RenderNode };\n  issues: FlowIssueMap;\n  assetStore: AssetStore;\n}\n\n// Initial state\nexport const initialState: FlowContext = {\n  definition: null,\n  baseLanguage: null,\n  metadata: {\n    dependencies: [],\n    results: [],\n    waiting_exit_uuids: [],\n    parent_refs: [],\n    issues: []\n  },\n  contactFields: {},\n  nodes: {},\n  issues: {},\n  assetStore: {}\n};\n\n// Action Creators\nexport const updateDefinition = (definition: FlowDefinition): UpdateDefinitionAction => ({\n  type: Constants.UPDATE_DEFINITION,\n  payload: {\n    definition\n  }\n});\n\nexport const updateNodes = (nodes: RenderNodeMap): UpdateNodesAction => ({\n  type: Constants.UPDATE_NODES,\n  payload: {\n    nodes\n  }\n});\n\nexport const updateIssues = (issues: FlowIssueMap): UpdateIssuesAction => ({\n  type: Constants.UPDATE_ISSUES,\n  payload: {\n    issues\n  }\n});\n\nexport const updateMetadata = (metadata: FlowMetadata): UpdateMetadataAction => {\n  return {\n    type: Constants.UPDATE_METADATA,\n    payload: {\n      metadata\n    }\n  };\n};\n\nexport const updateBaseLanguage = (baseLanguage: Asset): UpdateBaseLanguageAction => ({\n  type: Constants.UPDATE_BASE_LANGUAGE,\n  payload: {\n    baseLanguage\n  }\n});\n\nexport const updateContactFields = (contactFields: ContactFields): UpdateContactFieldsAction => ({\n  type: Constants.UPDATE_CONTACT_FIELDS,\n  payload: {\n    contactFields\n  }\n});\n\nexport const updateAssets = (assets: AssetStore): UpdateAssetsAction => {\n  const store: TembaStore = document.querySelector('temba-store');\n  if (store) {\n    store.setKeyedAssets('results', Object.keys(assets['results'].items));\n  }\n\n  return {\n    type: Constants.UPDATE_ASSET_MAP,\n    payload: {\n      assets\n    }\n  };\n};\n\n// Reducers\nexport const definition = (\n  state: FlowDefinition = initialState.definition,\n  action: ActionTypes\n) => {\n  switch (action.type) {\n    case Constants.UPDATE_DEFINITION:\n      return action.payload.definition;\n    default:\n      return state;\n  }\n};\n\nexport const nodes = (state: {} = initialState.nodes, action: ActionTypes) => {\n  switch (action.type) {\n    case Constants.UPDATE_NODES:\n      return action.payload.nodes;\n    default:\n      return state;\n  }\n};\n\nexport const issues = (state: {} = initialState.issues, action: ActionTypes) => {\n  switch (action.type) {\n    case Constants.UPDATE_ISSUES:\n      return action.payload.issues;\n    default:\n      return state;\n  }\n};\n\nexport const metadata = (state: FlowMetadata = initialState.metadata, action: ActionTypes) => {\n  switch (action.type) {\n    case Constants.UPDATE_METADATA:\n      return action.payload.metadata;\n    default:\n      return state;\n  }\n};\n\nexport const assetStore = (state: AssetStore = initialState.assetStore, action: ActionTypes) => {\n  switch (action.type) {\n    case Constants.UPDATE_ASSET_MAP:\n      return action.payload.assets;\n    default:\n      return state;\n  }\n};\n\nexport const baseLanguage = (state: Asset = initialState.baseLanguage, action: ActionTypes) => {\n  switch (action.type) {\n    case Constants.UPDATE_BASE_LANGUAGE:\n      return action.payload.baseLanguage;\n    default:\n      return state;\n  }\n};\n\nexport const contactFields = (\n  state: ContactFields = initialState.contactFields,\n  action: ActionTypes\n) => {\n  switch (action.type) {\n    case Constants.UPDATE_CONTACT_FIELDS:\n      return action.payload.contactFields;\n    default:\n      return state;\n  }\n};\n\n// Root reducer\nexport default combineReducers({\n  definition,\n  nodes,\n  issues,\n  metadata,\n  assetStore,\n  baseLanguage,\n  contactFields\n});\n","export enum FlowTypes {\n  MESSAGE = 'message',\n  VOICE = 'voice',\n  SURVEY = 'message_offline',\n  NONE = '-'\n}\n\nexport enum ContactStatus {\n  ACTIVE = 'active',\n  BLOCKED = 'blocked',\n  STOPPED = 'stopped',\n  ARCHIVED = 'archived'\n}\n\nexport enum Types {\n  execute_actions = 'execute_actions',\n  add_contact_urn = 'add_contact_urn',\n  add_contact_groups = 'add_contact_groups',\n  add_input_labels = 'add_input_labels',\n  remove_contact_groups = 'remove_contact_groups',\n  set_contact_channel = 'set_contact_channel',\n  set_contact_field = 'set_contact_field',\n  set_contact_name = 'set_contact_name',\n  set_contact_language = 'set_contact_language',\n  set_contact_status = 'set_contact_status',\n  set_run_result = 'set_run_result',\n  call_classifier = 'call_classifier',\n  call_resthook = 'call_resthook',\n  call_webhook = 'call_webhook',\n  open_ticket = 'open_ticket',\n  send_msg = 'send_msg',\n  send_email = 'send_email',\n  send_broadcast = 'send_broadcast',\n  enter_flow = 'enter_flow',\n  start_session = 'start_session',\n  transfer_airtime = 'transfer_airtime',\n  split_by_airtime = 'split_by_airtime',\n  split_by_expression = 'split_by_expression',\n  split_by_contact_field = 'split_by_contact_field',\n  split_by_run_result = 'split_by_run_result',\n  split_by_run_result_delimited = 'split_by_run_result_delimited',\n  split_by_groups = 'split_by_groups',\n  split_by_intent = 'split_by_intent',\n  split_by_random = 'split_by_random',\n  split_by_resthook = 'split_by_resthook',\n  split_by_ticket = 'split_by_ticket',\n  split_by_scheme = 'split_by_scheme',\n  split_by_subflow = 'split_by_subflow',\n  split_by_webhook = 'split_by_webhook',\n  wait_for_response = 'wait_for_response',\n  wait_for_time = 'wait_for_time',\n  wait_for_menu = 'wait_for_menu',\n  wait_for_digits = 'wait_for_digits',\n  wait_for_audio = 'wait_for_audio',\n  wait_for_video = 'wait_for_video',\n  wait_for_location = 'wait_for_location',\n  wait_for_image = 'wait_for_image',\n  missing = 'missing',\n  say_msg = 'say_msg',\n  play_audio = 'play_audio'\n}\n\nexport enum Operators {\n  has_any_word = 'has_any_word',\n  has_all_words = 'has_all_words',\n  has_phrase = 'has_phrase',\n  has_only_phrase = 'has_only_phrase',\n  has_beginning = 'has_beginning',\n  has_text = 'has_text',\n  has_date = 'has_date',\n  has_date_lt = 'has_date_lt',\n  has_date_eq = 'has_date_eq',\n  has_date_gt = 'has_date_gt',\n  has_time = 'has_time',\n  has_number = 'has_number',\n  has_number_between = 'has_number_between',\n  has_number_lt = 'has_number_lt',\n  has_number_lte = 'has_number_lte',\n  has_number_eq = 'has_number_eq',\n  has_number_gte = 'has_number_gte',\n  has_number_gt = 'has_number_gt',\n  has_run_status = 'has_run_status',\n  has_only_text = 'has_only_text',\n  has_group = 'has_group',\n  has_phone = 'has_phone',\n  has_email = 'has_email',\n  has_value = 'has_value',\n  has_district = 'has_district',\n  has_state = 'has_state',\n  has_ward = 'has_ward',\n  has_pattern = 'has_pattern',\n  has_error = 'has_error',\n  has_intent = 'has_intent',\n  has_top_intent = 'has_top_intent',\n  has_category = 'has_category',\n  has_media = 'has_media',\n  has_audio = 'has_audio',\n  has_image = 'has_image',\n  has_video = 'has_video',\n  has_file = 'has_file',\n  has_location = 'has_location'\n}\n\nexport enum FeatureFilter {\n  HAS_RESTHOOK = 'resthook',\n  HAS_WHATSAPP = 'whatsapp',\n  HAS_AIRTIME = 'airtime',\n  HAS_CLASSIFIER = 'classifier',\n  HAS_TICKETER = 'ticketer',\n  HAS_FACEBOOK = 'facebook'\n}\n\nexport interface FlowTypeVisibility {\n  visibility?: FlowTypes[];\n  filter?: FeatureFilter;\n}\n\nexport enum PopTabType {\n  SIMULATOR = 'Simulator',\n  REVISION_HISTORY = 'Revision History',\n  ISSUES_TAB = 'Issues Tab',\n  TRANSLATOR_TAB = 'Translator Tab'\n}\n\nexport interface Type extends FlowTypeVisibility {\n  type: Types;\n  name: string;\n  description: string;\n  component?: any;\n  form?: React.ComponentClass<any>;\n  aliases?: string[];\n  localization?: React.ComponentClass<any>;\n  localizeableKeys?: string[];\n\n  // opportunity to massage our object for display\n  massageForDisplay?: (obj: any) => void;\n}\n\nexport interface Operator extends FlowTypeVisibility {\n  type: Operators;\n  verboseName: string;\n  operands: number;\n  categoryName?: string;\n}\n\nexport interface OperatorMap {\n  [propName: string]: Operator;\n}\n\nexport const HIDDEN = [FlowTypes.NONE];\nexport const VOICE = [FlowTypes.VOICE];\nexport const SURVEY = [FlowTypes.SURVEY];\nexport const TEXT_TYPES = [FlowTypes.MESSAGE, FlowTypes.SURVEY];\nexport const ONLINE = [FlowTypes.MESSAGE, FlowTypes.VOICE];\n","import { AssetType } from 'store/flowContext';\r\n\r\nexport const currencies = {\r\n  ARS: {\r\n    id: 'ARS',\r\n    name: 'Argentine Peso',\r\n    type: AssetType.Currency\r\n  },\r\n  AUD: {\r\n    id: 'AUD',\r\n    name: 'Australian Dollar',\r\n    type: AssetType.Currency\r\n  },\r\n  BIF: {\r\n    id: 'BIF',\r\n    name: 'Burundi Franc',\r\n    type: AssetType.Currency\r\n  },\r\n  BRL: {\r\n    id: 'BRL',\r\n    name: 'Brazilian Real',\r\n    type: AssetType.Currency\r\n  },\r\n\r\n  CAD: {\r\n    id: 'CAD',\r\n    name: 'Canadian Dollar',\r\n    type: AssetType.Currency\r\n  },\r\n  CDF: {\r\n    id: 'CDF',\r\n    name: 'Congolese Franc',\r\n    type: AssetType.Currency\r\n  },\r\n  CLP: {\r\n    id: 'CLP',\r\n    name: 'Chilean Peso',\r\n    type: AssetType.Currency\r\n  },\r\n  COP: {\r\n    id: 'COP',\r\n    name: 'Colombian Peso',\r\n    type: AssetType.Currency\r\n  },\r\n  DJF: {\r\n    id: 'DJF',\r\n    name: 'Djibouti Franc',\r\n    type: AssetType.Currency\r\n  },\r\n  DOP: {\r\n    id: 'DOP',\r\n    name: 'Dominican Peso',\r\n    type: AssetType.Currency\r\n  },\r\n  DZD: {\r\n    id: 'DZD',\r\n    name: 'Algerian Dinar',\r\n    type: AssetType.Currency\r\n  },\r\n  EUR: {\r\n    id: 'EUR',\r\n    name: 'Euro',\r\n    type: AssetType.Currency\r\n  },\r\n  GBP: {\r\n    id: 'GBP',\r\n    name: 'Pound Sterling',\r\n    type: AssetType.Currency\r\n  },\r\n  GHS: {\r\n    id: 'GHS',\r\n    name: 'Ghana Cedi',\r\n    type: AssetType.Currency\r\n  },\r\n  GNF: {\r\n    id: 'GNF',\r\n    name: 'Guinean Franc',\r\n    type: AssetType.Currency\r\n  },\r\n  KES: {\r\n    id: 'KES',\r\n    name: 'Kenyan Shilling',\r\n    type: AssetType.Currency\r\n  },\r\n  LBP: {\r\n    id: 'LBP',\r\n    name: 'Lebanese Pound',\r\n    type: AssetType.Currency\r\n  },\r\n  LKR: {\r\n    id: 'LKR',\r\n    name: 'Sri Lanka Rupee',\r\n    type: AssetType.Currency\r\n  },\r\n  LRD: {\r\n    id: 'LRD',\r\n    name: 'Liberian Dollar',\r\n    type: AssetType.Currency\r\n  },\r\n  MWK: {\r\n    id: 'MWK',\r\n    name: 'Malawi Kwacha',\r\n    type: AssetType.Currency\r\n  },\r\n  MXN: {\r\n    id: 'MXN',\r\n    name: 'Mexican Peso',\r\n    type: AssetType.Currency\r\n  },\r\n  NAD: {\r\n    id: 'NAD',\r\n    name: 'Namibia Dollar',\r\n    type: AssetType.Currency\r\n  },\r\n  NPR: {\r\n    id: 'NPR',\r\n    name: 'Nepalese Rupee',\r\n    type: AssetType.Currency\r\n  },\r\n  NZD: {\r\n    id: 'NZD',\r\n    name: 'New Zealand Dollar',\r\n    type: AssetType.Currency\r\n  },\r\n  PHP: {\r\n    id: 'PHP',\r\n    name: 'Philippine Piso',\r\n    type: AssetType.Currency\r\n  },\r\n  PKR: {\r\n    id: 'PKR',\r\n    name: 'Pakistan Rupee',\r\n    type: AssetType.Currency\r\n  },\r\n  RUB: {\r\n    id: 'RUB',\r\n    name: 'Russian Ruble',\r\n    type: AssetType.Currency\r\n  },\r\n  RWF: {\r\n    id: 'RWF',\r\n    name: 'Rwanda Franc',\r\n    type: AssetType.Currency\r\n  },\r\n  SDG: {\r\n    id: 'SDG',\r\n    name: 'Sudanese Pound',\r\n    type: AssetType.Currency\r\n  },\r\n  SGD: {\r\n    id: 'SGD',\r\n    name: 'Singapore Dollar',\r\n    type: AssetType.Currency\r\n  },\r\n  SLL: {\r\n    id: 'SLL',\r\n    name: 'Leone',\r\n    type: AssetType.Currency\r\n  },\r\n  SOS: {\r\n    id: 'SOS',\r\n    name: 'Somali Shilling',\r\n    type: AssetType.Currency\r\n  },\r\n  SRD: {\r\n    id: 'SRD',\r\n    name: 'Surinam Dollar',\r\n    type: AssetType.Currency\r\n  },\r\n  SVC: {\r\n    id: 'SVC',\r\n    name: 'El Salvador Colon',\r\n    type: AssetType.Currency\r\n  },\r\n  TND: {\r\n    id: 'TND',\r\n    name: 'Tunisian Dinar',\r\n    type: AssetType.Currency\r\n  },\r\n  TRY: {\r\n    id: 'TRY',\r\n    name: 'Turkish Lira',\r\n    type: AssetType.Currency\r\n  },\r\n  TZS: {\r\n    id: 'TZS',\r\n    name: 'Tanzanian Shilling',\r\n    type: AssetType.Currency\r\n  },\r\n  UGX: {\r\n    id: 'UGX',\r\n    name: 'Uganda Shilling',\r\n    type: AssetType.Currency\r\n  },\r\n  USD: {\r\n    id: 'USD',\r\n    name: 'US Dollar',\r\n    type: AssetType.Currency\r\n  },\r\n  UYU: {\r\n    id: 'UYU',\r\n    name: 'Peso Uruguayo',\r\n    type: AssetType.Currency\r\n  },\r\n  UZS: {\r\n    id: 'UZS',\r\n    name: 'Uzbekistan Sum',\r\n    type: AssetType.Currency\r\n  },\r\n  VEF: {\r\n    id: 'VEF',\r\n    name: 'Bolvar',\r\n    type: AssetType.Currency\r\n  },\r\n  XCD: {\r\n    id: 'XCD',\r\n    name: 'East Caribbean Dollar',\r\n    type: AssetType.Currency\r\n  },\r\n  YER: {\r\n    id: 'YER',\r\n    name: 'Yemeni Rial',\r\n    type: AssetType.Currency\r\n  },\r\n  ZAR: {\r\n    id: 'ZAR',\r\n    name: 'Rand',\r\n    type: AssetType.Currency\r\n  },\r\n  ZMW: {\r\n    id: 'ZMW',\r\n    name: 'Zambian Kwacha',\r\n    type: AssetType.Currency\r\n  },\r\n  ZWL: {\r\n    id: 'ZWL',\r\n    name: 'Zimbabwe Dollar',\r\n    type: AssetType.Currency\r\n  }\r\n};\r\n","/* istanbul ignore file */\nimport axios, { AxiosResponse } from 'axios';\nimport { SaveResult } from 'components/revisions/RevisionExplorer';\nimport { Endpoints, Exit, FlowDefinition, SPEC_VERSION, FlowDetails } from 'flowTypes';\nimport { currencies } from 'store/currencies';\nimport { Activity, RecentMessage } from 'store/editor';\nimport {\n  Asset,\n  AssetMap,\n  Assets,\n  AssetStore,\n  AssetType,\n  CompletionOption\n} from 'store/flowContext';\nimport { assetListToMap } from 'store/helpers';\nimport { CompletionSchema } from 'utils/completion';\nimport { FlowTypes } from 'config/interfaces';\n\n// Configure axios to always send JSON requests\naxios.defaults.headers.post['Content-Type'] = 'application/javascript';\naxios.defaults.responseType = 'json';\naxios.defaults.timeout = 30000;\n\nexport const setHTTPTimeout = (millis: number) => {\n  axios.defaults.timeout = millis;\n};\n\n/**\n * Gets the path activity and the count of active particpants at each node\n * @param {string} flowUUID - The UUID of the current flow\n * @param {string} activityEndpoint - The URL path to the endpoint providing this data\n * @returns {Object} - An object representation of the flow's activty\n */\nexport const getActivity = (\n  activityEndpoint: string,\n  flowUUID: string,\n  headers = {}\n): Promise<Activity> =>\n  new Promise<Activity>((resolve, reject) =>\n    axios\n      .get(`${activityEndpoint}?flow=${flowUUID}`, { headers })\n      .then((response: AxiosResponse) => resolve(response.data as Activity))\n      .catch((error: any) => reject(error))\n  );\n\nexport interface Cancel {\n  reject?: () => void;\n}\n\nexport const saveRevision = (endpoint: string, definition: FlowDefinition): Promise<SaveResult> => {\n  const csrf = getCookie('csrftoken');\n  const headers = csrf ? { 'X-CSRFToken': csrf } : {};\n\n  // update the spec version in our def to the current editor version\n  let patch = '0';\n\n  // honor any existing patch increments\n  let release = definition.spec_version.split('.');\n  if (release.length > 2) {\n    patch = release[2];\n  }\n\n  definition.spec_version = [SPEC_VERSION, patch].join('.');\n\n  return new Promise<SaveResult>((resolve, reject) => {\n    axios\n      .post(endpoint, definition, { headers })\n      .then((response: AxiosResponse) => {\n        if (response.status === 200) {\n          resolve(response.data as SaveResult);\n        } else {\n          reject(response);\n        }\n      })\n      .catch(error => reject(error));\n  });\n};\n\nexport const getRecentMessages = (\n  recentsEndpoint: string,\n  exit: Exit,\n  cancel: Cancel\n): Promise<RecentMessage[]> =>\n  new Promise<RecentMessage[]>((resolve, reject) => {\n    cancel.reject = reject;\n    return axios\n      .get(`${recentsEndpoint}?exits=${exit.uuid}&to=${exit.destination_uuid}`)\n      .then((response: AxiosResponse) => {\n        const recentMessages: RecentMessage[] = [];\n        for (const row of response.data) {\n          recentMessages.push({ text: row.text, sent: row.sent });\n        }\n\n        resolve(response.data as RecentMessage[]);\n      })\n      .catch(error => reject(error));\n  });\n\n/** Get the value for a named cookie */\nexport const getCookie = (name: string): string => {\n  for (const cookie of document.cookie.split(';')) {\n    const idx = cookie.indexOf('=');\n    let key = cookie.substr(0, idx);\n    let value = cookie.substr(idx + 1);\n\n    // no spaces allowed\n    key = key.trim();\n    value = value.trim();\n\n    if (key === name) {\n      return value;\n    }\n  }\n  return null;\n};\n\nexport const postNewAsset = (assets: Assets, payload: any): Promise<Asset> => {\n  // if we have a csrf in our cookie, pass it along as a header\n  const csrf = getCookie('csrftoken');\n  const headers = csrf ? { 'X-CSRFToken': csrf } : {};\n\n  return new Promise<Asset>((resolve, reject) => {\n    axios\n      .post(assets.endpoint, payload, { headers })\n      .then((response: AxiosResponse) => {\n        resolve(response.data);\n      })\n      .catch(error => reject(error));\n  });\n};\n\nexport const fetchAsset = (assets: Assets, id: string): Promise<Asset> => {\n  return new Promise<Asset>((resolve, reject) => {\n    getAssets(assets.endpoint, assets.type, assets.id).then((results: Asset[]) => {\n      resolve(results.find((asset: Asset) => asset.id === id));\n    });\n  });\n};\n\ninterface AssetPage {\n  assets: Asset[];\n  next: string;\n}\n\nexport const getAssetPage = (url: string, type: AssetType, id: string): Promise<AssetPage> => {\n  return new Promise<AssetPage>((resolve, reject) => {\n    axios\n      .get(url)\n      .then((response: AxiosResponse) => {\n        const assets: Asset[] = response.data.results.map((result: any, idx: number) => {\n          const asset = resultToAsset(result, type, id);\n          asset.order = idx;\n          return asset;\n        });\n        resolve({ assets, next: response.data.next });\n      })\n      .catch(error => reject(error));\n  });\n};\n\nexport const getAssets = async (url: string, type: AssetType, id: string): Promise<Asset[]> => {\n  if (!url) {\n    return new Promise<Asset[]>((resolve, reject) => resolve([]));\n  }\n\n  let assets: Asset[] = [];\n  let pageUrl = url;\n  while (pageUrl) {\n    const assetPage = await getAssetPage(pageUrl, type, id);\n    assets = assets.concat(assetPage.assets);\n    pageUrl = assetPage.next;\n  }\n  return assets;\n};\n\nexport const resultToAsset = (result: any, type: AssetType, id: string): Asset => {\n  const idKey = id || 'uuid';\n\n  let assetType = type;\n\n  if (type === AssetType.Flow && result.type) {\n    switch (result.type) {\n      case 'message':\n        result.type = FlowTypes.MESSAGE;\n        break;\n      case 'voice':\n        result.type = FlowTypes.VOICE;\n        break;\n      case 'survey':\n        result.type = FlowTypes.SURVEY;\n        break;\n    }\n  }\n\n  if (type !== AssetType.Flow && result.type) {\n    assetType = result.type;\n  }\n\n  const asset: Asset = {\n    name: result.name || result.text || result.label || result[idKey],\n    id: result[idKey],\n    type: assetType\n  };\n\n  delete result[idKey];\n  delete result.name;\n  delete result.text;\n\n  asset.content = result;\n  return asset;\n};\n\nexport const isMatch = (\n  input: string,\n  asset: Asset,\n  shouldExclude: (asset: Asset) => boolean\n): boolean => {\n  if (shouldExclude && shouldExclude(asset)) {\n    return false;\n  }\n\n  const inputLower = input.toLowerCase();\n  // some assets have ids worth matching\n  if (asset.type === AssetType.Currency || asset.type === AssetType.Language) {\n    if (asset.id.toLowerCase().includes(inputLower)) {\n      return true;\n    }\n  }\n  return asset.name.toLowerCase().includes(inputLower);\n};\n\n/**\n * Searches an AssetMap for a substring\n */\nexport const searchAssetMap = (\n  query: string,\n  assets: AssetMap,\n  additionalOptions?: Asset[],\n  shouldExclude?: (asset: Asset) => boolean\n): Asset[] => {\n  const search = query.toLowerCase();\n  let matches = Object.keys(assets)\n    .map(key => assets[key])\n    .filter((asset: Asset) => isMatch(search, asset, shouldExclude));\n\n  // include our additional matches if we have any\n  matches = matches\n    .concat(additionalOptions || [])\n    .filter((asset: Asset) => isMatch(search, asset, shouldExclude));\n\n  return matches;\n};\n\nexport const createAssetStore = (endpoints: Endpoints): Promise<AssetStore> => {\n  return new Promise<AssetStore>((resolve, reject) => {\n    const assetStore: AssetStore = {\n      channels: {\n        endpoint: getURL(endpoints.channels),\n        type: AssetType.Channel,\n        items: {}\n      },\n      classifiers: {\n        endpoint: getURL(endpoints.classifiers),\n        type: AssetType.Classifier,\n        items: {}\n      },\n      languages: {\n        endpoint: getURL(endpoints.languages),\n        type: AssetType.Language,\n        items: {},\n        id: 'iso'\n      },\n      flows: {\n        endpoint: getURL(endpoints.flows),\n        type: AssetType.Flow,\n        items: {}\n      },\n      fields: {\n        endpoint: getURL(endpoints.fields),\n        type: AssetType.Field,\n        id: 'key',\n        items: {}\n      },\n      globals: {\n        endpoint: getURL(endpoints.globals),\n        type: AssetType.Global,\n        id: 'key',\n        items: {}\n      },\n      groups: {\n        endpoint: getURL(endpoints.groups),\n        type: AssetType.Group,\n        items: {}\n      },\n      revisions: {\n        endpoint: getURL(endpoints.revisions),\n        type: AssetType.Revision,\n        id: 'id',\n        items: {}\n      },\n      labels: {\n        endpoint: getURL(endpoints.labels),\n        type: AssetType.Label,\n        items: {}\n      },\n      results: {\n        type: AssetType.Result,\n        items: {}\n      },\n      recipients: {\n        endpoint: getURL(endpoints.recipients),\n        type: AssetType.Contact || AssetType.Group || AssetType.URN,\n        items: {},\n        id: 'id'\n      },\n      resthooks: {\n        endpoint: getURL(endpoints.resthooks),\n        type: AssetType.Resthook,\n        id: 'resthook',\n        items: {}\n      },\n      templates: {\n        endpoint: getURL(endpoints.templates),\n        type: AssetType.Template,\n        items: {}\n      },\n      ticketers: {\n        endpoint: getURL(endpoints.ticketers),\n        type: AssetType.Ticketer,\n        items: {}\n      },\n      currencies: {\n        type: AssetType.Currency,\n        id: 'id',\n        items: currencies,\n        prefetched: true\n      },\n      validateMedia: {\n        items: {},\n        type: AssetType.ValidateMedia,\n        endpoint: getURL(endpoints.validateMedia)\n      }\n    };\n\n    // prefetch some of our assets\n    const fetches: any[] = [];\n    ['languages', 'fields', 'groups', 'labels', 'globals', 'classifiers'].forEach(\n      (storeId: string) => {\n        const store = assetStore[storeId];\n        fetches.push(\n          getAssets(store.endpoint, store.type, store.id || 'uuid').then((assets: Asset[]) => {\n            store.items = assetListToMap(assets);\n            store.prefetched = true;\n          })\n        );\n      }\n    );\n\n    // wait for our prefetches to finish\n    Promise.all(fetches).then((results: any) => {\n      resolve(assetStore);\n    });\n  });\n};\n\nexport const getFunctions = (endpoint: string): Promise<CompletionOption[]> => {\n  return new Promise<CompletionOption[]>((resolve, reject) => {\n    axios\n      .get(endpoint)\n      .then(response => {\n        resolve(response.data);\n      })\n      .catch(error => reject(error));\n  });\n};\n\nexport const getCompletionSchema = (endpoint: string): Promise<CompletionSchema> => {\n  return new Promise<CompletionSchema>((resolve, reject) => {\n    axios.get(endpoint).then(response => {\n      resolve(response.data);\n    });\n  });\n};\n\nexport const getFlowDetails = (revisions: Assets, id: string = null): Promise<FlowDetails> => {\n  return new Promise<FlowDetails>((resolve, reject) => {\n    (async () => {\n      let revisionToLoad = id;\n      if (!revisionToLoad) {\n        try {\n          const response = await axios.get(`${revisions.endpoint}?version=${SPEC_VERSION}`);\n          if (response.data.results.length > 0) {\n            revisionToLoad = response.data.results[0].id;\n          }\n        } catch (error) {\n          reject(new Error(\"Couldn't reach revisions endpoint\"));\n        }\n      }\n\n      if (revisionToLoad) {\n        const url = `${revisions.endpoint}${revisionToLoad}?version=${SPEC_VERSION}`;\n        axios\n          .get(url)\n          .then((response: AxiosResponse) => {\n            const details = response.data as FlowDetails;\n            return resolve(details);\n          })\n          .catch(error => reject(error));\n      } else {\n        reject(new Error('No revision found for flow'));\n      }\n    })();\n  });\n};\n\nexport const getBaseURL = (): string => {\n  const location = window.location;\n  return location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '');\n};\n\nexport const getURL = (path: string): string => {\n  let url = path;\n  if (!url.endsWith('/') && url.indexOf('?') === -1 && url.indexOf('groups') === -1) {\n    url += '/';\n  }\n\n  if (url.startsWith('http://') || url.startsWith('https://')) {\n    return url;\n  }\n\n  // Set url for netlify deployments\n  // if (process.env.NODE_ENV === \"preview\") {\n  // url = \"/.netlify/functions/\" + url;\n  // }\n\n  const result = `${getBaseURL() + url}`;\n  return result;\n};\n\nexport const showHelpArticle = (link: string) => {\n  window.open(link, 'floweditor_help');\n};\n","import { Contact, Endpoints, Group, RecipientsAction, FlowIssue, FlowIssueType } from 'flowTypes';\nimport * as React from 'react';\nimport { Asset, AssetType } from 'store/flowContext';\nimport { FormEntry, NodeEditorSettings, ValidationFailure } from 'store/nodeEditor';\nimport { createUUID } from 'utils';\nimport { Trans } from 'react-i18next';\nimport shared from 'components/shared.module.scss';\nimport { showHelpArticle } from 'external';\nimport { IssueProps } from '../props';\n\nexport const renderIssues = (issueProps: IssueProps): JSX.Element => {\n  const { issues, helpArticles } = issueProps;\n  if (!issues || issues.length === 0) {\n    return null;\n  }\n\n  return (\n    <div style={{ padding: '10px 0px' }}>\n      {issues.map((issue: FlowIssue, num: Number) => {\n        const key = issue.node_uuid + issue.action_uuid + num;\n        return (\n          <div\n            style={{ margin: '6px 0px', display: 'flex', fontSize: '14px', color: 'tomato' }}\n            key={key}\n          >\n            <div\n              style={{ marginRight: '8px', marginTop: '-2px', fontSize: '18px' }}\n              className={`fe-warning`}\n            />\n            <div>{renderIssue(issue, helpArticles)}</div>\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nexport const renderIssue = (\n  issue: FlowIssue,\n  helpArticles: { [key: string]: string } = {}\n): JSX.Element => {\n  // worst case, defer to the default description\n  let message: JSX.Element = <>{issue.description}</>;\n\n  if (issue.type === FlowIssueType.MISSING_DEPENDENCY) {\n    message = (\n      <Trans\n        i18nKey=\"issues.missing_dependency\"\n        values={{\n          name: issue.dependency.name || issue.dependency.key,\n          type: issue.dependency.type\n        }}\n      >\n        Cannot find a [[type]] for <span className=\"emphasize\">[[name]]</span>\n      </Trans>\n    );\n  }\n\n  if (issue.type === FlowIssueType.INVALID_REGEX) {\n    message = (\n      <Trans i18nKey=\"issues.legacy_extra\" values={{ regex: issue.regex }}>\n        Invalid regular expression found: [[regex]]\n      </Trans>\n    );\n  }\n\n  if (issue.type === FlowIssueType.LEGACY_EXTRA) {\n    message = (\n      <Trans i18nKey=\"issues.legacy_extra\">Expressions should not reference @legacy_extra</Trans>\n    );\n  }\n\n  const article = helpArticles[issue.type];\n  if (article) {\n    return (\n      <div\n        className={shared.issue_help}\n        onClick={() => {\n          showHelpArticle(article);\n        }}\n      >\n        {message}\n      </div>\n    );\n  }\n\n  return message;\n};\n\nexport const getActionUUID = (nodeSettings: NodeEditorSettings, currentType: string): string => {\n  if (nodeSettings.originalAction && nodeSettings.originalAction.type === currentType) {\n    return nodeSettings.originalAction.uuid;\n  }\n  return createUUID();\n};\n\nexport const getRecipients = (action: RecipientsAction): Asset[] => {\n  let selected: any[] = (action.groups || []).map((group: Group) => {\n    return {\n      id: group.uuid,\n      name: group.name,\n      type: AssetType.Group\n    };\n  });\n\n  selected = selected.concat(\n    (action.contacts || []).map((contact: Contact) => {\n      return { id: contact.uuid, name: contact.name, type: AssetType.Contact, missing: false };\n    })\n  );\n\n  selected = selected.concat(\n    (action.legacy_vars || []).map((expression: string) => {\n      return { name: expression, value: expression, expression: true };\n    })\n  );\n\n  return selected;\n};\n\nexport const renderAssetList = (\n  assets: Asset[],\n  max: number = 10,\n  endpoints: Endpoints\n): JSX.Element[] => {\n  // show our missing ones first\n  return assets.reduce((elements, asset, idx) => {\n    if (idx <= max - 2 || assets.length === max) {\n      elements.push(renderAsset(asset, endpoints));\n    } else if (idx === max - 1) {\n      elements.push(<div key=\"ellipses\">+{assets.length - max + 1} more</div>);\n    }\n    return elements;\n  }, []);\n};\n\nexport const renderAsset = (asset: Asset, endpoints: Endpoints) => {\n  let assetBody = null;\n\n  switch (asset.type) {\n    case AssetType.Classifier:\n      assetBody = (\n        <Trans i18nKey=\"assets.classifier\" values={{ name: asset.name }}>\n          Call [[name]] classifier\n        </Trans>\n      );\n      break;\n    case AssetType.Group:\n      assetBody = (\n        <>\n          <span className={`${shared.node_group} fe-group`} />\n          {asset.name}\n        </>\n      );\n      break;\n    case AssetType.Label:\n      assetBody = (\n        <>\n          <span className={`${shared.node_label} fe-label`} />\n          {asset.name}\n        </>\n      );\n      break;\n    case AssetType.Flow:\n      assetBody = (\n        <>\n          <span className={`${shared.node_label} fe-split`} />\n          <a\n            onMouseDown={(e: any) => {\n              e.preventDefault();\n              e.stopPropagation();\n            }}\n            onMouseUp={(e: any) => {\n              e.preventDefault();\n              e.stopPropagation();\n            }}\n            href={`${endpoints.editor}/${asset.id}`}\n            rel=\"noopener noreferrer\"\n            target=\"_blank\"\n          >\n            {asset.name}\n          </a>\n        </>\n      );\n      break;\n    case AssetType.Ticketer:\n      assetBody = (\n        <Trans i18nKey=\"assets.ticketer\" values={{ name: asset.name }}>\n          Using [[name]] service\n        </Trans>\n      );\n      break;\n  }\n\n  if (!assetBody) {\n    assetBody = asset.name;\n  }\n\n  return (\n    <div className={`${shared.node_asset}`} key={asset.id || (asset as any).value}>\n      {assetBody}\n    </div>\n  );\n};\n\nexport const getAllErrors = (entry: FormEntry): ValidationFailure[] => {\n  return entry ? entry.validationFailures || [] : [];\n};\n\nexport const hasErrors = (entry: FormEntry): boolean => {\n  return getAllErrors(entry).length > 0;\n};\n\nexport const getAllErrorMessages = (entry: FormEntry): string[] => {\n  const errors = getAllErrors(entry).map((failure: ValidationFailure) => failure.message);\n  return errors;\n};\n\nexport const getExpressions = (assets: any[]): any[] => {\n  return assets\n    .filter((asset: any) => asset.expression)\n    .map((asset: any) => {\n      return asset.value;\n    });\n};\n\nexport const getRecipientsByAsset = (assets: Asset[], type: AssetType): any[] => {\n  return assets\n    .filter((asset: Asset) => asset.type === type)\n    .map((asset: Asset) => {\n      return { uuid: asset.id, name: asset.name };\n    });\n};\n","import { Type } from 'config/interfaces';\nimport { AnyAction, ContactProperties, FlowIssue } from 'flowTypes';\nimport { Asset, AssetStore, AssetType, RenderNode } from 'store/flowContext';\nimport { NodeEditorSettings } from 'store/nodeEditor';\nimport { DispatchWithState, GetState } from 'store/thunks';\nimport { titleCase } from 'utils';\nimport { CompletionSchema } from 'utils/completion';\n\nexport interface IssueProps {\n  helpArticles: { [key: string]: string };\n  issues: FlowIssue[];\n}\n\nexport interface ActionFormProps extends IssueProps {\n  // action details\n  nodeSettings: NodeEditorSettings;\n  typeConfig: Type;\n  assetStore: AssetStore;\n  completionSchema: CompletionSchema;\n\n  addAsset(assetType: string, asset: Asset): void;\n\n  // update handlers\n  updateAction(\n    action: AnyAction,\n    onUpdated?: (dispatch: DispatchWithState, getState: GetState) => void\n  ): void;\n\n  // modal notifiers\n  onTypeChange(config: Type): void;\n  onClose(canceled: boolean): void;\n}\n\nexport interface RouterFormProps extends IssueProps {\n  nodeSettings: NodeEditorSettings;\n  typeConfig: Type;\n\n  assetStore: AssetStore;\n\n  // update handlers\n  updateRouter(renderNode: RenderNode): void;\n\n  // modal notifiers\n  onTypeChange(config: Type): void;\n  onClose(canceled: boolean): void;\n}\n\nexport interface LocalizationFormProps extends IssueProps {\n  language: Asset;\n  nodeSettings: NodeEditorSettings;\n  updateLocalizations(languageCode: string, localizations: any[]): void;\n  onClose(canceled: boolean): void;\n  helpArticles: { [key: string]: string };\n}\n\nexport const NAME_PROPERTY: Asset = {\n  name: titleCase(ContactProperties.Name),\n  id: ContactProperties.Name,\n  type: AssetType.ContactProperty\n};\n\nexport const CHANNEL_PROPERTY: Asset = {\n  name: titleCase(ContactProperties.Channel),\n  id: ContactProperties.Channel,\n  type: AssetType.ContactProperty\n};\n\nexport const LANGUAGE_PROPERTY: Asset = {\n  name: titleCase(ContactProperties.Language),\n  id: ContactProperties.Language,\n  type: AssetType.ContactProperty\n};\n\nexport const STATUS_PROPERTY: Asset = {\n  name: titleCase(ContactProperties.Status),\n  id: ContactProperties.Status,\n  type: AssetType.ContactProperty\n};\n","import { FlowEditorConfig } from 'flowTypes';\nimport * as React from 'react';\n\nexport const fakePropType: any = (): any => null;\nfakePropType.isRequired = (): any => null;\n\ninterface ConfigProviderProps {\n  config: FlowEditorConfig;\n  children: any;\n}\n\nexport interface ConfigProviderContext {\n  config: FlowEditorConfig;\n}\n\n// ----------------------------------------------------------------------------------------------\n\nexport const SINGLE_CHILD_ERROR = 'ConfigProvider expects only one child component.';\nexport const VALID_CHILD_ERROR =\n  'ConfigProvider expects a valid React element: https://reactjs.org/docs/react-api.html#isvalidelement';\n\nexport default class ConfigProvider extends React.Component<ConfigProviderProps> {\n  public static childContextTypes = {\n    config: fakePropType,\n    assetService: fakePropType\n  };\n\n  constructor(props: ConfigProviderProps) {\n    super(props);\n\n    const tembaStore: any = document.createElement('temba-store');\n\n    tembaStore.completionsEndpoint = props.config.endpoints.completion;\n    tembaStore.functionsEndpoint = props.config.endpoints.functions;\n    tembaStore.fieldsEndpoint = props.config.endpoints.fields;\n    tembaStore.globalsEndpoint = props.config.endpoints.globals;\n\n    document.body.appendChild(tembaStore);\n\n    if (React.Children.count(props.children) > 1) {\n      throw new Error(SINGLE_CHILD_ERROR);\n    } else if (!React.isValidElement(props.children)) {\n      throw new Error(VALID_CHILD_ERROR);\n    }\n  }\n\n  public getChildContext(): ConfigProviderContext {\n    return {\n      config: this.props.config\n    };\n  }\n\n  public render(): JSX.Element {\n    return React.Children.only(this.props.children);\n  }\n}\n","import * as React from 'react';\r\nimport { renderAssetList } from 'components/flow/actions/helpers';\r\nimport { fakePropType } from 'config/ConfigProvider';\r\nimport { AddLabels } from 'flowTypes';\r\nimport { AssetType } from 'store/flowContext';\r\n\r\nexport const MAX_TO_SHOW = 5;\r\n\r\nconst AddLabelsComp: React.SFC<AddLabels> = ({ labels }, context: any): JSX.Element => {\r\n  return (\r\n    <>\r\n      {renderAssetList(\r\n        labels.map(label => {\r\n          return {\r\n            id: label.uuid,\r\n            name: label.name,\r\n            type: AssetType.Label\r\n          };\r\n        }),\r\n        MAX_TO_SHOW,\r\n        context.config.endpoints\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nAddLabelsComp.contextTypes = {\r\n  config: fakePropType\r\n};\r\n\r\nexport default AddLabelsComp;\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport classNames from 'classnames/bind';\r\nimport * as React from 'react';\r\nimport { FormEntry, ValidationFailure } from 'store/nodeEditor';\r\nimport { renderIf } from 'utils';\r\n\r\nimport styles from './FormElement.module.scss';\r\nimport { hasErrors } from 'components/flow/actions/helpers';\r\n\r\nconst cx: any = classNames.bind(styles);\r\n\r\nexport interface FormElementProps {\r\n  name: string;\r\n  helpText?: string | JSX.Element;\r\n  entry?: FormEntry;\r\n  showLabel?: boolean;\r\n  __className?: string;\r\n  border?: boolean;\r\n  sendMsgError?: boolean;\r\n  kaseError?: boolean;\r\n  attribError?: boolean;\r\n  hideError?: boolean;\r\n}\r\n\r\nexport default class FormElement extends React.PureComponent<FormElementProps> {\r\n  constructor(props: FormElementProps) {\r\n    super(props);\r\n    bindCallbacks(this, {\r\n      include: [/^get/, /^has/]\r\n    });\r\n  }\r\n  private getName(): JSX.Element {\r\n    return renderIf(\r\n      this.props.showLabel &&\r\n        this.props.name !== undefined &&\r\n        this.props.name !== null &&\r\n        this.props.name.length > 0\r\n    )(<div className={styles.label}>{this.props.name}</div>);\r\n  }\r\n\r\n  private getHelpText(): JSX.Element {\r\n    return renderIf(this.props.helpText != null)(\r\n      <div className={styles.help_text}>{this.props.helpText} </div>\r\n    );\r\n  }\r\n\r\n  private hasErrors(): boolean {\r\n    return hasErrors(this.props.entry);\r\n  }\r\n\r\n  private getValidationErrors(): ValidationFailure[] {\r\n    if (this.props.entry) {\r\n      return this.props.entry.validationFailures || [];\r\n    }\r\n    return [];\r\n  }\r\n\r\n  private getErrors(): JSX.Element {\r\n    if (this.hasErrors() && !this.props.hideError) {\r\n      const errors = this.getValidationErrors().map((failure, idx) => {\r\n        const className = cx({\r\n          [styles.error]: true,\r\n          [styles.send_msg_error]: this.props.sendMsgError === true\r\n        });\r\n        return (\r\n          <div key={idx} className={className}>\r\n            <div className={styles.arrow_up} />\r\n            <div>{failure.message}</div>\r\n          </div>\r\n        );\r\n      });\r\n      return <div className={styles.error_list}>{errors}</div>;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const name: JSX.Element = this.getName();\r\n    const helpText: JSX.Element = this.getHelpText();\r\n    const errorsToDisplay: JSX.Element = this.getErrors();\r\n\r\n    const className = cx({\r\n      [styles.ele]: true,\r\n      [styles.border]: this.props.border,\r\n      [styles.invalid]: this.hasErrors(),\r\n      [this.props.__className]: this.props.__className !== undefined\r\n    });\r\n\r\n    return (\r\n      <div className={className}>\r\n        {name}\r\n        {this.props.children}\r\n        {helpText}\r\n        {errorsToDisplay}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\n// TODO: consider chunking out translation files\n// and using something like XHR backend to lazily\n// load only the required language.\n// See https://www.i18next.com/how-to/add-or-load-translations\n\nimport defaults from './defaults.json';\nimport en from './en/resource.json';\nimport es from './es/resource.json';\nimport pt from './pt-br/resource.json';\n\nconst resources = {\n  defaults: { translation: defaults },\n  en: { translation: en },\n  es: { translation: es },\n  pt: { translation: pt }\n};\n\ni18n\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    resources,\n\n    // do not load a fallback\n    fallbackLng: ['en', 'defaults'],\n\n    interpolation: {\n      prefix: '[[',\n      suffix: ']]'\n    }\n  });\n\nexport default i18n;\n","import { react as bindCallbacks } from 'auto-bind';\nimport * as React from 'react';\nimport { bool, snakify } from 'utils';\nimport styles from './TembaSelect.module.scss';\nimport { Assets } from 'store/flowContext';\n\nexport enum TembaSelectStyle {\n  small = 'small',\n  normal = 'normal'\n}\n\nexport interface TembaSelectProps {\n  name: string;\n  options?: any[];\n  value: any;\n  onChange: (option: any) => void;\n  onFocus?: () => void;\n  shouldExclude?: (option: any) => boolean;\n  disabled?: boolean;\n\n  createPrefix?: string;\n  expressions?: boolean;\n  assets?: Assets;\n  errors?: string[];\n  style?: TembaSelectStyle;\n\n  placeholder?: string;\n  searchable?: boolean;\n  multi?: boolean;\n  tags?: boolean;\n\n  cacheKey?: string;\n\n  getName?: (option: any) => string;\n\n  nameKey?: string;\n  valueKey?: string;\n\n  sortFunction?(a: any, b: any): number;\n\n  hideError?: boolean;\n\n  clearable?: boolean;\n\n  queryParam?: string;\n}\n\ninterface TembaSelectState {}\n\nexport default class TembaSelect extends React.Component<TembaSelectProps, TembaSelectState> {\n  private selectbox: HTMLElement;\n\n  constructor(props: TembaSelectProps) {\n    super(props);\n\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  public getName(option: any): string {\n    let name = '';\n    if (this.props.getName) {\n      name = this.props.getName(option);\n    }\n\n    if (!name && this.props.nameKey in option) {\n      name = option[this.props.nameKey];\n    }\n\n    if (!name && 'label' in option) {\n      name = option['label'];\n    }\n\n    if (!name) {\n      name = option['name'];\n    }\n    return name;\n  }\n\n  public getValue(option: any): string {\n    return option[this.props.valueKey || 'value'];\n  }\n\n  public isMatch(a: any, b: any): boolean {\n    if (a && b) {\n      if (Array.isArray(a)) {\n        return a.find((option: any) => this.getValue(option) === this.getValue(b));\n      } else {\n        return this.getValue(a) === this.getValue(b);\n      }\n    }\n    return false;\n  }\n\n  public componentDidMount(): void {\n    const select = this;\n    // add the option to create groups abitrarily\n    if (this.props.createPrefix) {\n      (this.selectbox as any).createArbitraryOption = (input: string, options: any[]) => {\n        if (input.indexOf('@') === -1) {\n          var existing = options.find(function(option: any) {\n            const name = select.getName(option);\n            return !!(name.toLowerCase().trim() === input.toLowerCase().trim());\n          });\n          if (!existing) {\n            return {\n              prefix: this.props.createPrefix,\n              name: input,\n              id: 'created'\n            };\n          }\n        }\n      };\n    }\n\n    const selectbox = this.selectbox as any;\n\n    if (this.props.options) {\n      if (selectbox.setOptions) {\n        selectbox.setOptions(this.props.options);\n      }\n    }\n\n    if (this.props.sortFunction) {\n      selectbox.sortFunction = this.props.sortFunction;\n    }\n\n    if (this.props.shouldExclude) {\n      selectbox.shouldExclude = this.props.shouldExclude;\n    }\n\n    selectbox.getName = select.getName.bind(select);\n\n    this.selectbox.addEventListener('change', (event: any) => {\n      const values = event.target.values || [event.target.value];\n\n      let resolved = values;\n\n      if (!this.props.assets && !this.props.tags) {\n        resolved = values.map((op: any) => {\n          const result = (this.props.options || []).find(\n            (option: any) => this.getValue(option) === this.getValue(op)\n          );\n          if (!result && this.props.createPrefix) {\n            return op;\n          }\n          return result;\n        });\n\n        resolved.forEach((option: any) => {\n          if (!option) {\n            throw new Error('No option found for selection');\n          }\n        });\n      }\n\n      if (this.props.onChange) {\n        if (this.props.multi) {\n          this.props.onChange(resolved);\n        } else {\n          this.props.onChange(resolved[0]);\n        }\n      }\n    });\n  }\n\n  public isFocused(): boolean {\n    return (this.selectbox as any).focused;\n  }\n\n  public render(): JSX.Element {\n    let selectedArray: any[] = [];\n    if (this.props.value && !Array.isArray(this.props.value)) {\n      selectedArray = [this.props.value];\n    } else if (Array.isArray(this.props.value)) {\n      selectedArray = this.props.value;\n    }\n\n    const values = JSON.stringify(selectedArray);\n\n    return (\n      <div\n        className={\n          styles[this.props.style || TembaSelectStyle.normal] +\n          ' ' +\n          ((this.props.errors || []).length > 0 ? styles.error : '')\n        }\n      >\n        <temba-select\n          ref={(ele: any) => {\n            this.selectbox = ele;\n          }}\n          data-testid={`temba_select_${snakify(this.props.name)}`}\n          onFocus={this.props.onFocus}\n          nameKey={this.props.nameKey || 'name'}\n          valueKey={this.props.valueKey || 'value'}\n          name={this.props.name}\n          cacheKey={this.props.cacheKey}\n          expressions={this.props.expressions ? 'session' : ''}\n          endpoint={this.props.assets ? this.props.assets.endpoint : null}\n          values={values}\n          errors={JSON.stringify(this.props.errors ? this.props.errors : [])}\n          hideErrors={this.props.hideError}\n          placeholder={this.props.placeholder}\n          searchable={bool(this.props.searchable)}\n          multi={bool(this.props.multi)}\n          disabled={this.props.disabled}\n          clearable={this.props.clearable}\n          tags={this.props.tags}\n          queryParam={this.props.queryParam}\n        />\n      </div>\n    );\n  }\n}\n","import { Template } from 'flowTypes';\nimport { Asset, REMOVE_VALUE_ASSET } from 'store/flowContext';\n\n/**\n * Sorts all search results by name\n */\nexport const sortByName = (a: Asset, b: Asset): number => {\n  if (a.type === REMOVE_VALUE_ASSET.type) {\n    return -1;\n  }\n\n  if (b.type === REMOVE_VALUE_ASSET.type) {\n    return 1;\n  }\n\n  if (a.type && b.type && a.type !== b.type) {\n    return b.type.localeCompare(a.type);\n  }\n\n  if (a.name && b.name) {\n    return a.name.localeCompare(b.name);\n  }\n  return 0;\n};\n\nexport const hasPendingTranslation = (template: Template) => {\n  return !!template.translations.find(translation => translation.status === 'pending');\n};\n\nexport const hasUseableTranslation = (template: Template) => {\n  return !!template.translations.find(\n    translation => translation.status === 'pending' || translation.status === 'approved'\n  );\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport FormElement, { FormElementProps } from 'components/form/FormElement';\nimport { postNewAsset, searchAssetMap } from 'external';\nimport * as React from 'react';\nimport { Asset, Assets, AssetType, REMOVE_VALUE_ASSET } from 'store/flowContext';\nimport { AssetEntry } from 'store/nodeEditor';\n\nimport styles from './AssetSelector.module.scss';\nimport i18n from 'config/i18n';\nimport TembaSelect, { TembaSelectStyle } from 'temba/TembaSelect';\nimport { sortByName } from './helpers';\n\nexport interface AssetSelectorProps extends FormElementProps {\n  assets?: Assets;\n  onChange: (selected: Asset[]) => void;\n\n  // a function to exclude assets when matching\n  shouldExclude?: (asset: Asset) => boolean;\n\n  // override how a name is determined\n  getName?: (option: any) => string;\n\n  // should options not in the list be allowed\n  allowArbitrary?: boolean;\n\n  // allow expression entry\n  expressions?: boolean;\n\n  // more options to consider when searching\n  additionalOptions?: any[];\n\n  placeholder?: string;\n  searchable?: boolean;\n\n  // do we give the clearing option (trash)\n  valueClearable?: boolean;\n\n  // do we present an x to clear the form\n  formClearable?: boolean;\n\n  onFilter?: (asset: Asset) => boolean;\n\n  // creation options\n  createPrefix?: string;\n  onAssetCreated?: (asset: Asset) => void;\n  createAssetFromInput?: (input: string) => Asset;\n\n  // supports multiple selection\n  multi?: boolean;\n\n  // overrids default message when no options to show\n  noOptionsMessage?: string;\n\n  style?: TembaSelectStyle;\n\n  // override default sorting function\n  sortFunction?(a: any, b: any): number;\n\n  nameKey?: string;\n  valueKey?: string;\n}\n\ninterface AssetSelectorState {\n  defaultOptions: Asset[];\n  entry: AssetEntry;\n  isLoading: boolean;\n  message?: string;\n}\n\nexport default class AssetSelector extends React.Component<AssetSelectorProps, AssetSelectorState> {\n  private lastCreation: number = 0;\n\n  private options: any[] = [];\n\n  constructor(props: AssetSelectorProps) {\n    super(props);\n    bindCallbacks(this, {\n      include: [/^is/, /^handle/, /^get/]\n    });\n\n    let defaultOptions: Asset[] = [];\n\n    // or it should be a list of local assets from an empty search\n    if (props.assets && !props.assets.endpoint) {\n      defaultOptions = searchAssetMap('', props.assets.items);\n    }\n\n    this.options = this.props.additionalOptions || [];\n    if (this.props.valueClearable) {\n      this.options.push(REMOVE_VALUE_ASSET);\n    }\n\n    // if we don't have an endpoint, populate our options with items\n    if (!this.props.assets.endpoint) {\n      this.options = this.options.concat(\n        Object.keys(this.props.assets.items).map((id: string) => this.props.assets.items[id])\n      );\n    }\n\n    this.state = {\n      defaultOptions,\n      entry: this.props.entry,\n      isLoading: false\n    };\n  }\n\n  public static getDerivedStateFromProps(\n    nextProps: AssetSelectorProps,\n    prevState: AssetSelectorState\n  ): Partial<AssetSelectorState> {\n    // the default options should be true if there is an endpoint\n    let entry = nextProps.entry;\n\n    // if we don't know our entry name, look for it\n    if (prevState.defaultOptions && entry.value && !entry.value.name) {\n      const existing = prevState.defaultOptions.find((asset: Asset) => asset.id === entry.value.id);\n      if (existing) {\n        entry = { value: existing };\n      }\n    }\n\n    return { entry };\n  }\n\n  private handleChanged(selected: any): void {\n    if (selected) {\n      selected = Array.isArray(selected) ? selected : [selected];\n\n      // do we have an asset to create\n      const toCreate = selected.find((option: any) => option.arbitrary);\n      if (toCreate) {\n        // filter it out\n        selected = selected.filter((option: any) => !option.arbitrary);\n        this.handleCreateOption(toCreate.name);\n      } else {\n        this.props.onChange(selected);\n      }\n    } else {\n      this.props.onChange(selected);\n    }\n    this.setState({ message: null });\n  }\n\n  public handleLoadingComplete(): void {\n    this.setState({ isLoading: false });\n  }\n\n  public handleClearMessage(): void {\n    if (this.state.message) {\n      this.setState({ message: null });\n    }\n  }\n\n  public handleCreateOption(input: string): void {\n    // this is a hack due to react-select triggering two creates in a race\n    const now = new Date().getTime();\n    if (now - this.lastCreation < 1000) {\n      return;\n    }\n\n    this.lastCreation = now;\n    // mark us as loading\n    const asset: Asset = this.props.createAssetFromInput(input);\n\n    if (this.props.assets && this.props.assets.endpoint) {\n      this.setState({ isLoading: true, message: null });\n      postNewAsset(this.props.assets, asset)\n        .then((result: Asset) => {\n          this.setState({ isLoading: false });\n          this.props.onAssetCreated(result);\n          // this.props.onChange([...(this.state.entry.value as any)]);\n        })\n        .catch(error => {\n          let suffix = '';\n          if (error.response && error.response.data && error.response.data.non_field_errors) {\n            suffix = ' ' + error.response.data.non_field_errors.join(', ');\n          }\n          this.setState({\n            message: `Couldn't create new ${this.props.assets.type} \"${input}\".${suffix}`,\n            isLoading: false\n          });\n        });\n    } else {\n      this.props.onChange([asset]);\n    }\n  }\n\n  public getName(option: any) {\n    if (this.props.getName) {\n      return this.props.getName(option);\n    }\n  }\n\n  public render(): JSX.Element {\n    const fallbackPlaceholder = i18n.t(\n      'asset_selector.placeholder',\n      'Select existing [[name]] or enter a new one',\n      { name: this.props.name.toLocaleLowerCase(), count: this.props.multi ? 1000 : 1 }\n    );\n\n    return (\n      <FormElement\n        name={this.props.name}\n        entry={this.props.entry}\n        showLabel={this.props.showLabel}\n        helpText={this.props.helpText}\n        __className={styles.ele}\n      >\n        <TembaSelect\n          name={this.props.name}\n          style={this.props.style}\n          onChange={this.handleChanged}\n          nameKey={this.props.nameKey || 'name'}\n          valueKey={\n            this.props.valueKey || (this.props.assets ? this.props.assets.id : undefined) || 'uuid'\n          }\n          getName={this.props.getName}\n          createPrefix={this.props.createPrefix}\n          shouldExclude={this.props.shouldExclude}\n          assets={this.props.assets}\n          placeholder={this.props.placeholder || fallbackPlaceholder}\n          multi={this.props.multi}\n          expressions={this.props.expressions}\n          value={this.state.entry.value}\n          errors={this.state.message ? [this.state.message] : []}\n          searchable={this.props.searchable}\n          cacheKey={this.lastCreation + ''}\n          options={this.options}\n          sortFunction={this.props.sortFunction || sortByName}\n          queryParam={this.props.assets.type === AssetType.Contact ? 'search' : null}\n        />\n      </FormElement>\n    );\n  }\n}\n","import { FlowTypes, FlowTypeVisibility, ONLINE, Operator, Type } from 'config/interfaces';\nimport { FlowEditorConfig } from 'flowTypes';\n\nexport const isOnlineFlowType = (flowType: FlowTypes) => {\n  return !!ONLINE.find((type: FlowTypes) => type === flowType);\n};\n\nexport const filterOperators = (operators: Operator[], config: FlowEditorConfig): Operator[] => {\n  console.log('operators', operators);\n  return filterVisibility(excludeOperators(operators, config), config);\n};\n\nexport const filterTypeConfigs = (typeConfigs: Type[], config: FlowEditorConfig): Type[] => {\n  return filterVisibility(excludeTypes(typeConfigs, config), config);\n};\n\nconst filterVisibility = (items: FlowTypeVisibility[], config: FlowEditorConfig): any[] => {\n  return items.filter((item: FlowTypeVisibility) => {\n    // if we have a filter on our type, don't return it unless its present in our config\n    if (item.filter) {\n      if (!(config.filters || []).find((name: string) => name === item.filter)) {\n        return false;\n      }\n    }\n\n    if (item.visibility === undefined) {\n      return true;\n    }\n\n    return item.visibility.findIndex((ft: FlowTypes) => ft === config.flowType) > -1;\n  });\n};\n\nconst excludeTypes = (items: Type[], config: FlowEditorConfig): any[] => {\n  if (!config.excludeTypes) {\n    return items;\n  }\n  return items.filter((item: Type) => !config.excludeTypes.includes(item.type));\n};\n\nconst excludeOperators = (items: Operator[], config: FlowEditorConfig): any[] => {\n  if (!config.excludeOperators) {\n    return items;\n  }\n  return items.filter((item: Operator) => !config.excludeOperators.includes(item.type));\n};\n","import { fakePropType } from 'config/ConfigProvider';\nimport { filterTypeConfigs } from 'config/helpers';\nimport { Type } from 'config/interfaces';\nimport { configsToDisplay } from 'config/typeConfigs';\nimport * as React from 'react';\nimport i18n from 'config/i18n';\nimport styles from './TypeList.module.scss';\nimport TembaSelect from 'temba/TembaSelect';\n\nexport interface TypeListProps {\n  __className: string;\n  initialType: Type;\n  onChange(config: Type): void;\n}\n\nexport interface TypeListState {\n  config: Type;\n}\n\nexport default class TypeList extends React.PureComponent<TypeListProps, TypeListState> {\n  private typeConfigs: Type[];\n\n  constructor(props: TypeListProps) {\n    super(props);\n\n    this.state = {\n      config: this.props.initialType\n    };\n\n    this.handleChangeType = this.handleChangeType.bind(this);\n  }\n\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  private handleChangeType(config: Type): void {\n    this.setState({ config }, () => this.props.onChange(config));\n  }\n\n  private getTypeConfigs(): Type[] {\n    if (this.typeConfigs === undefined) {\n      this.typeConfigs = filterTypeConfigs(configsToDisplay, this.context.config);\n    }\n    return this.typeConfigs;\n  }\n\n  public render(): JSX.Element {\n    return (\n      <div className={`${this.props.__className} ${styles.type_list}`}>\n        <p>{i18n.t('forms.type_label', 'When a contact arrives at this point in your flow...')}</p>\n        <div>\n          <TembaSelect\n            key=\"type_select\"\n            name=\"type\"\n            onChange={this.handleChangeType}\n            nameKey=\"description\"\n            valueKey=\"type\"\n            value={this.state.config}\n            options={this.getTypeConfigs()}\n            searchable={true}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n","import * as headerUtils from 'http-headers-validation';\r\nimport { Asset } from 'store/flowContext';\r\nimport { FormEntry, ValidationFailure } from 'store/nodeEditor';\r\nimport { SelectOption } from 'components/form/select/SelectElement';\r\nimport i18n from 'config/i18n';\r\n\r\nexport type FormInput =\r\n  | string\r\n  | string[]\r\n  | number\r\n  | Asset\r\n  | Asset[]\r\n  | SelectOption\r\n  | SelectOption[];\r\nexport type ValidatorFunc = (\r\n  name: string,\r\n  input: FormInput\r\n) => { failures: ValidationFailure[]; value: FormInput };\r\n\r\n// Courtesy of @diegoperini: https://gist.github.com/dperini/729294\r\n// Expected behavior: https://mathiasbynens.be/demo/url-regex\r\nconst REGEX_URL = new RegExp(\r\n  '^' +\r\n    // protocol identifier\r\n    '(?:(?:https?|ftp)://)' +\r\n    // user:pass authentication\r\n    '(?:\\\\S+(?:u:\\\\S*)?@)?' +\r\n    '(?:' +\r\n    // IP address exclusion\r\n    // private & local networks\r\n    '(?!(?:10|127)(?:\\\\.\\\\d{1,3}){3})' +\r\n    '(?!(?:169\\\\.254|192\\\\.168)(?:\\\\.\\\\d{1,3}){2})' +\r\n    '(?!172\\\\.(?:1[6-9]|2\\\\d|3[0-1])(?:\\\\.\\\\d{1,3}){2})' +\r\n    // IP address dotted notation octets\r\n    // excludes loopback network 0.0.0.0\r\n    // excludes reserved space >= 224.0.0.0\r\n    // excludes network & broacast addresses\r\n    // (first & last IP address of each class)\r\n    '(?:[1-9]\\\\d?|1\\\\d\\\\d|2[01]\\\\d|22[0-3])' +\r\n    '(?:\\\\.(?:1?\\\\d{1,2}|2[0-4]\\\\d|25[0-5])){2}' +\r\n    '(?:\\\\.(?:[1-9]\\\\d?|1\\\\d\\\\d|2[0-4]\\\\d|25[0-4]))' +\r\n    '|' +\r\n    // host name\r\n    '(?:(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)' +\r\n    // domain name\r\n    '(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff0-9]-*)*[a-z\\\\u00a1-\\\\uffff0-9]+)*' +\r\n    // TLD identifier\r\n    '(?:\\\\.(?:[a-z\\\\u00a1-\\\\uffff]{2,}))' +\r\n    // TLD may end with dot\r\n    '\\\\.?' +\r\n    ')' +\r\n    // port number\r\n    '(?::\\\\d{2,5})?' +\r\n    // resource path\r\n    '(?:[/?#]\\\\S*)?' +\r\n    '$',\r\n  'i'\r\n);\r\n\r\nconst inputAsString = (input: FormInput): string => {\r\n  let value = input;\r\n  if (typeof input === 'string') {\r\n    return value + '';\r\n  }\r\n\r\n  // if we are an object consider the name to match assets\r\n  if (input && typeof input === 'object') {\r\n    value = (input as any).name || undefined;\r\n  }\r\n\r\n  return value ? value + '' : null;\r\n};\r\n\r\nconst fromMaxItems = (max: number): ValidatorFunc => (name: string, input: FormInput) => {\r\n  if (Array.isArray(input)) {\r\n    const items = input as string[];\r\n    if (items.length > max) {\r\n      return {\r\n        value: input,\r\n        failures: [{ message: `${name} cannot have more than ${max} entries` }]\r\n      };\r\n    }\r\n  }\r\n  return { failures: [], value: input };\r\n};\r\n\r\nconst fromRegex = (regex: RegExp, message: string): ValidatorFunc => (\r\n  name: string,\r\n  input: FormInput\r\n) => {\r\n  const value = inputAsString(input);\r\n  if (value) {\r\n    if (!regex.test(value)) {\r\n      return {\r\n        value: input,\r\n        failures: [{ message: `${name} ${message}` }]\r\n      };\r\n    }\r\n  }\r\n  return { failures: [], value: input };\r\n};\r\n\r\nexport const validate = (\r\n  name: string,\r\n  input: FormInput,\r\n  validators: ValidatorFunc[]\r\n): FormEntry => {\r\n  let allFailures: ValidationFailure[] = [];\r\n  let value = input;\r\n  validators.forEach(validateFunc => {\r\n    const validation = validateFunc(name, input);\r\n    value = validation.value;\r\n    allFailures = allFailures.concat(validation.failures);\r\n  });\r\n\r\n  return { value, validationFailures: allFailures };\r\n};\r\n\r\nexport const Empty: ValidatorFunc = (name: string, input: FormInput) => {\r\n  const isNotFinished = i18n.t('forms.is_not_finished', 'is not finished');\r\n\r\n  if (input) {\r\n    return { value: input, failures: [{ message: `${name} ${isNotFinished}` }] };\r\n  }\r\n\r\n  if (typeof input === 'string') {\r\n    if ((input as string).trim().length !== 0) {\r\n      return {\r\n        value: input,\r\n        failures: [{ message: `${name} ${isNotFinished}` }]\r\n      };\r\n    }\r\n  } else if (Array.isArray(input)) {\r\n    if (input.length !== 0) {\r\n      return {\r\n        value: input,\r\n        failures: [{ message: `${name} ${isNotFinished}` }]\r\n      };\r\n    }\r\n  }\r\n  return { failures: [], value: input };\r\n};\r\n\r\nexport const Required: ValidatorFunc = (name: string, input: FormInput) => {\r\n  const isRequired = i18n.t('forms.is_required', 'is required');\r\n\r\n  if (!input) {\r\n    return { value: input, failures: [{ message: `${name} ${isRequired}` }] };\r\n  }\r\n\r\n  if (typeof input === 'string') {\r\n    if ((input as string).trim().length === 0) {\r\n      return { value: input, failures: [{ message: `${name} ${isRequired}` }] };\r\n    }\r\n  } else if (Array.isArray(input)) {\r\n    if (input.length === 0) {\r\n      return {\r\n        value: input,\r\n        failures: [{ message: `${name} ${i18n.t('forms.are_required', 'are required')}` }]\r\n      };\r\n    }\r\n  }\r\n  return { failures: [], value: input };\r\n};\r\n\r\nexport const Regex: ValidatorFunc = (name: string, input: FormInput) => {\r\n  if (typeof input === 'string') {\r\n    const inputString = input as string;\r\n\r\n    if (inputString.trim().startsWith('@')) {\r\n      return { failures: [], value: input };\r\n    }\r\n\r\n    try {\r\n      // tslint:disable-next-line:no-unused-expression\r\n      new RegExp(inputString);\r\n    } catch (e) {\r\n      return {\r\n        value: input,\r\n        failures: [\r\n          {\r\n            message: `${name} ${i18n.t('forms.is_not_a_valid_regex', 'is not a valid regex')}`\r\n          }\r\n        ]\r\n      };\r\n    }\r\n  }\r\n\r\n  return { failures: [], value: input };\r\n};\r\n\r\nexport const LessThan = (amount: number, checkName: string): ValidatorFunc => (\r\n  name: string,\r\n  input: FormInput\r\n) => {\r\n  if (typeof input === 'string') {\r\n    if (parseFloat(input as string) >= amount) {\r\n      return {\r\n        value: input,\r\n        failures: [\r\n          {\r\n            message: `${name} ${i18n.t(\r\n              'forms.must_be_less_than',\r\n              'must be less than'\r\n            )} ${checkName}`\r\n          }\r\n        ]\r\n      };\r\n    }\r\n\r\n    return { failures: [], value: input };\r\n  }\r\n  return { failures: [], value: input };\r\n};\r\n\r\nexport const MoreThan = (amount: number, checkName: string): ValidatorFunc => (\r\n  name: string,\r\n  input: FormInput\r\n) => {\r\n  if (typeof input === 'string') {\r\n    if (parseFloat(input as string) <= amount) {\r\n      return {\r\n        value: input,\r\n        failures: [{ message: `${name} must be a more than ${checkName}` }]\r\n      };\r\n    }\r\n\r\n    return { failures: [], value: input };\r\n  }\r\n  return { failures: [], value: input };\r\n};\r\n\r\nexport const shouldRequireIf = (required: boolean): ValidatorFunc => (\r\n  name: string,\r\n  input: FormInput\r\n) => {\r\n  if (required) {\r\n    return Required(name, input);\r\n  }\r\n  return { failures: [], value: input };\r\n};\r\n\r\nexport const validateIf = (func: ValidatorFunc, predicate: boolean): ValidatorFunc => (\r\n  name: string,\r\n  input: FormInput\r\n) => {\r\n  if (predicate) {\r\n    return func(name, input);\r\n  }\r\n  return { failures: [], value: input };\r\n};\r\n\r\nexport const HeaderName: ValidatorFunc = (name: string, input: FormInput) => {\r\n  if (typeof input === 'string') {\r\n    if (input.trim().length > 0 && !headerUtils.validateHeaderName(input)) {\r\n      return { failures: [{ message: 'Invalid header name' }], value: input };\r\n    }\r\n  }\r\n  return { failures: [], value: input };\r\n};\r\n\r\nexport const IsValidIntent = (classifier: Asset): ValidatorFunc => (\r\n  name: string,\r\n  input: FormInput\r\n) => {\r\n  if (typeof input === 'object') {\r\n    const option = input as SelectOption;\r\n\r\n    if (option && classifier && classifier.content) {\r\n      const exists = !!classifier.content.intents.find((intent: string) => intent === option.value);\r\n      if (!exists) {\r\n        return {\r\n          value: input,\r\n          failures: [{ message: `${option.value} is not a valid intent for ${classifier.name}` }]\r\n        };\r\n      }\r\n    }\r\n    return { failures: [], value: input };\r\n  }\r\n  return { failures: [], value: input };\r\n};\r\n\r\nexport const MaxOfTenItems = fromMaxItems(10);\r\nexport const StartIsNonNumeric = fromRegex(/^(?!\\d)/, \"can't start with a number\");\r\nexport const ValidURL = fromRegex(REGEX_URL, 'is not a valid URL');\r\nexport const Numeric = fromRegex(/^([-+]?((\\.\\d+)|(\\d+)(\\.\\d+)?)$)/, 'must be a number');\r\nexport const Alphanumeric = fromRegex(/^[a-z\\d\\-_\\s]+$/i, 'can only have letters and numbers');\r\nexport const NumOrExp = fromRegex(/^@.*$|^([-+]?((\\.\\d+)|(\\d+)(\\.\\d+)?)$)/, 'must be a number');\r\n","import { hasErrors } from 'components/flow/actions/helpers';\r\nimport { SelectOption } from 'components/form/select/SelectElement';\r\nimport { Type } from 'config/interfaces';\r\nimport { Scheme } from 'config/typeConfigs';\r\nimport { AnyAction } from 'flowTypes';\r\nimport mutate from 'immutability-helper';\r\nimport { combineReducers } from 'redux';\r\nimport { LocalizedObject } from 'services/Localization';\r\nimport ActionTypes, {\r\n  UpdateNodeEditorSettings,\r\n  UpdateTypeConfigAction,\r\n  UpdateUserAddingActionAction\r\n} from 'store/actionTypes';\r\nimport Constants from 'store/constants';\r\nimport { Asset, RenderNode } from 'store/flowContext';\r\n\r\n// tslint:disable:no-shadowed-variable\r\nexport interface ValidationFailure {\r\n  message: string;\r\n}\r\n\r\nexport interface FormEntry {\r\n  value: any;\r\n  validationFailures?: ValidationFailure[];\r\n}\r\n\r\nexport interface SelectOptionEntry extends FormEntry {\r\n  value: SelectOption;\r\n}\r\n\r\nexport interface NumberEntry extends FormEntry {\r\n  value: number;\r\n}\r\n\r\nexport interface StringEntry extends FormEntry {\r\n  value: string;\r\n}\r\n\r\nexport interface SchemeEntry extends FormEntry {\r\n  value: Scheme;\r\n}\r\n\r\nexport interface StringArrayEntry extends FormEntry {\r\n  value: string[];\r\n}\r\n\r\nexport interface AssetEntry extends FormEntry {\r\n  value: Asset;\r\n}\r\n\r\nexport interface AssetArrayEntry extends FormEntry {\r\n  value: Asset[] | null;\r\n}\r\n\r\nexport interface SelectOptionArrayEntry extends FormEntry {\r\n  value: SelectOption[] | null;\r\n}\r\n\r\nexport const mergeForm = (\r\n  form: FormState,\r\n  toMerge: Partial<FormState>,\r\n  toRemove: any[] = []\r\n): FormState => {\r\n  // TODO: deal with explicit array setting\r\n  let updated = form || {};\r\n  // we auto update array items with uuids\r\n  for (const key of Object.keys(toMerge)) {\r\n    const entry: any = (toMerge as any)[key];\r\n    if (Array.isArray(entry)) {\r\n      for (const item of entry) {\r\n        // we support objects with uuids or FormEntry's with uuids\r\n        const isEntry = item.hasOwnProperty('value') && typeof item.value === 'object';\r\n\r\n        if ((isEntry && item.value.uuid) || item.uuid) {\r\n          const existingIdx = (form as any)[key].findIndex((existing: any) => {\r\n            if (isEntry) {\r\n              return existing.value.uuid === item.value.uuid;\r\n            } else {\r\n              return existing.uuid === item.uuid;\r\n            }\r\n          });\r\n\r\n          if (existingIdx > -1) {\r\n            // we found a match, merge us in\r\n            updated = mutate(updated, {\r\n              [key]: { $merge: { [existingIdx]: item } }\r\n            }) as FormState;\r\n          } else {\r\n            // couldn't find it, lets push it on\r\n            updated = mutate(updated, {\r\n              [key]: { $push: [item] }\r\n            }) as FormState;\r\n          }\r\n        }\r\n      }\r\n\r\n      // remove it from our merge\r\n      delete (toMerge as any)[key];\r\n    }\r\n  }\r\n\r\n  // removals can be items in an array\r\n  for (const remove of toRemove.filter((item: any) => typeof item === 'object')) {\r\n    for (const key of Object.keys(remove)) {\r\n      const entry: any = remove[key];\r\n      if (Array.isArray(entry)) {\r\n        for (const item of entry) {\r\n          // we support objects with uuids or FormEntry's with uuids\r\n          const isEntry = item.hasOwnProperty('value') && typeof item.value === 'object';\r\n          if ((isEntry && item.value.uuid) || item.uuid) {\r\n            updated = mutate(updated, {\r\n              [key]: (items: any) =>\r\n                items.filter((existing: any) => {\r\n                  if (isEntry) {\r\n                    return existing.value.uuid !== item.value.uuid;\r\n                  } else {\r\n                    return existing.uuid !== item.uuid;\r\n                  }\r\n                })\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  const removeKeys = toRemove.filter((item: any) => typeof item === 'string');\r\n  updated = mutate(updated, {\r\n    $merge: toMerge,\r\n    $unset: removeKeys\r\n  }) as FormState;\r\n\r\n  let valid = true;\r\n  for (const key of Object.keys(form)) {\r\n    const entry: any = (updated as any)[key];\r\n    if (Array.isArray(entry)) {\r\n      for (const item of entry) {\r\n        if (hasErrors(item)) {\r\n          valid = false;\r\n          break;\r\n        }\r\n      }\r\n    } else if (entry && typeof entry === 'object') {\r\n      if (hasErrors(entry)) {\r\n        valid = false;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return mutate(updated, { $merge: { valid } }) as FormState;\r\n};\r\n\r\nexport interface FormState {\r\n  validationFailures?: ValidationFailure[];\r\n  valid: boolean;\r\n}\r\n\r\nexport interface NodeEditorSettings {\r\n  originalNode: RenderNode;\r\n  showAdvanced?: boolean;\r\n  originalAction?: AnyAction;\r\n  localizations?: LocalizedObject[];\r\n}\r\n\r\nexport interface NodeEditor {\r\n  typeConfig: Type | null;\r\n  userAddingAction: boolean;\r\n  settings: NodeEditorSettings | null;\r\n}\r\n\r\n// Initial state\r\nexport const initialState: NodeEditor = {\r\n  typeConfig: null,\r\n  userAddingAction: false,\r\n  settings: null\r\n};\r\n\r\n// Action Creators\r\nexport const updateTypeConfig = (typeConfig: Type): UpdateTypeConfigAction => ({\r\n  type: Constants.UPDATE_TYPE_CONFIG,\r\n  payload: {\r\n    typeConfig\r\n  }\r\n});\r\n\r\nexport const updateNodeEditorSettings = (\r\n  settings: NodeEditorSettings\r\n): UpdateNodeEditorSettings => ({\r\n  type: Constants.UPDATE_NODE_EDITOR_SETTINGS,\r\n  payload: {\r\n    settings\r\n  }\r\n});\r\n\r\nexport const updateUserAddingAction = (\r\n  userAddingAction: boolean\r\n): UpdateUserAddingActionAction => ({\r\n  type: Constants.UPDATE_USER_ADDING_ACTION,\r\n  payload: {\r\n    userAddingAction\r\n  }\r\n});\r\n\r\n// Reducers\r\nexport const typeConfig = (state: Type | null = initialState.typeConfig, action: ActionTypes) => {\r\n  switch (action.type) {\r\n    case Constants.UPDATE_TYPE_CONFIG:\r\n      return action.payload!.typeConfig;\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport const userAddingAction = (\r\n  state: boolean = initialState.userAddingAction,\r\n  action: ActionTypes\r\n) => {\r\n  switch (action.type) {\r\n    case Constants.UPDATE_USER_ADDING_ACTION:\r\n      return action.payload!.userAddingAction;\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport const settings = (\r\n  state: NodeEditorSettings | null = initialState.settings,\r\n  action: ActionTypes\r\n) => {\r\n  switch (action.type) {\r\n    case Constants.UPDATE_NODE_EDITOR_SETTINGS:\r\n      return action.payload!.settings;\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\n// Root reducer\r\nexport default combineReducers({\r\n  typeConfig,\r\n  userAddingAction,\r\n  settings\r\n});\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { ActionFormProps } from 'components/flow/props';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { fakePropType } from 'config/ConfigProvider';\nimport * as React from 'react';\nimport { Asset } from 'store/flowContext';\nimport { FormState, mergeForm } from 'store/nodeEditor';\nimport { shouldRequireIf, validate } from 'store/validators';\n\nimport { initializeForm, stateToAction } from './helpers';\nimport i18n from 'config/i18n';\nimport { Trans } from 'react-i18next';\nimport { renderIssues } from '../helpers';\n\nexport interface AddLabelsFormState extends FormState {\n  labels: any;\n}\n\nexport const controlLabelSpecId = 'label';\n\nexport default class AddLabelsForm extends React.PureComponent<\n  ActionFormProps,\n  AddLabelsFormState\n> {\n  public static contextTypes = {\n    assetService: fakePropType\n  };\n\n  constructor(props: ActionFormProps) {\n    super(props);\n\n    this.state = initializeForm(this.props.nodeSettings);\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  public handleSave(): void {\n    const valid = this.handleLabelsChanged(this.state.labels.value!, true);\n\n    if (valid) {\n      const newAction = stateToAction(this.props.nodeSettings, this.state);\n      this.props.updateAction(newAction);\n      this.props.onClose(false);\n    }\n  }\n\n  public handleLabelsChanged(selected: Asset[], submitting: boolean = false): boolean {\n    const updates: Partial<AddLabelsFormState> = {\n      labels: validate(i18n.t('forms.labels', 'Labels'), selected, [shouldRequireIf(submitting)])\n    };\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  public handleCreateAssetFromInput(input: string): any {\n    return { name: input };\n  }\n\n  public handleLabelCreated(label: Asset): void {\n    // update our store with our new group\n    this.props.addAsset('labels', label);\n\n    this.handleLabelsChanged(this.state.labels.value!.concat(label));\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <p data-spec={controlLabelSpecId}>\n          <Trans i18nKey=\"forms.add_labels_summary\">\n            Select the labels to apply to the incoming message.\n          </Trans>\n        </p>\n\n        <AssetSelector\n          name={i18n.t('forms.labels', 'Labels')}\n          placeholder={i18n.t(\n            'enter_to_create_label',\n            'Enter the name of an existing label or create a new one'\n          )}\n          assets={this.props.assetStore.labels}\n          entry={this.state.labels}\n          searchable={true}\n          multi={true}\n          onChange={this.handleLabelsChanged}\n          createPrefix={i18n.t('create_label', 'Create Label') + ': '}\n          createAssetFromInput={this.handleCreateAssetFromInput}\n          onAssetCreated={this.handleLabelCreated}\n        />\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { AddLabelsFormState } from 'components/flow/actions/addlabels/AddLabelsForm';\nimport { getActionUUID } from 'components/flow/actions/helpers';\nimport { Types } from 'config/interfaces';\nimport { AddLabels } from 'flowTypes';\nimport { NodeEditorSettings } from 'store/nodeEditor';\n\nexport const initializeForm = (settings: NodeEditorSettings): AddLabelsFormState => {\n  if (settings.originalAction && settings.originalAction.type === Types.add_input_labels) {\n    const action = settings.originalAction as AddLabels;\n    return {\n      labels: { value: action.labels },\n      valid: true\n    };\n  }\n\n  return {\n    labels: { value: [] },\n    valid: false\n  };\n};\n\nexport const stateToAction = (\n  settings: NodeEditorSettings,\n  formState: AddLabelsFormState\n): AddLabels => {\n  return {\n    type: Types.add_input_labels,\n    labels: formState.labels.value,\n    uuid: getActionUUID(settings, Types.add_input_labels)\n  };\n};\n","import { AddURNFormState } from 'components/flow/actions/addurn/AddURNForm';\nimport { getActionUUID } from 'components/flow/actions/helpers';\nimport { SelectOption } from 'components/form/select/SelectElement';\nimport { Types } from 'config/interfaces';\nimport { Scheme, SCHEMES } from 'config/typeConfigs';\nimport { AddURN } from 'flowTypes';\nimport { NodeEditorSettings } from 'store/nodeEditor';\n\nexport const getSchemeOptions = (): SelectOption[] => {\n  return SCHEMES.map((scheme: Scheme) => {\n    return schemeToSelectOption(scheme);\n  });\n};\n\nexport const getSchemeObject = (scheme: string): Scheme => {\n  return SCHEMES.find((item: Scheme) => item.scheme === scheme)!;\n};\n\nexport const getSchemeSelectOption = (scheme: string): SelectOption =>\n  schemeToSelectOption(getSchemeObject(scheme));\n\nexport const schemeToSelectOption = (scheme: Scheme): SelectOption => {\n  return { value: scheme.scheme, name: scheme.path };\n};\n\nexport const initializeForm = (settings: NodeEditorSettings): AddURNFormState => {\n  if (settings.originalAction && settings.originalAction.type === Types.add_contact_urn) {\n    const { scheme, path } = settings.originalAction as AddURN;\n\n    return {\n      scheme: { value: getSchemeSelectOption(scheme) },\n      path: { value: path },\n      valid: true\n    };\n  }\n\n  return {\n    scheme: { value: getSchemeSelectOption('tel') },\n    path: { value: '' },\n    valid: false\n  };\n};\n\nexport const stateToAction = (settings: NodeEditorSettings, formState: AddURNFormState): AddURN => {\n  return {\n    type: Types.add_contact_urn,\n    uuid: getActionUUID(settings, Types.add_input_labels),\n    scheme: formState.scheme.value.value,\n    path: formState.path.value\n  };\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport FormElement, { FormElementProps } from 'components/form/FormElement';\nimport * as React from 'react';\nimport { StringEntry } from 'store/nodeEditor';\nimport { createTextInput } from './helpers';\n\nimport styles from './TextInputElement.module.scss';\nexport enum Count {\n  SMS = 'SMS'\n}\n\nexport enum TextInputStyle {\n  small = 'small',\n  normal = 'normal'\n}\n\nexport interface TextInputProps extends FormElementProps {\n  entry?: StringEntry;\n  __className?: string;\n  count?: Count;\n  textarea?: boolean;\n  placeholder?: string;\n  autocomplete?: boolean;\n  focus?: boolean;\n  showInvalid?: boolean;\n  maxLength?: number;\n  counter?: string;\n  style?: TextInputStyle;\n  onChange?: (value: string, name?: string) => void;\n  onBlur?: (event: React.ChangeEvent) => void;\n}\n\nexport default class TextInputElement extends React.Component<TextInputProps> {\n  constructor(props: TextInputProps) {\n    super(props);\n\n    let initial = '';\n    if (this.props.entry && this.props.entry.value) {\n      initial = this.props.entry.value;\n    }\n\n    this.state = {\n      value: initial\n    };\n\n    bindCallbacks(this, {\n      include: [/^on/, /Ref$/, 'setSelection', 'validate', /^has/, /^handle/]\n    });\n  }\n\n  public componentDidMount(): void {\n    // return this.props.focus && this.focusInput();\n  }\n\n  public handleChange({ currentTarget: { value } }: any): void {\n    if (this.props.onChange) {\n      this.props.onChange(value, this.props.name);\n    }\n  }\n\n  public render(): JSX.Element {\n    const charCount: JSX.Element =\n      this.props.count && this.props.count === Count.SMS ? (\n        <temba-charcount text={this.props.entry.value}></temba-charcount>\n      ) : null;\n\n    const optional: any = {};\n    if (this.props.textarea) {\n      optional['textarea'] = true;\n    }\n\n    if (this.props.counter) {\n      optional['counter'] = this.props.counter;\n    }\n\n    return (\n      <FormElement\n        __className={this.props.__className}\n        name={this.props.name}\n        helpText={this.props.helpText}\n        showLabel={this.props.showLabel}\n        // errors={this.state.errors}\n        entry={this.props.entry}\n      >\n        <div className={styles.wrapper + ' ' + styles[this.props.style || TextInputStyle.normal]}>\n          {createTextInput(this.props, this.handleChange, optional)}\n          {charCount}\n        </div>\n      </FormElement>\n    );\n  }\n}\n","import * as React from 'react';\r\nimport { AddURN } from 'flowTypes';\r\n\r\nimport { getSchemeObject } from './helpers';\r\nimport i18n from 'config/i18n';\r\nimport { emphasize } from 'utils';\r\n\r\nexport const MAX_TO_SHOW = 5;\r\n\r\nconst AddURNComp: React.SFC<AddURN> = ({ scheme, path }): JSX.Element => {\r\n  const schemeObject = getSchemeObject(scheme);\r\n  const schemeName = schemeObject ? schemeObject.path : scheme;\r\n  return (\r\n    <>\r\n      {i18n.t('add', 'Add')} {schemeName} {emphasize(path)}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AddURNComp;\r\n","import FormElement, { FormElementProps } from 'components/form/FormElement';\nimport * as React from 'react';\nimport TembaSelect, { TembaSelectStyle } from 'temba/TembaSelect';\nimport { getAllErrorMessages } from 'components/flow/actions/helpers';\n\ninterface SelectElementProps extends FormElementProps {\n  onChange?(value: any, action?: any): void;\n  onMenuOpen?: () => void;\n  onMenuClose?: () => void;\n  options: any;\n\n  style?: TembaSelectStyle;\n  placeholder?: string;\n  clearable?: boolean;\n\n  multi?: boolean;\n  styles?: any;\n\n  nameKey?: string;\n  valueKey?: string;\n\n  disabled?: boolean;\n}\n\nexport interface SelectOption {\n  name: string;\n  value: string;\n}\n\nexport default class SelectElement extends React.Component<SelectElementProps> {\n  public render(): JSX.Element {\n    return (\n      <FormElement name={this.props.name} entry={this.props.entry}>\n        <TembaSelect\n          key={this.props.name + '_select'}\n          name={this.props.name}\n          nameKey={this.props.nameKey}\n          valueKey={this.props.valueKey}\n          placeholder={this.props.placeholder}\n          onChange={this.props.onChange}\n          value={this.props.entry.value}\n          options={this.props.options}\n          searchable={false}\n          errors={getAllErrorMessages(this.props.entry)}\n          hideError={this.props.hideError}\n          style={this.props.style}\n          multi={this.props.multi}\n          disabled={this.props.disabled}\n          clearable={this.props.clearable}\n        ></TembaSelect>\n      </FormElement>\n    );\n  }\n}\n","import * as React from 'react';\nimport { TextInputProps } from './TextInputElement';\n\nexport const createTextInput = (props: TextInputProps, handleChange: any, optional: any) => {\n  return props.autocomplete ? (\n    <temba-completion\n      name={props.name}\n      onInput={handleChange}\n      onBlur={props.onBlur}\n      value={props.entry.value}\n      placeholder={props.placeholder}\n      maxLength={props.maxLength || -1}\n      session\n      {...optional}\n    ></temba-completion>\n  ) : (\n    <temba-textinput\n      name={props.name}\n      onInput={handleChange}\n      onBlur={props.onBlur}\n      value={props.entry.value}\n      placeholder={props.placeholder}\n      maxLength={props.maxLength || -1}\n      {...optional}\n    ></temba-textinput>\n  );\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { ActionFormProps } from 'components/flow/props';\nimport SelectElement, { SelectOption } from 'components/form/select/SelectElement';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport * as React from 'react';\nimport { FormState, mergeForm, SelectOptionEntry, StringEntry } from 'store/nodeEditor';\nimport { shouldRequireIf, validate } from 'store/validators';\n\nimport styles from './AddURNForm.module.scss';\nimport { getSchemeOptions, initializeForm, stateToAction } from './helpers';\nimport i18n from 'config/i18n';\nimport { Trans } from 'react-i18next';\nimport { renderIssues } from '../helpers';\n\nexport interface AddURNFormState extends FormState {\n  scheme: SelectOptionEntry;\n  path: StringEntry;\n}\n\nexport const controlLabelSpecId = 'label';\n\nexport default class AddURNForm extends React.PureComponent<ActionFormProps, AddURNFormState> {\n  constructor(props: ActionFormProps) {\n    super(props);\n    this.state = initializeForm(this.props.nodeSettings);\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  public handleSave(): void {\n    const valid = this.handlePathChanged(this.state.path.value, null, true);\n    if (valid) {\n      const newAction = stateToAction(this.props.nodeSettings, this.state);\n      this.props.updateAction(newAction);\n      this.props.onClose(false);\n    }\n  }\n\n  public handleSchemeChanged(selected: SelectOption): boolean {\n    const updates: Partial<AddURNFormState> = {\n      scheme: { value: selected }\n    };\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  public handlePathChanged(value: string, name: string, submitting: boolean = false): boolean {\n    const updates: Partial<AddURNFormState> = {\n      path: validate(i18n.t('forms.urn', 'URN'), value, [shouldRequireIf(submitting)])\n    };\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <p data-spec={controlLabelSpecId}>\n          <Trans i18nKey=\"forms.add_urn_summary\">\n            Add a new URN to reach the contact such as a phone number.\n          </Trans>\n        </p>\n        <div style={{ display: 'flex', alignItems: 'flex-end' }}>\n          <div className={styles.scheme_selection}>\n            <SelectElement\n              key={'urn_type_select'}\n              name={i18n.t('forms.urn_type', 'URN Type')}\n              entry={this.state.scheme}\n              onChange={this.handleSchemeChanged}\n              options={getSchemeOptions()}\n            />\n          </div>\n          <div className={styles.path}>\n            <TextInputElement\n              name={i18n.t('forms.urn', 'URN')}\n              placeholder=\"Enter the URN value\"\n              entry={this.state.path}\n              onChange={this.handlePathChanged}\n              autocomplete={true}\n            />\n          </div>\n        </div>\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import * as React from 'react';\r\nimport { CallResthook } from 'flowTypes';\r\n\r\nconst CallResthookComp: React.SFC<CallResthook> = ({ resthook }): JSX.Element => (\r\n  <div>{resthook}</div>\r\n);\r\n\r\nexport default CallResthookComp;\r\n","import * as React from 'react';\nimport { CallWebhook } from 'flowTypes';\nimport { ellipsize } from 'utils';\n\nconst CallWebhookComp: React.SFC<CallWebhook> = ({ url }): JSX.Element => (\n  <div>{ellipsize(url, 150)}</div>\n);\n\nexport default CallWebhookComp;\n","import { Group } from 'flowTypes';\nimport { Asset, AssetType } from 'store/flowContext';\nimport { FormState } from 'store/nodeEditor';\n\nexport const labelSpecId = 'label';\n\nexport interface ChangeGroupsFormState extends FormState {\n  groups: any;\n  removeAll?: boolean;\n}\n\nexport const excludeDynamicGroups = (group: any): boolean => {\n  return !!group.query;\n};\n\nexport const mapGroupsToAssets = (groups: Group[]): Asset[] => {\n  return groups.map(({ name, uuid, name_match }) => {\n    if (name_match) {\n      return { name: name_match, id: name_match, type: AssetType.GroupNameMatch };\n    }\n    return { name, id: uuid, type: AssetType.Group };\n  });\n};\n\nexport const mapAssetsToGroups = (searchResults: Asset[] | null): Group[] => {\n  if (!searchResults) {\n    return [];\n  }\n\n  const groups = searchResults.map(result => {\n    if (!result.id || result.id === result.name) {\n      return {\n        name_match: result.name\n      };\n    }\n    return {\n      uuid: result.id,\n      name: result.name\n    };\n  });\n\n  return groups;\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { ActionFormProps } from 'components/flow/props';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { ChangeGroups } from 'flowTypes';\nimport * as React from 'react';\nimport { Asset } from 'store/flowContext';\nimport { mergeForm } from 'store/nodeEditor';\nimport { shouldRequireIf, validate } from 'store/validators';\n\nimport { ChangeGroupsFormState, excludeDynamicGroups, labelSpecId } from '../helpers';\nimport { initializeForm, stateToAction } from './helpers';\nimport i18n from 'config/i18n';\nimport { Trans } from 'react-i18next';\nimport { renderIssues } from '../../helpers';\n\nexport default class AddGroupsForm extends React.Component<ActionFormProps, ChangeGroupsFormState> {\n  constructor(props: ActionFormProps) {\n    super(props);\n    this.state = initializeForm(this.props.nodeSettings) as ChangeGroupsFormState;\n\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  public handleSave(): void {\n    const valid = this.handleGroupsChanged(this.state.groups.value!, true);\n    if (valid) {\n      const newAction = stateToAction(this.props.nodeSettings, this.state);\n      this.props.updateAction(newAction as ChangeGroups);\n      this.props.onClose(false);\n    }\n  }\n\n  public handleGroupsChanged(groups: any[], submitting: boolean = false): boolean {\n    const updates: Partial<ChangeGroupsFormState> = {\n      groups: validate(i18n.t('forms.collections', 'Collections'), groups, [\n        shouldRequireIf(submitting)\n      ])\n    };\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  public handleGroupAdded(group: Asset): void {\n    // update our store with our new group\n    this.props.addAsset('groups', group);\n\n    // try to add the group\n    this.handleGroupsChanged((this.state.groups.value || []).concat(group), false);\n  }\n\n  public handleCreateAssetFromInput(input: string): any {\n    return { name: input };\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <p data-spec={labelSpecId}>\n          <Trans i18nKey=\"forms.add_groups_summary\">\n            Select the collections to add the contact to.\n          </Trans>\n        </p>\n\n        <AssetSelector\n          name={i18n.t('forms.groups', 'Collections')}\n          multi={true}\n          noOptionsMessage={i18n.t(\n            'enter_to_create_group',\n            'Enter a name to create a new collection'\n          )}\n          assets={this.props.assetStore.groups}\n          entry={this.state.groups}\n          onChange={this.handleGroupsChanged}\n          searchable={true}\n          shouldExclude={excludeDynamicGroups}\n          placeholder={i18n.t('select_groups', 'Select Collection')}\n          expressions={true}\n          // Groups can be created on the fly\n          // createPrefix={i18n.t('create_group', 'Create Collection') + ': '}\n          createAssetFromInput={this.handleCreateAssetFromInput}\n          onAssetCreated={this.handleGroupAdded}\n        />\n\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { ChangeGroupsFormState } from 'components/flow/actions/changegroups/helpers';\nimport { getActionUUID } from 'components/flow/actions/helpers';\nimport { Types } from 'config/interfaces';\nimport { ChangeGroups, Group } from 'flowTypes';\nimport { NodeEditorSettings } from 'store/nodeEditor';\n\nexport const initializeForm = (settings: NodeEditorSettings): ChangeGroupsFormState => {\n  if (settings.originalAction && settings.originalAction.type === Types.add_contact_groups) {\n    const action = settings.originalAction as ChangeGroups;\n    return {\n      groups: {\n        value: action.groups.map((group: Group) => {\n          if (group.name_match) {\n            return { name: group.name_match, expression: true };\n          }\n          return group;\n        })\n      },\n      valid: true\n    };\n  }\n\n  return {\n    groups: { value: null },\n    valid: false\n  };\n};\n\nexport const stateToAction = (\n  nodeSettings: NodeEditorSettings,\n  state: ChangeGroupsFormState\n): ChangeGroups => {\n  return {\n    type: Types.add_contact_groups,\n    groups: state.groups.value.map((group: any) => {\n      if (group.expression) {\n        return { name_match: group.name };\n      }\n      return group;\n    }),\n    uuid: getActionUUID(nodeSettings, Types.add_contact_groups)\n  };\n};\n","import { renderAssetList } from 'components/flow/actions/helpers';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { Types } from 'config/interfaces';\nimport { ChangeGroups, Endpoints } from 'flowTypes';\nimport * as React from 'react';\nimport { AssetType } from 'store/flowContext';\n\nexport const removeAllSpecId = 'remove_from_all';\nexport const contentSpecId = 'content';\nexport const removeAllText = 'Remove from all collections';\n\nexport const MAX_TO_SHOW = 5;\nexport const getRemoveAllMarkup = (\n  key = removeAllSpecId,\n  specId = removeAllSpecId,\n  text = removeAllText\n) => (\n  <div key={key} data-spec={specId}>\n    {text}\n  </div>\n);\n\nexport const getContentMarkup = (\n  { type, groups }: ChangeGroups,\n  endpoints?: Endpoints\n): JSX.Element[] => {\n  const content = [];\n\n  if (type === Types.remove_contact_groups && (!groups || !groups.length)) {\n    content.push(getRemoveAllMarkup());\n  } else {\n    return renderAssetList(\n      groups.map(group => {\n        if (group.name_match) {\n          return {\n            id: group.name_match,\n            name: group.name_match,\n            type: AssetType.GroupNameMatch\n          };\n        }\n        return {\n          id: group.uuid,\n          name: group.name,\n          type: AssetType.Group\n        };\n      }),\n      MAX_TO_SHOW,\n      endpoints!\n    );\n  }\n\n  return content;\n};\n\nexport const getChangeGroupsMarkup = (\n  action: ChangeGroups,\n  endpoints?: Endpoints,\n  specId = contentSpecId\n) => <div data-spec={specId}>{getContentMarkup(action, endpoints)}</div>;\n\nconst ChangeGroupsComp: React.SFC<ChangeGroups> = (props: any, context: any): JSX.Element => {\n  return getChangeGroupsMarkup(props, context.config.endpoints);\n};\n\nChangeGroupsComp.contextTypes = {\n  config: fakePropType\n};\n\nexport default ChangeGroupsComp;\n","import classNames from 'classnames/bind';\r\nimport { FormElementProps } from 'components/form/FormElement';\r\nimport * as React from 'react';\r\nimport { isRealValue, renderIf } from 'utils';\r\n\r\nimport styles from './CheckboxElement.module.scss';\r\n\r\nexport interface CheckboxElementProps extends FormElementProps {\r\n  checked: boolean;\r\n  title?: string;\r\n  description?: string;\r\n  labelClassName?: string;\r\n  checkboxClassName?: string;\r\n  onChange?(checked: boolean): void;\r\n}\r\n\r\ninterface CheckboxState {\r\n  checked: boolean;\r\n}\r\n\r\nexport const boxIco = 'fe-square';\r\nexport const checkedBoxIco = 'fe-check-square';\r\n\r\nexport const checkboxSpecId = 'checkbox';\r\nexport const titleSpecId = 'title';\r\nexport const descSpecId = 'description';\r\n\r\nconst cx: any = classNames.bind(styles);\r\n\r\nexport default class CheckboxElement extends React.Component<CheckboxElementProps, CheckboxState> {\r\n  constructor(props: any) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      checked: this.props.checked\r\n    };\r\n\r\n    this.handleChange = this.handleChange.bind(this);\r\n  }\r\n\r\n  private handleChange(event: React.MouseEvent): void {\r\n    // this null check only for testing, remove after switching to RTL\r\n    if (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    }\r\n\r\n    this.setState({ checked: !this.state.checked }, () => {\r\n      if (this.props.onChange) {\r\n        this.props.onChange(this.state.checked);\r\n      }\r\n    });\r\n  }\r\n\r\n  /* istanbul ignore next */\r\n  public validate(): boolean {\r\n    return true;\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const checkboxIcon = this.state.checked ? checkedBoxIco : boxIco;\r\n    return (\r\n      <label className={cx(styles.label, this.props.labelClassName)} onClick={this.handleChange}>\r\n        <span\r\n          data-spec={checkboxSpecId}\r\n          className={cx(checkboxIcon, this.props.checkboxClassName)}\r\n        />\r\n        {renderIf(isRealValue(this.props.title))(\r\n          <div data-spec={titleSpecId} className={styles.title}>\r\n            {this.props.title}\r\n          </div>\r\n        )}\r\n        {renderIf(isRealValue(this.props.description))(\r\n          <div\r\n            data-spec={descSpecId}\r\n            className={this.props.title ? styles.description : styles.description_solo}\r\n          >\r\n            {this.props.description}\r\n          </div>\r\n        )}\r\n      </label>\r\n    );\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport {\n  ChangeGroupsFormState,\n  excludeDynamicGroups\n} from 'components/flow/actions/changegroups/helpers';\nimport { ActionFormProps } from 'components/flow/props';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport CheckboxElement from 'components/form/checkbox/CheckboxElement';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { ChangeGroups } from 'flowTypes';\nimport * as React from 'react';\nimport { Asset } from 'store/flowContext';\nimport { mergeForm } from 'store/nodeEditor';\nimport { shouldRequireIf, validate } from 'store/validators';\nimport { renderIf } from 'utils';\n\nimport { initializeForm, stateToAction } from './helpers';\nimport styles from './RemoveGroupsForm.module.scss';\nimport i18n from 'config/i18n';\nimport { renderIssues } from '../../helpers';\n\nexport const LABEL = i18n.t(\n  'forms.remove_groups_summary',\n  'Select the collections to remove the contact from.'\n);\nexport const NOT_FOUND = i18n.t('errors.group_not_found', 'Enter the name of an existing group');\nexport const PLACEHOLDER = i18n.t(\n  'forms.remove_groups_placeholder',\n  'Enter the name of an existing collection'\n);\nexport const REMOVE_FROM_ALL = i18n.t('forms.remove_from_all_label', 'Remove from all');\nexport const REMOVE_FROM_ALL_DESC = i18n.t(\n  'forms.remove_from_all_summary',\n  \"Remove the active contact from all collection they're a member of.\"\n);\n\nexport const labelSpecId = 'label';\nexport const fieldContainerSpecId = 'field-container';\n\nexport default class RemoveGroupsForm extends React.Component<\n  ActionFormProps,\n  ChangeGroupsFormState\n> {\n  public static contextTypes = {\n    assetService: fakePropType\n  };\n\n  constructor(props: ActionFormProps) {\n    super(props);\n    this.state = initializeForm(this.props.nodeSettings) as ChangeGroupsFormState;\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  public handleSave(): void {\n    const valid = this.handleGroupsChanged(this.state.groups.value!, true);\n    if (valid) {\n      const newAction = stateToAction(this.props.nodeSettings, this.state);\n      this.props.updateAction(newAction as ChangeGroups);\n      this.props.onClose(false);\n    }\n  }\n\n  private handleUpdate(\n    keys: { groups?: Asset[]; removeAll?: boolean },\n    submitting: boolean = false\n  ): boolean {\n    const updates: Partial<ChangeGroupsFormState> = {};\n\n    // we only require groups if removeAll isn't checked\n    let groupValidators = this.state.removeAll ? [] : [shouldRequireIf(submitting)];\n\n    if (keys.hasOwnProperty('removeAll')) {\n      updates.removeAll = keys.removeAll;\n      if (keys.removeAll) {\n        groupValidators = [];\n      }\n    }\n\n    if (keys.hasOwnProperty('groups')) {\n      updates.groups = validate(\n        i18n.t('forms.collections', 'Collections'),\n        keys.groups!,\n        groupValidators\n      );\n    }\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  public handleGroupsChanged(groups: Asset[], submitting: boolean = false): boolean {\n    return this.handleUpdate({ groups }, submitting);\n  }\n\n  public handleRemoveAllUpdate(removeAll: boolean): boolean {\n    return this.handleUpdate({ removeAll });\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n\n        {renderIf(!this.state.removeAll)(\n          <div>\n            <p data-spec={labelSpecId}>{LABEL}</p>\n            <AssetSelector\n              name={i18n.t('forms.groups', 'Collections')}\n              placeholder={i18n.t('select_groups', 'Select Collections')}\n              assets={this.props.assetStore.groups}\n              entry={this.state.groups}\n              shouldExclude={excludeDynamicGroups}\n              searchable={true}\n              onChange={this.handleGroupsChanged}\n              multi={true}\n            />\n          </div>\n        )}\n\n        <CheckboxElement\n          name={REMOVE_FROM_ALL}\n          title={REMOVE_FROM_ALL}\n          labelClassName={this.state.removeAll ? '' : styles.checkbox}\n          checked={this.state.removeAll!}\n          description={REMOVE_FROM_ALL_DESC}\n          onChange={this.handleRemoveAllUpdate}\n        />\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { ChangeGroupsFormState } from 'components/flow/actions/changegroups/helpers';\nimport { getActionUUID } from 'components/flow/actions/helpers';\nimport { Types } from 'config/interfaces';\nimport { RemoveFromGroups } from 'flowTypes';\nimport { NodeEditorSettings } from 'store/nodeEditor';\n\nexport const initializeForm = (settings: NodeEditorSettings): ChangeGroupsFormState => {\n  if (settings.originalAction && settings.originalAction.type === Types.remove_contact_groups) {\n    const action = settings.originalAction as RemoveFromGroups;\n\n    const groups = action.groups || [];\n    return {\n      groups: { value: groups },\n      removeAll: groups.length === 0 || action.all_groups,\n      valid: true\n    };\n  }\n\n  return {\n    groups: { value: null },\n    removeAll: false,\n    valid: false\n  };\n};\n\nexport const stateToAction = (\n  settings: NodeEditorSettings,\n  state: ChangeGroupsFormState\n): RemoveFromGroups => {\n  return {\n    type: Types.remove_contact_groups,\n    groups: state.removeAll\n      ? []\n      : state.groups.value.map((group: any) => {\n          return { uuid: group.uuid, name: group.name };\n        }),\n    all_groups: !!state.removeAll,\n    uuid: getActionUUID(settings, Types.remove_contact_groups)\n  };\n};\n","import { Type, Types } from 'config/interfaces';\r\nimport { getType, getTypeConfig } from 'config/typeConfigs';\r\nimport { NodeEditorSettings } from 'store/nodeEditor';\r\nimport { Asset } from 'store/flowContext';\r\nimport { FlowIssue } from 'flowTypes';\r\n\r\nexport const determineTypeConfig = (nodeSettings: NodeEditorSettings): Type => {\r\n  const renderNode = nodeSettings.originalNode;\r\n  const node = renderNode && renderNode.node;\r\n\r\n  if (nodeSettings.originalAction && nodeSettings.originalAction.type) {\r\n    return getTypeConfig(nodeSettings.originalAction.type);\r\n  } else if (node && node.actions && node.actions.length > 0) {\r\n    return getTypeConfig(node.actions[node.actions.length - 1].type);\r\n  } else {\r\n    try {\r\n      const type = getType(renderNode);\r\n      const config = getTypeConfig(type);\r\n      if (config.type !== Types.missing) {\r\n        return config;\r\n      }\r\n      // tslint:disable-next-line:no-empty\r\n    } catch (Error) {}\r\n  }\r\n\r\n  // Account for ghost nodes\r\n  if (node && node.router) {\r\n    return getTypeConfig(node.router.type);\r\n  }\r\n\r\n  throw new Error(`Couldn't determine type config for: ${node.uuid}`);\r\n};\r\n\r\nexport const hasIssues = (issues: FlowIssue[], translating: boolean, language: Asset): boolean => {\r\n  if (!issues || issues.length === 0) {\r\n    return false;\r\n  }\r\n\r\n  if (!translating) {\r\n    return !!issues.find((issue: FlowIssue) => !issue.language);\r\n  } else {\r\n    return !!issues.find((issue: FlowIssue) => issue.language === language.id);\r\n  }\r\n};\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport Dialog, { ButtonSet, Tab } from 'components/dialog/Dialog';\r\nimport styles from 'components/flow/actions/action/Action.module.scss';\r\nimport { initializeLocalizedKeyForm } from 'components/flow/actions/localization/helpers';\r\nimport { determineTypeConfig } from 'components/flow/helpers';\r\nimport { LocalizationFormProps } from 'components/flow/props';\r\nimport TextInputElement from 'components/form/textinput/TextInputElement';\r\nimport { fakePropType } from 'config/ConfigProvider';\r\nimport * as React from 'react';\r\nimport { FormState, StringEntry } from 'store/nodeEditor';\r\nimport i18n from 'config/i18n';\r\nimport { renderIssues } from '../helpers';\r\n\r\nexport interface KeyLocalizationFormState extends FormState {\r\n  keyValues: { [key: string]: StringEntry };\r\n}\r\n\r\nexport default class KeyLocalizationForm extends React.Component<\r\n  LocalizationFormProps,\r\n  KeyLocalizationFormState\r\n> {\r\n  constructor(props: LocalizationFormProps) {\r\n    super(props);\r\n    this.state = initializeLocalizedKeyForm(this.props.nodeSettings);\r\n    bindCallbacks(this, {\r\n      include: [/^handle/, /^on/]\r\n    });\r\n  }\r\n\r\n  public static contextTypes = {\r\n    config: fakePropType\r\n  };\r\n\r\n  public handleKeyUpdate(text: string, name: string): boolean {\r\n    const keyValues = { ...this.state.keyValues };\r\n    keyValues[name.toLowerCase()] = { value: text };\r\n    this.setState({ keyValues });\r\n    return true;\r\n  }\r\n\r\n  private handleSave(): void {\r\n    const translations: { [key: string]: string } = {};\r\n\r\n    Object.keys(this.state.keyValues).forEach((key: string) => {\r\n      const value = this.state.keyValues[key].value;\r\n      if (value) {\r\n        translations[key] = value;\r\n      } else {\r\n        delete translations[key];\r\n      }\r\n    });\r\n\r\n    this.props.updateLocalizations(this.props.language.id, [\r\n      {\r\n        uuid: this.props.nodeSettings.originalAction!.uuid,\r\n        translations\r\n      }\r\n    ]);\r\n\r\n    // notify our modal we are done\r\n    this.props.onClose(false);\r\n  }\r\n\r\n  private getButtons(): ButtonSet {\r\n    return {\r\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\r\n      secondary: {\r\n        name: i18n.t('buttons.cancel', 'Cancel'),\r\n        onClick: () => this.props.onClose(true)\r\n      }\r\n    };\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const typeConfig = determineTypeConfig(this.props.nodeSettings);\r\n    const tabs: Tab[] = [];\r\n\r\n    let base: JSX.Element;\r\n\r\n    const translation = i18n.t('forms.translation', 'Translation');\r\n\r\n    typeConfig.localizeableKeys.forEach((key: string) => {\r\n      const name = key[0].toUpperCase() + key.slice(1);\r\n\r\n      const form = (\r\n        <div key={`localize_form_${key}`}>\r\n          <div data-spec=\"translation-container\">\r\n            <div data-spec=\"text-to-translate\" className={styles.translate_from}>\r\n              {(this.props.nodeSettings.originalAction as any)[key]}\r\n            </div>\r\n          </div>\r\n          <TextInputElement\r\n            name={name}\r\n            showLabel={false}\r\n            onChange={this.handleKeyUpdate}\r\n            entry={this.state.keyValues[key]}\r\n            placeholder={`${this.props.language.name} ${translation}`}\r\n            autocomplete={true}\r\n            focus={true}\r\n            textarea={true}\r\n          />\r\n        </div>\r\n      );\r\n\r\n      if (!base) {\r\n        base = form;\r\n      } else {\r\n        const translation = i18n.t('forms.translation', 'Translation');\r\n        tabs.push({\r\n          name: name + ' ' + translation,\r\n          body: form,\r\n          checked: !!this.state.keyValues[key].value\r\n        });\r\n      }\r\n    });\r\n\r\n    return (\r\n      <Dialog\r\n        title={typeConfig.name}\r\n        headerClass={typeConfig.type}\r\n        buttons={this.getButtons()}\r\n        tabs={tabs}\r\n      >\r\n        {base}\r\n        {renderIssues(this.props)}\r\n      </Dialog>\r\n    );\r\n  }\r\n}\r\n","import { KeyLocalizationFormState } from 'components/flow/actions/localization/KeyLocalizationForm';\nimport { MsgLocalizationFormState } from 'components/flow/actions/localization/MsgLocalizationForm';\nimport { Types } from 'config/interfaces';\nimport { getTypeConfig } from 'config/typeConfigs';\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\nimport { SendMsg, MsgTemplating, SayMsg } from 'flowTypes';\n\nexport const initializeLocalizedKeyForm = (\n  settings: NodeEditorSettings\n): KeyLocalizationFormState => {\n  const keyValues: { [key: string]: StringEntry } = {};\n  const localized = settings.localizations[0];\n  const action = localized.getObject() as any;\n\n  const keys = settings.originalAction\n    ? getTypeConfig(settings.originalAction.type).localizeableKeys || []\n    : [];\n  keys.forEach((key: string) => {\n    keyValues[key] = { value: key in localized.localizedKeys ? action[key] : '' };\n  });\n\n  return {\n    keyValues,\n    valid: true\n  };\n};\n\nexport const initializeLocalizedForm = (settings: NodeEditorSettings): MsgLocalizationFormState => {\n  const state: MsgLocalizationFormState = {\n    message: { value: '' },\n    quickReplies: { value: [] },\n    templateVariables: [],\n    templating: null,\n    attachments: [],\n    audio: { value: null },\n    valid: true\n  };\n\n  // check if our form should use a localized action\n  if (\n    settings.originalAction &&\n    (settings.originalAction.type === Types.send_msg ||\n      settings.originalAction.type === Types.say_msg) &&\n    settings.localizations &&\n    settings.localizations.length > 0\n  ) {\n    if (settings.originalAction && (settings.originalAction as any).templating) {\n      state.templating = (settings.originalAction as any).templating;\n      state.templateVariables = state.templating.variables.map((value: string) => {\n        return {\n          value: ''\n        };\n      });\n    }\n\n    for (const localized of settings.localizations) {\n      if (localized.isLocalized()) {\n        const localizedObject = localized.getObject() as any;\n\n        if (localizedObject.text) {\n          const action = localizedObject as (SendMsg & SayMsg);\n          state.message.value = 'text' in localized.localizedKeys ? action.text : '';\n          state.audio.value = 'audio_url' in localized.localizedKeys ? action.audio_url : null;\n          state.quickReplies.value =\n            'quick_replies' in localized.localizedKeys ? action.quick_replies || [] : [];\n          state.valid = true;\n        }\n\n        if (localizedObject.attachments) {\n          const attachments: any = [];\n          (localizedObject.attachments || []).forEach((attachmentString: string): void => {\n            const splitPoint = attachmentString.indexOf(':');\n\n            const type = attachmentString.substring(0, splitPoint);\n            const attachment = {\n              type,\n              url: attachmentString.substring(splitPoint + 1)\n            };\n\n            attachments.push(attachment);\n          });\n          state.attachments = attachments;\n        }\n\n        if (localizedObject.variables) {\n          const templating = localizedObject as MsgTemplating;\n          state.templateVariables = templating.variables.map((value: string) => {\n            return {\n              value: 'variables' in localized.localizedKeys ? value : ''\n            };\n          });\n          state.valid = true;\n        }\n      }\n    }\n  }\n  return state;\n};\n","import * as React from 'react';\r\n\r\nimport styles from './Pill.module.scss';\r\n\r\nexport interface PillProps {\r\n  advanced?: boolean;\r\n  onClick?(event: React.MouseEvent<HTMLDivElement>): void;\r\n  text: string;\r\n  maxLength?: number;\r\n  icon?: string;\r\n  large?: boolean;\r\n  style?: React.CSSProperties;\r\n}\r\n\r\nconst Pill: React.SFC<PillProps> = (props: PillProps): JSX.Element => {\r\n  let text = props.text;\r\n\r\n  if (props.text.startsWith('@')) {\r\n    text = '@(exp)';\r\n  } else if (props.maxLength && text.length > props.maxLength) {\r\n    text = props.text.substring(0, props.maxLength) + '...';\r\n  }\r\n\r\n  const pillStyles = [styles.pill];\r\n\r\n  if (props.large) {\r\n    pillStyles.push(styles.large);\r\n  }\r\n\r\n  if (props.onClick) {\r\n    pillStyles.push(styles.clickable);\r\n  }\r\n\r\n  return (\r\n    <div\r\n      style={props.style}\r\n      data-advanced={props.advanced}\r\n      onClick={props.onClick}\r\n      className={pillStyles.join(' ')}\r\n    >\r\n      {text}\r\n      {props.icon ? (\r\n        <span data-advanced={props.advanced} className={styles.icon + ' ' + props.icon} />\r\n      ) : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Pill;\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport axios from 'axios';\r\nimport * as React from 'react';\r\nimport Button, { ButtonTypes } from 'components/button/Button';\r\nimport { getCookie } from 'external';\r\n\r\nexport interface UploadButtonState {}\r\n\r\nexport interface UploadButtonProps {\r\n  icon: string;\r\n  uploadText: string;\r\n  removeText: string;\r\n  url: string;\r\n  endpoint: string;\r\n  onUploadChanged: (url: string) => void;\r\n}\r\n\r\nexport default class UploadButton extends React.Component<UploadButtonProps, UploadButtonState> {\r\n  private filePicker: any;\r\n\r\n  constructor(props: UploadButtonProps) {\r\n    super(props);\r\n    this.state = {};\r\n    bindCallbacks(this, {\r\n      include: [/^handle/]\r\n    });\r\n  }\r\n\r\n  private handleRemoveUpload(): void {\r\n    this.props.onUploadChanged(null);\r\n  }\r\n\r\n  private handleUploadFile(files: FileList): void {\r\n    const data = new FormData();\r\n    data.append('file', files[0]);\r\n\r\n    // if we have a csrf in our cookie, pass it along as a header\r\n    const csrf = getCookie('csrftoken');\r\n    const headers = csrf ? { 'X-CSRFToken': csrf } : {};\r\n\r\n    axios\r\n      .post(this.props.endpoint, data, { headers })\r\n      .then(response => {\r\n        this.props.onUploadChanged(response.data.url);\r\n      })\r\n      .catch(error => {\r\n        console.log(error);\r\n      });\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    return (\r\n      <>\r\n        <input\r\n          style={{\r\n            display: 'none'\r\n          }}\r\n          ref={ele => {\r\n            this.filePicker = ele;\r\n          }}\r\n          type=\"file\"\r\n          onChange={e => this.handleUploadFile(e.target.files)}\r\n        />\r\n        {this.props.url ? (\r\n          <Button\r\n            iconName=\"fe-trash\"\r\n            name={this.props.removeText}\r\n            topSpacing={true}\r\n            onClick={this.handleRemoveUpload}\r\n            type={ButtonTypes.tertiary}\r\n          />\r\n        ) : (\r\n          <Button\r\n            iconName={this.props.icon}\r\n            name={this.props.uploadText}\r\n            topSpacing={true}\r\n            onClick={() => {\r\n              this.filePicker.click();\r\n            }}\r\n            type={ButtonTypes.tertiary}\r\n          />\r\n        )}\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet, Tab } from 'components/dialog/Dialog';\nimport styles from 'components/flow/actions/action/Action.module.scss';\nimport { determineTypeConfig } from 'components/flow/helpers';\nimport TextInputElement, { TextInputStyle } from 'components/form/textinput/TextInputElement';\nimport { LocalizationFormProps } from 'components/flow/props';\nimport SelectElement, { SelectOption } from 'components/form/select/SelectElement';\nimport MultiChoiceInput from 'components/form/multichoice/MultiChoice';\nimport Pill from 'components/pill/Pill';\nimport UploadButton from 'components/uploadbutton/UploadButton';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { SendMsg, MsgTemplating } from 'flowTypes';\nimport * as React from 'react';\nimport { TembaSelectStyle } from 'temba/TembaSelect';\nimport mutate from 'immutability-helper';\nimport { FormState, mergeForm, StringArrayEntry, StringEntry } from 'store/nodeEditor';\nimport { MaxOfTenItems, validate } from 'store/validators';\n\nimport { initializeLocalizedForm } from './helpers';\nimport i18n from 'config/i18n';\nimport { Trans } from 'react-i18next';\nimport { createUUID, range } from 'utils';\nimport { renderIssues } from '../helpers';\n\nconst MAX_ATTACHMENTS = 1;\n\nconst TYPE_OPTIONS: SelectOption[] = [\n  { value: 'image', name: i18n.t('forms.image_url', 'Image URL') },\n  { value: 'audio', name: i18n.t('forms.audio_url', 'Audio URL') },\n  { value: 'video', name: i18n.t('forms.video_url', 'Video URL') },\n  { value: 'application', name: i18n.t('forms.pdf_url', 'PDF Document URL') }\n];\n\nconst getAttachmentTypeOption = (type: string): SelectOption => {\n  return TYPE_OPTIONS.find((option: SelectOption) => option.value === type);\n};\n\nexport interface Attachment {\n  type: string;\n  url: string;\n  uploaded?: boolean;\n}\n\nexport interface MsgLocalizationFormState extends FormState {\n  message: StringEntry;\n  quickReplies: StringArrayEntry;\n  audio: StringEntry;\n  templateVariables: StringEntry[];\n  templating: MsgTemplating;\n  attachments: Attachment[];\n}\n\nexport default class MsgLocalizationForm extends React.Component<\n  LocalizationFormProps,\n  MsgLocalizationFormState\n> {\n  constructor(props: LocalizationFormProps) {\n    super(props);\n\n    this.state = initializeLocalizedForm(this.props.nodeSettings);\n    bindCallbacks(this, {\n      include: [/^handle/, /^on/]\n    });\n  }\n\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  public handleMessageUpdate(text: string): boolean {\n    return this.handleUpdate({ text });\n  }\n\n  public handleQuickRepliesUpdate(quickReplies: string[]): boolean {\n    return this.handleUpdate({ quickReplies });\n  }\n\n  private handleAudioChanged(url: string): void {\n    this.handleUpdate({ audio: url });\n  }\n\n  private handleUpdate(keys: {\n    text?: string;\n    sendAll?: boolean;\n    quickReplies?: string[];\n    audio?: string;\n  }): boolean {\n    const updates: Partial<MsgLocalizationFormState> = {};\n\n    if (keys.hasOwnProperty('text')) {\n      updates.message = validate(i18n.t('forms.message', 'Message'), keys.text!, []);\n    }\n\n    if (keys.hasOwnProperty('quickReplies')) {\n      updates.quickReplies = validate(\n        i18n.t('forms.quick_replies', 'Quick Replies'),\n        keys.quickReplies!,\n        [MaxOfTenItems]\n      );\n    }\n\n    if (keys.hasOwnProperty('audio')) {\n      updates.audio! = { value: keys.audio! };\n    }\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n\n    return updated.valid;\n  }\n\n  private handleSave(): void {\n    const { message: text, quickReplies, audio, templateVariables, attachments } = this.state;\n\n    // make sure we are valid for saving, only quick replies can be invalid\n    const typeConfig = determineTypeConfig(this.props.nodeSettings);\n\n    const valid =\n      typeConfig.localizeableKeys!.indexOf('quick_replies') > -1\n        ? this.handleQuickRepliesUpdate(this.state.quickReplies.value)\n        : true;\n\n    if (valid) {\n      const translations: any = {};\n      if (text.value) {\n        translations.text = text.value;\n      }\n\n      if (quickReplies.value && quickReplies.value.length > 0) {\n        translations.quick_replies = quickReplies.value;\n      }\n\n      if (attachments.length > 0) {\n        translations.attachments = attachments\n          .filter((attachment: Attachment) => attachment.url.trim().length > 0)\n          .map((attachment: Attachment) => `${attachment.type}:${attachment.url}`);\n      }\n      if (audio.value) {\n        translations.audio_url = audio.value;\n      }\n\n      const localizations = [\n        {\n          uuid: this.props.nodeSettings.originalAction!.uuid,\n          translations\n        }\n      ];\n\n      // if we have template variables, they show up on their own key\n      const hasTemplateVariables = templateVariables.find(\n        (entry: StringEntry) => entry.value.length > 0\n      );\n      if (hasTemplateVariables) {\n        localizations.push({\n          uuid: this.state.templating.uuid,\n          translations: { variables: templateVariables.map((entry: StringEntry) => entry.value) }\n        });\n      }\n\n      this.props.updateLocalizations(this.props.language.id, localizations);\n\n      // notify our modal we are done\n      this.props.onClose(false);\n    }\n  }\n\n  public handleAttachmentRemoved(index: number): void {\n    // we found a match, merge us in\n    const updated: any = mutate(this.state.attachments, {\n      $splice: [[index, 1]]\n    });\n    this.setState({ attachments: updated });\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  private handleAddQuickReply(newQuickReply: string): boolean {\n    const newReplies = [...this.state.quickReplies.value];\n    if (newReplies.length >= 10) {\n      return false;\n    }\n\n    // we don't allow two quick replies with the same name\n    const isNew = !newReplies.find(\n      (reply: string) => reply.toLowerCase() === newQuickReply.toLowerCase()\n    );\n\n    if (isNew) {\n      newReplies.push(newQuickReply);\n      this.setState({\n        quickReplies: { value: newReplies }\n      });\n      return true;\n    }\n\n    return false;\n  }\n\n  private handleQuickReplyChanged(quickReplies: string[]): void {\n    this.handleUpdate({ quickReplies });\n  }\n\n  private handleTemplateVariableChanged(updatedText: string, num: number): void {\n    const entry = validate(`Variable ${num + 1}`, updatedText, []);\n\n    const templateVariables = mutate(this.state.templateVariables, {\n      $merge: { [num]: entry }\n    }) as StringEntry[];\n\n    this.setState({ templateVariables });\n  }\n\n  private renderAttachment(index: number, attachment: Attachment): JSX.Element {\n    let attachments: any = this.state.attachments;\n    return (\n      <div\n        className={styles.url_attachment}\n        key={index > -1 ? 'url_attachment_' + index : createUUID()}\n      >\n        <div className={styles.type_choice}>\n          <SelectElement\n            key={'attachment_type_' + index}\n            style={TembaSelectStyle.small}\n            name={i18n.t('forms.type_options', 'Type Options')}\n            placeholder=\"Add Attachment\"\n            entry={{\n              value: index > -1 ? getAttachmentTypeOption(attachment.type) : null\n            }}\n            onChange={(option: any) => {\n              if (index === -1) {\n                attachments = mutate(attachments, {\n                  $push: [{ type: option.value, url: '' }]\n                });\n              } else {\n                attachments = mutate(attachments, {\n                  [index]: {\n                    $set: { type: option.value, url: attachment.url }\n                  }\n                });\n              }\n              this.setState({ attachments });\n            }}\n            options={TYPE_OPTIONS}\n          />\n        </div>\n        {index > -1 ? (\n          <>\n            <div className={styles.url}>\n              <TextInputElement\n                placeholder=\"URL\"\n                name={i18n.t('forms.url', 'URL')}\n                style={TextInputStyle.small}\n                onChange={(value: string) => {\n                  attachments = mutate(attachments, {\n                    [index]: { $set: { type: attachment.type, url: value } }\n                  });\n                  this.setState({ attachments });\n                }}\n                entry={{ value: attachment.url }}\n                autocomplete={true}\n              />\n            </div>\n            <div className={styles.remove}>\n              <Pill\n                icon=\"fe-x\"\n                text=\" Remove\"\n                large={true}\n                onClick={() => {\n                  this.handleAttachmentRemoved(index);\n                }}\n              />\n            </div>\n          </>\n        ) : null}\n      </div>\n    );\n  }\n\n  private renderAttachments(): JSX.Element {\n    const attachments = this.state.attachments.map((attachment, index: number) =>\n      this.renderAttachment(index, attachment)\n    );\n\n    const emptyOption =\n      this.state.attachments.length < MAX_ATTACHMENTS\n        ? this.renderAttachment(-1, { url: '', type: '' })\n        : null;\n    return (\n      <>\n        <p>\n          <Trans i18nKey=\"forms.add_attachments\" values={{ language: this.props.language.name }}>\n            Add an attachment for this message in [[language]] language\n          </Trans>\n        </p>\n        {attachments}\n        {emptyOption}\n      </>\n    );\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = determineTypeConfig(this.props.nodeSettings);\n    const tabs: Tab[] = [];\n\n    if (typeConfig.localizeableKeys.indexOf('attachments') > -1) {\n      tabs.push({\n        name: 'Attachments',\n        body: this.renderAttachments(),\n        checked: this.state.attachments.length > 0\n      });\n    }\n    if (\n      this.state.templating &&\n      typeConfig.localizeableKeys!.indexOf('templating.variables') > -1\n    ) {\n      const hasLocalizedValue = !!this.state.templateVariables.find(\n        (entry: StringEntry) => entry.value.length > 0\n      );\n\n      const variable = i18n.t('forms.variable', 'Variable');\n\n      tabs.push({\n        name: 'WhatsApp',\n        body: (\n          <>\n            <p>\n              {i18n.t(\n                'forms.whatsapp_warning',\n                'Sending messages over a WhatsApp channel requires that a template be used if you have not received a message from a contact in the last 24 hours. Setting a template to use over WhatsApp is especially important for the first message in your flow.'\n              )}\n            </p>\n            {this.state.templating && this.state.templating.variables.length > 0 ? (\n              <>\n                {range(0, this.state.templating.variables.length).map((num: number) => {\n                  const entry = this.state.templateVariables[num] || { value: '' };\n                  return (\n                    <div className={styles.variable} key={'tr_arg_' + num}>\n                      <TextInputElement\n                        name={`${i18n.t('forms.variable', 'Variable')} ${num + 1}`}\n                        showLabel={false}\n                        placeholder={`${this.props.language.name} ${variable} ${num + 1}`}\n                        onChange={(updatedText: string) => {\n                          this.handleTemplateVariableChanged(updatedText, num);\n                        }}\n                        entry={entry}\n                        autocomplete={true}\n                      />\n                    </div>\n                  );\n                })}\n              </>\n            ) : null}\n          </>\n        ),\n        checked: hasLocalizedValue\n      });\n    }\n\n    // if (typeConfig.localizeableKeys!.indexOf('quick_replies') > -1) {\n    //   tabs.push({\n    //     name: 'Quick Replies',\n    //     body: (\n    //       <>\n    //         <MultiChoiceInput\n    //           name={i18n.t('forms.quick_reply', 'Quick Reply')}\n    //           helpText={\n    //             <Trans\n    //               i18nKey=\"forms.localized_quick_replies\"\n    //               values={{ language: this.props.language.name }}\n    //             >\n    //               Add a new [[language]] Quick Reply and press enter.\n    //             </Trans>\n    //           }\n    //           items={this.state.quickReplies}\n    //           onChange={this.handleQuickReplyChanged}\n    //         />\n    //       </>\n    //     ),\n    //     checked: this.state.quickReplies.value.length > 0\n    //   });\n    // }\n\n    let audioButton: JSX.Element | null = null;\n    if (typeConfig.localizeableKeys!.indexOf('audio_url') > 0) {\n      audioButton = (\n        <UploadButton\n          icon=\"fe-mic\"\n          uploadText=\"Upload Recording\"\n          removeText=\"Remove Recording\"\n          url={this.state.audio.value}\n          endpoint={this.context.config.endpoints.attachments}\n          onUploadChanged={this.handleAudioChanged}\n        />\n      );\n    }\n\n    const translation = i18n.t('forms.translation', 'Translation');\n\n    return (\n      <Dialog\n        title={typeConfig.name}\n        headerClass={typeConfig.type}\n        buttons={this.getButtons()}\n        tabs={tabs}\n      >\n        <div data-spec=\"translation-container\">\n          <div data-spec=\"text-to-translate\" className={styles.translate_from}>\n            {(this.props.nodeSettings.originalAction as SendMsg).text}\n          </div>\n        </div>\n\n        <TextInputElement\n          name={i18n.t('forms.message', 'Message')}\n          showLabel={false}\n          onChange={this.handleMessageUpdate}\n          entry={this.state.message}\n          placeholder={`${this.props.language.name} ${translation}`}\n          autocomplete={true}\n          focus={true}\n          textarea={true}\n        />\n\n        {audioButton}\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import * as React from 'react';\r\nimport { Action } from 'flowTypes';\r\n\r\n/* istanbul ignore next */\r\nconst MissingComp: React.SFC<Action> = ({ type }): JSX.Element => {\r\n  return <div className=\"placeholder\">No implementation yet for {type}</div>;\r\n};\r\n\r\nexport default MissingComp;\r\n","import * as React from 'react';\r\nimport { PlayAudio } from 'flowTypes';\r\n\r\nconst PlayAudioComp: React.SFC<PlayAudio> = (action: PlayAudio): JSX.Element => {\r\n  return <div>{action.audio_url}</div>;\r\n};\r\n\r\nexport default PlayAudioComp;\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport * as React from 'react';\r\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\r\nimport { ActionFormProps } from 'components/flow/props';\r\nimport TextInputElement from 'components/form/textinput/TextInputElement';\r\nimport TypeList from 'components/nodeeditor/TypeList';\r\nimport { FormState, mergeForm, StringEntry } from 'store/nodeEditor';\r\nimport { validate, Required } from 'store/validators';\r\n\r\nimport { initializeForm, stateToAction } from './helpers';\r\nimport i18n from 'config/i18n';\r\nimport { Trans } from 'react-i18next';\r\nimport { renderIssues } from '../helpers';\r\n\r\nexport interface PlayAudioFormState extends FormState {\r\n  audio: StringEntry;\r\n}\r\n\r\nexport default class PlayAudioForm extends React.Component<ActionFormProps, PlayAudioFormState> {\r\n  constructor(props: ActionFormProps) {\r\n    super(props);\r\n    this.state = initializeForm(this.props.nodeSettings);\r\n    bindCallbacks(this, {\r\n      include: [/^handle/]\r\n    });\r\n  }\r\n\r\n  public handleAudioUpdate(text: string): boolean {\r\n    const updates: Partial<PlayAudioFormState> = {};\r\n    updates.audio = validate(i18n.t('forms.recording', 'Recording'), text, [Required]);\r\n\r\n    const updated = mergeForm(this.state, updates);\r\n    this.setState(updated);\r\n    return updated.valid;\r\n  }\r\n\r\n  private handleSave(): void {\r\n    // make sure we validate untouched text fields\r\n    const valid = this.handleAudioUpdate(this.state.audio.value);\r\n\r\n    if (valid) {\r\n      this.props.updateAction(stateToAction(this.props.nodeSettings, this.state));\r\n\r\n      // notify our modal we are done\r\n      this.props.onClose(false);\r\n    }\r\n  }\r\n\r\n  private getButtons(): ButtonSet {\r\n    return {\r\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\r\n      secondary: {\r\n        name: i18n.t('buttons.cancel', 'Cancel'),\r\n        onClick: () => this.props.onClose(true)\r\n      }\r\n    };\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const typeConfig = this.props.typeConfig;\r\n\r\n    return (\r\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\r\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\r\n        <p>{i18n.t('forms.recording_label', 'Previous Recording')}</p>\r\n        <TextInputElement\r\n          name={i18n.t('forms.message', 'Message')}\r\n          showLabel={false}\r\n          onChange={this.handleAudioUpdate}\r\n          entry={this.state.audio}\r\n          autocomplete={true}\r\n          focus={true}\r\n          helpText={\r\n            <Trans i18nKey=\"forms.play_audio_help_text\">\r\n              Enter a variable that contains a recording the contact has previously recorded. For\r\n              example, @results.voicemail or @fields.short_bio.\r\n            </Trans>\r\n          }\r\n        />\r\n        {renderIssues(this.props)}\r\n      </Dialog>\r\n    );\r\n  }\r\n}\r\n","import { getActionUUID } from 'components/flow/actions/helpers';\r\nimport { PlayAudioFormState } from 'components/flow/actions/playaudio/PlayAudioForm';\r\nimport { Types } from 'config/interfaces';\r\nimport { PlayAudio } from 'flowTypes';\r\nimport { NodeEditorSettings } from 'store/nodeEditor';\r\n\r\nexport const initializeForm = (settings: NodeEditorSettings): PlayAudioFormState => {\r\n  if (settings.originalAction && settings.originalAction.type === Types.play_audio) {\r\n    const action = settings.originalAction as PlayAudio;\r\n    return {\r\n      audio: { value: action.audio_url },\r\n      valid: true\r\n    };\r\n  }\r\n\r\n  return {\r\n    audio: { value: '' },\r\n    valid: false\r\n  };\r\n};\r\n\r\nexport const stateToAction = (\r\n  settings: NodeEditorSettings,\r\n  state: PlayAudioFormState\r\n): PlayAudio => ({\r\n  audio_url: state.audio.value,\r\n  type: Types.play_audio,\r\n  uuid: getActionUUID(settings, Types.say_msg)\r\n});\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport * as React from 'react';\r\n\r\nimport styles from './MediaPlayer.module.scss';\r\n\r\nexport interface MediaPlayerProps {\r\n  url: string;\r\n  triggered?: boolean;\r\n}\r\n\r\ninterface MediaPlayerState {\r\n  durationSeconds: number;\r\n  currentSeconds: number;\r\n  progress: number;\r\n  playing: boolean;\r\n}\r\n\r\nexport class MediaPlayer extends React.Component<MediaPlayerProps, MediaPlayerState> {\r\n  private ele: HTMLAudioElement;\r\n\r\n  private stroke = 1;\r\n  private radius = 9;\r\n\r\n  private radiusNormalized = this.radius - this.stroke * 2;\r\n  private circumference = this.radiusNormalized * 2 * Math.PI;\r\n\r\n  constructor(props: MediaPlayerProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      durationSeconds: 0,\r\n      currentSeconds: 0,\r\n      playing: false,\r\n      progress: 0\r\n    };\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^handle/]\r\n    });\r\n  }\r\n\r\n  private handleTimeUpdate(e: React.SyntheticEvent<HTMLAudioElement>): void {\r\n    const currentTime = this.ele.currentTime || 0;\r\n    const duration = this.ele.duration || 0;\r\n\r\n    this.setState((prevState: MediaPlayerState) => {\r\n      if ((this.ele.ended || currentTime === 0) && prevState.playing) {\r\n        setTimeout(() => {\r\n          this.setState({ progress: 0, playing: false });\r\n        }, 500);\r\n      }\r\n\r\n      return {\r\n        currentSeconds: this.ele.ended ? 0 : currentTime,\r\n        durationSeconds: duration,\r\n        playing: currentTime > 0,\r\n        progress: duration > 0 ? Math.floor((currentTime / duration) * 100) : 0\r\n      };\r\n    });\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    if (this.props.triggered) {\r\n      this.handleTogglePlay(null);\r\n    }\r\n  }\r\n\r\n  private handleTogglePlay(e: React.MouseEvent<HTMLDivElement>): void {\r\n    if (this.state.playing) {\r\n      this.ele.pause();\r\n      this.ele.currentTime = 0;\r\n    } else {\r\n      this.ele.play();\r\n    }\r\n\r\n    if (e !== null) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }\r\n\r\n  private handleRef(ref: HTMLAudioElement): any {\r\n    return (this.ele = ref);\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: MediaPlayerProps): void {\r\n    if (this.props.url !== prevProps.url) {\r\n      this.setState({\r\n        durationSeconds: 0,\r\n        currentSeconds: 0,\r\n        playing: false,\r\n        progress: 0\r\n      });\r\n    }\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const progress = this.state.progress || 0;\r\n    const strokeDashoffset = this.circumference - (progress / 100) * this.circumference;\r\n\r\n    return (\r\n      <div\r\n        className={styles.player + ' ' + (this.state.playing ? styles.playing : '')}\r\n        style={{ height: this.radius * 2, width: this.radius * 2 }}\r\n        onMouseDown={this.handleTogglePlay}\r\n      >\r\n        <audio ref={this.handleRef} onTimeUpdate={this.handleTimeUpdate} src={this.props.url} />\r\n\r\n        <div className={styles.circles}>\r\n          <svg height={this.radius * 2} width={this.radius * 2}>\r\n            <circle\r\n              className={styles.circle_background}\r\n              stroke=\"#fff\"\r\n              fill=\"#fff\"\r\n              strokeWidth={this.stroke}\r\n              r={this.radiusNormalized}\r\n              cx={this.radius}\r\n              cy={this.radius}\r\n            />\r\n            <circle\r\n              className={styles.circle_background}\r\n              stroke=\"#ddd\"\r\n              fill=\"transparent\"\r\n              strokeWidth={this.stroke}\r\n              r={this.radiusNormalized}\r\n              cx={this.radius}\r\n              cy={this.radius}\r\n            />\r\n            <circle\r\n              className={styles.circle_foreground}\r\n              stroke=\"cornflowerblue\"\r\n              fill=\"transparent\"\r\n              strokeWidth={this.stroke}\r\n              strokeDasharray={this.circumference + ' ' + this.circumference}\r\n              style={{ strokeDashoffset }}\r\n              r={this.radiusNormalized}\r\n              cx={this.radius}\r\n              cy={this.radius}\r\n            />\r\n          </svg>\r\n        </div>\r\n        <div className={styles.button + ' ' + (this.state.playing ? 'fe-stop' : 'fe-play_arrow')} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { MediaPlayer } from 'components/mediaplayer/MediaPlayer';\r\nimport { SayMsg } from 'flowTypes';\r\nimport * as React from 'react';\r\n\r\nimport styles from './SayMsg.module.scss';\r\nimport i18n from 'config/i18n';\r\n\r\nexport const PLACEHOLDER = i18n.t('actions.say_msg.placeholder', 'Send a message to the contact');\r\n\r\nconst SayMsgComp: React.SFC<SayMsg> = (action: SayMsg): JSX.Element => {\r\n  if (action.text) {\r\n    return (\r\n      <>\r\n        <div className={styles.text}>{action.text}</div>\r\n\r\n        {action.audio_url ? (\r\n          <div className={styles.recording}>\r\n            <MediaPlayer url={action.audio_url} />\r\n          </div>\r\n        ) : null}\r\n      </>\r\n    );\r\n  }\r\n  return <div className=\"placeholder\">{PLACEHOLDER}</div>;\r\n};\r\n\r\nexport default SayMsgComp;\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\r\nimport { ActionFormProps } from 'components/flow/props';\r\nimport TextInputElement from 'components/form/textinput/TextInputElement';\r\nimport TypeList from 'components/nodeeditor/TypeList';\r\nimport UploadButton from 'components/uploadbutton/UploadButton';\r\nimport { fakePropType } from 'config/ConfigProvider';\r\nimport * as React from 'react';\r\nimport { FormState, mergeForm, StringEntry } from 'store/nodeEditor';\r\nimport { shouldRequireIf, validate } from 'store/validators';\r\n\r\nimport { initializeForm, stateToAction } from './helpers';\r\nimport i18n from 'config/i18n';\r\nimport { renderIssues } from '../helpers';\r\n\r\nexport interface SayMsgFormState extends FormState {\r\n  message: StringEntry;\r\n  audio: StringEntry;\r\n}\r\n\r\nexport default class SayMsgForm extends React.Component<ActionFormProps, SayMsgFormState> {\r\n  constructor(props: ActionFormProps) {\r\n    super(props);\r\n    this.state = initializeForm(this.props.nodeSettings);\r\n    bindCallbacks(this, {\r\n      include: [/^handle/]\r\n    });\r\n  }\r\n\r\n  public static contextTypes = {\r\n    config: fakePropType\r\n  };\r\n\r\n  private handleUpdate(keys: { text?: string }, submitting = false): boolean {\r\n    const updates: Partial<SayMsgFormState> = {};\r\n\r\n    if (keys.hasOwnProperty('text')) {\r\n      updates.message = validate(i18n.t('forms.message', 'Message'), keys.text!, [\r\n        shouldRequireIf(submitting)\r\n      ]);\r\n    }\r\n\r\n    const updated = mergeForm(this.state, updates);\r\n    this.setState(updated);\r\n    return updated.valid;\r\n  }\r\n\r\n  public handleMessageUpdate(text: string, name: string, submitting = false): boolean {\r\n    return this.handleUpdate({ text }, submitting);\r\n  }\r\n\r\n  private handleSave(): void {\r\n    // make sure we validate untouched text fields\r\n    const valid = this.handleUpdate({ text: this.state.message.value }, true);\r\n\r\n    if (valid) {\r\n      this.props.updateAction(stateToAction(this.props.nodeSettings, this.state));\r\n\r\n      // notify our modal we are done\r\n      this.props.onClose(false);\r\n    }\r\n  }\r\n\r\n  private getButtons(): ButtonSet {\r\n    return {\r\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\r\n      secondary: {\r\n        name: i18n.t('buttons.cancel', 'Cancel'),\r\n        onClick: () => this.props.onClose(true)\r\n      }\r\n    };\r\n  }\r\n\r\n  private handleUploadChanged(url: string): void {\r\n    this.setState({ audio: { value: url } });\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const typeConfig = this.props.typeConfig;\r\n\r\n    return (\r\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\r\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\r\n        <TextInputElement\r\n          name={i18n.t('forms.message', 'Message')}\r\n          showLabel={false}\r\n          onChange={this.handleMessageUpdate}\r\n          entry={this.state.message}\r\n          autocomplete={true}\r\n          focus={true}\r\n          textarea={true}\r\n        />\r\n\r\n        <UploadButton\r\n          icon=\"fe-mic\"\r\n          uploadText=\"Upload Recording\"\r\n          removeText=\"Remove Recording\"\r\n          url={this.state.audio.value}\r\n          endpoint={this.context.config.endpoints.attachments}\r\n          onUploadChanged={this.handleUploadChanged}\r\n        />\r\n        {renderIssues(this.props)}\r\n      </Dialog>\r\n    );\r\n  }\r\n}\r\n","import { getActionUUID } from 'components/flow/actions/helpers';\r\nimport { SayMsgFormState } from 'components/flow/actions/saymsg/SayMsgForm';\r\nimport { Types } from 'config/interfaces';\r\nimport { SayMsg } from 'flowTypes';\r\nimport { NodeEditorSettings } from 'store/nodeEditor';\r\n\r\nexport const initializeForm = (settings: NodeEditorSettings): SayMsgFormState => {\r\n  if (settings.originalAction && settings.originalAction.type === Types.say_msg) {\r\n    const action = settings.originalAction as SayMsg;\r\n    return {\r\n      message: { value: action.text },\r\n      audio: { value: action.audio_url },\r\n      valid: true\r\n    };\r\n  }\r\n\r\n  return {\r\n    message: { value: '' },\r\n    audio: { value: '' },\r\n    valid: false\r\n  };\r\n};\r\n\r\nexport const stateToAction = (settings: NodeEditorSettings, state: SayMsgFormState): SayMsg => ({\r\n  text: state.message.value,\r\n  audio_url: state.audio.value,\r\n  type: Types.say_msg,\r\n  uuid: getActionUUID(settings, Types.say_msg)\r\n});\r\n","import { getRecipients, renderAssetList } from 'components/flow/actions/helpers';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { BroadcastMsg } from 'flowTypes';\nimport * as React from 'react';\n\nimport styles from './SendBroadcast.module.scss';\nimport i18n from 'config/i18n';\n\nexport const PLACEHOLDER = i18n.t(\n  'actions.send_broadcast.placeholder',\n  'Send a message to the contact'\n);\n\nconst MAX_TO_SHOW = 5;\n\nconst SendBroadcastComp: React.SFC<BroadcastMsg> = (\n  action: BroadcastMsg,\n  context: any\n): JSX.Element => {\n  const assets = getRecipients(action);\n\n  return (\n    <div className={styles.node}>\n      <div className={styles.to} key={action.uuid + '_broadcast_recipients'}>\n        {renderAssetList(assets, MAX_TO_SHOW, context.config.endpoints)}\n      </div>\n      <div className={styles.message}>\n        {action.text &&\n          action.text.split(/\\r?\\n/).map((line: string, idx: number) => (\n            <div key={action.uuid + idx} className={styles.line}>\n              {line}\n            </div>\n          ))}\n        <div className={styles.icons}>\n          {action.attachments && action.attachments.length > 0 ? (\n            <div className={`${styles.attachment} fe-paperclip`} />\n          ) : null}\n          {action.templating && action.templating.template ? (\n            <div className={`${styles.whatsapp} fe-whatsapp`} />\n          ) : null}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nSendBroadcastComp.contextTypes = {\n  config: fakePropType\n};\n\nexport default SendBroadcastComp;\n","import {\n  getActionUUID,\n  getExpressions,\n  getRecipients,\n  getRecipientsByAsset\n} from 'components/flow/actions/helpers';\nimport { SendBroadcastFormState } from 'components/flow/actions/sendbroadcast/SendBroadcastForm';\nimport { Types } from 'config/interfaces';\nimport { Attachment } from 'components/flow/actions/sendmsg/SendMsgForm';\nimport { BroadcastMsg, SendMsg, MsgTemplating } from 'flowTypes';\nimport { AssetType } from 'store/flowContext';\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\nimport { createUUID } from 'utils';\n\nexport const initializeForm = (settings: NodeEditorSettings): SendBroadcastFormState => {\n  let template: any = { value: null };\n  let templateVariables: any = [];\n\n  const finalState: SendBroadcastFormState = {\n    template,\n    templateVariables,\n    message: { value: '' },\n    recipients: { value: [] },\n    valid: true,\n    attachments: [],\n    validAttachment: false,\n    attachmentError: ''\n  };\n\n  if (settings.originalAction && settings.originalAction.type === Types.send_broadcast) {\n    let action = settings.originalAction as BroadcastMsg;\n    const attachments: Attachment[] = [];\n    (action.attachments || []).forEach((attachmentString: string) => {\n      const splitPoint = attachmentString.indexOf(':');\n\n      const type = attachmentString.substring(0, splitPoint);\n      const attachment = {\n        type,\n        url: attachmentString.substring(splitPoint + 1),\n        uploaded: type.indexOf('/') > -1\n      };\n\n      attachments.push(attachment);\n    });\n\n    finalState.attachments = attachments;\n\n    if (action.templating) {\n      const msgTemplate = action.templating.template;\n      template = {\n        value: {\n          uuid: msgTemplate.uuid,\n          name: msgTemplate.name\n        }\n      };\n      templateVariables = action.templating.variables.map((value: string) => {\n        return {\n          value\n        };\n      });\n    }\n\n    finalState.template = template;\n    finalState.templateVariables = templateVariables;\n    // check if our form should use a localized action\n    if (settings.localizations && settings.localizations.length > 0) {\n      const localized = settings.localizations[0];\n      if (localized.isLocalized()) {\n        action = settings.localizations[0].getObject() as BroadcastMsg;\n      } else {\n        return finalState;\n      }\n    }\n\n    finalState.message = { value: action.text };\n    finalState.recipients = { value: getRecipients(action) };\n\n    return finalState;\n  }\n\n  finalState.valid = false;\n\n  return finalState;\n};\n\nexport const stateToAction = (\n  settings: NodeEditorSettings,\n  formState: SendBroadcastFormState\n): BroadcastMsg => {\n  const attachments = formState.attachments\n    .filter((attachment: Attachment) => attachment.url.trim().length > 0)\n    .map((attachment: Attachment) => `${attachment.type}:${attachment.url}`);\n\n  let templating: MsgTemplating = null;\n\n  if (formState.template && formState.template.value) {\n    let templatingUUID = createUUID();\n    if (settings.originalAction && settings.originalAction.type === Types.send_msg) {\n      const action = settings.originalAction as SendMsg;\n      if (\n        action.templating &&\n        action.templating.template &&\n        action.templating.template.uuid === formState.template.value.id\n      ) {\n        templatingUUID = action.templating.uuid;\n      }\n    }\n\n    templating = {\n      uuid: templatingUUID,\n      template: {\n        uuid: formState.template.value.uuid,\n        name: formState.template.value.name\n      },\n\n      variables: formState.templateVariables.map((variable: StringEntry) => variable.value)\n    };\n  }\n\n  let result: any = {\n    attachments,\n    legacy_vars: getExpressions(formState.recipients.value),\n    contacts: getRecipientsByAsset(formState.recipients.value, AssetType.Contact),\n    groups: getRecipientsByAsset(formState.recipients.value, AssetType.Group),\n    text: formState.message.value,\n    type: Types.send_broadcast,\n    uuid: getActionUUID(settings, Types.send_broadcast)\n  };\n\n  if (templating) {\n    result.templating = templating;\n  }\n\n  return result;\n};\n","import * as React from 'react';\r\nimport { range } from 'utils';\r\n\r\nimport styles from './Loading.module.scss';\r\n\r\nexport interface LoadingProps {\r\n  size: number;\r\n  units: number;\r\n  color: string;\r\n  square?: boolean;\r\n}\r\n\r\ninterface Color {\r\n  r: number;\r\n  g: number;\r\n  b: number;\r\n}\r\n\r\ninterface LoadingState {\r\n  color: Color;\r\n}\r\n\r\nconst hexToRgb = (hex: string): Color => {\r\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n  return result\r\n    ? {\r\n        r: parseInt(result[1], 16),\r\n        g: parseInt(result[2], 16),\r\n        b: parseInt(result[3], 16)\r\n      }\r\n    : null;\r\n};\r\n\r\nexport default class Loading extends React.Component<LoadingProps, LoadingState> {\r\n  constructor(props: LoadingProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      color: hexToRgb(props.color)\r\n    };\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    return (\r\n      <div\r\n        className={styles.loading}\r\n        style={{\r\n          width: this.props.size * this.props.units * 2,\r\n          height: this.props.size\r\n        }}\r\n      >\r\n        {range(0, this.props.units).map((num: number) => (\r\n          <div\r\n            key={`ball_${num}`}\r\n            style={{\r\n              borderRadius: this.props.square ? '0' : '50%',\r\n              width: this.props.size,\r\n              height: this.props.size,\r\n              margin: this.props.size / 3,\r\n              animationDelay: `-${1 - num * (1 / this.props.units)}s`,\r\n              background: `rgba(${this.state.color.r},${this.state.color.g},${\r\n                this.state.color.b\r\n              }, ${1 - num * (1 / this.props.units)})`\r\n            }}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet, Tab } from 'components/dialog/Dialog';\nimport { initializeForm, stateToAction } from 'components/flow/actions/sendbroadcast/helpers';\nimport { ActionFormProps } from 'components/flow/props';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport TextInputElement, {\n  Count,\n  TextInputStyle\n} from 'components/form/textinput/TextInputElement';\n\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { hasUseableTranslation } from 'components/form/assetselector/helpers';\nimport { fakePropType } from 'config/ConfigProvider';\nimport mutate from 'immutability-helper';\nimport * as React from 'react';\nimport { Asset } from 'store/flowContext';\nimport SelectElement, { SelectOption } from 'components/form/select/SelectElement';\nimport { AssetArrayEntry, FormState, mergeForm, FormEntry, StringEntry } from 'store/nodeEditor';\nimport { shouldRequireIf, validate, Required } from 'store/validators';\nimport i18n from 'config/i18n';\n\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { Template, TemplateTranslation } from 'flowTypes';\nimport { createUUID, range } from 'utils';\nimport styles from './SendBroadcastForm.module.scss';\nimport { Attachment } from '../sendmsg/SendMsgForm';\nimport { TembaSelectStyle } from 'temba/TembaSelect';\nimport Pill from 'components/pill/Pill';\nimport Loading from 'components/loading/Loading';\nimport { ImCross } from 'react-icons/im';\nimport { fetchAsset } from 'external';\nimport axios from 'axios';\nexport interface SendBroadcastFormState extends FormState {\n  template: FormEntry;\n  templateVariables: StringEntry[];\n  templateTranslation?: TemplateTranslation;\n  message: StringEntry;\n  recipients: AssetArrayEntry;\n  attachments: Attachment[];\n  validAttachment: boolean;\n  attachmentError: string;\n}\n\nconst MAX_ATTACHMENTS = 1;\n\nconst TYPE_OPTIONS: SelectOption[] = [\n  { value: 'image', name: i18n.t('forms.image_url', 'Image URL') },\n  { value: 'audio', name: i18n.t('forms.audio_url', 'Audio URL') },\n  { value: 'video', name: i18n.t('forms.video_url', 'Video URL') },\n  { value: 'application', name: i18n.t('forms.pdf_url', 'PDF Document URL') }\n];\n\nconst getAttachmentTypeOption = (type: string): SelectOption => {\n  return TYPE_OPTIONS.find((option: SelectOption) => option.value === type);\n};\n\n// Note: action prop is only used for its uuid (see onValid)\nexport default class SendBroadcastForm extends React.Component<\n  ActionFormProps,\n  SendBroadcastFormState\n> {\n  public static contextTypes = {\n    endpoints: fakePropType,\n    assetService: fakePropType\n  };\n\n  constructor(props: ActionFormProps) {\n    super(props);\n    this.state = initializeForm(this.props.nodeSettings);\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n    if (this.state.template.value !== null) {\n      fetchAsset(this.props.assetStore.templates, this.state.template.value.uuid).then(\n        (asset: Asset) => {\n          if (asset !== null) {\n            this.handleTemplateChanged([{ ...this.state.template.value, ...asset.content }]);\n          }\n        }\n      );\n    }\n  }\n\n  public handleRecipientsChanged(recipients: Asset[]): boolean {\n    return this.handleUpdate({ recipients });\n  }\n\n  public handleMessageUpdate(text: string): boolean {\n    return this.handleUpdate({ text });\n  }\n\n  private handleUpdate(keys: { text?: string; recipients?: Asset[] }, submitting = false): boolean {\n    const updates: Partial<SendBroadcastFormState> = {};\n\n    if (keys.hasOwnProperty('recipients')) {\n      updates.recipients = validate(i18n.t('forms.recipients', 'Recipients'), keys.recipients!, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('text')) {\n      updates.message = validate(i18n.t('forms.message', 'Message'), keys.text!, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  public handleAxios(body: any, type: any) {\n    axios\n      .get(`${this.props.assetStore.validateMedia.endpoint}?url=${body.url}&type=${body.type}`)\n      .then(response => {\n        if (response.data.is_valid) {\n          // make sure we validate untouched text fields and contact fields\n          let valid = true;\n          // check if the recipient is added or not\n          // if not, throw required validation\n          if (this.state.recipients.value!.length <= 0 && !this.state.message.value) {\n            valid = this.handleUpdate(\n              {\n                recipients: this.state.recipients.value!\n              },\n              true\n            );\n          } else if (this.state.recipients.value!.length > 0 && !this.state.message.value) {\n            valid = true;\n          }\n\n          if (valid) {\n            // this.setState({ validAttachment: false });\n            this.props.updateAction(stateToAction(this.props.nodeSettings, this.state));\n            // notify our modal we are done\n            this.props.onClose(false);\n          } else {\n            this.setState({ valid });\n          }\n        } else {\n          this.setState({ attachmentError: response.data.message });\n        }\n      })\n      .catch(error => {\n        this.setState({ attachmentError: `The attachment url is invalid!: ${error.toString()}` });\n      });\n  }\n\n  private handleSave(): void {\n    if (this.state.attachments.length > 0) {\n      const type = this.state.attachments[0].type;\n      const url = this.state.attachments[0].url;\n\n      let body = {\n        type,\n        url\n      };\n\n      if (type === 'application') {\n        body.type = 'document';\n      }\n      switch (type) {\n        case 'image':\n          this.handleAxios(body, 'image');\n          break;\n        case 'video':\n          this.handleAxios(body, 'video');\n          break;\n        case 'audio':\n          this.handleAxios(body, 'audio');\n          break;\n        case 'application':\n          this.handleAxios(body, 'document');\n          break;\n      }\n      this.setState({ validAttachment: true, attachmentError: null });\n    } else {\n      // validate in case they never updated an empty field\n      let valid = this.handleUpdate(\n        {\n          text: this.state.message.value,\n          recipients: this.state.recipients.value!\n        },\n        true\n      );\n      let templateVariables = this.state.templateVariables;\n      // make sure we don't have untouched template variables\n      this.state.templateVariables.forEach((variable: StringEntry, num: number) => {\n        const updated = validate(`Variable ${num + 1}`, variable.value, [Required]);\n        templateVariables = mutate(templateVariables, {\n          [num]: { $merge: updated }\n        }) as StringEntry[];\n        valid = valid && !hasErrors(updated);\n      });\n      // check if the template and recipient are added or not\n      // if not, throw required validation\n      if (templateVariables.length > 0) {\n        if (this.state.recipients.value!.length <= 0 && !this.state.message.value) {\n          valid = this.handleUpdate(\n            {\n              recipients: this.state.recipients.value!\n            },\n            true\n          );\n        } else if (this.state.recipients.value!.length > 0 && !this.state.message.value) {\n          valid = true;\n        }\n      }\n      if (valid) {\n        this.props.updateAction(stateToAction(this.props.nodeSettings, this.state));\n        // notify our modal we are done\n        this.props.onClose(false);\n      } else {\n        this.setState({ templateVariables, valid });\n      }\n    }\n  }\n\n  private handleShouldExcludeTemplate(template: any): boolean {\n    return !hasUseableTranslation(template as Template);\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  private handleTemplateChanged(selected: any[]): void {\n    const template = selected ? selected[0] : null;\n\n    if (!template) {\n      this.setState({\n        template: { value: null },\n        templateTranslation: null,\n        templateVariables: []\n      });\n    } else {\n      const templateTranslation = template.translations[0];\n\n      const templateVariables =\n        this.state.templateVariables.length === 0 ||\n        (this.state.template.value && this.state.template.value.id !== template.id)\n          ? range(0, templateTranslation.variable_count).map(() => {\n              return {\n                value: ''\n              };\n            })\n          : this.state.templateVariables;\n      this.setState({\n        template: { value: template },\n        templateTranslation,\n        templateVariables\n      });\n    }\n  }\n\n  private handleTemplateVariableChanged(updatedText: string, num: number): void {\n    const entry = validate(`Variable ${num + 1}`, updatedText, [Required]);\n    const templateVariables = mutate(this.state.templateVariables, {\n      $merge: { [num]: entry }\n    }) as StringEntry[];\n    this.setState({ templateVariables });\n  }\n\n  private renderTemplateConfig(): JSX.Element {\n    return (\n      <>\n        <p>\n          {i18n.t(\n            'forms.whatsapp_warning',\n            'Sending messages over a WhatsApp channel requires that a template be used if you have not received a message from a contact in the last 24 hours. Setting a template to use over WhatsApp is especially important for the first message in your flow.'\n          )}\n        </p>\n        <AssetSelector\n          name={i18n.t('forms.template', 'template')}\n          noOptionsMessage=\"No templates found\"\n          assets={this.props.assetStore.templates}\n          entry={this.state.template}\n          onChange={this.handleTemplateChanged}\n          shouldExclude={this.handleShouldExcludeTemplate}\n          searchable={true}\n          formClearable={true}\n        />\n        {this.state.templateTranslation ? (\n          <>\n            <div className={styles.template_text}>{this.state.templateTranslation.content}</div>\n            {range(0, this.state.templateTranslation.variable_count).map((num: number): any => {\n              return (\n                <div className={styles.variable} key={'tr_arg_' + num}>\n                  <TextInputElement\n                    name={`${i18n.t('forms.variable', 'Variable')} ${num + 1}`}\n                    showLabel={false}\n                    placeholder={`${i18n.t('forms.variable', 'Variable')} ${num + 1}`}\n                    onChange={(updatedText: string): any => {\n                      this.handleTemplateVariableChanged(updatedText, num);\n                    }}\n                    entry={\n                      this.state.templateVariables[num] === undefined\n                        ? { value: '' }\n                        : this.state.templateVariables[num]\n                    }\n                    autocomplete={true}\n                  />\n                </div>\n              );\n            })}\n          </>\n        ) : null}\n      </>\n    );\n  }\n\n  public handleAttachmentRemoved(index: number): void {\n    // we found a match, merge us in\n    const updated: any = mutate(this.state.attachments, {\n      $splice: [[index, 1]]\n    });\n    this.setState({ attachments: updated, attachmentError: null, validAttachment: false });\n  }\n\n  private renderAttachment(index: number, attachment: Attachment): JSX.Element {\n    let attachments: any = this.state.attachments;\n    return (\n      <>\n        <div\n          className={styles.url_attachment}\n          key={index > -1 ? 'url_attachment_' + index : createUUID()}\n        >\n          <div className={styles.type_choice}>\n            <SelectElement\n              key={'attachment_type_' + index}\n              style={TembaSelectStyle.small}\n              name={i18n.t('forms.type_options', 'Type Options')}\n              placeholder=\"Add Attachment\"\n              entry={{\n                value: index > -1 ? getAttachmentTypeOption(attachment.type) : null\n              }}\n              onChange={(option: any) => {\n                if (index === -1) {\n                  attachments = mutate(attachments, {\n                    $push: [{ type: option.value, url: '' }]\n                  });\n                } else {\n                  attachments = mutate(attachments, {\n                    [index]: {\n                      $set: { type: option.value, url: attachment.url }\n                    }\n                  });\n                }\n                this.setState({ attachments });\n              }}\n              options={TYPE_OPTIONS}\n            />\n          </div>\n          {index > -1 ? (\n            <>\n              <div className={styles.url}>\n                <TextInputElement\n                  placeholder=\"URL\"\n                  name={i18n.t('forms.url', 'URL')}\n                  style={TextInputStyle.small}\n                  onChange={(value: string) => {\n                    attachments = mutate(attachments, {\n                      [index]: { $set: { type: attachment.type, url: value } }\n                    });\n                    this.setState({ attachments });\n                  }}\n                  entry={{ value: attachment.url }}\n                  autocomplete={true}\n                />\n              </div>\n              <div className={styles.remove}>\n                <Pill\n                  icon=\"fe-x\"\n                  text=\" Remove\"\n                  large={true}\n                  onClick={() => {\n                    this.handleAttachmentRemoved(index);\n                  }}\n                />\n              </div>\n            </>\n          ) : null}\n        </div>\n        {this.state.valid && this.state.validAttachment && !this.state.attachmentError ? (\n          <div className={styles.loading}>\n            Checking URL validity\n            <Loading size={10} units={6} color=\"#999999\" />\n          </div>\n        ) : null}\n        {this.state.attachmentError ? (\n          <div className={styles.error}>\n            <ImCross className={styles.crossIcon} />\n            {this.state.attachmentError}\n          </div>\n        ) : null}\n      </>\n    );\n  }\n\n  private renderAttachments(): JSX.Element {\n    const attachments = this.state.attachments.map((attachment, index: number) =>\n      this.renderAttachment(index, attachment)\n    );\n\n    const emptyOption =\n      this.state.attachments.length < MAX_ATTACHMENTS\n        ? this.renderAttachment(-1, { url: '', type: '' })\n        : null;\n    return (\n      <>\n        <p>\n          {i18n.t(\n            'forms.send_msg_summary',\n            'Add an attachment to each message. The attachment can be a file you upload or a dynamic URL using expressions and variables from your Flow.',\n            { count: MAX_ATTACHMENTS }\n          )}\n        </p>\n        {attachments}\n        {emptyOption}\n      </>\n    );\n  }\n\n  private checkAttachmentErrors(): boolean {\n    if (this.state.valid) {\n      return this.state.validAttachment;\n    } else {\n      return false;\n    }\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    const templates: any = {\n      name: 'WhatsApp',\n      body: this.renderTemplateConfig(),\n      checked: this.state.template.value != null,\n      hasErrors: !!this.state.templateVariables.find((entry: StringEntry) => hasErrors(entry))\n    };\n\n    const attachments: Tab = {\n      name: 'Attachments',\n      body: this.renderAttachments(),\n      checked: this.state.attachments.length > 0,\n      hasErrors: this.checkAttachmentErrors()\n    };\n    return (\n      <Dialog\n        title={typeConfig.name}\n        headerClass={typeConfig.type}\n        buttons={this.getButtons()}\n        tabs={[templates, attachments]}\n      >\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <AssetSelector\n          name={i18n.t('forms.recipients', 'Recipients')}\n          placeholder={i18n.t('forms.select_contacts', 'Select Contacts')}\n          assets={this.props.assetStore.recipients}\n          entry={this.state.recipients}\n          searchable={true}\n          multi={true}\n          expressions={true}\n          onChange={this.handleRecipientsChanged}\n        />\n        <p />\n        <TextInputElement\n          name={i18n.t('forms.message', 'Message')}\n          showLabel={false}\n          count={Count.SMS}\n          onChange={this.handleMessageUpdate}\n          entry={this.state.message}\n          autocomplete={true}\n          focus={true}\n          textarea={true}\n        />\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import * as React from 'react';\r\nimport { SendEmail } from 'flowTypes';\r\n\r\nconst SendEmailComp: React.SFC<SendEmail> = ({ subject }): JSX.Element => <div>{subject}</div>;\r\n\r\nexport default SendEmailComp;\r\n","import { StylesConfig } from 'react-select';\n\nexport const large = {\n  placeholder: (styles: StylesConfig, state: any) => {\n    return { ...styles, color: '#ddd', marginLeft: '3px' };\n  },\n  singleValue: (styles: StylesConfig, state: any) => {\n    return { ...styles, marginLeft: '3px' };\n  },\n  multiValue: (styles: StylesConfig, state: any) => {\n    return { ...styles, marginLeft: '0px' };\n  },\n  input: (styles: StylesConfig, state: any) => {\n    return {\n      ...styles,\n      marginLeft: '0px',\n      caretColor: '#999',\n      marginBottom: '0px',\n      boxShadow: 'none',\n      border: 'none',\n      fontSize: '13px'\n    };\n  },\n  control: (styles: StylesConfig, state: any) => {\n    return {\n      ...styles,\n      borderColor: '#e6e6e6',\n      boxShadow: 'none',\n      fontSize: '13px',\n      transition: 'all 0.3s ease-in-out',\n      '&:hover': {\n        borderColor: '#e6e6e6'\n      },\n      '&:focus-within': {\n        boxShadow: 'var(--widget-box-shadow-focused) !important',\n        border: '1px solid #a4cafe !important'\n      }\n    };\n  }\n};\n\nexport const messageStyle = {\n  control: (styles: StylesConfig, state: any) => {\n    return {\n      ...styles,\n      borderColor: '#e6e6e6',\n      boxShadow: 'none',\n      borderBottom: 'none',\n      borderBottomRightRadius: '0px',\n      borderBottomLeftRadius: '0px',\n      '&:hover': {\n        borderColor: '#e6e6e6'\n      }\n    };\n  }\n};\n\nexport const getErroredSelect = (baseControl: any): any => {\n  return {\n    control: (styles: StylesConfig) => ({\n      ...styles,\n      ...baseControl,\n      borderColor: 'tomato',\n      boxShadow: '0 0 0 3px rgba(255,196,186,0.5) !important;',\n      '&:hover': {\n        borderColor: 'tomato'\n      }\n    })\n  };\n};\n\nexport const small = {\n  control: (styles: StylesConfig) => ({\n    ...styles,\n    borderColor: '#e6e6e6',\n    boxShadow: 'none',\n    '&:hover': {\n      borderColor: '#e6e6e6'\n    },\n    maxHeight: '28px',\n    minHeight: '28px',\n    fontSize: '12px',\n    lineHeight: '12px',\n    marginBottom: '-10px',\n    '&:focus-within': {\n      boxShadow: 'var(--widget-box-shadow-focused) !important',\n      border: '1px solid #a4cafe !important'\n    }\n  }),\n  menuList: (styles: StylesConfig) => ({\n    ...styles,\n    maxHeight: 200\n  }),\n  option: (styles: StylesConfig) => ({\n    ...styles,\n    fontSize: 12\n  }),\n  singleValue: (styles: StylesConfig) => ({\n    ...styles,\n    maxHeight: 28,\n    lineHeight: '13px'\n  }),\n  indicatorsContainer: (styles: StylesConfig) => ({\n    ...styles,\n    height: 28,\n    maxHeight: 28\n  }),\n  valueContainer: (styles: StylesConfig) => ({\n    ...styles,\n    height: 28,\n    maxHeight: 28\n  }),\n  input: (styles: StylesConfig) => ({\n    ...styles,\n    marginLeft: '-2px',\n    marginTop: '0px',\n    caretColor: '#999',\n    boxShadow: 'none',\n    border: 'none',\n    maxHeight: '20px',\n    minHeight: '20px',\n    lineHeight: '12px'\n  })\n};\n\nexport const tagging = {\n  control: (styles: StylesConfig, state: any) => {\n    return {\n      ...styles,\n      borderColor: '#e6e6e6',\n      boxShadow: 'none',\n      transition: 'all 0.3s ease-in-out',\n      '&:hover': {\n        borderColor: '#e6e6e6'\n      },\n      '&:focus-within': {\n        boxShadow: 'var(--widget-box-shadow-focused) !important',\n        border: '1px solid #a4cafe !important'\n      }\n    };\n  },\n  input: (styles: StylesConfig, state: any) => {\n    return {\n      ...styles,\n      marginLeft: '0px',\n      caretColor: '#999',\n      marginBottom: '0px',\n      boxShadow: 'none',\n      border: 'none'\n    };\n  },\n  multiValue: (styles: StylesConfig) => {\n    return {\n      ...styles,\n      maxHeight: 24,\n      minHeight: 24,\n      lineHeight: '17px',\n      backgroundColor: 'hsl(0, 0%, 94%)',\n      border: '1px solid hsl(0, 0%, 85%)'\n    };\n  }\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport FormElement, { FormElementProps } from 'components/form/FormElement';\nimport React from 'react';\nimport { StringArrayEntry } from 'store/nodeEditor';\nimport { getSelectClass } from 'utils';\nimport { tagging } from 'utils/reactselect';\nimport CreatableSelect from 'react-select/creatable';\n\nexport type TagList = Array<{ label: string; value: string }>;\n\nexport interface TaggingElementProps extends FormElementProps {\n  placeholder?: string;\n  prompt: string;\n  createPrompt?: string;\n  onChange?: (values: string[]) => void;\n  onCheckValid: (value: string) => boolean;\n}\n\nexport const tagsToOptions = (tags: StringArrayEntry): TagList => {\n  return tags.value.map(tag => ({ label: tag, value: tag }));\n};\n\nexport const optionsToTags = (tags: TagList): string[] =>\n  (tags || []).map(tag => {\n    return tag.label;\n  });\n\nexport default class TaggingElement extends React.Component<TaggingElementProps> {\n  constructor(props: any) {\n    super(props);\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  public handleUpdateTags(tags: TagList): void {\n    if (this.props.onChange) {\n      this.props.onChange(optionsToTags(tags));\n    }\n  }\n\n  public handleCheckValid(label: string): boolean {\n    if (!label || label.trim().length === 0) {\n      return false;\n    }\n    return this.props.onCheckValid(label);\n  }\n\n  private arrowRenderer(): JSX.Element {\n    return <div />;\n  }\n\n  public render(): JSX.Element {\n    const className: string = getSelectClass((this.props.entry.validationFailures || []).length);\n\n    const tags = tagsToOptions(this.props.entry);\n    return (\n      <FormElement name={this.props.name} entry={this.props.entry}>\n        <CreatableSelect\n          styles={tagging as any}\n          className={className}\n          name={this.props.name}\n          placeholder={this.props.placeholder}\n          value={tags}\n          onChange={this.handleUpdateTags as any}\n          isMulti={true}\n          isSearchable={true}\n          isValidNewOption={this.handleCheckValid}\n          noOptionsMessage={() => this.props.prompt}\n          formatCreateLabel={(input: string) => {\n            return this.props.createPrompt !== undefined\n              ? this.props.createPrompt + input\n              : 'Create new ' + input;\n          }}\n          options={[]}\n        />\n      </FormElement>\n    );\n  }\n}\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\r\nimport { ActionFormProps } from 'components/flow/props';\r\nimport TaggingElement from 'components/form/select/tags/TaggingElement';\r\nimport TextInputElement from 'components/form/textinput/TextInputElement';\r\nimport TypeList from 'components/nodeeditor/TypeList';\r\nimport * as React from 'react';\r\nimport { FormState, mergeForm, StringArrayEntry, StringEntry } from 'store/nodeEditor';\r\nimport { shouldRequireIf, validate } from 'store/validators';\r\n\r\nimport { initializeForm, stateToAction } from './helpers';\r\nimport styles from './SendEmailForm.module.scss';\r\nimport i18n from 'config/i18n';\r\nimport { renderIssues } from '../helpers';\r\n\r\nconst EMAIL_PATTERN = /\\S+@\\S+\\.\\S+/;\r\n\r\nexport interface SendEmailFormState extends FormState {\r\n  recipients: StringArrayEntry;\r\n  subject: StringEntry;\r\n  body: StringEntry;\r\n}\r\n\r\nexport default class SendEmailForm extends React.Component<ActionFormProps, SendEmailFormState> {\r\n  constructor(props: ActionFormProps) {\r\n    super(props);\r\n\r\n    this.state = initializeForm(this.props.nodeSettings);\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^on/, /^handle/]\r\n    });\r\n  }\r\n\r\n  public handleRecipientsChanged(recipients: string[]): boolean {\r\n    return this.handleUpdate({ recipients });\r\n  }\r\n\r\n  public handleSubjectChanged(subject: string): boolean {\r\n    return this.handleUpdate({ subject });\r\n  }\r\n\r\n  public handleBodyChanged(body: string): boolean {\r\n    return this.handleUpdate({ body });\r\n  }\r\n\r\n  private handleUpdate(\r\n    keys: { recipients?: string[]; subject?: string; body?: string },\r\n    submitting = false\r\n  ): boolean {\r\n    const updates: Partial<SendEmailFormState> = {};\r\n\r\n    if (keys.hasOwnProperty('recipients')) {\r\n      updates.recipients = validate(i18n.t('forms.recipients', 'Recipients'), keys.recipients!, [\r\n        shouldRequireIf(submitting)\r\n      ]);\r\n    }\r\n\r\n    if (keys.hasOwnProperty('subject')) {\r\n      updates.subject = validate(i18n.t('forms.subject', 'Subject'), keys.subject!, [\r\n        shouldRequireIf(submitting)\r\n      ]);\r\n    }\r\n\r\n    if (keys.hasOwnProperty('body')) {\r\n      updates.body = validate(i18n.t('forms.body', 'Body'), keys.body!, [\r\n        shouldRequireIf(submitting)\r\n      ]);\r\n    }\r\n\r\n    const updated = mergeForm(this.state, updates);\r\n    this.setState(updated);\r\n    return updated.valid;\r\n  }\r\n\r\n  public handleSave(): void {\r\n    // validate in case they never updated an empty field\r\n    const valid = this.handleUpdate(\r\n      {\r\n        recipients: this.state.recipients.value,\r\n        subject: this.state.subject.value,\r\n        body: this.state.body.value\r\n      },\r\n      true\r\n    );\r\n\r\n    if (valid) {\r\n      this.props.updateAction(stateToAction(this.props.nodeSettings, this.state));\r\n\r\n      // notify our modal we are done\r\n      this.props.onClose(false);\r\n    }\r\n  }\r\n\r\n  private getButtons(): ButtonSet {\r\n    return {\r\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\r\n      secondary: {\r\n        name: i18n.t('buttons.cancel', 'Cancel'),\r\n        onClick: () => this.props.onClose(true)\r\n      }\r\n    };\r\n  }\r\n\r\n  public handleCheckValid(value: string): boolean {\r\n    return EMAIL_PATTERN.test(value) || value.startsWith('@');\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const typeConfig = this.props.typeConfig;\r\n    return (\r\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\r\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\r\n        <div className={styles.ele}>\r\n          <TaggingElement\r\n            name={i18n.t('forms.email_recipient_name', 'Recipient')}\r\n            placeholder={i18n.t('forms.email_recipient_placeholder', 'To')}\r\n            prompt={i18n.t('forms.email_recipient_prompt', 'Enter email address')}\r\n            onCheckValid={this.handleCheckValid}\r\n            entry={this.state.recipients}\r\n            onChange={this.handleRecipientsChanged}\r\n            createPrompt={''}\r\n          />\r\n          <TextInputElement\r\n            __className={styles.subject}\r\n            name={i18n.t('forms.subject', 'Subject')}\r\n            placeholder={i18n.t('forms.subject', 'Subject')}\r\n            onChange={this.handleSubjectChanged}\r\n            entry={this.state.subject}\r\n            autocomplete={true}\r\n          />\r\n          <TextInputElement\r\n            __className={styles.message}\r\n            name={i18n.t('forms.message', 'Message')}\r\n            showLabel={false}\r\n            onChange={this.handleBodyChanged}\r\n            entry={this.state.body}\r\n            autocomplete={true}\r\n            textarea={true}\r\n          />\r\n        </div>\r\n        {renderIssues(this.props)}\r\n      </Dialog>\r\n    );\r\n  }\r\n}\r\n","import { getActionUUID } from 'components/flow/actions/helpers';\r\nimport { SendEmailFormState } from 'components/flow/actions/sendemail/SendEmailForm';\r\nimport { Types } from 'config/interfaces';\r\nimport { SendEmail } from 'flowTypes';\r\nimport { NodeEditorSettings } from 'store/nodeEditor';\r\n\r\nexport const initializeForm = (settings: NodeEditorSettings): SendEmailFormState => {\r\n  if (settings.originalAction && settings.originalAction.type === Types.send_email) {\r\n    const action = settings.originalAction as SendEmail;\r\n    return {\r\n      body: { value: action.body },\r\n      subject: { value: action.subject },\r\n      recipients: { value: action.addresses },\r\n      valid: true\r\n    };\r\n  }\r\n\r\n  return {\r\n    body: { value: '' },\r\n    subject: { value: '' },\r\n    recipients: { value: [] },\r\n    valid: true\r\n  };\r\n};\r\n\r\nexport const stateToAction = (\r\n  settings: NodeEditorSettings,\r\n  formState: SendEmailFormState\r\n): SendEmail => {\r\n  return {\r\n    addresses: formState.recipients.value,\r\n    subject: formState.subject.value,\r\n    body: formState.body.value,\r\n    type: Types.send_email,\r\n    uuid: getActionUUID(settings, Types.send_email)\r\n  };\r\n};\r\n","import Pill from 'components/pill/Pill';\nimport { SendMsg } from 'flowTypes';\nimport * as React from 'react';\n\nimport styles from './SendMsg.module.scss';\nimport i18n from 'config/i18n';\n\nexport const PLACEHOLDER = i18n.t('actions.send_msg.placeholder', 'Send a message to the contact');\n\nconst SendMsgComp: React.SFC<SendMsg> = (action: SendMsg): JSX.Element => {\n  if (action.text) {\n    let replies = null;\n\n    let quickReplies = action.quick_replies || [];\n    if (quickReplies.length > 0) {\n      replies = (\n        <div className={styles.quick_replies}>\n          {quickReplies.map(reply => (\n            <Pill\n              style={{ marginLeft: 4, marginTop: 4 }}\n              maxLength={20}\n              advanced={true}\n              key={action.uuid + reply}\n              text={reply}\n            />\n          ))}\n        </div>\n      );\n    }\n\n    return (\n      <>\n        <div>\n          {action.text.split(/\\r?\\n/).map((line: string, idx: number) => (\n            <div key={action.uuid + idx} className={styles.line}>\n              {line}\n            </div>\n          ))}\n          {action.attachments && action.attachments.length > 0 ? (\n            <div className={`${styles.attachment} fe-paperclip`} />\n          ) : null}\n          {action.templating && action.templating.template ? (\n            <div className={`${styles.whatsapp} fe-whatsapp`} />\n          ) : null}\n          {action.topic ? <div className={`${styles.facebook} fe-facebook`} /> : null}\n        </div>\n        <div className={styles.summary}>{replies}</div>\n      </>\n    );\n  }\n  if (action.attachments && action.attachments.length > 0) {\n    return <div className={`${styles.attachment} fe-paperclip`} />;\n  }\n  if (action.templating && action.templating.template) {\n    return <div className={`${styles.whatsapp} fe-whatsapp`} />;\n  }\n  return <div className=\"placeholder\">{PLACEHOLDER}</div>;\n};\n\nexport default SendMsgComp;\n","/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport { getActionUUID } from 'components/flow/actions/helpers';\nimport { Attachment, SendMsgFormState } from 'components/flow/actions/sendmsg/SendMsgForm';\nimport { Types } from 'config/interfaces';\nimport { MsgTemplating, SendMsg } from 'flowTypes';\nimport { AssetStore } from 'store/flowContext';\nimport { FormEntry, NodeEditorSettings, StringEntry } from 'store/nodeEditor';\nimport { SelectOption } from 'components/form/select/SelectElement';\nimport { createUUID } from 'utils';\n\nexport const TOPIC_OPTIONS: SelectOption[] = [\n  { value: 'event', name: 'Event' },\n  { value: 'account', name: 'Account' },\n  { value: 'purchase', name: 'Purchase' },\n  { value: 'agent', name: 'Agent' }\n];\n\nexport const initializeForm = (\n  settings: NodeEditorSettings,\n  assetStore: AssetStore\n): SendMsgFormState => {\n  let template: FormEntry = { value: null };\n  let templateVariables: StringEntry[] = [];\n\n  if (settings.originalAction && settings.originalAction.type === Types.send_msg) {\n    const action = settings.originalAction as SendMsg;\n    const attachments: Attachment[] = [];\n    (action.attachments || []).forEach((attachmentString: string) => {\n      const splitPoint = attachmentString.indexOf(':');\n\n      const type = attachmentString.substring(0, splitPoint);\n      const attachment = {\n        type,\n        url: attachmentString.substring(splitPoint + 1),\n        uploaded: type.indexOf('/') > -1\n      };\n\n      attachments.push(attachment);\n    });\n\n    if (action.templating) {\n      const msgTemplate = action.templating.template;\n      template = {\n        value: {\n          uuid: msgTemplate.uuid,\n          name: msgTemplate.name\n        }\n      };\n      templateVariables = action.templating.variables.map((value: string) => {\n        return {\n          value\n        };\n      });\n    }\n\n    return {\n      topic: { value: TOPIC_OPTIONS.find(option => option.value === action.topic) },\n      template,\n      templateVariables,\n      attachments,\n      message: { value: action.text },\n      quickReplies: { value: action.quick_replies || [] },\n      quickReplyEntry: { value: '' },\n      sendAll: action.all_urns,\n      valid: true,\n      validAttachment: false,\n      attachmentError: null\n    };\n  }\n\n  return {\n    topic: { value: null },\n    template,\n    templateVariables: [],\n    attachments: [],\n    message: { value: '' },\n    quickReplies: { value: [] },\n    quickReplyEntry: { value: '' },\n    sendAll: false,\n    valid: false,\n    validAttachment: false,\n    attachmentError: null\n  };\n};\n\nexport const stateToAction = (settings: NodeEditorSettings, state: SendMsgFormState): SendMsg => {\n  const attachments = state.attachments\n    .filter((attachment: Attachment) => attachment.url.trim().length > 0)\n    .map((attachment: Attachment) => `${attachment.type}:${attachment.url}`);\n\n  let templating: MsgTemplating = null;\n\n  if (state.template && state.template.value) {\n    let templatingUUID = createUUID();\n    if (settings.originalAction && settings.originalAction.type === Types.send_msg) {\n      const action = settings.originalAction as SendMsg;\n      if (\n        action.templating &&\n        action.templating.template &&\n        action.templating.template.uuid === state.template.value.id\n      ) {\n        templatingUUID = action.templating.uuid;\n      }\n    }\n\n    templating = {\n      uuid: templatingUUID,\n      template: {\n        uuid: state.template.value.uuid,\n        name: state.template.value.name\n      },\n      variables: state.templateVariables.map((variable: StringEntry) => variable.value)\n    };\n  }\n\n  const result: SendMsg = {\n    attachments,\n    text: state.message.value,\n    type: Types.send_msg,\n    all_urns: state.sendAll,\n    quick_replies: state.quickReplies.value,\n    uuid: getActionUUID(settings, Types.send_msg)\n  };\n\n  if (templating) {\n    result.templating = templating;\n  }\n\n  if (state.topic.value) {\n    result.topic = state.topic.value.value;\n  }\n\n  return result;\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport * as React from 'react';\nimport { StringArrayEntry, StringEntry } from 'store/nodeEditor';\nimport TembaSelect from 'temba/TembaSelect';\n\nexport interface MultiChoiceInputProps {\n  name: string;\n  items: StringArrayEntry;\n  entry?: StringEntry;\n  onChange?: (values: string[]) => void;\n  helpText?: JSX.Element;\n}\n\ninterface MultiChoiceInputState {\n  currentInput: StringEntry;\n}\n\nexport default class MultiChoiceInput extends React.Component<\n  MultiChoiceInputProps,\n  MultiChoiceInputState\n> {\n  constructor(props: MultiChoiceInputProps) {\n    super(props);\n\n    if (this.props.entry) {\n      this.state = {\n        currentInput: this.props.entry\n      };\n    } else {\n      this.state = {\n        currentInput: { value: '' }\n      };\n    }\n\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  private handleChange(options: { name: string; value: string }[]): void {\n    this.props.onChange(options.map(option => option.value));\n  }\n\n  public render(): JSX.Element {\n    const values = this.props.items.value.map((value: string) => {\n      return { name: value, value };\n    });\n    return (\n      <>\n        {this.props.helpText ? <p>{this.props.helpText}</p> : <p />}\n        <TembaSelect\n          name={this.props.name}\n          placeholder={this.props.name}\n          onChange={this.handleChange}\n          value={values}\n          multi={true}\n          tags={true}\n          searchable={true}\n          expressions={true}\n        />\n      </>\n    );\n  }\n}\n","/* eslint-disable @typescript-eslint/explicit-member-accessibility */\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\nimport { react as bindCallbacks } from 'auto-bind';\nimport axios from 'axios';\nimport { ImCross } from 'react-icons/im';\nimport Loading from 'components/loading/Loading';\nimport Dialog, { ButtonSet, Tab } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport {\n  initializeForm as stateToForm,\n  stateToAction,\n  TOPIC_OPTIONS\n} from 'components/flow/actions/sendmsg/helpers';\nimport { ActionFormProps } from 'components/flow/props';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport { hasUseableTranslation } from 'components/form/assetselector/helpers';\nimport CheckboxElement from 'components/form/checkbox/CheckboxElement';\nimport MultiChoiceInput from 'components/form/multichoice/MultiChoice';\nimport SelectElement, { SelectOption } from 'components/form/select/SelectElement';\nimport TextInputElement, { TextInputStyle } from 'components/form/textinput/TextInputElement';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport Pill from 'components/pill/Pill';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { fetchAsset, getCookie } from 'external';\nimport { Template, TemplateTranslation } from 'flowTypes';\nimport mutate from 'immutability-helper';\nimport * as React from 'react';\nimport flowContext, { Asset } from 'store/flowContext';\nimport {\n  FormState,\n  mergeForm,\n  StringArrayEntry,\n  StringEntry,\n  SelectOptionEntry,\n  FormEntry\n} from 'store/nodeEditor';\nimport { MaxOfTenItems, Required, shouldRequireIf, validate } from 'store/validators';\nimport { createUUID, range } from 'utils';\n\nimport styles from './SendMsgForm.module.scss';\nimport { hasFeature } from 'config/typeConfigs';\nimport { FeatureFilter } from 'config/interfaces';\n\nimport i18n from 'config/i18n';\nimport { Trans } from 'react-i18next';\nimport { TembaSelectStyle } from 'temba/TembaSelect';\nimport Modal from 'components/modal/Modal';\n\nconst MAX_ATTACHMENTS = 1;\n\nconst TYPE_OPTIONS: SelectOption[] = [\n  { value: 'image', name: i18n.t('forms.image_url', 'Image URL') },\n  { value: 'audio', name: i18n.t('forms.audio_url', 'Audio URL') },\n  { value: 'video', name: i18n.t('forms.video_url', 'Video URL') },\n  { value: 'application', name: i18n.t('forms.pdf_url', 'PDF Document URL') }\n];\n\nconst getAttachmentTypeOption = (type: string): SelectOption => {\n  return TYPE_OPTIONS.find((option: SelectOption) => option.value === type);\n};\n\nexport interface Attachment {\n  type: string;\n  url: string;\n  uploaded?: boolean;\n}\n\nexport interface SendMsgFormState extends FormState {\n  message: StringEntry;\n  quickReplies: StringArrayEntry;\n  quickReplyEntry: StringEntry;\n  sendAll: boolean;\n  attachments: Attachment[];\n  template: FormEntry;\n  topic: SelectOptionEntry;\n  templateVariables: StringEntry[];\n  templateTranslation?: TemplateTranslation;\n  validAttachment: any;\n  attachmentError: any;\n}\n\nexport default class SendMsgForm extends React.Component<ActionFormProps, SendMsgFormState> {\n  private filePicker: any;\n\n  constructor(props: ActionFormProps) {\n    super(props);\n    this.state = stateToForm(this.props.nodeSettings, this.props.assetStore);\n    bindCallbacks(this, {\n      include: [/^handle/, /^on/]\n    });\n    // intialize our templates if we have them\n    if (this.state.template.value !== null) {\n      fetchAsset(this.props.assetStore.templates, this.state.template.value.uuid).then(\n        (asset: Asset) => {\n          if (asset !== null) {\n            this.handleTemplateChanged([{ ...this.state.template.value, ...asset.content }]);\n          }\n        }\n      );\n    }\n  }\n\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  private handleUpdate(\n    keys: {\n      text?: string;\n      sendAll?: boolean;\n      quickReplies?: string[];\n    },\n    submitting = false\n  ): boolean {\n    const updates: Partial<SendMsgFormState> = {};\n    if (keys.hasOwnProperty('text')) {\n      updates.message = validate(i18n.t('forms.message', 'Message'), keys.text, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('sendAll')) {\n      updates.sendAll = keys.sendAll;\n    }\n\n    if (keys.hasOwnProperty('quickReplies')) {\n      updates.quickReplies = validate(\n        i18n.t('forms.quick_replies', 'Quick Replies'),\n        keys.quickReplies,\n        [MaxOfTenItems]\n      );\n    }\n\n    const updated = mergeForm(this.state, updates) as SendMsgFormState;\n\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  public handleMessageInput(event: React.KeyboardEvent) {\n    return this.handleUpdate({ text: (event.target as any).value }, false);\n  }\n\n  public handleMessageUpdate(message: string, name: string, submitting = false): boolean {\n    return this.handleUpdate({ text: message }, submitting);\n  }\n\n  public handleQuickRepliesUpdate(quickReplies: string[]): boolean {\n    return this.handleUpdate({ quickReplies });\n  }\n\n  public handleSendAllUpdate(sendAll: boolean): boolean {\n    return this.handleUpdate({ sendAll });\n  }\n\n  public handleAxios(body: any, type: any) {\n    axios\n      .get(`${this.props.assetStore.validateMedia.endpoint}?url=${body.url}&type=${body.type}`)\n      .then(response => {\n        if (response.data.is_valid) {\n          // make sure we validate untouched text fields and contact fields\n          // let valid = this.handleMessageUpdate(this.state.message.value, null, true);\n          let valid = true;\n\n          let templateVariables = this.state.templateVariables;\n          // make sure we don't have untouched template variables\n          this.state.templateVariables.forEach((variable: StringEntry, num: number) => {\n            const updated = validate(`Variable ${num + 1}`, variable.value, [Required]);\n            templateVariables = mutate(templateVariables, {\n              [num]: { $merge: updated }\n            }) as StringEntry[];\n            valid = valid && !hasErrors(updated);\n          });\n\n          valid = valid && !hasErrors(this.state.quickReplyEntry);\n\n          if (valid) {\n            this.setState({ validAttachment: false });\n            this.props.updateAction(stateToAction(this.props.nodeSettings, this.state));\n            // notify our modal we are done\n            this.props.onClose(false);\n          } else {\n            this.setState({ templateVariables, valid });\n          }\n        } else {\n          this.setState({ attachmentError: response.data.message });\n        }\n      })\n      .catch(error => {\n        this.setState({ attachmentError: `The attachment url is invalid!: ${error.toString()}` });\n      });\n  }\n\n  private handleSave(): void {\n    if (this.state.attachments.length > 0) {\n      const type = this.state.attachments[0].type;\n      const url = this.state.attachments[0].url;\n\n      let body = {\n        type,\n        url\n      };\n\n      if (type === 'application') {\n        body.type = 'document';\n      }\n\n      switch (type) {\n        case 'image':\n          this.handleAxios(body, 'image');\n          break;\n\n        case 'video':\n          this.handleAxios(body, 'video');\n          break;\n\n        case 'audio':\n          this.handleAxios(body, 'audio');\n          break;\n        case 'application':\n          this.handleAxios(body, 'document');\n          break;\n      }\n      this.setState({ validAttachment: true, attachmentError: null });\n    } else {\n      // don't continue if our message already has errors\n      if (hasErrors(this.state.message)) {\n        return;\n      }\n\n      // make sure we validate untouched text fields and contact fields\n      let valid = this.handleMessageUpdate(this.state.message.value, null, true);\n      let templateVariables = this.state.templateVariables;\n      // make sure we don't have untouched template variables\n      this.state.templateVariables.forEach((variable: StringEntry, num: number) => {\n        const updated = validate(`Variable ${num + 1}`, variable.value, [Required]);\n        templateVariables = mutate(templateVariables, {\n          [num]: { $merge: updated }\n        }) as StringEntry[];\n        valid = valid && !hasErrors(updated);\n      });\n\n      valid = valid && !hasErrors(this.state.quickReplyEntry);\n\n      if (templateVariables.length > 0 && !this.state.message.value) {\n        valid = !valid;\n      }\n      if (valid) {\n        this.props.updateAction(stateToAction(this.props.nodeSettings, this.state));\n        // notify our modal we are done\n        this.props.onClose(false);\n      } else {\n        this.setState({ templateVariables, valid });\n      }\n    }\n  }\n\n  public handleAttachmentRemoved(index: number): void {\n    // we found a match, merge us in\n    const updated: any = mutate(this.state.attachments, {\n      $splice: [[index, 1]]\n    });\n    this.setState({ attachments: updated, attachmentError: null, validAttachment: false });\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  private renderUpload(index: number, attachment: Attachment): JSX.Element {\n    return (\n      <div\n        className={styles.url_attachment}\n        key={index > -1 ? 'url_attachment_' + index : createUUID()}\n      >\n        <div className={styles.type_choice}>\n          <SelectElement\n            key={'attachment_type_' + index}\n            name={i18n.t('forms.type', 'Type')}\n            style={TembaSelectStyle.small}\n            entry={{\n              value: { name: attachment.type }\n            }}\n            options={TYPE_OPTIONS}\n            disabled={true}\n          />\n        </div>\n        <div className={styles.url}>\n          <span className={styles.upload}>\n            <Pill\n              icon=\"fe-download\"\n              text=\"Download\"\n              large={true}\n              onClick={() => {\n                window.open(attachment.url, '_blank');\n              }}\n            />\n            <div className={styles.remove_upload}>\n              <Pill\n                icon=\"fe-x\"\n                text=\"Remove\"\n                large={true}\n                onClick={() => {\n                  this.handleAttachmentRemoved(index);\n                }}\n              />\n            </div>\n          </span>\n        </div>\n      </div>\n    );\n  }\n\n  private handleUploadFile(files: FileList): void {\n    let attachments: any = this.state.attachments;\n\n    // if we have a csrf in our cookie, pass it along as a header\n    const csrf = getCookie('csrftoken');\n    const headers: any = csrf ? { 'X-CSRFToken': csrf } : {};\n\n    // mark us as ajax\n    headers['X-Requested-With'] = 'XMLHttpRequest';\n\n    const data = new FormData();\n    data.append('file', files[0]);\n    axios\n      .post(this.context.config.endpoints.attachments, data, { headers })\n      .then(response => {\n        attachments = mutate(attachments, {\n          $push: [{ type: response.data.type, url: response.data.url, uploaded: true }]\n        });\n        this.setState({ attachments });\n      })\n      .catch(error => {\n        console.log(error);\n      });\n  }\n\n  private renderAttachment(index: number, attachment: Attachment): JSX.Element {\n    let attachments: any = this.state.attachments;\n    return (\n      <>\n        <div\n          className={styles.url_attachment}\n          key={index > -1 ? 'url_attachment_' + index : createUUID()}\n        >\n          <div className={styles.type_choice}>\n            <SelectElement\n              key={'attachment_type_' + index}\n              style={TembaSelectStyle.small}\n              name={i18n.t('forms.type_options', 'Type Options')}\n              placeholder=\"Add Attachment\"\n              entry={{\n                value: index > -1 ? getAttachmentTypeOption(attachment.type) : null\n              }}\n              onChange={(option: any) => {\n                if (option.value === 'upload') {\n                  window.setTimeout(() => {\n                    this.filePicker.click();\n                  }, 200);\n                } else {\n                  if (index === -1) {\n                    attachments = mutate(attachments, {\n                      $push: [{ type: option.value, url: '' }]\n                    });\n                  } else {\n                    attachments = mutate(attachments, {\n                      [index]: {\n                        $set: { type: option.value, url: attachment.url }\n                      }\n                    });\n                  }\n                  this.setState({ attachments });\n                }\n              }}\n              options={TYPE_OPTIONS}\n            />\n          </div>\n          {index > -1 ? (\n            <>\n              <div className={styles.url}>\n                <TextInputElement\n                  placeholder=\"URL\"\n                  name={i18n.t('forms.url', 'URL')}\n                  style={TextInputStyle.small}\n                  onChange={(value: string) => {\n                    attachments = mutate(attachments, {\n                      [index]: { $set: { type: attachment.type, url: value } }\n                    });\n                    this.setState({ attachments });\n                  }}\n                  entry={{ value: attachment.url }}\n                  autocomplete={true}\n                />\n              </div>\n              <div className={styles.remove}>\n                <Pill\n                  icon=\"fe-x\"\n                  text=\" Remove\"\n                  large={true}\n                  onClick={() => {\n                    this.handleAttachmentRemoved(index);\n                  }}\n                />\n              </div>\n            </>\n          ) : null}\n        </div>\n        {this.state.validAttachment && !this.state.attachmentError ? (\n          <div className={styles.loading}>\n            Checking URL validity\n            <Loading size={10} units={6} color=\"#999999\" />\n          </div>\n        ) : null}\n        {this.state.attachmentError ? (\n          <div className={styles.error}>\n            <ImCross className={styles.crossIcon} />\n            {this.state.attachmentError}\n          </div>\n        ) : null}\n      </>\n    );\n  }\n\n  private renderAttachments(): JSX.Element {\n    const attachments = this.state.attachments.map((attachment, index: number) =>\n      attachment.uploaded\n        ? this.renderUpload(index, attachment)\n        : this.renderAttachment(index, attachment)\n    );\n\n    const emptyOption =\n      this.state.attachments.length < MAX_ATTACHMENTS\n        ? this.renderAttachment(-1, { url: '', type: '' })\n        : null;\n    return (\n      <>\n        <p>\n          {i18n.t(\n            'forms.send_msg_summary',\n            'Add an attachment to each message. The attachment can be a file you upload or a dynamic URL using expressions and variables from your Flow.',\n            { count: MAX_ATTACHMENTS }\n          )}\n        </p>\n        {attachments}\n        {emptyOption}\n        <input\n          style={{\n            display: 'none'\n          }}\n          ref={ele => {\n            this.filePicker = ele;\n          }}\n          type=\"file\"\n          onChange={e => this.handleUploadFile(e.target.files)}\n        />\n      </>\n    );\n  }\n\n  private handleTemplateChanged(selected: any[]): void {\n    const template = selected ? selected[0] : null;\n\n    if (!template) {\n      this.setState({\n        template: { value: null },\n        templateTranslation: null,\n        templateVariables: []\n      });\n    } else {\n      const templateTranslation = template.translations[0];\n      const templateVariables =\n        this.state.templateVariables.length === 0 ||\n        (this.state.template.value && this.state.template.value.id !== template.id)\n          ? range(0, templateTranslation.variable_count).map(() => {\n              return {\n                value: ''\n              };\n            })\n          : this.state.templateVariables;\n\n      this.setState({\n        template: { value: template },\n        templateTranslation,\n        templateVariables\n      });\n    }\n  }\n\n  private handleTemplateVariableChanged(updatedText: string, num: number): void {\n    const entry = validate(`Variable ${num + 1}`, updatedText, [Required]);\n    const templateVariables = mutate(this.state.templateVariables, {\n      $merge: { [num]: entry }\n    }) as StringEntry[];\n    this.setState({ templateVariables });\n  }\n\n  private handleShouldExcludeTemplate(template: any): boolean {\n    return !hasUseableTranslation(template as Template);\n  }\n\n  private renderTopicConfig(): JSX.Element {\n    return (\n      <>\n        <p>\n          {i18n.t(\n            'forms.send_msg_facebook_warning',\n            'Sending bulk messages over a Facebook channel requires that a topic be specified if the user has not sent a message in the last 24 hours. Setting a topic to use over Facebook is especially important for the first message in your flow.'\n          )}\n        </p>\n        <SelectElement\n          key={'fb_method_select'}\n          name={i18n.t('forms.method', 'Method')}\n          entry={this.state.topic}\n          onChange={this.handleTopicUpdate}\n          options={TOPIC_OPTIONS}\n          placeholder={i18n.t(\n            'forms.send_msg_facebook_topic_placeholder',\n            'Select a topic to use over Facebook'\n          )}\n          clearable={true}\n        />\n      </>\n    );\n  }\n\n  private handleTopicUpdate(topic: SelectOption) {\n    this.setState({ topic: { value: topic } });\n  }\n\n  private renderTemplateConfig(): JSX.Element {\n    return (\n      <>\n        <p>\n          {i18n.t(\n            'forms.whatsapp_warning',\n            'Sending messages over a WhatsApp channel requires that a template be used if you have not received a message from a contact in the last 24 hours. Setting a template to use over WhatsApp is especially important for the first message in your flow.'\n          )}\n        </p>\n        <AssetSelector\n          name={i18n.t('forms.template', 'template')}\n          noOptionsMessage=\"No templates found\"\n          assets={this.props.assetStore.templates}\n          entry={this.state.template}\n          onChange={this.handleTemplateChanged}\n          shouldExclude={this.handleShouldExcludeTemplate}\n          searchable={true}\n          formClearable={true}\n        />\n        {this.state.templateTranslation ? (\n          <>\n            <div className={styles.template_text}>{this.state.templateTranslation.content}</div>\n            {range(0, this.state.templateTranslation.variable_count).map((num: number) => {\n              return (\n                <div className={styles.variable} key={'tr_arg_' + num}>\n                  <TextInputElement\n                    name={`${i18n.t('forms.variable', 'Variable')} ${num + 1}`}\n                    showLabel={false}\n                    placeholder={`${i18n.t('forms.variable', 'Variable')} ${num + 1}`}\n                    onChange={(updatedText: string) => {\n                      this.handleTemplateVariableChanged(updatedText, num);\n                    }}\n                    entry={\n                      this.state.templateVariables[num] === undefined\n                        ? { value: '' }\n                        : this.state.templateVariables[num]\n                    }\n                    autocomplete={true}\n                  />\n                </div>\n              );\n            })}\n          </>\n        ) : null}\n      </>\n    );\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    const quickReplies: Tab = {\n      name: 'Quick Replies',\n      body: (\n        <>\n          <p>\n            {i18n.t(\n              'forms.quick_replies_summary',\n              'Quick Replies are made into buttons for supported channels. For example, when asking a question, you might add a Quick Reply for \"Yes\" and one for \"No\".'\n            )}\n          </p>\n\n          <MultiChoiceInput\n            name={i18n.t('forms.quick_reply', 'quick_reply')}\n            helpText={\n              <Trans i18nKey=\"forms.add_quick_reply\">Add a new Quick Reply and press enter.</Trans>\n            }\n            items={this.state.quickReplies}\n            entry={this.state.quickReplyEntry}\n            onChange={this.handleQuickRepliesUpdate}\n          />\n        </>\n      ),\n      checked: this.state.quickReplies.value.length > 0,\n      hasErrors: hasErrors(this.state.quickReplyEntry)\n    };\n\n    const attachments: Tab = {\n      name: 'Attachments',\n      body: this.renderAttachments(),\n      checked: this.state.attachments.length > 0,\n      hasErrors: this.state.validAttachment\n    };\n\n    const advanced: Tab = {\n      name: 'Advanced',\n      body: (\n        <CheckboxElement\n          name={i18n.t('forms.all_destinations', 'All Destinations')}\n          title=\"All Destinations\"\n          labelClassName={styles.checkbox}\n          checked={this.state.sendAll}\n          description={i18n.t(\n            'forms.all_destinations',\n            \"Send a message to all destinations known for this contact. If you aren't sure what this means, leave it unchecked.\"\n          )}\n          onChange={this.handleSendAllUpdate}\n        />\n      ),\n      checked: this.state.sendAll\n    };\n\n    // const tabs = [quickReplies, attachments, advanced];\n    const tabs = [attachments];\n\n    if (hasFeature(this.context.config, FeatureFilter.HAS_WHATSAPP)) {\n      const templates: Tab = {\n        name: 'WhatsApp',\n        body: this.renderTemplateConfig(),\n        checked: this.state.template.value != null,\n        hasErrors: !!this.state.templateVariables.find((entry: StringEntry) => hasErrors(entry))\n      };\n      tabs.splice(0, 0, templates);\n    }\n\n    // currently, we aren't support to facebook\n\n    // if (hasFeature(this.context.config, FeatureFilter.HAS_FACEBOOK)) {\n    //   const templates: Tab = {\n    //     name: 'Facebook',\n    //     body: this.renderTopicConfig(),\n    //     checked: this.state.topic.value != null\n    //   };\n    //   tabs.splice(0, 0, templates);\n    // }\n\n    return (\n      <>\n        <Dialog\n          title={typeConfig.name}\n          headerClass={typeConfig.type}\n          buttons={this.getButtons()}\n          tabs={tabs}\n        >\n          <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n          <TextInputElement\n            name={i18n.t('forms.message', 'Message')}\n            showLabel={false}\n            counter=\".sms-counter\"\n            onChange={this.handleMessageUpdate}\n            entry={this.state.message}\n            autocomplete={true}\n            focus={true}\n            textarea={true}\n          />\n          <temba-charcount class=\"sms-counter\"></temba-charcount>\n          {renderIssues(this.props)}\n        </Dialog>\n      </>\n    );\n  }\n}\n","import * as React from 'react';\nimport { SetRunResult } from 'flowTypes';\nimport { ellipsize, emphasize } from 'utils';\n\nexport const getSavePlaceholder = (value: string, name: string): JSX.Element => (\n  <div>\n    Save {emphasize(ellipsize(value, 100))} as {emphasize(name)}\n  </div>\n);\n\nexport const getClearPlaceholder = (name: string) => <div>Clear value for {emphasize(name)}</div>;\n\nconst SetRunResultComp: React.SFC<SetRunResult> = ({ value, name }): JSX.Element => {\n  if (value) {\n    return getSavePlaceholder(value, name);\n  }\n  return getClearPlaceholder(name);\n};\n\nexport default SetRunResultComp;\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { ActionFormProps } from 'components/flow/props';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport * as React from 'react';\nimport { Asset, AssetType } from 'store/flowContext';\nimport { AssetEntry, FormState, mergeForm, StringEntry } from 'store/nodeEditor';\nimport { Alphanumeric, shouldRequireIf, StartIsNonNumeric, validate } from 'store/validators';\nimport { snakify } from 'utils';\n\nimport { initializeForm, stateToAction } from './helpers';\nimport styles from './SetRunResultForm.module.scss';\nimport i18n from 'config/i18n';\nimport { Trans } from 'react-i18next';\nimport { SelectOption } from 'components/form/select/SelectElement';\n\nexport interface SetRunResultFormState extends FormState {\n  name: AssetEntry;\n  value: StringEntry;\n  category: StringEntry;\n}\n\nexport default class SetRunResultForm extends React.PureComponent<\n  ActionFormProps,\n  SetRunResultFormState\n> {\n  options: SelectOption[] = [];\n\n  constructor(props: ActionFormProps) {\n    super(props);\n\n    this.state = initializeForm(this.props.nodeSettings);\n\n    bindCallbacks(this, {\n      include: [/^handle/, /^on/]\n    });\n  }\n\n  public componentDidMount(): void {\n    const items = this.props.assetStore.results.items;\n    this.options = Object.keys(items).map((key: string) => {\n      return { name: items[key].name, value: key };\n    });\n  }\n\n  private handleNameUpdate(selected: Asset[]): void {\n    if (selected) {\n      this.handleUpdate({ name: selected[0] });\n    } else {\n      this.handleUpdate({ name: null });\n    }\n  }\n\n  public handleValueUpdate(value: string): boolean {\n    return this.handleUpdate({ value });\n  }\n\n  public handleCategoryUpdate(category: string): boolean {\n    return this.handleUpdate({ category });\n  }\n\n  private handleUpdate(\n    keys: { name?: Asset; value?: string; category?: string },\n    submitting: boolean = false\n  ): boolean {\n    const updates: Partial<SetRunResultFormState> = {};\n\n    if (keys.hasOwnProperty('name')) {\n      updates.name = validate(i18n.t('forms.name', 'Name'), keys.name, [\n        shouldRequireIf(submitting),\n        Alphanumeric,\n        StartIsNonNumeric\n      ]);\n    }\n\n    if (keys.hasOwnProperty('value')) {\n      updates.value = validate(i18n.t('forms.value', 'Value'), keys.value, []);\n    }\n\n    if (keys.hasOwnProperty('category')) {\n      updates.category = validate(i18n.t('forms.category', 'Category'), keys.category, []);\n    }\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private handleSave(): void {\n    // make sure we validate untouched text fields\n    const valid = this.handleUpdate({ name: this.state.name.value }, true);\n\n    if (valid) {\n      this.props.updateAction(stateToAction(this.props.nodeSettings, this.state));\n\n      // notify our modal we are done\n      this.props.onClose(false);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  private handleCreateAssetFromInput(input: string): Asset {\n    return {\n      id: snakify(input),\n      name: input,\n      type: AssetType.Result\n    };\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n    const snaked =\n      !hasErrors(this.state.name) && this.state.name.value\n        ? '.' + snakify(this.state.name.value.name)\n        : '';\n\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <div className={styles.form}>\n          <AssetSelector\n            name={i18n.t('forms.result', 'Result')}\n            assets={this.props.assetStore.results}\n            entry={this.state.name}\n            searchable={true}\n            createPrefix={i18n.t('forms.create_prefix', 'New: ')}\n            onChange={this.handleNameUpdate}\n            createAssetFromInput={this.handleCreateAssetFromInput}\n            formClearable={true}\n            showLabel={true}\n            valueKey=\"value\"\n            nameKey=\"name\"\n            additionalOptions={this.options}\n            helpText={\n              <Trans\n                i18nKey=\"forms.result_name_help\"\n                values={{ resultFormat: `@results${snaked}` }}\n              >\n                By naming the result, you can reference it later using [[resultFormat]]\n              </Trans>\n            }\n          />\n\n          <TextInputElement\n            __className={styles.value}\n            name={i18n.t('forms.value', 'Value')}\n            showLabel={true}\n            onChange={this.handleValueUpdate}\n            entry={this.state.value}\n            autocomplete={true}\n            helpText=\"The value to save for this result or empty to clears it. You can use expressions, for example: @(title(input))\"\n          />\n          <TextInputElement\n            __className={styles.category}\n            name={i18n.t('forms.category', 'Category')}\n            placeholder=\"Optional\"\n            showLabel={true}\n            onChange={this.handleCategoryUpdate}\n            entry={this.state.category}\n            autocomplete={false}\n            helpText=\"An optional category for your result. For age, the value might be 17, but the category might be 'Young Adult'\"\n          />\n        </div>\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { getActionUUID } from 'components/flow/actions/helpers';\r\nimport { SetRunResultFormState } from 'components/flow/actions/setrunresult/SetRunResultForm';\r\nimport { Types } from 'config/interfaces';\r\nimport { SetRunResult } from 'flowTypes';\r\nimport { AssetType } from 'store/flowContext';\r\nimport { NodeEditorSettings } from 'store/nodeEditor';\r\nimport { snakify } from 'utils';\r\n\r\nexport const initializeForm = (settings: NodeEditorSettings): SetRunResultFormState => {\r\n  if (settings.originalAction && settings.originalAction.type === Types.set_run_result) {\r\n    const action = settings.originalAction as SetRunResult;\r\n\r\n    return {\r\n      name: {\r\n        value: {\r\n          id: snakify(action.name),\r\n          name: action.name,\r\n          type: AssetType.Result\r\n        }\r\n      },\r\n      value: { value: action.value },\r\n      category: { value: action.category },\r\n      valid: true\r\n    };\r\n  }\r\n\r\n  return {\r\n    name: { value: null },\r\n    value: { value: '' },\r\n    category: { value: '' },\r\n    valid: false\r\n  };\r\n};\r\n\r\nexport const stateToAction = (\r\n  settings: NodeEditorSettings,\r\n  state: SetRunResultFormState\r\n): SetRunResult => {\r\n  return {\r\n    type: Types.set_run_result,\r\n    name: state.name.value.name,\r\n    value: state.value.value,\r\n    category: state.category.value,\r\n    uuid: getActionUUID(settings, Types.set_run_result)\r\n  };\r\n};\r\n","import * as React from 'react';\r\nimport { renderAssetList } from 'components/flow/actions/helpers';\r\nimport { fakePropType } from 'config/ConfigProvider';\r\nimport { StartFlow } from 'flowTypes';\r\nimport { AssetType } from 'store/flowContext';\r\n\r\nconst StartFlowComp: React.SFC<StartFlow> = (\r\n  { flow: { name, uuid } },\r\n  context: any\r\n): JSX.Element => (\r\n  <>{renderAssetList([{ name, id: uuid, type: AssetType.Flow }], 3, context.config.endpoints)}</>\r\n);\r\n\r\nStartFlowComp.contextTypes = {\r\n  config: fakePropType\r\n};\r\n\r\nexport default StartFlowComp;\r\n","import { getRecipients, renderAssetList, renderAsset } from 'components/flow/actions/helpers';\r\nimport { fakePropType } from 'config/ConfigProvider';\r\nimport { StartSession } from 'flowTypes';\r\nimport * as React from 'react';\r\nimport { AssetType } from 'store/flowContext';\r\n\r\nimport styles from './StartSession.module.scss';\r\n\r\nconst MAX_TO_SHOW = 5;\r\n\r\nexport const StartSessionComp: React.SFC<StartSession> = (\r\n  action: StartSession,\r\n  context: any\r\n): JSX.Element => {\r\n  const recipients = getRecipients(action);\r\n  return (\r\n    <div className={styles.node}>\r\n      <div className={styles.to}>\r\n        {action.create_contact\r\n          ? 'Create a new contact'\r\n          : action.contact_query\r\n          ? action.contact_query\r\n          : renderAssetList(recipients, MAX_TO_SHOW, context.config.endpoints)}\r\n      </div>\r\n      <div className={styles.flow}>\r\n        {renderAsset(\r\n          {\r\n            name: action.flow.name,\r\n            id: action.flow.uuid,\r\n            type: AssetType.Flow\r\n          },\r\n          context.config.endpoints\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nStartSessionComp.contextTypes = {\r\n  config: fakePropType\r\n};\r\n\r\nexport default StartSessionComp;\r\n","import i18n from 'config/i18n';\n\nexport const WAIT_LABEL = i18n.t('forms.message_label', 'If the message response...');\nexport const EXPRESSION_LABEL = i18n.t('forms.expression_label', 'If the expression...');\nexport const GROUP_LABEL = i18n.t(\n  'forms.split_by_groups',\n  \"Select the collections you'd like to split by below\"\n);\n\nexport const OPERAND_LOCALIZATION_DESC = i18n.t(\n  'forms.localize_rules',\n  'Sometimes languages need special rules to route things properly. If a translation is not provided, the original rule will be used.'\n);\n\n// We intentionally don't localize these names\nexport enum DefaultExitNames {\n  All_Responses = 'All Responses',\n  No_Response = 'No Response',\n  Any_Value = 'Any Value',\n  Other = 'Other'\n}\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { ActionFormProps } from 'components/flow/props';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport * as React from 'react';\nimport { Asset } from 'store/flowContext';\nimport {\n  AssetArrayEntry,\n  FormState,\n  mergeForm,\n  StringEntry,\n  SelectOptionEntry,\n  FormEntry\n} from 'store/nodeEditor';\nimport { shouldRequireIf, validate } from 'store/validators';\nimport { renderIf } from 'utils';\nimport SelectElement, { SelectOption } from 'components/form/select/SelectElement';\nimport { initializeForm, stateToAction } from './helpers';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\nimport i18n from 'config/i18n';\nimport { renderIssues } from '../helpers';\n\nexport const START_TYPE_ASSETS: SelectOption = {\n  name: 'Select recipients manually',\n  value: 'assets'\n};\nexport const START_TYPE_CREATE: SelectOption = {\n  name: 'Create a new contact',\n  value: 'create_contact'\n};\nexport const START_TYPE_QUERY: SelectOption = {\n  name: 'Select recipients from a query',\n  value: 'contact_query'\n};\n\nconst START_TYPE_OPTIONS = [START_TYPE_ASSETS, START_TYPE_QUERY, START_TYPE_CREATE];\n\nexport interface StartSessionFormState extends FormState {\n  recipients: AssetArrayEntry;\n  flow: FormEntry;\n  startType: SelectOptionEntry;\n  contactQuery: StringEntry;\n}\n\nexport class StartSessionForm extends React.Component<ActionFormProps, StartSessionFormState> {\n  constructor(props: ActionFormProps) {\n    super(props);\n\n    this.state = initializeForm(this.props.nodeSettings);\n\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  public handleRecipientsChanged(recipients: Asset[]): boolean {\n    return this.handleUpdate({ recipients });\n  }\n\n  public handleFlowChanged(flows: Asset[]): boolean {\n    let flow = null;\n    if (flows && flows.length > 0) {\n      flow = flows[0];\n    }\n    return this.handleUpdate({ flow });\n  }\n\n  public handleStartTypeChanged(startType: SelectOption): boolean {\n    return this.handleUpdate({ startType });\n  }\n\n  public handleContactQueryChanged(contactQuery: string): boolean {\n    return this.handleUpdate({ contactQuery });\n  }\n\n  private handleUpdate(\n    keys: { flow?: Asset; recipients?: Asset[]; startType?: SelectOption; contactQuery?: string },\n    submitting = false\n  ): boolean {\n    const updates: Partial<StartSessionFormState> = {};\n\n    if (keys.hasOwnProperty('startType')) {\n      updates.startType = { value: keys.startType };\n      if (keys.startType !== START_TYPE_ASSETS) {\n        updates.recipients = { value: [] };\n      }\n\n      if (keys.startType !== START_TYPE_QUERY) {\n        updates.contactQuery = { value: '' };\n      }\n    }\n\n    if (keys.hasOwnProperty('contactQuery')) {\n      updates.contactQuery = validate(\n        i18n.t('forms.contact_query', 'Contact Query'),\n        keys.contactQuery,\n        [shouldRequireIf(submitting && this.state.startType.value === START_TYPE_QUERY)]\n      );\n    }\n\n    if (keys.hasOwnProperty('recipients')) {\n      updates.recipients = validate(i18n.t('forms.recipients', 'Recipients'), keys.recipients, [\n        shouldRequireIf(submitting && this.state.startType.value === START_TYPE_ASSETS)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('flow')) {\n      updates.flow = validate(i18n.t('forms.flow', 'Flow'), keys.flow, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private handleSave(): void {\n    // validate in case they never updated an empty field\n    const valid = this.handleUpdate(\n      {\n        recipients: this.state.recipients.value,\n        flow: this.state.flow.value,\n        contactQuery: this.state.contactQuery.value\n      },\n      true\n    );\n\n    if (valid) {\n      this.props.updateAction(stateToAction(this.props.nodeSettings, this.state));\n\n      // notify our modal we are done\n      this.props.onClose(false);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <div>\n          <SelectElement\n            key=\"start_type_select\"\n            name={i18n.t('forms.start_type', 'Start Type')}\n            entry={this.state.startType}\n            onChange={this.handleStartTypeChanged}\n            options={START_TYPE_OPTIONS}\n          />\n        </div>\n        <p />\n        <div>\n          {renderIf(this.state.startType.value === START_TYPE_ASSETS)(\n            <div data-testid=\"recipients\">\n              <AssetSelector\n                name={i18n.t('forms.recipients', 'Recipients')}\n                placeholder=\"Choose who should be started in the flow\"\n                assets={this.props.assetStore.recipients}\n                entry={this.state.recipients}\n                searchable={true}\n                multi={true}\n                onChange={this.handleRecipientsChanged}\n              />\n              <p />\n            </div>\n          )}\n\n          {renderIf(this.state.startType.value === START_TYPE_QUERY)(\n            <div data-testid=\"contact_query\">\n              <TextInputElement\n                name={i18n.t('forms.contact_query', 'Contact Query')}\n                placeholder={'household_id = @fields.household_id'}\n                onChange={this.handleContactQueryChanged}\n                entry={this.state.contactQuery}\n                autocomplete={true}\n                focus={true}\n              />\n              <p />\n            </div>\n          )}\n\n          <AssetSelector\n            name={i18n.t('forms.flow', 'Flow')}\n            placeholder=\"Choose which flow to start\"\n            assets={this.props.assetStore.flows}\n            entry={this.state.flow}\n            searchable={true}\n            onChange={this.handleFlowChanged}\n          />\n        </div>\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n\nexport default StartSessionForm;\n","import {\n  getActionUUID,\n  getExpressions,\n  getRecipients,\n  getRecipientsByAsset\n} from 'components/flow/actions/helpers';\nimport {\n  StartSessionFormState,\n  START_TYPE_CREATE,\n  START_TYPE_ASSETS,\n  START_TYPE_QUERY\n} from 'components/flow/actions/startsession/StartSessionForm';\nimport { Types } from 'config/interfaces';\nimport { StartSession } from 'flowTypes';\nimport { AssetType } from 'store/flowContext';\nimport { NodeEditorSettings } from 'store/nodeEditor';\n\nexport const initializeForm = (settings: NodeEditorSettings): StartSessionFormState => {\n  if (settings.originalAction && settings.originalAction.type === Types.start_session) {\n    const action = settings.originalAction as StartSession;\n\n    const init = {\n      recipients: {\n        value: getRecipients(action)\n      },\n      flow: {\n        value: action.flow\n      },\n      startType: {\n        value: action.create_contact\n          ? START_TYPE_CREATE\n          : action.contact_query\n          ? START_TYPE_QUERY\n          : START_TYPE_ASSETS\n      },\n      contactQuery: { value: action.contact_query || '' },\n      valid: true\n    };\n\n    return init;\n  }\n\n  return {\n    recipients: { value: [] },\n    flow: { value: null },\n    startType: { value: START_TYPE_ASSETS },\n    contactQuery: { value: '' },\n    valid: false\n  };\n};\n\nexport const stateToAction = (\n  settings: NodeEditorSettings,\n  state: StartSessionFormState\n): StartSession => {\n  const flow = state.flow.value;\n\n  const action: StartSession = {\n    legacy_vars: getExpressions(state.recipients.value),\n    contacts: getRecipientsByAsset(state.recipients.value, AssetType.Contact),\n    groups: getRecipientsByAsset(state.recipients.value, AssetType.Group),\n    create_contact: state.startType.value === START_TYPE_CREATE,\n    flow: { name: flow.name, uuid: flow.uuid },\n    type: Types.start_session,\n    uuid: getActionUUID(settings, Types.start_session)\n  };\n\n  // only include contact query if it is set\n  if (state.contactQuery.value) {\n    action['contact_query'] = state.contactQuery.value;\n  }\n\n  return action;\n};\n","import { TransferAirtime } from 'flowTypes';\r\nimport * as React from 'react';\r\n\r\nimport styles from './TransferAirtime.module.scss';\r\n\r\nconst TransferAirtimeComp: React.SFC<TransferAirtime> = (transfer): JSX.Element => {\r\n  const details = Object.keys(transfer.amounts).map((key: string) => {\r\n    return (\r\n      <div key={'transfer_' + key}>\r\n        <div className={styles.amount}>{transfer.amounts[key]}</div>\r\n        <div className={styles.code}>{key}</div>\r\n      </div>\r\n    );\r\n  });\r\n\r\n  return <div>{details}</div>;\r\n};\r\n\r\nexport default TransferAirtimeComp;\r\n","import { getLanguageForCode } from 'components/flow/actions/updatecontact/helpers';\nimport { Types } from 'config/interfaces';\nimport {\n  SetContactAttribute,\n  SetContactChannel,\n  SetContactLanguage,\n  SetContactName,\n  SetContactStatus\n} from 'flowTypes';\nimport * as React from 'react';\nimport { emphasize } from 'utils';\nconst styles = require('components/shared.module.scss');\n\nconst withEmph = (text: string, emph: boolean) => (emph ? emphasize(text) : text);\n\nexport const renderSetText = (\n  name: string,\n  value: string,\n  emphasizeName: boolean = false\n): JSX.Element => {\n  if (value) {\n    return (\n      <div className={`${styles.node_asset}`}>\n        Set {withEmph(name, emphasizeName)} to {emphasize(value)}.\n      </div>\n    );\n  } else {\n    return <div>Clear {withEmph(name, emphasizeName)}.</div>;\n  }\n};\n\nconst UpdateContactComp: React.SFC<SetContactAttribute> = (\n  action: SetContactAttribute\n): JSX.Element => {\n  if (action.type === Types.set_contact_field) {\n    return renderSetText(action.field.key, action.value, true);\n  }\n\n  if (action.type === Types.set_contact_channel) {\n    const setContactAction = action as SetContactChannel;\n    return renderSetText(\n      'channel',\n      setContactAction.channel ? setContactAction.channel.name : null,\n      false\n    );\n  }\n\n  if (action.type === Types.set_contact_language) {\n    const setLanguageAction = action as SetContactLanguage;\n    return renderSetText(\n      'language',\n      getLanguageForCode(setLanguageAction.language, (action as any).languages),\n      false\n    );\n  }\n\n  if (action.type === Types.set_contact_status) {\n    return renderSetText('status', (action as SetContactStatus).status, false);\n  }\n\n  if (action.type === Types.set_contact_name) {\n    return renderSetText('name', (action as SetContactName).name, false);\n  }\n\n  return null;\n};\n\nexport default UpdateContactComp;\n","import {\n  CHANNEL_PROPERTY,\n  LANGUAGE_PROPERTY,\n  NAME_PROPERTY,\n  STATUS_PROPERTY\n} from 'components/flow/props';\nimport { isOnlineFlowType } from 'config/helpers';\nimport { FlowTypes } from 'config/interfaces';\nimport { Asset, RenderNode } from 'store/flowContext';\n\nexport interface DragPoint {\n  exitUUID: string;\n  nodeUUID: string;\n}\n\nexport const getDraggedFrom = (ghostNode: RenderNode): DragPoint => {\n  if (ghostNode.ghost) {\n    const exitUUIDs = Object.keys(ghostNode.inboundConnections);\n    if (exitUUIDs.length > 0) {\n      const exitUUID = exitUUIDs[0];\n      const nodeUUID = ghostNode.inboundConnections[exitUUID];\n      return { exitUUID, nodeUUID };\n    }\n  }\n};\n\nconst ONLINE_PROPERTIES: Asset[] = [\n  NAME_PROPERTY,\n  LANGUAGE_PROPERTY,\n  CHANNEL_PROPERTY,\n  STATUS_PROPERTY\n];\nconst OFFLINE_PROPERTIES: Asset[] = [NAME_PROPERTY, LANGUAGE_PROPERTY, STATUS_PROPERTY];\n\nexport const getContactProperties = (flowType: FlowTypes = null): Asset[] => {\n  return !flowType || isOnlineFlowType(flowType) ? ONLINE_PROPERTIES : OFFLINE_PROPERTIES;\n};\n","import { CaseProps } from 'components/flow/routers/caselist/CaseList';\nimport { DefaultExitNames } from 'components/flow/routers/constants';\nimport { Operators, Types } from 'config/interfaces';\nimport {\n  Action,\n  CallResthook,\n  CallWebhook,\n  Case,\n  Category,\n  Exit,\n  FlowNode,\n  Router,\n  RouterTypes,\n  SwitchRouter,\n  TransferAirtime,\n  UIConfig,\n  WebhookExitNames,\n  CallClassifier,\n  OpenTicket\n} from 'flowTypes';\nimport { RenderNode } from 'store/flowContext';\nimport { createUUID, snakify } from 'utils';\n\nexport interface CategorizedCases {\n  cases: Case[];\n  categories: Category[];\n  exits: Exit[];\n  caseConfig: { [uuid: string]: any };\n}\nexport interface ResolvedRoutes extends CategorizedCases {\n  defaultCategory: string;\n  timeoutCategory?: string;\n}\n\nexport const createRenderNode = (\n  uuid: string,\n  router: Router,\n  exits: Exit[],\n  type: Types,\n  actions: Action[] = [],\n  uiConfig: { [key: string]: any } = {}\n): RenderNode => {\n  const renderNode: RenderNode = {\n    node: {\n      uuid,\n      actions,\n      router,\n      exits\n    },\n    ui: {\n      type,\n      position: null,\n      config: uiConfig\n    },\n    inboundConnections: {}\n  };\n  return renderNode;\n};\n\nexport const hasCases = (node: FlowNode): boolean => {\n  if (\n    node.router &&\n    (node.router as SwitchRouter).cases &&\n    (node.router as SwitchRouter).cases.length\n  ) {\n    return true;\n  }\n  return false;\n};\n\nexport const getCategories = (renderNode: RenderNode): Category[] => {\n  if (renderNode.node.router) {\n    return renderNode.node.router.categories;\n  }\n  return [];\n};\n\nexport const createCaseProps = (cases: Case[], renderNode: RenderNode): CaseProps[] => {\n  const categories: Category[] = getCategories(renderNode);\n\n  // make sure we don't mutate the in memory version of our cases\n  const newCases = JSON.parse(JSON.stringify(cases));\n  return newCases.map((kase: Case) => {\n    const matchingCategory = categories.find(\n      (category: Category) => category.uuid === kase.category_uuid\n    );\n\n    if (isRelativeDate(kase.type)) {\n      if (renderNode.ui.config && renderNode.ui.config.cases) {\n        const caseConfig = renderNode.ui.config.cases[kase.uuid];\n        if (caseConfig && caseConfig.arguments) {\n          kase.arguments = caseConfig.arguments;\n        }\n      }\n    }\n\n    return {\n      uuid: kase.uuid,\n      kase,\n      categoryName: matchingCategory ? matchingCategory.name : null,\n      valid: true\n    };\n  });\n};\n\nexport const isRelativeDate = (operatorType: Operators): boolean => {\n  return !![Operators.has_date_eq, Operators.has_date_gt, Operators.has_date_lt].find(\n    (type: string) => operatorType === type\n  );\n};\n\nconst isCategoryMatch = (cat: Category, kase: CaseProps) => {\n  // see if we have the same name\n  return cat.name.toLowerCase().trim() === kase.categoryName.trim().toLowerCase();\n};\n\n/**\n * Given a set of cases and previous categories, determines correct merging of cases\n * and the union of categories\n */\nexport const categorizeCases = (\n  newCases: CaseProps[],\n  originalNode: FlowNode\n): CategorizedCases => {\n  const categories: Category[] = [];\n  const cases: Case[] = [];\n  const exits: Exit[] = [];\n  const caseConfig: UIConfig = {};\n\n  const originalRouter = originalNode && originalNode.router;\n  const previousCategories = (originalRouter && originalRouter.categories) || [];\n\n  // look over the new cases and match up categories and exits\n  for (const newCase of newCases) {\n    // ignore empty cases\n    if (!newCase.categoryName || newCase.categoryName.trim().length === 0) {\n      continue;\n    }\n\n    // convert relative dates to expressions with configs\n    if (isRelativeDate(newCase.kase.type)) {\n      caseConfig[newCase.uuid] = { arguments: newCase.kase.arguments };\n      newCase.kase.arguments = [`@(datetime_add(today(), ${newCase.kase.arguments[0]}, \"D\"))`];\n    }\n\n    //  see if it exists on a previous case\n    let category = categories.find((cat: Category) => isCategoryMatch(cat, newCase));\n\n    // if not, see if that category exists on our old node\n    if (!category) {\n      category = previousCategories.find((cat: Category) => isCategoryMatch(cat, newCase));\n\n      // still no category, lets see if we can find a case uuid match\n      if (!category) {\n        const router = getSwitchRouter(originalNode);\n        if (router) {\n          const previousCase = router.cases.find((kase: Case) => kase.uuid === newCase.uuid);\n          if (previousCase) {\n            const previousCategory = previousCategories.find(\n              (cat: Category) => cat.uuid === previousCase.category_uuid\n            );\n\n            if (previousCategory) {\n              category = { ...previousCategory, name: newCase.categoryName };\n            }\n          }\n        }\n      }\n\n      // don't pull over an old category more than once\n      if (category && categories.find((cat: Category) => cat.uuid === category.uuid)) {\n        category = null;\n      }\n\n      // we found an old category, bring it and its exit over\n      if (category) {\n        categories.push(category);\n        const previousExit = originalNode.exits.find(\n          (exit: Exit) => category.exit_uuid === exit.uuid\n        );\n        exits.push(previousExit);\n      }\n    }\n\n    // if still no category, finally lets just create a new one\n    if (!category) {\n      const exit: Exit = {\n        uuid: createUUID()\n      };\n\n      exits.push(exit);\n\n      category = {\n        uuid: createUUID(),\n        name: newCase.categoryName,\n        exit_uuid: exit.uuid\n      };\n\n      categories.push(category);\n    }\n\n    // lastly, add our case\n    cases.push({\n      ...newCase.kase,\n      category_uuid: category.uuid\n    });\n  }\n\n  return { cases, categories, exits, caseConfig };\n};\n\nexport const getSwitchRouter = (node: FlowNode): SwitchRouter => {\n  if (node && node.router && node.router.type === RouterTypes.switch) {\n    return node.router as SwitchRouter;\n  }\n  return null;\n};\n\n/**\n * Adds a default route, reusing the previous one if possible\n * @param originalNode\n */\nexport const getDefaultRoute = (\n  defaultCategoryName: string,\n  originalNode: FlowNode\n): { defaultCategory: Category; defaultExit: Exit } => {\n  const originalRouter = getSwitchRouter(originalNode);\n\n  // use the previous default if it had one\n  if (originalRouter) {\n    const defaultCategory = originalRouter.categories.find(\n      (cat: Category) => cat.uuid === originalRouter.default_category_uuid\n    );\n\n    const defaultExit = originalNode.exits.find((e: Exit) => e.uuid === defaultCategory.exit_uuid);\n\n    defaultCategory.name = defaultCategoryName;\n\n    return { defaultCategory, defaultExit };\n  }\n  // otherwise, create a new exit and category\n  else {\n    const defaultExit: Exit = {\n      uuid: createUUID()\n    };\n\n    const defaultCategory = {\n      uuid: createUUID(),\n      name: defaultCategoryName,\n      exit_uuid: defaultExit.uuid\n    };\n\n    return { defaultCategory, defaultExit };\n  }\n};\n\nconst getTimeoutRoute = (\n  originalNode: FlowNode\n): { timeoutCategory: Category; timeoutExit: Exit } => {\n  let timeoutCategory: Category = null;\n  let timeoutExit: Exit = null;\n\n  const originalRouter = getSwitchRouter(originalNode);\n\n  // see if our previous node had a timeout case\n  if (originalRouter) {\n    if (originalRouter.wait && originalRouter.wait.timeout) {\n      const previousCategory = originalRouter.wait.timeout.category_uuid;\n      timeoutCategory = originalRouter.categories.find(\n        (cat: Category) => cat.uuid === previousCategory\n      );\n      timeoutExit = originalNode.exits.find(\n        (exit: Exit) => exit.uuid === timeoutCategory.exit_uuid\n      );\n    }\n  }\n\n  if (!timeoutCategory) {\n    // create a new route\n    timeoutExit = {\n      uuid: createUUID()\n    };\n\n    timeoutCategory = {\n      uuid: createUUID(),\n      name: DefaultExitNames.No_Response,\n      exit_uuid: timeoutExit.uuid\n    };\n  }\n\n  return { timeoutCategory, timeoutExit };\n};\n\n/**\n * Given a set of cases and previous categories, determines correct merging of cases\n * and the union of categories\n */\nexport const resolveRoutes = (\n  newCases: CaseProps[],\n  hasTimeout: boolean,\n  originalNode: FlowNode,\n  defaultCategoryName: string = null\n): ResolvedRoutes => {\n  const resolved = categorizeCases(newCases, originalNode);\n\n  let resolvedDefaultCategory = defaultCategoryName;\n  if (!resolvedDefaultCategory) {\n    resolvedDefaultCategory =\n      resolved.categories.length > 0 ? DefaultExitNames.Other : DefaultExitNames.All_Responses;\n  }\n\n  // tack on our other category\n  const { defaultCategory, defaultExit } = getDefaultRoute(resolvedDefaultCategory, originalNode);\n  resolved.categories.push(defaultCategory);\n  resolved.exits.push(defaultExit);\n\n  const results: ResolvedRoutes = {\n    ...resolved,\n    defaultCategory: defaultCategory.uuid\n  };\n\n  // add in a timeout route if we need one\n  if (hasTimeout) {\n    const { timeoutCategory, timeoutExit } = getTimeoutRoute(originalNode);\n    resolved.categories.push(timeoutCategory);\n    resolved.exits.push(timeoutExit);\n    results.timeoutCategory = timeoutCategory.uuid;\n  }\n\n  return results;\n};\n\nexport const createWebhookBasedNode = (\n  action: CallWebhook | CallResthook | OpenTicket | TransferAirtime,\n  originalNode: RenderNode,\n  useCategoryTest: boolean\n): RenderNode => {\n  const exits: Exit[] = [];\n  let cases: Case[] = [];\n  let categories: Category[] = [];\n\n  // see if we are editing an existing router so we reuse exits\n  if (\n    originalNode &&\n    originalNode.node.actions.length === 1 &&\n    originalNode.node.actions[0].type === action.type\n  ) {\n    const previousRouter = getSwitchRouter(originalNode.node);\n    originalNode.node.exits.forEach((exit: any) => exits.push(exit));\n    previousRouter.cases.forEach(kase => cases.push(kase));\n    originalNode.node.router.categories.forEach(category => categories.push(category));\n  } else {\n    // Otherwise, let's create some new ones\n    exits.push(\n      {\n        uuid: createUUID(),\n        destination_uuid: null\n      },\n      {\n        uuid: createUUID(),\n        destination_uuid: null\n      }\n    );\n\n    categories = [\n      {\n        uuid: createUUID(),\n        name: WebhookExitNames.Success,\n        exit_uuid: exits[0].uuid\n      },\n      {\n        uuid: createUUID(),\n        name: WebhookExitNames.Failure,\n        exit_uuid: exits[1].uuid\n      }\n    ];\n\n    cases = [\n      {\n        uuid: createUUID(),\n        type: useCategoryTest ? Operators.has_category : Operators.has_only_text,\n        arguments: [WebhookExitNames.Success],\n        category_uuid: categories[0].uuid\n      }\n    ];\n  }\n\n  let operand = '@results.' + snakify(action.result_name);\n  if (!useCategoryTest) {\n    operand += '.category';\n  }\n\n  const router: SwitchRouter = {\n    type: RouterTypes.switch,\n    operand: operand,\n    cases,\n    categories,\n    default_category_uuid: categories[categories.length - 1].uuid\n  };\n\n  let splitType = Types.split_by_webhook;\n  if (action.type === Types.call_resthook) {\n    splitType = Types.split_by_resthook;\n  } else if (action.type === Types.open_ticket) {\n    splitType = Types.split_by_ticket;\n  } else if (action.type === Types.transfer_airtime) {\n    splitType = Types.split_by_airtime;\n  }\n\n  return createRenderNode(originalNode.node.uuid, router, exits, splitType, [action]);\n};\n\nexport const createSplitOnActionResultNode = (\n  action: CallClassifier,\n  originalNode: RenderNode\n): RenderNode => {\n  const splitType = Types.split_by_intent;\n  const exits: Exit[] = [];\n  const router: SwitchRouter = {\n    cases: [],\n    operand: '',\n    categories: [],\n    type: RouterTypes.switch,\n    default_category_uuid: null\n  };\n\n  return createRenderNode(originalNode.node.uuid, router, exits, splitType, [action]);\n};\n","import { getSwitchRouter } from 'components/flow/routers/helpers';\nimport { Types } from 'config/interfaces';\nimport {\n  CallResthook,\n  CallWebhook,\n  Category,\n  Exit,\n  FlowNode,\n  RouterTypes,\n  TransferAirtime,\n  Action,\n  AnyAction,\n  FlowIssue\n} from 'flowTypes';\nimport { RenderNode } from 'store/flowContext';\nimport { getType } from 'config/typeConfigs';\n\nexport const getCategoriesForExit = (renderNode: RenderNode, exit: Exit): Category[] => {\n  // if we are\n  const isGroupSplit = getType(renderNode) === Types.split_by_groups;\n\n  if (!renderNode.node.router) {\n    return [];\n  }\n  return renderNode.node.router.categories\n    .filter((cat: Category) => cat.exit_uuid === exit.uuid)\n    .map((cat: Category) => {\n      if (isGroupSplit) {\n        return {\n          ...cat\n        };\n      } else {\n        return { ...cat, missing: false };\n      }\n    });\n};\n\nexport const getResultName = (node: FlowNode) => {\n  const switchRouter = getSwitchRouter(node);\n  if (switchRouter && switchRouter.result_name) {\n    return switchRouter.result_name;\n  }\n\n  if (node.router && node.router.type === RouterTypes.random) {\n    return node.router.result_name;\n  }\n\n  if (node.actions.length === 1) {\n    const action = node.actions[0];\n    if (\n      action.type === Types.call_webhook ||\n      action.type === Types.call_resthook ||\n      action.type === Types.open_ticket ||\n      action.type === Types.transfer_airtime\n    ) {\n      const resultAction = action as CallWebhook | CallResthook | TransferAirtime;\n      return resultAction.result_name;\n    }\n  }\n};\n\nexport const getVisibleActions = (renderNode: RenderNode): Action[] => {\n  // subflow nodes hide their set run results\n  if (getType(renderNode) === Types.split_by_subflow) {\n    return renderNode.node.actions.filter((action: Action) => action.type !== Types.set_run_result);\n  }\n\n  return renderNode.node.actions;\n};\n\nexport const filterIssuesForAction = (\n  nodeUUID: string,\n  action: AnyAction,\n  issues: FlowIssue[]\n): FlowIssue[] => {\n  return issues.filter(issue => issue.node_uuid === nodeUUID && issue.action_uuid === action.uuid);\n};\n","import { getResultName } from 'components/flow/node/helpers';\r\nimport { Revision } from 'components/revisions/RevisionExplorer';\r\nimport { Types } from 'config/interfaces';\r\nimport {\r\n  AnyAction,\r\n  Dimensions,\r\n  FlowDefinition,\r\n  FlowNode,\r\n  FlowPosition,\r\n  RouterTypes,\r\n  StickyNote,\r\n  SwitchRouter\r\n} from 'flowTypes';\r\nimport {\r\n  Asset,\r\n  AssetMap,\r\n  AssetStore,\r\n  AssetType,\r\n  Reference,\r\n  RenderNode,\r\n  RenderNodeMap\r\n} from 'store/flowContext';\r\nimport { assetListToMap, detectLoops, getActionIndex, getExitIndex, getNode } from 'store/helpers';\r\nimport { NodeEditorSettings } from 'store/nodeEditor';\r\nimport { LocalizationUpdates } from 'store/thunks';\r\nimport { createUUID, merge, push, set, snakify, snapToGrid, splice, unset } from 'utils';\r\n\r\nconst mutate = require('immutability-helper');\r\n\r\nexport const uniquifyNode = (newNode: FlowNode): FlowNode => {\r\n  // Give our node a unique uuid\r\n  return mutate(newNode, merge({ uuid: createUUID() }));\r\n};\r\n\r\nexport const getDefaultExit = (node: FlowNode) => {\r\n  if (node.router.type === RouterTypes.switch) {\r\n    const switchRouter = node.router as SwitchRouter;\r\n    return node.exits.find(exit => exit.uuid === switchRouter.default_category_uuid);\r\n  }\r\n};\r\n\r\nexport const addAssets = (type: string, store: AssetStore, assets: Asset[]): AssetStore => {\r\n  const assetMap = assetListToMap(assets);\r\n  const updated = mutate(store, {\r\n    [type]: {\r\n      items: {\r\n        $merge: assetMap\r\n      }\r\n    }\r\n  });\r\n  return updated;\r\n};\r\n\r\nexport const removeResultReference = (\r\n  resultName: string,\r\n  items: AssetMap,\r\n  reference: Reference\r\n): AssetMap => {\r\n  const key = snakify(resultName);\r\n\r\n  if (key in items) {\r\n    const item = items[key];\r\n    const filteredRefs = item.references.filter(\r\n      (ref: Reference) =>\r\n        ref.nodeUUID !== reference.nodeUUID || ref.actionUUID !== reference.actionUUID\r\n    );\r\n\r\n    if (filteredRefs.length === 0) {\r\n      return mutate(items, { $unset: [key] });\r\n    }\r\n\r\n    return mutate(items, { [key]: { references: { $set: filteredRefs } } });\r\n  }\r\n  return items;\r\n};\r\n\r\nexport const removeResultFromStore = (\r\n  resultName: string,\r\n  assets: AssetStore,\r\n  reference: Reference\r\n): AssetStore => {\r\n  if (resultName && assets.results) {\r\n    const items = removeResultReference(resultName, assets.results.items, reference);\r\n    return mutate(assets, { results: { items: { $set: items } } });\r\n  }\r\n  return assets;\r\n};\r\n\r\nexport const addResultToStore = (\r\n  resultName: string,\r\n  assets: AssetStore,\r\n  reference: Reference\r\n): AssetStore => {\r\n  if (resultName) {\r\n    const items = addResult(resultName, assets.results.items, reference);\r\n    return mutate(assets, { results: { items: { $set: items } } });\r\n  }\r\n};\r\n\r\nexport const addResult = (resultName: string, items: AssetMap, reference: Reference): AssetMap => {\r\n  const key = snakify(resultName);\r\n  const result =\r\n    key in items\r\n      ? items[key]\r\n      : {\r\n          name: resultName,\r\n          id: key,\r\n          type: AssetType.Result,\r\n          references: []\r\n        };\r\n\r\n  if (\r\n    !result.references.find(\r\n      (ref: Reference) =>\r\n        ref.nodeUUID === reference.nodeUUID && ref.actionUUID === reference.actionUUID\r\n    )\r\n  ) {\r\n    result.references.push(reference);\r\n  }\r\n\r\n  return mutate(items, { $merge: { [key]: result } });\r\n};\r\n\r\nexport const addRevision = (assets: AssetStore, revision: Revision): AssetStore => {\r\n  return mutate(assets, {\r\n    revisions: { items: { $merge: { [revision.id]: revision } } }\r\n  });\r\n};\r\n\r\nexport const addFlowResult = (assets: AssetStore, node: FlowNode): AssetStore => {\r\n  let updated = assets;\r\n\r\n  // TODO: initialize these to empties further up to avoid this\r\n  if (!updated) {\r\n    updated = { results: { items: {}, type: AssetType.Result } };\r\n  }\r\n\r\n  if (!updated.results) {\r\n    updated.results = { items: {}, type: AssetType.Result };\r\n  }\r\n\r\n  const resultName = getResultName(node);\r\n  if (resultName) {\r\n    const items = addResult(resultName, assets.results.items, {\r\n      nodeUUID: node.uuid\r\n    });\r\n    return mutate(assets, { results: { items: { $set: items } } });\r\n  }\r\n\r\n  return assets;\r\n};\r\n\r\n/**\r\n * Update the destination for a specific exit. Updates destination_uuid and\r\n * the inboundConnections for the given node\r\n * @param nodes\r\n * @param fromNodeUUID\r\n * @param fromExitUUID\r\n * @param destination\r\n */\r\nexport const updateConnection = (\r\n  nodes: RenderNodeMap,\r\n  fromNodeUUID: string,\r\n  fromExitUUID: string,\r\n  destinationNodeUUID: string\r\n): RenderNodeMap => {\r\n  let updatedNodes = nodes;\r\n  const fromNode = getNode(nodes, fromNodeUUID);\r\n\r\n  // make sure our destination exits if they provided one\r\n  if (destinationNodeUUID) {\r\n    getNode(nodes, destinationNodeUUID);\r\n  }\r\n\r\n  const exitIdx = getExitIndex(fromNode.node, fromExitUUID);\r\n  const previousDestination = fromNode.node.exits[exitIdx].destination_uuid;\r\n\r\n  updatedNodes = mutate(updatedNodes, {\r\n    [fromNodeUUID]: {\r\n      node: {\r\n        exits: {\r\n          [exitIdx]: {\r\n            destination_uuid: set(destinationNodeUUID)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  // update our pointers\r\n  if (destinationNodeUUID) {\r\n    updatedNodes = mutate(updatedNodes, {\r\n      [destinationNodeUUID]: {\r\n        inboundConnections: merge({ [fromExitUUID]: fromNodeUUID })\r\n      }\r\n    });\r\n  }\r\n\r\n  if (previousDestination != null) {\r\n    updatedNodes = mutate(updatedNodes, {\r\n      [previousDestination]: { inboundConnections: unset([[fromExitUUID]]) }\r\n    });\r\n  }\r\n\r\n  return updatedNodes;\r\n};\r\n\r\nexport const addLanguage = (languages: Asset[], language: Asset): Asset[] => {\r\n  return mutate(languages, push([language]));\r\n};\r\n\r\n/**\r\n * Removes a spcific destination for an exit and the associated inboundConnection.\r\n * @param nodes\r\n * @param fromNodeUUID\r\n * @param fromExitUUID\r\n */\r\nexport const removeConnection = (\r\n  nodes: RenderNodeMap,\r\n  fromNodeUUID: string,\r\n  fromExitUUID: string\r\n): RenderNodeMap => {\r\n  return updateConnection(nodes, fromNodeUUID, fromExitUUID, null);\r\n};\r\n\r\n/**\r\n * Adds a given RenderNode to our node map or updates an existing one.\r\n * Updates destinations for any inboundConnections provided and updates\r\n * inboundConnections for any destination_uuid our exits point to.\r\n * @param nodes\r\n * @param node the node to add, if unique uuid, it will be added\r\n */\r\nexport const mergeNode = (nodes: RenderNodeMap, node: RenderNode): RenderNodeMap => {\r\n  let updatedNodes = nodes;\r\n\r\n  // if the node is already there, remove it first\r\n  if (updatedNodes[node.node.uuid]) {\r\n    updatedNodes = removeNode(nodes, node.node.uuid);\r\n  }\r\n\r\n  // add our node upadted node\r\n  updatedNodes = mutate(nodes, merge({ [node.node.uuid]: node }));\r\n\r\n  // if we have inbound connections, update our nodes accordingly\r\n  for (const fromExitUUID of Object.keys(node.inboundConnections)) {\r\n    const fromNodeUUID = node.inboundConnections[fromExitUUID];\r\n\r\n    const fromNode = getNode(nodes, fromNodeUUID);\r\n    const exitIdx = getExitIndex(fromNode.node, fromExitUUID);\r\n\r\n    updatedNodes = mutate(updatedNodes, {\r\n      [fromNodeUUID]: {\r\n        node: {\r\n          exits: {\r\n            [exitIdx]: merge({ destination_uuid: node.node.uuid })\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  return updatedNodes;\r\n};\r\n\r\n/**\r\n * Adds a given action to the provided node\r\n * @param nodes\r\n * @param nodeUUID\r\n * @param action\r\n */\r\nexport const addAction = (\r\n  nodes: RenderNodeMap,\r\n  nodeUUID: string,\r\n  action: AnyAction\r\n): RenderNodeMap => {\r\n  // check that our node exists\r\n  getNode(nodes, nodeUUID);\r\n  return mutate(nodes, { [nodeUUID]: { node: { actions: push([action]) } } });\r\n};\r\n\r\n/**\r\n * Updates the given action in place by it's uuid\r\n * @param nodes\r\n * @param nodeUUID\r\n * @param action\r\n */\r\nexport const updateAction = (\r\n  nodes: RenderNodeMap,\r\n  nodeUUID: string,\r\n  newAction: AnyAction,\r\n  originalAction?: AnyAction\r\n) => {\r\n  const originalNode = getNode(nodes, nodeUUID);\r\n  // If we have existing actions, find our action and update it\r\n  const actionIdx = originalAction ? getActionIndex(originalNode.node, originalAction.uuid) : 0;\r\n  return mutate(nodes, {\r\n    [nodeUUID]: {\r\n      node: {\r\n        actions: { [actionIdx]: set(newAction) }\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nexport const spliceInAction = (\r\n  nodes: RenderNodeMap,\r\n  nodeUUID: string,\r\n  action: AnyAction\r\n): RenderNodeMap => {\r\n  const { [nodeUUID]: previousNode } = nodes;\r\n\r\n  const otherExit = getDefaultExit(previousNode.node);\r\n  const destination = otherExit ? otherExit.destination_uuid : null;\r\n\r\n  // remove our previous node\r\n  let updatedNodes = removeNode(nodes, previousNode.node.uuid, false);\r\n\r\n  const newNode: RenderNode = {\r\n    node: {\r\n      uuid: createUUID(),\r\n      actions: [action],\r\n      exits: [{ uuid: createUUID(), destination_uuid: destination }]\r\n    },\r\n    ui: { position: previousNode.ui.position, type: Types.execute_actions },\r\n    inboundConnections: previousNode.inboundConnections\r\n  };\r\n\r\n  // add our new node\r\n  updatedNodes = mergeNode(updatedNodes, newNode);\r\n\r\n  return updatedNodes;\r\n};\r\n\r\n/** Removes a specific action from a node */\r\nexport const removeAction = (nodes: RenderNodeMap, nodeUUID: string, actionUUID: string) => {\r\n  const renderNode = getNode(nodes, nodeUUID);\r\n  const actionIdx = getActionIndex(renderNode.node, actionUUID);\r\n  return mutate(nodes, {\r\n    [nodeUUID]: { node: { actions: splice([[actionIdx, 1]]) } }\r\n  });\r\n};\r\n\r\n/**\r\n * Moves a single action up in the list for the given node\r\n * @param nodes\r\n * @param nodeUUID\r\n * @param action\r\n */\r\nexport const moveActionUp = (nodes: RenderNodeMap, nodeUUID: string, actionUUID: string) => {\r\n  const renderNode = getNode(nodes, nodeUUID);\r\n\r\n  const actions = renderNode.node.actions;\r\n  const actionIdx = getActionIndex(renderNode.node, actionUUID);\r\n\r\n  if (actionIdx === 0) {\r\n    throw new Error('Cannot move an action at the top upwards');\r\n  }\r\n\r\n  const action = actions[actionIdx];\r\n  const actionAbove = actions[actionIdx - 1];\r\n\r\n  return mutate(nodes, {\r\n    [nodeUUID]: {\r\n      node: { actions: splice([[actionIdx - 1, 2, action, actionAbove]]) }\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Removes a given node from our node map. Updates destinations for any exits that point to us\r\n * and removes any inboundConnections that reference our exits. Also will reroute connections\r\n * that route through us.\r\n * @param nodes\r\n * @param nodeToRemove\r\n */\r\nexport const removeNode = (\r\n  nodes: RenderNodeMap,\r\n  nodeUUID: string,\r\n  remap: boolean = true\r\n): RenderNodeMap => {\r\n  const nodeToRemove = getNode(nodes, nodeUUID);\r\n  let updatedNodes = nodes;\r\n\r\n  // remove us from any inbound connections\r\n  for (const exit of nodeToRemove.node.exits) {\r\n    if (exit.destination_uuid) {\r\n      updatedNodes = mutate(updatedNodes, {\r\n        [exit.destination_uuid]: {\r\n          inboundConnections: unset([exit.uuid])\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  // clear any destinations that point to us\r\n  for (const fromExitUUID of Object.keys(nodeToRemove.inboundConnections)) {\r\n    // if we have a single destination, reroute those pointing to us\r\n    let destination = null;\r\n    if (remap && nodeToRemove.node.exits.length === 1) {\r\n      ({ destination_uuid: destination } = nodeToRemove.node.exits[0]);\r\n    }\r\n\r\n    const fromNodeUUID = nodeToRemove.inboundConnections[fromExitUUID];\r\n    const fromNode = getNode(nodes, fromNodeUUID);\r\n\r\n    // make sure we aren't creating a loop\r\n    if (destination) {\r\n      try {\r\n        detectLoops(updatedNodes, fromNodeUUID, destination);\r\n      } catch {\r\n        destination = null;\r\n      }\r\n    }\r\n\r\n    const exitIdx = getExitIndex(fromNode.node, fromExitUUID);\r\n    updatedNodes = mutate(updatedNodes, {\r\n      [fromNodeUUID]: {\r\n        node: {\r\n          exits: {\r\n            [exitIdx]: { destination_uuid: set(destination) }\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    // if we are setting a new destination, update the inboundConnections\r\n    if (destination) {\r\n      // make sure our destination exists\r\n      getNode(nodes, destination);\r\n      updatedNodes = mutate(updatedNodes, {\r\n        [destination]: {\r\n          inboundConnections: merge({ [fromExitUUID]: fromNodeUUID })\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  // remove the actual node\r\n  return mutate(updatedNodes, unset([nodeUUID]));\r\n};\r\n\r\n/**\r\n * Update the position for a given node\r\n * @param nodes\r\n * @param nodeUUID\r\n * @param x\r\n * @param y\r\n */\r\nexport const updatePosition = (\r\n  nodes: RenderNodeMap,\r\n  nodeUUID: string,\r\n  position: FlowPosition,\r\n  snap: boolean = true\r\n): RenderNodeMap => {\r\n  const { left, top } = position;\r\n\r\n  // make sure we are on the grid\r\n  let adjusted = { left, top };\r\n\r\n  if (snap) {\r\n    adjusted = snapToGrid(left, top);\r\n  }\r\n\r\n  return mutate(nodes, {\r\n    [nodeUUID]: {\r\n      ui: {\r\n        position: set({\r\n          left: adjusted.left,\r\n          top: adjusted.top\r\n        })\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nexport const updateStickyNotePosition = (\r\n  definition: FlowDefinition,\r\n  stickyUUID: string,\r\n  position: FlowPosition,\r\n  snap: boolean = true\r\n): FlowDefinition => {\r\n  if (!definition._ui.stickies) {\r\n    definition._ui.stickies = {};\r\n  }\r\n\r\n  const lastPos = definition._ui.stickies[stickyUUID].position;\r\n  const width = lastPos.right - lastPos.left;\r\n  const height = lastPos.bottom - lastPos.top;\r\n\r\n  const { left, top } = position;\r\n\r\n  // make sure we are on the grid\r\n  let adjusted = { left, top };\r\n\r\n  if (snap) {\r\n    adjusted = snapToGrid(left, top);\r\n  }\r\n\r\n  return mutate(definition, {\r\n    _ui: {\r\n      stickies: {\r\n        [stickyUUID]: {\r\n          position: set({\r\n            left: adjusted.left,\r\n            top: adjusted.top,\r\n            right: adjusted.left + width,\r\n            bottom: adjusted.top + height\r\n          })\r\n        }\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Update the dimensions for a specific node\r\n * @param nodes\r\n * @param nodeUUID\r\n * @param dimensions\r\n */\r\nexport const updateNodeDimensions = (\r\n  nodes: RenderNodeMap,\r\n  nodeUUID: string,\r\n  dimensions: Dimensions\r\n): RenderNodeMap => {\r\n  const node = getNode(nodes, nodeUUID);\r\n  return mutate(nodes, {\r\n    [nodeUUID]: {\r\n      ui: {\r\n        position: merge({\r\n          bottom: node.ui.position.top + dimensions.height,\r\n          right: node.ui.position.left + dimensions.width\r\n        })\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Update the dimensions for a specific sticky\r\n * @param definition\r\n * @param uuuid\r\n * @param dimensions\r\n */\r\nexport const updateStickyDimensions = (\r\n  definition: FlowDefinition,\r\n  uuid: string,\r\n  dimensions: Dimensions\r\n): FlowDefinition => {\r\n  const position = definition._ui.stickies[uuid].position;\r\n  return mutate(definition, {\r\n    _ui: {\r\n      stickies: {\r\n        [uuid]: {\r\n          position: merge({\r\n            bottom: position.top + dimensions.height,\r\n            right: position.left + dimensions.width\r\n          })\r\n        }\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nexport const updateStickyNote = (\r\n  definition: FlowDefinition,\r\n  stickyUUID: string,\r\n  sticky: StickyNote\r\n): FlowDefinition => {\r\n  if (!definition._ui.stickies) {\r\n    definition._ui.stickies = {};\r\n  }\r\n  if (sticky) {\r\n    return mutate(definition, {\r\n      _ui: { stickies: merge({ [stickyUUID]: sticky }) }\r\n    });\r\n  } else {\r\n    return mutate(definition, { _ui: { stickies: unset([stickyUUID]) } });\r\n  }\r\n};\r\n\r\nexport const mergeNodeEditorSettings = (\r\n  current: NodeEditorSettings,\r\n  newSettings: NodeEditorSettings\r\n) => {\r\n  if (!newSettings) {\r\n    return current;\r\n  }\r\n\r\n  if (!current) {\r\n    return newSettings;\r\n  }\r\n\r\n  return mutate(current, { $merge: newSettings });\r\n};\r\n\r\n/**\r\n * Prunes the definition for editing, removing node references\r\n * @param definition our full definition\r\n */\r\nexport const pruneDefinition = (definition: FlowDefinition): FlowDefinition =>\r\n  mutate(definition, { nodes: [], _ui: { $merge: { nodes: {} } } });\r\n\r\n/**\r\n * Update the localization in the definition with the provided changes for a language\r\n * @param definition\r\n * @param language\r\n * @param changes\r\n */\r\nexport const updateLocalization = (\r\n  definition: FlowDefinition,\r\n  language: string,\r\n  changes: LocalizationUpdates\r\n) => {\r\n  let newDef = definition;\r\n\r\n  // Add language to localization map if not present\r\n  if (!newDef.localization[language]) {\r\n    newDef = mutate(newDef, {\r\n      localization: {\r\n        [language]: set({})\r\n      }\r\n    });\r\n  }\r\n\r\n  // Apply changes\r\n  changes.forEach(({ translations, uuid }) => {\r\n    if (translations) {\r\n      // normalize our translations so all are treated as arrays\r\n      const normalizedTranslations: { [uuid: string]: string[] } = {};\r\n      for (const key of Object.keys(translations)) {\r\n        const prev = translations[key];\r\n        if (Array.isArray(prev)) {\r\n          normalizedTranslations[key] = prev;\r\n        } else {\r\n          normalizedTranslations[key] = [prev];\r\n        }\r\n      }\r\n\r\n      // adding localization\r\n      newDef = mutate(newDef, {\r\n        localization: { [language]: { [uuid]: set(normalizedTranslations) } }\r\n      });\r\n    } else {\r\n      // removing localization\r\n      newDef = mutate(newDef, {\r\n        localization: { [language]: unset([uuid]) }\r\n      });\r\n    }\r\n  });\r\n\r\n  return newDef;\r\n};\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport {\n  getName,\n  initializeForm,\n  sortFieldsAndProperties,\n  stateToAction,\n  UpdateContactFormState\n} from 'components/flow/actions/updatecontact/helpers';\nimport { ActionFormProps } from 'components/flow/props';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\nimport { getContactProperties } from 'components/helpers';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { Types, ContactStatus } from 'config/interfaces';\nimport { ContactProperties } from 'flowTypes';\nimport * as React from 'react';\nimport { Asset, AssetType, updateAssets } from 'store/flowContext';\nimport * as mutators from 'store/mutators';\nimport { mergeForm } from 'store/nodeEditor';\nimport { DispatchWithState, GetState } from 'store/thunks';\nimport { shouldRequireIf, validate } from 'store/validators';\n\nimport styles from './UpdateContactForm.module.scss';\nimport i18n from 'config/i18n';\nimport { renderIssues } from '../helpers';\nimport SelectElement, { SelectOption } from 'components/form/select/SelectElement';\n\nexport const CONTACT_STATUS_ACTIVE: SelectOption = {\n  name: i18n.t('contact_statuses.active', 'Active'),\n  value: ContactStatus.ACTIVE\n};\nexport const CONTACT_STATUS_BLOCKED: SelectOption = {\n  name: i18n.t('contact_statuses.blocked', 'Blocked - remove from groups, ignore forever'),\n  value: ContactStatus.BLOCKED\n};\nexport const CONTACT_STATUS_STOPPED: SelectOption = {\n  name: i18n.t(\n    'contact_statuses.stopped',\n    'Stopped - remove from groups, ignore until they message again'\n  ),\n  value: ContactStatus.STOPPED\n};\nexport const CONTACT_STATUS_ARCHIVED: SelectOption = {\n  name: i18n.t('contact_statuses.archived', 'Archived - remove from groups, ignore forever'),\n  value: ContactStatus.ARCHIVED\n};\nexport const CONTACT_STATUS_OPTIONS: SelectOption[] = [\n  CONTACT_STATUS_ACTIVE,\n  CONTACT_STATUS_BLOCKED,\n  CONTACT_STATUS_STOPPED,\n  CONTACT_STATUS_ARCHIVED\n];\n\nexport default class UpdateContactForm extends React.Component<\n  ActionFormProps,\n  UpdateContactFormState\n> {\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  constructor(props: ActionFormProps) {\n    super(props);\n\n    this.state = initializeForm(this.props.nodeSettings, this.props.assetStore);\n\n    bindCallbacks(this, {\n      include: [/^get/, /^on/, /^handle/]\n    });\n  }\n\n  private handleUpdate(\n    keys: {\n      type?: Types;\n      name?: string;\n      channel?: Asset;\n      language?: Asset;\n      status?: SelectOption;\n      field?: Asset;\n      fieldValue?: string;\n    },\n    submitting = false\n  ): boolean {\n    const updates: Partial<UpdateContactFormState> = {};\n\n    if (keys.hasOwnProperty('type')) {\n      updates.type = keys.type;\n    }\n\n    if (keys.hasOwnProperty('name')) {\n      updates.name = { value: keys.name };\n    }\n\n    if (keys.hasOwnProperty('channel')) {\n      updates.channel = validate(i18n.t('forms.channel', 'Channel'), keys.channel, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('language')) {\n      updates.language = validate(i18n.t('forms.language', 'Language'), keys.language, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('status')) {\n      updates.status = { value: keys.status };\n    }\n\n    if (keys.hasOwnProperty('field')) {\n      updates.field = { value: keys.field };\n    }\n\n    if (keys.hasOwnProperty('fieldValue')) {\n      updates.fieldValue = { value: keys.fieldValue, validationFailures: [] };\n    }\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private handlePropertyChange(selected: any[]): boolean {\n    const selection = selected[0];\n    if (selection) {\n      if (selection.type === AssetType.ContactProperty) {\n        switch (selection.id) {\n          case ContactProperties.Name:\n            return this.handleUpdate({\n              field: selection,\n              type: Types.set_contact_name,\n              name: ''\n            });\n          case ContactProperties.Language:\n            return this.handleUpdate({\n              field: selection,\n              type: Types.set_contact_language\n            });\n          case ContactProperties.Status:\n            return this.handleUpdate({\n              field: selection,\n              type: Types.set_contact_status\n            });\n          case ContactProperties.Channel:\n            return this.handleUpdate({\n              field: selection,\n              type: Types.set_contact_channel\n            });\n        }\n      }\n      return this.handleUpdate({\n        type: Types.set_contact_field,\n        field: selection,\n        fieldValue: ''\n      });\n    }\n  }\n\n  private handleChannelUpdate(selection: Asset[], submitting = false): boolean {\n    return this.handleUpdate({ channel: selection[0] }, submitting);\n  }\n\n  private handleLanguageUpdate(selection: any[], submitting = false): boolean {\n    return this.handleUpdate({ language: selection[0] }, submitting);\n  }\n\n  private handleStatusUpdate(status: SelectOption): boolean {\n    return this.handleUpdate({ status, fieldValue: '' });\n  }\n\n  private handleFieldValueUpdate(fieldValue: string): boolean {\n    return this.handleUpdate({ fieldValue, name: '' });\n  }\n\n  private handleNameUpdate(name: string): boolean {\n    return this.handleUpdate({ name, fieldValue: '' });\n  }\n\n  private onUpdated(dispatch: DispatchWithState, getState: GetState): void {\n    const {\n      flowContext: { assetStore }\n    } = getState();\n\n    if (this.state.field.value.type === AssetType.Field) {\n      dispatch(updateAssets(mutators.addAssets('fields', assetStore, [this.state.field.value])));\n    }\n  }\n\n  public handleFieldAdded(field: Asset): void {\n    // update our store with our new group\n    this.props.addAsset('fields', field);\n    this.handlePropertyChange([field]);\n  }\n\n  private handleSave(): void {\n    let valid = this.state.valid;\n\n    // check if language required\n    if (this.state.type === Types.set_contact_language) {\n      valid = this.handleLanguageUpdate([this.state.language.value], true) && valid;\n    }\n\n    // check if channel required\n    if (this.state.type === Types.set_contact_channel) {\n      valid = this.handleChannelUpdate([this.state.channel.value], true) && valid;\n    }\n\n    if (valid) {\n      // do the saving!\n      this.props.updateAction(stateToAction(this.props.nodeSettings, this.state), this.onUpdated);\n      this.props.onClose(true);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  /**\n   * The value widget varies for the action type\n   */\n  private getValueWidget(): JSX.Element {\n    if (this.state.type === Types.set_contact_channel) {\n      return (\n        <AssetSelector\n          key=\"select_channel\"\n          name={i18n.t('forms.channel', 'Channel')}\n          placeholder=\"Select the channel to use for this contact\"\n          assets={this.props.assetStore.channels}\n          entry={this.state.channel}\n          searchable={true}\n          valueClearable={true}\n          onChange={this.handleChannelUpdate}\n        />\n      );\n    }\n\n    if (this.state.type === Types.set_contact_language) {\n      return (\n        <AssetSelector\n          key=\"select_language\"\n          name={i18n.t('forms.language', 'Language')}\n          placeholder=\"Select the language to use for this contact\"\n          assets={this.props.assetStore.languages}\n          entry={this.state.language}\n          valueClearable={true}\n          onChange={this.handleLanguageUpdate}\n          shouldExclude={(language: any) => {\n            return language.iso === 'base';\n          }}\n        />\n      );\n    } else if (this.state.type === Types.set_contact_status) {\n      return (\n        <SelectElement\n          key=\"contact_status_select\"\n          name={i18n.t('forms.status', 'Status')}\n          entry={this.state.status}\n          onChange={this.handleStatusUpdate}\n          options={CONTACT_STATUS_OPTIONS}\n        />\n      );\n    } else if (this.state.type === Types.set_contact_name) {\n      return (\n        <TextInputElement\n          name={i18n.t('forms.name', 'Name')}\n          placeholder=\"Enter a new name for the contact\"\n          onChange={this.handleNameUpdate}\n          entry={this.state.name}\n          autocomplete={true}\n          focus={true}\n        />\n      );\n    } else {\n      return (\n        <TextInputElement\n          name={i18n.t('forms.field_value', 'Field Value')}\n          placeholder={`Enter a new value for ${this.state.field.value.label}`}\n          onChange={this.handleFieldValueUpdate}\n          entry={this.state.fieldValue}\n          autocomplete={true}\n          focus={true}\n        />\n      );\n    }\n  }\n\n  public handleCreateAssetFromInput(input: string): any {\n    return { label: input, value_type: 'text' };\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n\n        <p>Select what to update</p>\n        <AssetSelector\n          name={i18n.t('forms.contact_field', 'Contact Field')}\n          assets={this.props.assetStore.fields}\n          additionalOptions={getContactProperties(this.context.config.flowType)}\n          entry={this.state.field}\n          searchable={true}\n          sortFunction={sortFieldsAndProperties}\n          onChange={this.handlePropertyChange}\n          getName={getName}\n          // Fields can be created on the fly\n          createPrefix=\"Create Contact Field: \"\n          createAssetFromInput={this.handleCreateAssetFromInput}\n          onAssetCreated={this.handleFieldAdded}\n        />\n\n        <div className={styles.value}>{this.getValueWidget()}</div>\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { react as bindCallbacks } from 'auto-bind';\nimport { AirtimeTransferEntry } from 'components/flow/routers/airtime/AirtimeRouterForm';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport FormElement from 'components/form/FormElement';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\nimport * as React from 'react';\nimport { Asset } from 'store/flowContext';\nimport { ValidationFailure } from 'store/nodeEditor';\n\nimport styles from './CurrencyElement.module.scss';\nimport i18n from 'config/i18n';\nimport { TembaSelectStyle } from 'temba/TembaSelect';\n\nexport interface AirtimeTransfer {\n  amount: string;\n  code: string;\n}\n\nexport interface CurrencyElementProps {\n  currencies: any[];\n  transfer: AirtimeTransferEntry;\n  index: number;\n  exclude: AirtimeTransferEntry[];\n  onChange(index: number, transfer: AirtimeTransferEntry): void;\n  onRemove(index: number): void;\n}\n\nexport default class CurrencyElement extends React.Component<CurrencyElementProps> {\n  constructor(props: CurrencyElementProps) {\n    super(props);\n\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  private handleCurrencyChanged(selected: any[]): void {\n    this.props.onChange(this.props.index, {\n      value: { amount: this.props.transfer.value.amount, code: selected[0].id },\n      validationFailures: this.props.transfer.validationFailures\n    });\n  }\n\n  private handleAmountChanged(value: string): void {\n    const validationFailures: ValidationFailure[] = [];\n    if (isNaN(Number(value))) {\n      validationFailures.push({\n        message: 'Invalid amount, please enter a number'\n      });\n    }\n    this.props.onChange(this.props.index, {\n      value: { amount: value, code: this.props.transfer.value.code },\n      validationFailures\n    });\n  }\n\n  public render(): JSX.Element {\n    let placeholder = 'Transfer Amount';\n\n    let amount = '';\n    let currency: any = null;\n\n    if (this.props.transfer.value) {\n      const transfer = this.props.transfer.value;\n      if (transfer.code) {\n        placeholder = `${transfer.code} ${placeholder}`;\n        currency = { id: transfer.code };\n      }\n\n      amount = '' + transfer.amount;\n    }\n\n    const amountInput =\n      this.props.index > -1 ? (\n        <div className={styles.amount}>\n          <TextInputElement\n            placeholder={placeholder}\n            name={i18n.t('forms.value', 'value')}\n            onChange={this.handleAmountChanged}\n            entry={{ value: amount }}\n          />\n        </div>\n      ) : null;\n\n    const removeIco =\n      this.props.index > -1 ? (\n        <div\n          className={styles.remove}\n          onClick={() => {\n            this.props.onRemove(this.props.index);\n          }}\n        >\n          <span className=\"fe-x\" />\n        </div>\n      ) : null;\n\n    const shouldExclude = (asset: Asset): boolean => {\n      return (\n        this.props.exclude.filter(\n          (airtime: AirtimeTransferEntry) => airtime.value.code === asset.id\n        ).length > 1\n      );\n    };\n\n    return (\n      <FormElement\n        name={i18n.t('forms.currency', 'Currency')}\n        entry={this.props.transfer}\n        __className={styles.form_element}\n      >\n        <div className={styles.transfer}>\n          <div className={styles.currency}>\n            <AssetSelector\n              style={TembaSelectStyle.small}\n              name={i18n.t('forms.currency', 'Currency')}\n              shouldExclude={shouldExclude}\n              entry={{ value: currency }}\n              nameKey=\"id\"\n              valueKey=\"id\"\n              onChange={this.handleCurrencyChanged}\n              additionalOptions={this.props.currencies}\n              placeholder={i18n.t('forms.currency', 'Select a Currency')}\n            />\n          </div>\n          {amountInput} {removeIco}\n        </div>\n      </FormElement>\n    );\n  }\n}\n","import { react as bindCallbacks } from 'auto-bind';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\nimport * as React from 'react';\nimport { FormState, StringEntry } from 'store/nodeEditor';\n\nimport styles from './OptionalTextInput.module.scss';\n\nexport interface OptionalTextInputProps {\n  name: string;\n  value: StringEntry;\n  toggleText: string;\n  onChange(value: string): void;\n  helpText?: string | JSX.Element;\n  maxLength?: number;\n}\n\nexport interface OptionalTextInputState extends FormState {\n  editing: boolean;\n}\n\n/**\n * OptionalText is a hideable text box\n */\nexport default class OptionalTextInput extends React.Component<\n  OptionalTextInputProps,\n  OptionalTextInputState\n> {\n  constructor(props: OptionalTextInputProps) {\n    super(props);\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n\n    this.state = {\n      editing: this.props.value.value.trim().length > 0,\n      valid: true\n    };\n  }\n\n  private handleTextChanged(text: string): void {\n    this.props.onChange(text);\n  }\n\n  private handleEditingChanged(): void {\n    this.setState({ editing: true });\n  }\n\n  public render(): JSX.Element {\n    let ele: JSX.Element;\n\n    if (this.state.editing) {\n      ele = (\n        <TextInputElement\n          data-testid=\"optional-field\"\n          data-spec=\"optional-field\"\n          name={this.props.name}\n          showLabel={true}\n          entry={this.props.value}\n          onChange={this.handleTextChanged}\n          helpText={this.props.helpText}\n          maxLength={this.props.maxLength}\n        />\n      );\n    } else {\n      ele = (\n        <span\n          data-testid=\"toggle-link\"\n          data-spec=\"toggle-link\"\n          className={styles.toggle_link}\n          onClick={this.handleEditingChanged}\n        >\n          {this.props.toggleText}\n        </span>\n      );\n    }\n\n    return <div className={styles.optional_text_input}>{ele}</div>;\n  }\n}\n","import * as React from 'react';\r\nimport { hasErrors } from 'components/flow/actions/helpers';\r\nimport OptionalTextInput from 'components/form/optionaltext/OptionalTextInput';\r\nimport { StringEntry } from 'store/nodeEditor';\r\nimport { snakify } from 'utils';\r\nimport { Trans } from 'react-i18next';\r\nimport i18n from 'config/i18n';\r\n\r\nexport const createResultNameInput = (\r\n  value: StringEntry,\r\n  onChange: (value: string) => void\r\n): JSX.Element => {\r\n  const snaked = !hasErrors(value) && value.value ? '.' + snakify(value.value) : '';\r\n\r\n  return (\r\n    <OptionalTextInput\r\n      name={i18n.t('forms.save_result_name', 'Result Name')}\r\n      maxLength={64}\r\n      value={value}\r\n      onChange={onChange}\r\n      toggleText={i18n.t('forms.save_as_title', 'Save as..')}\r\n      helpText={\r\n        <Trans i18nKey=\"forms.result_name_help\" values={{ resultFormat: `@results${snaked}` }}>\r\n          By naming the result, you can reference it later using [[resultFormat]]\r\n        </Trans>\r\n      }\r\n    />\r\n  );\r\n};\r\n","import * as React from 'react';\r\nimport { ValidationFailure } from 'store/nodeEditor';\r\n\r\nimport styles from './ValidationFailures.module.scss';\r\n\r\nexport interface Validation {\r\n  validationFailures: ValidationFailure[];\r\n}\r\n\r\nconst ValidationFailures: React.SFC<Validation> = (validation): JSX.Element => {\r\n  const errors = validation.validationFailures.map((failure: ValidationFailure, idx: number) => {\r\n    return (\r\n      <div key={'validation_' + idx} className={styles.error}>\r\n        {failure.message}\r\n      </div>\r\n    );\r\n  });\r\n  return <div className={styles.errors}>{errors}</div>;\r\n};\r\n\r\nexport default ValidationFailures;\r\n","import {\r\n  AirtimeRouterFormState,\r\n  AirtimeTransferEntry\r\n} from 'components/flow/routers/airtime/AirtimeRouterForm';\r\nimport { createWebhookBasedNode } from 'components/flow/routers/helpers';\r\nimport { Types } from 'config/interfaces';\r\nimport { TransferAirtime } from 'flowTypes';\r\nimport { RenderNode } from 'store/flowContext';\r\nimport { NodeEditorSettings } from 'store/nodeEditor';\r\nimport { createUUID } from 'utils';\r\n\r\nexport const nodeToState = (settings: NodeEditorSettings): AirtimeRouterFormState => {\r\n  const originalAction = getOriginalAction(settings);\r\n  let resultName = { value: 'Result' };\r\n  let valid = false;\r\n\r\n  const amounts: AirtimeTransferEntry[] = [];\r\n  if (originalAction && originalAction.type === Types.transfer_airtime) {\r\n    Object.keys(originalAction.amounts).forEach((key: string) => {\r\n      amounts.push({\r\n        value: { code: key, amount: '' + originalAction.amounts[key] }\r\n      });\r\n    });\r\n    resultName = { value: originalAction.result_name };\r\n    valid = true;\r\n  }\r\n\r\n  return {\r\n    valid,\r\n    amounts,\r\n    resultName\r\n  };\r\n};\r\n\r\nexport const stateToNode = (\r\n  settings: NodeEditorSettings,\r\n  state: AirtimeRouterFormState\r\n): RenderNode => {\r\n  let uuid = createUUID();\r\n  const originalAction = getOriginalAction(settings);\r\n  if (originalAction) {\r\n    uuid = originalAction.uuid;\r\n  }\r\n\r\n  const amounts = {};\r\n  state.amounts.forEach((entry: AirtimeTransferEntry) => {\r\n    if (entry.value.amount.trim().length > 0) {\r\n      (amounts as any)[entry.value.code] = Number(entry.value.amount);\r\n    }\r\n  });\r\n\r\n  const newAction: TransferAirtime = {\r\n    uuid,\r\n    type: Types.transfer_airtime,\r\n    amounts,\r\n    result_name: state.resultName.value\r\n  };\r\n\r\n  return createWebhookBasedNode(newAction, settings.originalNode, true);\r\n};\r\n\r\nexport const getOriginalAction = (settings: NodeEditorSettings): TransferAirtime => {\r\n  const action =\r\n    settings.originalAction ||\r\n    (settings.originalNode.node.actions.length > 0 && settings.originalNode.node.actions[0]);\r\n\r\n  if (action.type === Types.transfer_airtime) {\r\n    return action as TransferAirtime;\r\n  }\r\n};\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { RouterFormProps } from 'components/flow/props';\nimport CurrencyElement, {\n  AirtimeTransfer\n} from 'components/flow/routers/airtime/currency/CurrencyElement';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport ValidationFailures from 'components/form/ValidationFailures';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport mutate from 'immutability-helper';\nimport * as React from 'react';\nimport { FormEntry, FormState, StringEntry } from 'store/nodeEditor';\nimport { Alphanumeric, Required, StartIsNonNumeric, validate } from 'store/validators';\n\nimport styles from './AirtimeRouterForm.module.scss';\nimport { nodeToState, stateToNode } from './helpers';\nimport i18n from 'config/i18n';\n\nexport interface AirtimeTransferEntry extends FormEntry {\n  value: AirtimeTransfer;\n}\n\nexport interface AirtimeRouterFormState extends FormState {\n  amounts: AirtimeTransferEntry[];\n  resultName: StringEntry;\n}\n\nexport default class AirtimeRouterForm extends React.PureComponent<\n  RouterFormProps,\n  AirtimeRouterFormState\n> {\n  options: any[] = [];\n\n  constructor(props: RouterFormProps) {\n    super(props);\n\n    this.state = nodeToState(props.nodeSettings);\n\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  public componentDidMount(): void {\n    const items = this.props.assetStore.currencies ? this.props.assetStore.currencies.items : {};\n    this.options = Object.keys(items).map((key: string) => {\n      return { id: items[key].id };\n    });\n  }\n\n  private handleSave(): void {\n    const missing: number[] = [];\n\n    this.state.amounts.forEach((entry: AirtimeTransferEntry, index: number) => {\n      if (entry.value.amount.trim().length === 0) {\n        missing.push(index);\n      }\n    });\n\n    let valid: boolean = !!!this.state.amounts.find(\n      (entry: AirtimeTransferEntry) => (entry.validationFailures || []).length > 0\n    );\n\n    // make sure at least one has a value\n    if (valid) {\n      valid =\n        this.state.amounts.find(\n          (entry: AirtimeTransferEntry) => entry.value.amount.trim().length > 0\n        ) !== undefined;\n\n      if (!valid) {\n        this.setState({\n          valid: false,\n          validationFailures: [{ message: 'At least one amount to transfer is required' }]\n        });\n      }\n    }\n\n    if (valid) {\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  private handleUpdateResultName(result: string): void {\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), result, [\n      Required,\n      Alphanumeric,\n      StartIsNonNumeric\n    ]);\n    this.setState({\n      resultName,\n      valid: this.state.valid && !hasErrors(resultName)\n    });\n  }\n\n  public getButtons(): ButtonSet {\n    return {\n      primary: { name: 'Ok', onClick: this.handleSave },\n      secondary: { name: 'Cancel', onClick: () => this.props.onClose(true) }\n    };\n  }\n\n  public handleRemoved(index: number): void {\n    // we found a match, merge us in\n    const updated: any = mutate(this.state.amounts, {\n      $splice: [[index, 1]]\n    });\n    this.setState({ amounts: updated });\n  }\n\n  public handleTransferChanged(idx: number, transfer: AirtimeTransferEntry): void {\n    let updated: any = this.state.amounts;\n\n    if (idx > -1) {\n      // we found a match, merge us in\n      updated = mutate(this.state.amounts, {\n        $merge: { [idx]: transfer }\n      });\n    } else {\n      // otherwise push us on\n      updated = mutate(this.state.amounts, {\n        $push: [transfer]\n      });\n    }\n\n    this.setState({ amounts: updated, validationFailures: [] });\n  }\n\n  private renderAmount(index: number, entry: AirtimeTransferEntry): JSX.Element {\n    return (\n      <CurrencyElement\n        key={'currency_' + index}\n        exclude={this.state.amounts}\n        currencies={this.options}\n        transfer={entry}\n        index={index}\n        onChange={this.handleTransferChanged}\n        onRemove={this.handleRemoved}\n      />\n    );\n  }\n\n  private renderAmounts(): JSX.Element {\n    const amounts = this.state.amounts.map((entry: AirtimeTransferEntry, index: number) => {\n      return this.renderAmount(index, entry);\n    });\n\n    return (\n      <div>\n        {amounts}\n        {this.renderAmount(-1, { value: { code: null, amount: '' } })}\n      </div>\n    );\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    const errors = this.state.validationFailures ? (\n      <ValidationFailures validationFailures={this.state.validationFailures} />\n    ) : null;\n\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        {this.renderAmounts()}\n        {errors}\n        <div className={styles.result_name}>\n          {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\n        </div>\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { HIDDEN, Operator, OperatorMap, Operators, TEXT_TYPES, ONLINE } from 'config/interfaces';\nimport i18n from 'config/i18n';\n\nexport const intentOperatorList: Operator[] = [\n  {\n    type: Operators.has_top_intent,\n    verboseName: i18n.t('operators.has_top_intent', 'has top intent'),\n    operands: 2,\n    visibility: ONLINE\n  },\n  {\n    type: Operators.has_intent,\n    verboseName: i18n.t('operators.has_intent', 'has intent'),\n    operands: 2,\n    visibility: ONLINE\n  }\n];\n\nexport const operatorConfigList: Operator[] = [\n  {\n    type: Operators.has_any_word,\n    verboseName: i18n.t('operators.has_any_word', 'has any of the words'),\n    operands: 1,\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_all_words,\n    verboseName: i18n.t('operators.has_all_words', 'has all of the words'),\n    operands: 1,\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_phrase,\n    verboseName: i18n.t('operators.has_phrase', 'has the phrase'),\n    operands: 1,\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_only_phrase,\n    verboseName: i18n.t('operators.has_only_phrase', 'has only the phrase'),\n    operands: 1,\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_beginning,\n    verboseName: i18n.t('operators.has_beginning', 'starts with'),\n    operands: 1\n  },\n  {\n    type: Operators.has_text,\n    verboseName: i18n.t('operators.has_text', 'has some text'),\n    operands: 0,\n    categoryName: 'Has Text',\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_number,\n    verboseName: i18n.t('operators.has_number', 'has a number'),\n    operands: 0,\n    categoryName: 'Has Number'\n  },\n  {\n    type: Operators.has_number_between,\n    verboseName: i18n.t('operators.has_number_between', 'has a number between'),\n    operands: 2\n  },\n  {\n    type: Operators.has_number_lt,\n    verboseName: i18n.t('operators.has_number_lt', 'has a number below'),\n    operands: 1\n  },\n  {\n    type: Operators.has_number_lte,\n    verboseName: i18n.t('operators.has_number_lte', 'has a number at or below'),\n    operands: 1\n  },\n  {\n    type: Operators.has_number_eq,\n    verboseName: i18n.t('operators.has_number_eq', 'has a number equal to'),\n    operands: 1\n  },\n  {\n    type: Operators.has_number_gte,\n    verboseName: i18n.t('operators.has_number_gte', 'has a number at or above'),\n    operands: 1\n  },\n  {\n    type: Operators.has_number_gt,\n    verboseName: i18n.t('operators.has_number_gt', 'has a number above'),\n    operands: 1\n  },\n  {\n    type: Operators.has_date,\n    verboseName: i18n.t('operators.has_date', 'has a date'),\n    operands: 0,\n    categoryName: i18n.t('operators.has_date_category', 'Has Date'),\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_date_lt,\n    verboseName: i18n.t('operators.has_date_lt', 'has a date before'),\n    operands: 1,\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_date_eq,\n    verboseName: i18n.t('operators.has_date_eq', 'has a date equal to'),\n    operands: 1,\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_date_gt,\n    verboseName: i18n.t('operators.has_date_gt', 'has a date after'),\n    operands: 1,\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_time,\n    verboseName: i18n.t('operators.has_time', 'has a time'),\n    operands: 0,\n    categoryName: 'Has Time',\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_group,\n    verboseName: i18n.t('operators.has_group', 'is in the group'),\n    operands: 1,\n    visibility: HIDDEN\n  },\n  {\n    type: Operators.has_category,\n    verboseName: i18n.t('operators.has_category', 'has the category'),\n    operands: 0,\n    visibility: HIDDEN\n  },\n  {\n    type: Operators.has_phone,\n    verboseName: i18n.t('operators.has_phone', 'has a phone number'),\n    operands: 0,\n    categoryName: i18n.t('operators.has_phone_category', 'Has Phone')\n  },\n  {\n    type: Operators.has_email,\n    verboseName: i18n.t('operators.has_email', 'has an email'),\n    operands: 0,\n    categoryName: i18n.t('operators.has_email_category', 'Has Email'),\n    visibility: TEXT_TYPES\n  },\n  {\n    type: Operators.has_state,\n    verboseName: i18n.t('operators.has_state', 'has state'),\n    operands: 0,\n    categoryName: i18n.t('operators.has_state_category', 'Has State')\n  },\n  {\n    type: Operators.has_district,\n    verboseName: i18n.t('operators.has_district', 'has district'),\n    operands: 1,\n    categoryName: i18n.t('operators.has_district_category', 'Has District')\n  },\n  {\n    type: Operators.has_ward,\n    verboseName: i18n.t('operators.has_ward', 'has ward'),\n    operands: 2,\n    categoryName: i18n.t('operators.has_ward_category', 'Has Ward')\n  },\n  {\n    type: Operators.has_error,\n    verboseName: i18n.t('operators.has_error', 'has an error'),\n    operands: 0,\n    categoryName: i18n.t('operators.has_error_category', 'Has Error'),\n    visibility: HIDDEN\n  },\n  {\n    type: Operators.has_value,\n    verboseName: i18n.t('operators.has_value', 'is not empty'),\n    operands: 0,\n    categoryName: i18n.t('operators.has_value_category', 'Not Empty'),\n    visibility: HIDDEN\n  },\n  {\n    type: Operators.has_pattern,\n    verboseName: i18n.t('operator.has_pattern', 'matches regex'),\n    operands: 1\n  },\n\n  {\n    type: Operators.has_media,\n    verboseName: i18n.t('operators.has_media', 'has media'),\n    operands: 0,\n    categoryName: 'Has Media',\n    visibility: TEXT_TYPES\n  },\n\n  {\n    type: Operators.has_audio,\n    verboseName: i18n.t('operators.has_audio', 'has audio'),\n    operands: 0,\n    categoryName: 'Has Audio',\n    visibility: TEXT_TYPES\n  },\n\n  {\n    type: Operators.has_image,\n    verboseName: i18n.t('operators.has_image', 'has image'),\n    operands: 0,\n    categoryName: 'Has Image',\n    visibility: TEXT_TYPES\n  },\n\n  {\n    type: Operators.has_video,\n    verboseName: i18n.t('operators.has_video', 'has video'),\n    operands: 0,\n    categoryName: 'Has Video',\n    visibility: TEXT_TYPES\n  },\n\n  {\n    type: Operators.has_file,\n    verboseName: i18n.t('operators.has_file', 'has file'),\n    operands: 0,\n    categoryName: 'Has File',\n    visibility: TEXT_TYPES\n  },\n\n  {\n    type: Operators.has_location,\n    verboseName: i18n.t('operators.has_location', 'has location'),\n    operands: 0,\n    categoryName: 'Has Location',\n    visibility: TEXT_TYPES\n  }\n];\n\nexport const operatorConfigMap: OperatorMap = [...operatorConfigList, ...intentOperatorList].reduce(\n  (map: OperatorMap, operatorConfig: Operator) => {\n    map[operatorConfig.type] = operatorConfig;\n    return map;\n  },\n  {}\n);\n\n/**\n * Shortcut for constant lookup of operator config in operator configs map\n * @param {string} type - The type of the operator config to return, e.g. 'send_msg'\n * @returns {Object} - The operator config found at operatorConfigs[type] or -1\n */\nexport const getOperatorConfig = (type: Operators): Operator => operatorConfigMap[type];\n","import { isRelativeDate } from 'components/flow/routers/helpers';\nimport { Operator, Operators } from 'config/interfaces';\nimport { getOperatorConfig } from 'config/operatorConfigs';\nimport {\n  LessThan,\n  MoreThan,\n  Numeric,\n  NumOrExp,\n  Required,\n  validate,\n  IsValidIntent\n} from 'store/validators';\nimport { titleCase } from 'utils';\n\nimport { CaseElementProps, CaseElementState } from './CaseElement';\nimport { SelectOption } from 'components/form/select/SelectElement';\nimport { Asset } from 'store/flowContext';\nimport i18n from 'config/i18n';\n\nexport const initializeForm = (props: CaseElementProps): CaseElementState => {\n  const arg1 =\n    props.kase.arguments && props.kase.arguments.length >= 1 ? props.kase.arguments[0] : '';\n  const arg2 =\n    props.kase.arguments && props.kase.arguments.length === 2 ? props.kase.arguments[1] : '';\n\n  return {\n    errors: [],\n    operatorConfig: getOperatorConfig(props.kase.type),\n    argument: { value: arg1 },\n    min: { value: arg1 },\n    max: { value: arg2 },\n    state: { value: arg1 },\n    district: { value: arg2 },\n    intent: { value: arg1 ? { name: arg1, value: arg1 } : null },\n    confidence: { value: arg2 },\n    categoryName: { value: props.categoryName || '' },\n    categoryNameEdited: !!props.categoryName,\n    valid: true\n  };\n};\n/**\n * Determines prefix for case's exit name\n */\nexport const prefix = (operatorType: string): string => {\n  let pre = '';\n\n  if (operatorType.indexOf('_lt') > -1) {\n    if (operatorType.indexOf('date') > -1) {\n      pre = 'Before ';\n    } else {\n      if (operatorType.indexOf('lte') > -1) {\n        pre = '<= ';\n      } else {\n        pre = '< ';\n      }\n    }\n  } else if (operatorType.indexOf('_gt') > -1) {\n    if (operatorType.indexOf('date') > -1) {\n      pre = 'After ';\n    } else {\n      if (operatorType.indexOf('gte') > -1) {\n        pre = '>= ';\n      } else {\n        pre = '>';\n      }\n    }\n  }\n\n  return pre;\n};\n\n/**\n * Returns min, max values for Operators.has_number_between case\n */\nexport const getMinMax = (args: string[] = []): { min: string; max: string } => {\n  let min = '';\n  let max = '';\n  if (args.length) {\n    if (strContainsNum(args[0])) {\n      min = args[0];\n    }\n    if (args[1]) {\n      if (strContainsNum(args[1])) {\n        max = args[1];\n      }\n    }\n  }\n  return {\n    min,\n    max\n  };\n};\n\nexport const isFloat = (val: string): boolean => /^[+-]?\\d?(\\.\\d*)?$/.test(val.trim());\n\nexport const isInt = (val: string): boolean => /^[+-]?\\d+$/.test(val.trim());\n\nexport const strContainsNum = (str: string): boolean => {\n  const trimmed = str.trim();\n  if (isFloat(trimmed)) {\n    return true;\n  } else if (isInt(trimmed)) {\n    return true;\n  } else {\n    return false;\n  }\n};\n\nexport const parseNum = (str: string): number => {\n  const trimmed = (str || '').trim();\n  if (isFloat(trimmed)) {\n    return parseFloat(str);\n  } else if (isInt(trimmed)) {\n    return parseInt(trimmed, 10);\n  }\n};\n\nexport const validateCase = (keys: {\n  operatorConfig: Operator;\n  argument?: string;\n  state?: string;\n  district?: string;\n  min?: string;\n  max?: string;\n  confidence?: string;\n  intent?: SelectOption;\n  exitName?: string;\n  exitEdited?: boolean;\n  classifier?: Asset;\n}): Partial<CaseElementState> => {\n  // when the exit is set, our arguments become required\n  const validators = keys.exitEdited && keys.exitName ? [Required] : [];\n\n  const updates: Partial<CaseElementState> = {\n    operatorConfig: keys.operatorConfig\n  };\n\n  updates.district = { value: '', validationFailures: [] };\n  updates.state = { value: '', validationFailures: [] };\n  updates.min = { value: '', validationFailures: [] };\n  updates.max = { value: '', validationFailures: [] };\n  updates.argument = { value: '', validationFailures: [] };\n  updates.intent = { value: null, validationFailures: [] };\n  updates.confidence = { value: '', validationFailures: [] };\n\n  if (keys.operatorConfig.operands > 0) {\n    switch (keys.operatorConfig.type) {\n      case Operators.has_number_eq:\n      case Operators.has_number_gt:\n      case Operators.has_number_gte:\n      case Operators.has_number_lt:\n      case Operators.has_number_lte:\n        validators.push(NumOrExp);\n        break;\n      case Operators.has_date_eq:\n      case Operators.has_date_lt:\n      case Operators.has_date_gt:\n        validators.push(Numeric);\n        break;\n    }\n\n    if (keys.operatorConfig.type === Operators.has_number_between) {\n      updates.min = validate(\n        i18n.t('forms.minimum_value', 'Minimum value'),\n        keys.min || '',\n        validators.concat([\n          Numeric,\n          LessThan(parseFloat(keys.max), i18n.t('forms.the_maximum', 'the maximum'))\n        ])\n      );\n\n      updates.max = validate(\n        i18n.t('forms.maximum_value', 'Maximum value'),\n        keys.max || '',\n        validators.concat([\n          Numeric,\n          MoreThan(parseFloat(keys.min), i18n.t('forms.the_minimum', 'the minimum'))\n        ])\n      );\n    } else if (keys.operatorConfig.type === Operators.has_district) {\n      updates.argument = validate(\n        i18n.t('forms.state', 'State'),\n        keys.argument || '',\n        validators.concat([])\n      );\n    } else if (keys.operatorConfig.type === Operators.has_ward) {\n      updates.state = validate(\n        i18n.t('forms.state', 'State'),\n        keys.state || '',\n        validators.concat([])\n      );\n      updates.district = validate(\n        i18n.t('forms.district', 'District'),\n        keys.district || '',\n        validators.concat([])\n      );\n    } else if (\n      keys.operatorConfig.type === Operators.has_top_intent ||\n      keys.operatorConfig.type === Operators.has_intent\n    ) {\n      const intentValidators = [IsValidIntent(keys.classifier)];\n      if (keys.confidence) {\n        intentValidators.push(Required);\n      }\n      updates.intent = validate(i18n.t('forms.intent', 'Intent'), keys.intent, intentValidators);\n      updates.confidence = validate(\n        i18n.t('forms.confidence', 'Confidence'),\n        keys.confidence || '',\n        validators.concat(keys.intent ? [Numeric, Required] : [Numeric])\n      );\n    } else {\n      updates.argument = validate('Value', keys.argument || '', validators);\n    }\n  }\n\n  updates.categoryNameEdited = !!keys.exitEdited;\n  updates.categoryName = validate(\n    i18n.t('forms.category', 'Category'),\n    updates.categoryNameEdited ? keys.exitName : getCategoryName(updates),\n    updates.argument.value ||\n      (updates.min.value && updates.max.value) ||\n      (updates.state.value && updates.district.value)\n      ? [Required]\n      : []\n  );\n\n  updates.valid =\n    updates.state.validationFailures.length === 0 &&\n    updates.district.validationFailures.length === 0 &&\n    updates.min.validationFailures.length === 0 &&\n    updates.max.validationFailures.length === 0 &&\n    updates.argument.validationFailures.length === 0 &&\n    updates.intent.validationFailures.length === 0 &&\n    updates.confidence.validationFailures.length === 0 &&\n    updates.categoryName.validationFailures.length === 0;\n\n  return updates;\n};\n\nexport const getCategoryName = (state: Partial<CaseElementState>): string => {\n  if (state.categoryNameEdited) {\n    return state.categoryName.value;\n  }\n\n  if (state.operatorConfig.operands === 0) {\n    return state.operatorConfig.categoryName;\n  }\n\n  if (\n    state.operatorConfig.type === Operators.has_intent ||\n    state.operatorConfig.type === Operators.has_top_intent\n  ) {\n    if (state.intent.value) {\n      return titleCase(state.intent.value.name.replace('_', ' '));\n    }\n  }\n\n  if (\n    state.operatorConfig.type === Operators.has_number_between &&\n    state.min.value &&\n    state.max.value\n  ) {\n    return `${state.min.value} - ${state.max.value}`;\n  }\n\n  if (isRelativeDate(state.operatorConfig.type)) {\n    const count = parseInt(state.argument.value, 10);\n    if (!isNaN(count)) {\n      const today =\n        state.operatorConfig.type === Operators.has_date_eq\n          ? i18n.t('forms.today_proper', 'Today')\n          : i18n.t('forms.today', 'today');\n      const op = count < 0 ? ' - ' : ' + ';\n      const inDays =\n        ' ' + (Math.abs(count) === 1 ? i18n.t('forms.day', 'day') : i18n.t('forms.days', 'days'));\n      return prefix(state.operatorConfig.type) + today + op + Math.abs(count) + inDays;\n    }\n  }\n\n  if (state.argument && state.argument.value) {\n    const pre = prefix(state.operatorConfig.type);\n    const words = state.argument.value.match(/\\w+/g);\n\n    if (words && words.length > 0) {\n      const [firstWord] = words;\n      return pre + titleCase(firstWord);\n    }\n\n    return pre + titleCase(state.argument.value);\n  }\n\n  return '';\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport { CaseProps } from 'components/flow/routers/caselist/CaseList';\nimport { isRelativeDate } from 'components/flow/routers/helpers';\nimport FormElement from 'components/form/FormElement';\nimport TextInputElement, { TextInputStyle } from 'components/form/textinput/TextInputElement';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { filterOperators } from 'config/helpers';\nimport { Operator, Operators } from 'config/interfaces';\nimport { operatorConfigList } from 'config/operatorConfigs';\nimport { Case } from 'flowTypes';\nimport * as React from 'react';\nimport { FormState, StringEntry, SelectOptionEntry } from 'store/nodeEditor';\nimport { hasErrorType } from 'utils';\n\nimport styles from './CaseElement.module.scss';\nimport { initializeForm, validateCase } from './helpers';\nimport { Asset } from 'store/flowContext';\nimport SelectElement, { SelectOption } from 'components/form/select/SelectElement';\nimport i18n from 'config/i18n';\nimport TembaSelect, { TembaSelectStyle } from 'temba/TembaSelect';\n\nexport interface CaseElementProps {\n  kase: Case;\n  categoryName: string;\n  name?: string; // satisfy form widget props\n  onRemove?(uuid: string): void;\n  onChange?(c: CaseProps): void;\n  operators?: Operator[];\n  classifier?: Asset;\n}\n\nexport interface CaseElementState extends FormState {\n  errors: string[];\n  operatorConfig: Operator;\n  categoryName: StringEntry;\n  categoryNameEdited: boolean;\n\n  // for string based args\n  argument: StringEntry;\n\n  // for numeric operators\n  min: StringEntry;\n  max: StringEntry;\n\n  // intents\n  intent: SelectOptionEntry;\n  confidence: StringEntry;\n\n  state: StringEntry;\n  district: StringEntry;\n}\n\nexport default class CaseElement extends React.Component<CaseElementProps, CaseElementState> {\n  private operators: Operator[];\n\n  constructor(props: CaseElementProps) {\n    super(props);\n\n    bindCallbacks(this, {\n      include: [/^handle/, /^get/]\n    });\n\n    this.state = initializeForm(props);\n  }\n\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  public componentDidMount() {\n    const updates = validateCase({\n      operatorConfig: this.state.operatorConfig,\n      argument: this.state.argument.value,\n      min: this.state.min.value,\n      max: this.state.max.value,\n      intent: this.state.intent.value,\n      confidence: this.state.confidence.value,\n      exitName: this.state.categoryName.value,\n      exitEdited: this.state.categoryNameEdited,\n      classifier: this.props.classifier\n    });\n\n    this.setState(updates as CaseElementState, this.handleChange);\n  }\n\n  public componentDidUpdate(previousProps: CaseElementProps): void {\n    if (\n      this.props.classifier &&\n      this.props.classifier !== previousProps.classifier &&\n      this.state.intent.value\n    ) {\n      const updates = validateCase({\n        operatorConfig: this.state.operatorConfig,\n        argument: this.state.argument.value,\n        min: this.state.min.value,\n        max: this.state.max.value,\n        intent: this.state.intent.value,\n        confidence: this.state.confidence.value,\n        exitName: this.state.categoryName.value,\n        exitEdited: this.state.categoryNameEdited,\n        classifier: this.props.classifier\n      });\n\n      this.setState(updates as CaseElementState, this.handleChange);\n    }\n  }\n\n  private getOperators(): Operator[] {\n    let operators = this.props.operators || operatorConfigList;\n    if (this.operators === undefined) {\n      this.operators = filterOperators(operators, this.context.config);\n    }\n\n    return this.operators;\n  }\n\n  private getArgumentArray(): string[] {\n    if (this.state.operatorConfig.operands === 0) {\n      return [];\n    }\n\n    if (\n      this.state.operatorConfig.type === Operators.has_intent ||\n      this.state.operatorConfig.type === Operators.has_top_intent\n    ) {\n      if (this.state.intent.value) {\n        return [this.state.intent.value.value, this.state.confidence.value];\n      } else {\n        return ['', this.state.confidence.value];\n      }\n    }\n\n    if (this.state.operatorConfig.type === Operators.has_number_between) {\n      return [this.state.min.value, this.state.max.value];\n    }\n\n    if (this.state.operatorConfig.type === Operators.has_ward) {\n      return [this.state.state.value, this.state.district.value];\n    }\n\n    return [this.state.argument.value];\n  }\n\n  private handleOperatorChanged(operatorConfig: Operator): void {\n    const updates = validateCase({\n      operatorConfig,\n      argument: this.state.argument.value,\n      min: this.state.min.value,\n      max: this.state.max.value,\n      intent: this.state.intent.value,\n      confidence: this.state.confidence.value,\n      exitName: this.state.categoryName.value,\n      exitEdited: this.state.categoryNameEdited,\n      classifier: this.props.classifier\n    });\n\n    this.setState(updates as CaseElementState, () => this.handleChange());\n  }\n\n  private handleArgumentChanged(value: string): void {\n    const updates = validateCase({\n      operatorConfig: this.state.operatorConfig,\n      argument: value,\n      exitName: this.state.categoryName.value,\n      exitEdited: this.state.categoryNameEdited\n    });\n\n    this.setState(updates as CaseElementState, () => this.handleChange());\n  }\n\n  private handleDistrictChanged(value: string): void {\n    const updates = validateCase({\n      operatorConfig: this.state.operatorConfig,\n      argument: this.state.argument.value,\n      state: this.state.state.value,\n      district: value,\n      exitName: this.state.categoryName.value,\n      exitEdited: this.state.categoryNameEdited\n    });\n\n    this.setState(updates as CaseElementState, () => this.handleChange());\n  }\n\n  /** The user changed the value for the state (a location-based state) */\n  private handleStateChanged(value: string): void {\n    const updates = validateCase({\n      operatorConfig: this.state.operatorConfig,\n      argument: this.state.argument.value,\n      district: this.state.district.value,\n      state: value,\n      exitName: this.state.categoryName.value,\n      exitEdited: this.state.categoryNameEdited\n    });\n\n    this.setState(updates as CaseElementState, () => this.handleChange());\n  }\n\n  private handleIntentChanged(selected: SelectOption): void {\n    const updates = validateCase({\n      operatorConfig: this.state.operatorConfig,\n      intent: selected,\n      confidence: this.state.confidence.value || '.9',\n      exitName: this.state.categoryName.value,\n      exitEdited: this.state.categoryNameEdited,\n      classifier: this.props.classifier\n    });\n\n    this.setState(updates as CaseElementState, () => this.handleChange());\n  }\n\n  private handleConfidenceChanged(value: string): void {\n    const updates = validateCase({\n      operatorConfig: this.state.operatorConfig,\n      intent: this.state.intent.value,\n      confidence: value,\n      exitName: this.state.categoryName.value,\n      exitEdited: this.state.categoryNameEdited,\n      classifier: this.props.classifier\n    });\n\n    this.setState(updates as CaseElementState, () => this.handleChange());\n  }\n\n  private handleMinChanged(value: string): void {\n    const updates = validateCase({\n      operatorConfig: this.state.operatorConfig,\n      min: value,\n      max: this.state.max.value,\n      exitName: this.state.categoryName.value,\n      exitEdited: this.state.categoryNameEdited\n    });\n\n    this.setState(updates as CaseElementState, () => this.handleChange());\n  }\n\n  private handleMaxChanged(value: string): void {\n    const updates = validateCase({\n      operatorConfig: this.state.operatorConfig,\n      min: this.state.min.value,\n      max: value,\n      exitName: this.state.categoryName.value,\n      exitEdited: this.state.categoryNameEdited\n    });\n\n    this.setState(updates as CaseElementState, () => this.handleChange());\n  }\n\n  private handleExitChanged(value: string): void {\n    const updates = validateCase({\n      operatorConfig: this.state.operatorConfig,\n      state: this.state.state.value,\n      district: this.state.district.value,\n      argument: this.state.argument.value,\n      min: this.state.min.value,\n      max: this.state.max.value,\n      intent: this.state.intent.value,\n      confidence: this.state.confidence.value,\n      classifier: this.props.classifier,\n      exitName: value,\n      exitEdited: true\n    });\n\n    this.setState(updates as CaseElementState, () => this.handleChange());\n  }\n\n  private handleRemoveClicked(): void {\n    this.props.onRemove(this.props.kase.uuid);\n  }\n\n  private getCaseProps(): CaseProps {\n    const props = {\n      uuid: this.props.kase.uuid,\n      categoryName: this.state.categoryName.value,\n      kase: {\n        arguments: this.getArgumentArray(),\n        type: this.state.operatorConfig.type,\n        uuid: this.props.kase.uuid,\n\n        // if the exit name changed, we'll need to recompute our exit\n        category_uuid: this.state.categoryNameEdited ? null : this.props.kase.category_uuid\n      },\n      valid: this.state.valid\n    };\n\n    return props;\n  }\n\n  private handleChange(): void {\n    // If the case doesn't have arguments & an exit name, remove it\n    if (!this.state.categoryName.value) {\n      // see if we are clearing out a between\n      if (this.state.operatorConfig.type === Operators.has_number_between) {\n        if (!this.state.min.value && !this.state.max.value) {\n          // this.handleRemoveClicked();\n          // return;\n        }\n      }\n      // see if we are clearing out a single operand\n      else {\n        if (!this.state.argument.value) {\n          // this.handleRemoveClicked();\n          // return;\n        }\n      }\n    }\n\n    this.props.onChange(this.getCaseProps());\n  }\n\n  private handleIntentMenuOpened() {\n    // hiding any errors when the menu opens\n    this.setState({ intent: { value: this.state.intent.value } });\n  }\n\n  private handleIntentMenuClosed() {\n    // we want to revalidate close without selection\n    // wait a cycle for selection event to fire first\n    window.setTimeout(() => {\n      this.handleIntentChanged(this.state.intent.value);\n    }, 0);\n  }\n\n  private renderArguments(): JSX.Element {\n    if (this.state.operatorConfig.operands > 0) {\n      // First pass at displaying, handling Operators.has_number_between inputs\n      if (this.state.operatorConfig.operands > 1) {\n        if (this.state.operatorConfig.type === Operators.has_number_between) {\n          return (\n            <>\n              <TextInputElement\n                name={i18n.t('forms.arguments', 'arguments')}\n                style={TextInputStyle.small}\n                onChange={this.handleMinChanged}\n                entry={this.state.min}\n              />\n              <span className={styles.divider} data-draggable={true}>\n                and\n              </span>\n              <TextInputElement\n                name={i18n.t('forms.arguments', 'arguments')}\n                style={TextInputStyle.small}\n                onChange={this.handleMaxChanged}\n                entry={this.state.max}\n              />\n            </>\n          );\n        } else if (\n          this.state.operatorConfig.type === Operators.has_intent ||\n          this.state.operatorConfig.type === Operators.has_top_intent\n        ) {\n          let intents: SelectOption[] = [];\n\n          if (this.props.classifier && this.props.classifier.content) {\n            intents = this.props.classifier.content.intents.map((intent: string) => {\n              const option: SelectOption = {\n                name: intent,\n                value: intent\n              };\n              return option;\n            });\n          }\n\n          return (\n            <>\n              <div style={{ width: '114px' }}>\n                <SelectElement\n                  key=\"intent_select\"\n                  style={TembaSelectStyle.small}\n                  name={i18n.t('forms.intent', 'Intent')}\n                  placeholder={i18n.t('forms.select_intent', 'Select intent')}\n                  entry={this.state.intent}\n                  onChange={this.handleIntentChanged}\n                  options={intents}\n                  onMenuOpen={this.handleIntentMenuOpened}\n                  onMenuClose={this.handleIntentMenuClosed}\n                  hideError={true}\n                ></SelectElement>\n              </div>\n              <div className={styles.divider} data-draggable={true}>\n                above\n              </div>\n              <div style={{ width: '34px' }}>\n                <TextInputElement\n                  name={i18n.t('forms.confidence', 'confidence')}\n                  onChange={this.handleConfidenceChanged}\n                  entry={this.state.confidence}\n                  style={TextInputStyle.small}\n                  placeholder=\".9\"\n                />\n              </div>\n            </>\n          );\n        } else {\n          return (\n            <>\n              <TextInputElement\n                name={i18n.t('forms.state', 'State')}\n                placeholder=\"State\"\n                onChange={this.handleStateChanged}\n                style={TextInputStyle.small}\n                entry={this.state.state}\n              />\n              <span className={styles.divider} data-draggable={true}>\n                and\n              </span>\n              <TextInputElement\n                name={i18n.t('forms.district', 'District')}\n                placeholder={i18n.t('forms.district', 'District')}\n                onChange={this.handleDistrictChanged}\n                style={TextInputStyle.small}\n                entry={this.state.district}\n              />\n            </>\n          );\n        }\n      } else if (isRelativeDate(this.state.operatorConfig.type)) {\n        return (\n          <>\n            <span className={styles.divider} data-draggable={true}>\n              today +{' '}\n            </span>\n            <TextInputElement\n              __className={styles.relative_date}\n              name={i18n.t('forms.arguments', 'arguments')}\n              onChange={this.handleArgumentChanged}\n              entry={this.state.argument}\n              style={TextInputStyle.small}\n              autocomplete={false}\n            />\n            <span className={styles.divider}>days</span>\n          </>\n        );\n      } else {\n        return (\n          <TextInputElement\n            name={i18n.t('forms.arguments', 'arguments')}\n            onChange={this.handleArgumentChanged}\n            entry={this.state.argument}\n            style={TextInputStyle.small}\n            placeholder={this.state.operatorConfig.type === Operators.has_district ? 'State' : ''}\n            autocomplete={true}\n          />\n        );\n      }\n    }\n\n    return null;\n  }\n\n  public render(): JSX.Element {\n    return (\n      <FormElement\n        data-spec=\"case-form\"\n        name={this.props.name}\n        __className={styles.group}\n        kaseError={this.state.errors.length > 0}\n      >\n        <div\n          className={`${styles.kase} ${styles[this.state.operatorConfig.type]}`}\n          data-draggable={true}\n        >\n          <span className={`fe-chevrons-expand ${styles.dnd_icon}`} data-draggable={true} />\n          <div className={styles.choice}>\n            <TembaSelect\n              name={i18n.t('forms.operator', 'operator')}\n              style={TembaSelectStyle.small}\n              options={this.getOperators()}\n              nameKey=\"verboseName\"\n              valueKey=\"type\"\n              onChange={this.handleOperatorChanged}\n              value={this.state.operatorConfig}\n            ></TembaSelect>\n          </div>\n          <div\n            className={\n              this.state.operatorConfig.operands > 1 ? styles.multi_operand : styles.single_operand\n            }\n          >\n            {this.renderArguments()}\n          </div>\n          <div className={styles.categorize_as} data-draggable={true}>\n            categorize as\n          </div>\n          <div className={styles.category}>\n            <TextInputElement\n              name={i18n.t('forms.exit_name', 'Exit Name')}\n              style={TextInputStyle.small}\n              onChange={this.handleExitChanged}\n              entry={this.state.categoryName}\n              maxLength={36}\n              showInvalid={hasErrorType(this.state.errors, [/category/])}\n            />\n          </div>\n          <span\n            data-testid={'remove-case-' + this.props.kase.uuid}\n            className={`fe-x ${styles.remove_icon}`}\n            onClick={this.handleRemoveClicked}\n          />\n        </div>\n      </FormElement>\n    );\n  }\n}\n","import { CaseProps } from 'components/flow/routers/caselist/CaseList';\r\nimport { Operators } from 'config/interfaces';\r\nimport { createUUID } from 'utils';\r\n\r\nexport const createEmptyCase = (): CaseProps => {\r\n  const uuid = createUUID();\r\n  return {\r\n    uuid,\r\n    kase: {\r\n      uuid,\r\n      type: Operators.has_any_word,\r\n      arguments: [''],\r\n      category_uuid: null\r\n    },\r\n    categoryName: '',\r\n    valid: true\r\n  };\r\n};\r\n","import arrayMove from 'array-move';\nimport { react as bindCallbacks } from 'auto-bind';\nimport CaseElement from 'components/flow/routers/case/CaseElement';\nimport { createEmptyCase } from 'components/flow/routers/caselist/helpers';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { Case } from 'flowTypes';\nimport * as React from 'react';\nimport { FormState, mergeForm } from 'store/nodeEditor';\nimport { SortableElement, SortEnd, SortableContainer } from 'react-sortable-hoc';\n\nimport styles from './CaseList.module.scss';\nimport { Operator } from 'config/interfaces';\nimport { Asset } from 'store/flowContext';\n\nexport enum DragCursor {\n  move = 'move',\n  pointer = 'pointer'\n}\n\nexport interface CaseProps {\n  uuid: string;\n  kase: Case;\n  categoryName: string;\n  valid: boolean;\n  operators?: Operator[];\n  classifier?: Asset;\n}\n\nexport interface CaseListProps {\n  cases: CaseProps[];\n  onCasesUpdated(cases: CaseProps[]): void;\n  operators?: Operator[];\n  classifier?: Asset;\n  createEmptyCase?: () => CaseProps;\n}\n\nexport interface CaseListState extends FormState {\n  currentCases: CaseProps[];\n}\n\nconst SortableItem = SortableElement(({ value: row }: any) => {\n  const caseProps = row.item;\n  return (\n    <div className={styles.kase + ' case_list_case'}>\n      <CaseElement\n        key={caseProps.uuid}\n        {...caseProps}\n        onRemove={row.list.handleRemoveCase}\n        onChange={row.list.handleUpdateCase}\n        operators={row.list.props.operators}\n        classifier={row.list.props.classifier}\n      />\n    </div>\n  );\n});\n\n/**\n * CaseList is a component made up of case elements that lets\n * the user configure rules and drag and drop to set their order.\n */\nexport default class CaseList extends React.Component<CaseListProps, CaseListState> {\n  private sortableList = SortableContainer(({ items }: any) => {\n    return (\n      <div className={styles.case_list}>\n        {items.map((value: any, index: any) => (\n          <SortableItem\n            key={`item-${index}`}\n            index={index}\n            value={{ item: value, list: this }}\n            disabled={index === this.state.currentCases.length - 1}\n            shouldCancelStart={(e: any) => {\n              console.log(e);\n              return true;\n            }}\n          />\n        ))}\n      </div>\n    );\n  });\n\n  constructor(props: CaseListProps) {\n    super(props);\n\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n\n    const caseProps = this.props.cases;\n\n    if (!this.hasEmptyCase(caseProps)) {\n      caseProps.push(this.createEmptyCase());\n    }\n\n    // initialize our cases\n    this.state = {\n      currentCases: caseProps,\n      valid: true\n    };\n  }\n\n  private createEmptyCase(): CaseProps {\n    return this.props.createEmptyCase ? this.props.createEmptyCase() : createEmptyCase();\n  }\n\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  private handleUpdate(keys: { caseProps?: CaseProps; removeCase?: any }) {\n    const updates: Partial<CaseListState> = {};\n\n    let ensureEmptyCase = false;\n\n    if (keys.hasOwnProperty('caseProps')) {\n      updates.currentCases = [keys.caseProps];\n      ensureEmptyCase = true;\n      if (!keys.caseProps.valid) {\n        // TODO: refactor this to be a form entry\n        // mock our case to have validation failures, this is so the case list sees\n        // the existence of errors which mergeForm uses when merging form validity\n        // (keys.caseProps as any).validationFailures = [{ message: 'invalid case' }];\n        updates.valid = false;\n      }\n    }\n\n    let toRemove: any[] = [];\n    if (keys.hasOwnProperty('removeCase')) {\n      toRemove = [{ currentCases: [keys.removeCase] }];\n      ensureEmptyCase = true;\n    }\n\n    // update our form\n    this.setState(\n      (prevState: CaseListState) => {\n        const updated = mergeForm(prevState, updates, toRemove) as CaseListState;\n\n        // notify our listener\n        this.props.onCasesUpdated(updated.currentCases);\n        return updated;\n      },\n      () => {\n        // if we no longer have an empty case, add one\n        if (ensureEmptyCase) {\n          if (!this.hasEmptyCase(this.state.currentCases)) {\n            this.handleUpdate({ caseProps: this.createEmptyCase() });\n          }\n        }\n      }\n    );\n  }\n\n  private hasEmptyCase(cases: CaseProps[]): boolean {\n    return cases.find((caseProps: CaseProps) => caseProps.categoryName.trim().length === 0) != null;\n  }\n\n  private handleRemoveCase(uuid: string) {\n    return this.handleUpdate({\n      removeCase: { uuid }\n    });\n  }\n\n  private handleUpdateCase(caseProps: CaseProps) {\n    this.handleUpdate({ caseProps });\n  }\n\n  private handleSortEnd({ oldIndex, newIndex }: SortEnd): void {\n    this.setState(\n      ({ currentCases }) => ({\n        currentCases: arrayMove(\n          currentCases,\n          oldIndex,\n          newIndex === this.state.currentCases.length - 1 ? newIndex - 1 : newIndex\n        )\n      }),\n      () => {\n        this.props.onCasesUpdated(this.state.currentCases);\n      }\n    );\n  }\n\n  public render(): JSX.Element {\n    return (\n      <div\n        className={\n          styles.case_list_container +\n          ' ' +\n          (this.state.currentCases.length > 5 ? styles.scrolling : '')\n        }\n        tabIndex={0}\n      >\n        <this.sortableList\n          items={this.state.currentCases}\n          onSortEnd={this.handleSortEnd}\n          shouldCancelStart={(e: React.MouseEvent<HTMLDivElement>) => {\n            if (!(e.target instanceof HTMLElement)) {\n              return true;\n            }\n            return !e.target.dataset.draggable;\n          }}\n        />\n      </div>\n    );\n  }\n}\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport * as React from 'react';\r\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\r\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\r\nimport { RouterFormProps } from 'components/flow/props';\r\nimport CaseList, { CaseProps } from 'components/flow/routers/caselist/CaseList';\r\nimport { nodeToState, stateToNode } from 'components/flow/routers/expression/helpers';\r\nimport { createResultNameInput } from 'components/flow/routers/widgets';\r\nimport TextInputElement from 'components/form/textinput/TextInputElement';\r\nimport TypeList from 'components/nodeeditor/TypeList';\r\nimport { FormState, StringEntry } from 'store/nodeEditor';\r\nimport { Alphanumeric, Required, StartIsNonNumeric, validate } from 'store/validators';\r\nimport i18n from 'config/i18n';\r\n\r\n// TODO: Remove use of Function\r\n// tslint:disable:ban-types\r\nexport enum InputToFocus {\r\n  args = 'args',\r\n  min = 'min',\r\n  max = 'max',\r\n  exit = 'exit'\r\n}\r\n\r\nexport interface ExpressionRouterFormState extends FormState {\r\n  cases: CaseProps[];\r\n  resultName: StringEntry;\r\n  operand: StringEntry;\r\n}\r\n\r\nexport const leadInSpecId = 'lead-in';\r\n\r\nexport default class ExpressionRouterForm extends React.Component<\r\n  RouterFormProps,\r\n  ExpressionRouterFormState\r\n> {\r\n  constructor(props: RouterFormProps) {\r\n    super(props);\r\n\r\n    this.state = nodeToState(this.props.nodeSettings);\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^on/, /^handle/]\r\n    });\r\n  }\r\n\r\n  private handleUpdateResultName(value: string): void {\r\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\r\n      Alphanumeric,\r\n      StartIsNonNumeric\r\n    ]);\r\n    this.setState({\r\n      resultName,\r\n      valid: this.state.valid && !hasErrors(resultName)\r\n    });\r\n  }\r\n\r\n  private handleOperandUpdated(value: string): void {\r\n    this.setState({\r\n      operand: validate(i18n.t('forms.operand', 'Operand'), value, [Required])\r\n    });\r\n  }\r\n\r\n  private handleCasesUpdated(cases: CaseProps[]): void {\r\n    this.setState({ cases });\r\n  }\r\n\r\n  private handleSave(): void {\r\n    if (this.state.valid) {\r\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\r\n      this.props.onClose(false);\r\n    }\r\n  }\r\n\r\n  private getButtons(): ButtonSet {\r\n    return {\r\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\r\n      secondary: {\r\n        name: i18n.t('buttons.cancel', 'Cancel'),\r\n        onClick: () => this.props.onClose(true)\r\n      }\r\n    };\r\n  }\r\n\r\n  public renderEdit(): JSX.Element {\r\n    const typeConfig = this.props.typeConfig;\r\n\r\n    return (\r\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\r\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\r\n        <p>If the expression...</p>\r\n        <TextInputElement\r\n          name={i18n.t('forms.operand', 'Operand')}\r\n          showLabel={false}\r\n          autocomplete={true}\r\n          onChange={this.handleOperandUpdated}\r\n          entry={this.state.operand}\r\n        />\r\n        <CaseList\r\n          data-spec=\"cases\"\r\n          cases={this.state.cases}\r\n          onCasesUpdated={this.handleCasesUpdated}\r\n        />\r\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\r\n        {renderIssues(this.props)}\r\n      </Dialog>\r\n    );\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    return this.renderEdit();\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\r\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\r\nimport { RouterFormProps } from 'components/flow/props';\r\nimport CaseList, { CaseProps } from 'components/flow/routers/caselist/CaseList';\r\nimport { createResultNameInput } from 'components/flow/routers/widgets';\r\nimport TypeList from 'components/nodeeditor/TypeList';\r\nimport * as React from 'react';\r\nimport { FormState, StringEntry } from 'store/nodeEditor';\r\nimport { Alphanumeric, StartIsNonNumeric, validate } from 'store/validators';\r\n\r\nimport styles from './DigitsRouterForm.module.scss';\r\nimport { nodeToState, stateToNode } from './helpers';\r\nimport i18n from 'config/i18n';\r\n\r\nexport interface DigitsRouterFormState extends FormState {\r\n  cases: CaseProps[];\r\n  resultName: StringEntry;\r\n}\r\n\r\nexport default class DigitsRouterForm extends React.Component<\r\n  RouterFormProps,\r\n  DigitsRouterFormState\r\n> {\r\n  constructor(props: RouterFormProps) {\r\n    super(props);\r\n\r\n    this.state = nodeToState(this.props.nodeSettings);\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^on/, /^handle/]\r\n    });\r\n  }\r\n\r\n  private handleUpdateResultName(value: string): void {\r\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\r\n      Alphanumeric,\r\n      StartIsNonNumeric\r\n    ]);\r\n    this.setState({\r\n      resultName,\r\n      valid: this.state.valid && !hasErrors(resultName)\r\n    });\r\n  }\r\n\r\n  private handleCasesUpdated(cases: CaseProps[]): void {\r\n    this.setState({ cases });\r\n  }\r\n\r\n  private handleSave(): void {\r\n    if (this.state.valid) {\r\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\r\n      this.props.onClose(false);\r\n    }\r\n  }\r\n\r\n  private getButtons(): ButtonSet {\r\n    return {\r\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\r\n      secondary: {\r\n        name: i18n.t('buttons.cancel', 'Cancel'),\r\n        onClick: () => this.props.onClose(true)\r\n      }\r\n    };\r\n  }\r\n\r\n  public renderEdit(): JSX.Element {\r\n    const typeConfig = this.props.typeConfig;\r\n\r\n    return (\r\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\r\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\r\n        <p className={styles.lead_in}>If the keypad entry before the # symbol..</p>\r\n        <CaseList\r\n          data-spec=\"cases\"\r\n          cases={this.state.cases}\r\n          onCasesUpdated={this.handleCasesUpdated}\r\n        />\r\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\r\n        {renderIssues(this.props)}\r\n      </Dialog>\r\n    );\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    return this.renderEdit();\r\n  }\r\n}\r\n","import { CaseProps } from 'components/flow/routers/caselist/CaseList';\r\nimport {\r\n  createCaseProps,\r\n  createRenderNode,\r\n  hasCases,\r\n  resolveRoutes\r\n} from 'components/flow/routers/helpers';\r\nimport { Types } from 'config/interfaces';\r\nimport { getType } from 'config/typeConfigs';\r\nimport { HintTypes, Router, RouterTypes, SwitchRouter, WaitTypes } from 'flowTypes';\r\nimport { RenderNode } from 'store/flowContext';\r\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\r\n\r\nimport { DigitsRouterFormState } from './DigitsRouterForm';\r\nimport { DIGITS_OPERAND } from 'components/nodeeditor/constants';\r\n\r\nexport const nodeToState = (settings: NodeEditorSettings): DigitsRouterFormState => {\r\n  let initialCases: CaseProps[] = [];\r\n\r\n  // TODO: work out an incremental result name\r\n  let resultName: StringEntry = { value: '' };\r\n\r\n  if (getType(settings.originalNode) === Types.wait_for_digits) {\r\n    const router = settings.originalNode.node.router as SwitchRouter;\r\n    if (router) {\r\n      if (hasCases(settings.originalNode.node)) {\r\n        initialCases = createCaseProps(router.cases, settings.originalNode);\r\n      }\r\n\r\n      resultName = { value: router.result_name || '' };\r\n    }\r\n  }\r\n\r\n  return {\r\n    cases: initialCases,\r\n    resultName,\r\n    valid: true\r\n  };\r\n};\r\n\r\nexport const stateToNode = (\r\n  settings: NodeEditorSettings,\r\n  state: DigitsRouterFormState\r\n): RenderNode => {\r\n  const { cases, exits, categories, defaultCategory: defaultExit, caseConfig } = resolveRoutes(\r\n    state.cases,\r\n    false,\r\n    settings.originalNode.node\r\n  );\r\n\r\n  const optionalRouter: Pick<Router, 'result_name'> = {};\r\n  if (state.resultName.value) {\r\n    optionalRouter.result_name = state.resultName.value;\r\n  }\r\n\r\n  const router: SwitchRouter = {\r\n    type: RouterTypes.switch,\r\n    default_category_uuid: defaultExit,\r\n    categories,\r\n    cases,\r\n    operand: DIGITS_OPERAND,\r\n    wait: { type: WaitTypes.msg, hint: { type: HintTypes.digits } },\r\n    ...optionalRouter\r\n  };\r\n\r\n  const newRenderNode = createRenderNode(\r\n    settings.originalNode.node.uuid,\r\n    router,\r\n    exits,\r\n    Types.wait_for_response,\r\n    [],\r\n\r\n    { cases: caseConfig }\r\n  );\r\n\r\n  return newRenderNode;\r\n};\r\n","export const DEFAULT_OPERAND = '@input.text';\nexport const GROUPS_OPERAND = '@contact.groups';\nexport const WEBHOOK_OPERAND = '@run.webhook';\nexport const SUBFLOW_OPERAND = '@child.run.status';\nexport const MEDIA_OPERAND = '@input';\nexport const DIGITS_OPERAND = '@input.text';\nexport const MENU_OPERAND = '@input.text';\nexport const SCHEMES_OPERAND = '@(urn_parts(contact.urn).scheme)';\n\n// default body for non-GET webhook actions\n// export const DEFAULT_BODY: string = `@(json(object(\n//   \"contact\", object(\n//     \"uuid\", contact.uuid,\n//     \"name\", contact.name,\n//     \"urn\", contact.urn\n//   ),\n//   \"flow\", object(\n//     \"uuid\", run.flow.uuid,\n//     \"name\", run.flow.name\n//   ),\n//   \"results\", foreach_value(results, extract_object, \"value\", \"category\")\n// )))`;\n\nexport const DEFAULT_BODY: string = `{\n  \"contact\": \"@contact\",\n  \"results\": \"@results\",\n  \"custom_key\": \"custom_value\"\n}`;\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { getName, sortFieldsAndProperties } from 'components/flow/actions/updatecontact/helpers';\nimport { RouterFormProps } from 'components/flow/props';\nimport CaseList, { CaseProps } from 'components/flow/routers/caselist/CaseList';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { fakePropType } from 'config/ConfigProvider';\nimport * as React from 'react';\nimport { FormEntry, FormState, StringEntry } from 'store/nodeEditor';\nimport { Alphanumeric, StartIsNonNumeric, validate } from 'store/validators';\n\nimport styles from './FieldRouterForm.module.scss';\nimport { getRoutableFields, nodeToState, stateToNode } from './helpers';\nimport i18n from 'config/i18n';\nimport { TembaSelectStyle } from 'temba/TembaSelect';\n\n// TODO: Remove use of Function\n// tslint:disable:ban-types\nexport enum InputToFocus {\n  args = 'args',\n  min = 'min',\n  max = 'max',\n  exit = 'exit'\n}\n\nexport interface FieldRouterFormState extends FormState {\n  field: FormEntry;\n  cases: CaseProps[];\n  resultName: StringEntry;\n}\n\nexport const leadInSpecId = 'lead-in';\n\nexport default class FieldRouterForm extends React.Component<\n  RouterFormProps,\n  FieldRouterFormState\n> {\n  public static contextTypes = {\n    assetService: fakePropType,\n    config: fakePropType\n  };\n\n  constructor(props: RouterFormProps) {\n    super(props);\n    this.state = nodeToState(this.props.nodeSettings, this.props.assetStore);\n\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  private handleUpdateResultName(value: string): void {\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\n      Alphanumeric,\n      StartIsNonNumeric\n    ]);\n    this.setState({\n      resultName,\n      valid: this.state.valid && !hasErrors(resultName)\n    });\n  }\n\n  private handleFieldChanged(selected: any[]): void {\n    this.setState({ field: { value: selected[0] } });\n  }\n\n  private handleCasesUpdated(cases: CaseProps[]): void {\n    this.setState({ cases });\n  }\n\n  private handleSave(): void {\n    if (this.state.valid) {\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  public renderEdit(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <div className={styles.lead_in}>\n          If the contact's\n          <div className={`${styles.field_select} select-small`}>\n            <AssetSelector\n              name={i18n.t('forms.contact_field', 'Contact Field')}\n              style={TembaSelectStyle.small}\n              assets={this.props.assetStore.fields}\n              additionalOptions={getRoutableFields(this.context.config.flowType)}\n              valueKey=\"id\"\n              getName={getName}\n              entry={this.state.field}\n              searchable={true}\n              sortFunction={sortFieldsAndProperties}\n              onChange={this.handleFieldChanged}\n            />\n          </div>\n        </div>\n        <CaseList\n          data-spec=\"cases\"\n          cases={this.state.cases}\n          onCasesUpdated={this.handleCasesUpdated}\n        />\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n\n  public render(): JSX.Element {\n    return this.renderEdit();\n  }\n}\n","import { CaseProps } from 'components/flow/routers/caselist/CaseList';\r\nimport { ExpressionRouterFormState } from 'components/flow/routers/expression/ExpressionRouterForm';\r\nimport {\r\n  createCaseProps,\r\n  createRenderNode,\r\n  hasCases,\r\n  resolveRoutes\r\n} from 'components/flow/routers/helpers';\r\nimport { DEFAULT_OPERAND } from 'components/nodeeditor/constants';\r\nimport { Types } from 'config/interfaces';\r\nimport { getType } from 'config/typeConfigs';\r\nimport { Router, RouterTypes, SwitchRouter } from 'flowTypes';\r\nimport { RenderNode } from 'store/flowContext';\r\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\r\n\r\nexport const nodeToState = (settings: NodeEditorSettings): ExpressionRouterFormState => {\r\n  let initialCases: CaseProps[] = [];\r\n\r\n  // TODO: work out an incremental result name\r\n  let resultName: StringEntry = { value: '' };\r\n\r\n  let operand = DEFAULT_OPERAND;\r\n\r\n  if (settings.originalNode && getType(settings.originalNode) === Types.split_by_expression) {\r\n    const router = settings.originalNode.node.router as SwitchRouter;\r\n    if (router) {\r\n      if (hasCases(settings.originalNode.node)) {\r\n        initialCases = createCaseProps(router.cases, settings.originalNode);\r\n      }\r\n\r\n      resultName = { value: router.result_name || '' };\r\n    }\r\n\r\n    operand = router.operand;\r\n  }\r\n\r\n  return {\r\n    cases: initialCases,\r\n    resultName,\r\n    operand: { value: operand },\r\n    valid: true\r\n  };\r\n};\r\n\r\nexport const stateToNode = (\r\n  settings: NodeEditorSettings,\r\n  state: ExpressionRouterFormState\r\n): RenderNode => {\r\n  const { cases, exits, defaultCategory: defaultExit, caseConfig, categories } = resolveRoutes(\r\n    state.cases,\r\n    false,\r\n    settings.originalNode.node\r\n  );\r\n\r\n  const optionalRouter: Pick<Router, 'result_name'> = {};\r\n  if (state.resultName.value) {\r\n    optionalRouter.result_name = state.resultName.value;\r\n  }\r\n\r\n  const router: SwitchRouter = {\r\n    type: RouterTypes.switch,\r\n    default_category_uuid: defaultExit,\r\n    categories,\r\n    cases,\r\n    operand: state.operand.value,\r\n    ...optionalRouter\r\n  };\r\n\r\n  const newRenderNode = createRenderNode(\r\n    settings.originalNode.node.uuid,\r\n    router,\r\n    exits,\r\n    Types.split_by_expression,\r\n    [],\r\n    { cases: caseConfig }\r\n  );\r\n\r\n  return newRenderNode;\r\n};\r\n","import { NAME_PROPERTY } from 'components/flow/props';\nimport { CaseProps } from 'components/flow/routers/caselist/CaseList';\nimport { FieldRouterFormState } from 'components/flow/routers/field/FieldRouterForm';\nimport {\n  createCaseProps,\n  createRenderNode,\n  hasCases,\n  resolveRoutes\n} from 'components/flow/routers/helpers';\nimport { getContactProperties } from 'components/helpers';\nimport { DEFAULT_OPERAND } from 'components/nodeeditor/constants';\nimport { FlowTypes, Types } from 'config/interfaces';\nimport { getType, Scheme, SCHEMES } from 'config/typeConfigs';\nimport { Router, RouterTypes, SwitchRouter } from 'flowTypes';\nimport { Asset, AssetStore, AssetType, RenderNode } from 'store/flowContext';\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\n\nexport const getRoutableFields = (flowType: FlowTypes = null): Asset[] => {\n  return [\n    ...getContactProperties(flowType),\n    ...SCHEMES.map((scheme: Scheme) => ({\n      name: scheme.path,\n      id: scheme.scheme,\n      type: AssetType.Scheme\n    }))\n  ];\n};\n\nexport const nodeToState = (\n  settings: NodeEditorSettings,\n  assetStore: AssetStore\n): FieldRouterFormState => {\n  let initialCases: CaseProps[] = [];\n\n  // TODO: work out an incremental result name\n  let resultName: StringEntry = { value: '' };\n\n  let field: any = null;\n\n  const type = getType(settings.originalNode);\n  if (settings.originalNode && type === Types.split_by_contact_field) {\n    const router = settings.originalNode.node.router as SwitchRouter;\n\n    if (router) {\n      if (hasCases(settings.originalNode.node)) {\n        initialCases = createCaseProps(router.cases, settings.originalNode);\n      }\n\n      resultName = { value: router.result_name || '' };\n    }\n\n    const operand = settings.originalNode.ui.config.operand;\n\n    if (assetStore.fields) {\n      if (operand.id in assetStore.fields.items) {\n        const name = assetStore.fields.items[operand.id].name;\n        field = { key: operand.id, label: name, type: operand.type };\n      }\n    }\n\n    // couldn't find the asset, check our routable fields\n    if (!field) {\n      field = getRoutableFields().find((asset: Asset) => asset.id === operand.id);\n    }\n  }\n\n  // our default is name\n  if (!field) {\n    field = NAME_PROPERTY;\n  }\n\n  return {\n    cases: initialCases,\n    resultName,\n    field: { value: field },\n    valid: true\n  };\n};\n\nexport const stateToNode = (\n  settings: NodeEditorSettings,\n  state: FieldRouterFormState\n): RenderNode => {\n  const { cases, exits, defaultCategory: defaultExit, caseConfig, categories } = resolveRoutes(\n    state.cases,\n    false,\n    settings.originalNode.node\n  );\n\n  const optionalRouter: Pick<Router, 'result_name'> = {};\n  if (state.resultName.value) {\n    optionalRouter.result_name = state.resultName.value;\n  }\n\n  let operand = DEFAULT_OPERAND;\n\n  const asset = state.field.value;\n\n  let operandConfig = {\n    id: asset.id,\n    type: asset.type,\n    name: asset.name\n  };\n\n  if (asset.type === AssetType.Scheme) {\n    operand = `@(default(urn_parts(urns.${asset.id}).path, \"\"))`;\n  } else if (asset.type === AssetType.ContactProperty) {\n    operand = `@contact.${asset.id}`;\n  } else if (asset.key) {\n    operand = `@fields.${asset.key}`;\n    operandConfig = {\n      id: asset.key,\n      name: asset.label,\n      type: AssetType.Field\n    };\n  }\n\n  const router: SwitchRouter = {\n    type: RouterTypes.switch,\n    default_category_uuid: defaultExit,\n    cases,\n    categories,\n    operand,\n    ...optionalRouter\n  };\n\n  const newRenderNode = createRenderNode(\n    settings.originalNode.node.uuid,\n    router,\n    exits,\n    Types.split_by_contact_field,\n    [],\n    {\n      operand: operandConfig,\n      cases: caseConfig\n    }\n  );\n\n  return newRenderNode;\n};\n","import { CaseProps } from 'components/flow/routers/caselist/CaseList';\nimport { GroupsRouterFormState } from 'components/flow/routers/groups/GroupsRouterForm';\nimport { createRenderNode, getSwitchRouter, resolveRoutes } from 'components/flow/routers/helpers';\nimport { GROUPS_OPERAND } from 'components/nodeeditor/constants';\nimport { Operators, Types } from 'config/interfaces';\nimport { getType } from 'config/typeConfigs';\nimport { Category, FlowNode, RouterTypes, SwitchRouter } from 'flowTypes';\nimport { RenderNode } from 'store/flowContext';\nimport { NodeEditorSettings } from 'store/nodeEditor';\nimport { createUUID } from 'utils';\n\nexport const nodeToState = (settings: NodeEditorSettings): GroupsRouterFormState => {\n  const state: GroupsRouterFormState = {\n    groups: { value: [] },\n    resultName: { value: '' },\n    valid: false\n  };\n\n  if (getType(settings.originalNode) === Types.split_by_groups) {\n    state.groups.value = extractGroups(settings.originalNode.node);\n    state.resultName = {\n      value: (settings.originalNode.node.router as SwitchRouter).result_name || ''\n    };\n    state.valid = true;\n  }\n\n  return state;\n};\n\nexport const stateToNode = (\n  settings: NodeEditorSettings,\n  state: GroupsRouterFormState\n): RenderNode => {\n  const currentCases = groupsToCases(state.groups.value);\n  const { cases, exits, defaultCategory: defaultExit, caseConfig, categories } = resolveRoutes(\n    currentCases,\n    false,\n    settings.originalNode.node\n  );\n\n  const router: SwitchRouter = {\n    type: RouterTypes.switch,\n    cases,\n    categories,\n    default_category_uuid: defaultExit,\n    operand: GROUPS_OPERAND,\n    result_name: state.resultName.value\n  };\n\n  return createRenderNode(\n    settings.originalNode.node.uuid,\n    router,\n    exits,\n    Types.split_by_groups,\n    [],\n    { cases: caseConfig }\n  );\n};\n\nexport const extractGroups = (node: FlowNode): any[] => {\n  let groups: any[] = [];\n  const router = getSwitchRouter(node);\n  if (router) {\n    groups = (router as SwitchRouter).cases.map(kase => {\n      const category = router.categories.find((cat: Category) => cat.uuid === kase.category_uuid);\n      return {\n        name: category.name,\n        uuid: kase.arguments[0]\n      };\n    });\n  }\n  return groups;\n};\nexport const groupsToCases = (groups: any[] = []): CaseProps[] => {\n  return groups.map(({ name, uuid }: any) => ({\n    uuid,\n    kase: {\n      uuid: createUUID(),\n      type: Operators.has_group,\n      arguments: [uuid, name],\n      category_uuid: ''\n    },\n    categoryName: name,\n    valid: true\n  }));\n};\n","import { Types } from 'config/interfaces';\r\nimport { getType } from 'config/typeConfigs';\r\nimport { Case, Category, SwitchRouter } from 'flowTypes';\r\nimport { LocalizedObject } from 'services/Localization';\r\nimport { RenderNode } from 'store/flowContext';\r\nimport { NodeEditorSettings } from 'store/nodeEditor';\r\n\r\nexport enum LocalizedType {\r\n  Category,\r\n  Case\r\n}\r\n\r\nexport const getOriginalCase = (nodeSettings: NodeEditorSettings, uuid: string) => {\r\n  const cases = (nodeSettings.originalNode.node.router as SwitchRouter).cases;\r\n  return cases.find((item: any) => item.uuid === uuid);\r\n};\r\n\r\nexport const getOriginalCategory = (nodeSettings: NodeEditorSettings, uuid: string) => {\r\n  const items = nodeSettings.originalNode.node.router.categories;\r\n  return items.find((item: any) => item.uuid === uuid);\r\n};\r\n\r\nexport const hasLocalizableCases = (renderNode: RenderNode) => {\r\n  const type = getType(renderNode);\r\n  return type === Types.wait_for_response || type === Types.split_by_expression;\r\n};\r\n\r\nexport const getLocalizedObjects = (\r\n  nodeSettings: NodeEditorSettings,\r\n  localizedType: LocalizedType\r\n): Category[] | Case[] => {\r\n  const filtered: any = [];\r\n\r\n  let items: Category[] | Case[] = nodeSettings.originalNode.node.router.categories;\r\n  if (localizedType === LocalizedType.Case) {\r\n    if (hasLocalizableCases(nodeSettings.originalNode)) {\r\n      items = (nodeSettings.originalNode.node.router as SwitchRouter).cases;\r\n    } else {\r\n      items = [];\r\n    }\r\n  }\r\n\r\n  for (const original of items) {\r\n    const [localized] = nodeSettings.localizations.filter(\r\n      (localizedObject: LocalizedObject) => localizedObject.getObject().uuid === original.uuid\r\n    );\r\n\r\n    if (localized.isLocalized()) {\r\n      filtered.push(localized.getObject());\r\n    } else {\r\n      filtered.push({ uuid: original.uuid });\r\n    }\r\n  }\r\n  return filtered;\r\n};\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport * as React from 'react';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { RouterFormProps } from 'components/flow/props';\nimport { GROUP_LABEL } from 'components/flow/routers/constants';\nimport { nodeToState, stateToNode } from 'components/flow/routers/groups/helpers';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { Asset } from 'store/flowContext';\nimport { AssetArrayEntry, FormState, mergeForm, StringEntry } from 'store/nodeEditor';\nimport { Required, validate } from 'store/validators';\nimport i18n from 'config/i18n';\nimport { renderIssues } from 'components/flow/actions/helpers';\n\n// TODO: Remove use of Function\n// tslint:disable:ban-types\nexport interface GroupsRouterFormState extends FormState {\n  groups: AssetArrayEntry;\n  resultName: StringEntry;\n}\n\nexport default class GroupsRouterForm extends React.Component<\n  RouterFormProps,\n  GroupsRouterFormState\n> {\n  public static contextTypes = {\n    endpoints: fakePropType,\n    assetService: fakePropType\n  };\n\n  constructor(props: RouterFormProps) {\n    super(props);\n    this.state = nodeToState(this.props.nodeSettings);\n\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  private handleGroupsChanged(groups: Asset[]): void {\n    this.handleUpdate({ groups });\n  }\n\n  private handleUpdateResultName(resultName: string): void {\n    this.handleUpdate({ resultName });\n  }\n\n  private handleUpdate(keys: { groups?: Asset[]; resultName?: string }): boolean {\n    const updates: Partial<GroupsRouterFormState> = {};\n\n    if (keys.hasOwnProperty('groups')) {\n      updates.groups = validate(i18n.t('forms.collections', 'Groups'), keys.groups, [Required]);\n    }\n\n    if (keys.hasOwnProperty('resultName')) {\n      updates.resultName = { value: keys.resultName };\n    }\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private handleSave(): void {\n    if (this.state.valid) {\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <p>{GROUP_LABEL}</p>\n        <AssetSelector\n          name={i18n.t('forms.groups', 'Groups')}\n          assets={this.props.assetStore.groups}\n          entry={this.state.groups}\n          searchable={true}\n          onChange={this.handleGroupsChanged}\n          multi={true}\n          placeholder={i18n.t('select_groups', 'Select existing collections or enter a new one')}\n        />\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport Dialog, { ButtonSet, Tab } from 'components/dialog/Dialog';\r\nimport { determineTypeConfig } from 'components/flow/helpers';\r\nimport { LocalizationFormProps } from 'components/flow/props';\r\nimport TextInputElement from 'components/form/textinput/TextInputElement';\r\nimport { getOperatorConfig } from 'config/operatorConfigs';\r\nimport { Case, Category } from 'flowTypes';\r\nimport * as React from 'react';\r\nimport { FormState, mergeForm } from 'store/nodeEditor';\r\n\r\nimport {\r\n  getLocalizedObjects,\r\n  getOriginalCase,\r\n  getOriginalCategory,\r\n  LocalizedType\r\n} from './helpers';\r\nimport styles from './RouterLocalizationForm.module.scss';\r\nimport i18n from 'config/i18n';\r\nimport { renderIssues } from 'components/flow/actions/helpers';\r\n\r\nexport interface RouterLocalizationFormState extends FormState {\r\n  categories: Category[];\r\n  cases: Case[];\r\n}\r\n\r\nexport default class RouterLocalizationForm extends React.Component<\r\n  LocalizationFormProps,\r\n  RouterLocalizationFormState\r\n> {\r\n  constructor(props: LocalizationFormProps) {\r\n    super(props);\r\n\r\n    const categories: Category[] = getLocalizedObjects(\r\n      props.nodeSettings,\r\n      LocalizedType.Category\r\n    ) as Category[];\r\n    const cases: Case[] = getLocalizedObjects(props.nodeSettings, LocalizedType.Case) as Case[];\r\n\r\n    this.state = { categories, cases, valid: true };\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^handle/]\r\n    });\r\n  }\r\n\r\n  private handleUpdate(keys: { category?: Category; kase?: Case }): boolean {\r\n    const updates: Partial<RouterLocalizationFormState> = {};\r\n\r\n    if (keys.hasOwnProperty('category')) {\r\n      updates.categories = [keys.category];\r\n    }\r\n\r\n    if (keys.hasOwnProperty('kase')) {\r\n      updates.cases = [keys.kase];\r\n    }\r\n\r\n    const updated = mergeForm(this.state, updates);\r\n    this.setState(updated);\r\n    return updated.valid;\r\n  }\r\n\r\n  private handleUpdateCategoryName(category: Category, name: string): boolean {\r\n    category.name = name;\r\n    return this.handleUpdate({ category });\r\n  }\r\n\r\n  private handleUpdateCaseArgument(kase: Case, arg: string): boolean {\r\n    kase.arguments = [arg];\r\n    return this.handleUpdate({ kase });\r\n  }\r\n\r\n  private handleSave(): void {\r\n    // collect up our category localizations\r\n    const translations: any[] = this.state.categories.map((cat: Category) => {\r\n      return cat.name\r\n        ? {\r\n            uuid: cat.uuid,\r\n            translations: {\r\n              name: cat.name\r\n            }\r\n          }\r\n        : { uuid: cat.uuid };\r\n    });\r\n\r\n    // same thing for any cases\r\n    translations.push(\r\n      ...this.state.cases.map((kase: Case) => {\r\n        return kase.arguments\r\n          ? {\r\n              uuid: kase.uuid,\r\n              translations: {\r\n                arguments: kase.arguments\r\n              }\r\n            }\r\n          : { uuid: kase.uuid };\r\n      })\r\n    );\r\n\r\n    this.props.updateLocalizations(this.props.language.id, translations);\r\n\r\n    // notify our modal we are done\r\n    this.props.onClose(false);\r\n  }\r\n\r\n  private getButtons(): ButtonSet {\r\n    return {\r\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\r\n      secondary: {\r\n        name: i18n.t('buttons.cancel', 'Cancel'),\r\n        onClick: () => this.props.onClose(true)\r\n      }\r\n    };\r\n  }\r\n\r\n  public renderCases(): JSX.Element[] {\r\n    return this.state.cases.map((kase: Case) => {\r\n      const originalCase = getOriginalCase(this.props.nodeSettings, kase.uuid) as Case;\r\n\r\n      const { verboseName } = getOperatorConfig(originalCase.type);\r\n\r\n      const [orginalArgument] = originalCase.arguments;\r\n\r\n      let argument = '';\r\n      if (kase.arguments && kase.arguments.length > 0) {\r\n        argument = kase.arguments[0];\r\n      }\r\n      const translation = i18n.t('forms.translation', 'Translation');\r\n\r\n      return (\r\n        <div\r\n          key={`translate_${kase.uuid}`}\r\n          data-spec=\"operator-field\"\r\n          className={styles.translating_operator_container}\r\n        >\r\n          <div data-spec=\"verbose-name\" className={styles.translating_operator}>\r\n            {verboseName}\r\n          </div>\r\n          <div data-spec=\"argument-to-translate\" className={styles.translating_from}>\r\n            {orginalArgument}\r\n          </div>\r\n          <div className={styles.translating_to}>\r\n            <TextInputElement\r\n              data-spec=\"localize-case\"\r\n              name={kase.uuid}\r\n              placeholder={`${this.props.language.name} ${translation}`}\r\n              showLabel={false}\r\n              onChange={(arg: string) => this.handleUpdateCaseArgument(kase, arg)}\r\n              entry={{ value: argument }}\r\n            />\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n  }\r\n\r\n  public renderCategories(): JSX.Element[] {\r\n    return this.state.categories.map((cat: Category) => {\r\n      const originalCategory = getOriginalCategory(this.props.nodeSettings, cat.uuid);\r\n\r\n      const placeholder = `${this.props.language.name} Translation`;\r\n\r\n      if (!cat.name) {\r\n        cat.name = '';\r\n      }\r\n\r\n      return (\r\n        <div key={cat.uuid} className={styles.translating_category}>\r\n          <div data-spec=\"category-name\" className={styles.translating_from}>\r\n            {originalCategory.name}\r\n          </div>\r\n          <div className={styles.translating_to}>\r\n            <TextInputElement\r\n              data-spec=\"localize-category\"\r\n              name={cat.name}\r\n              placeholder={placeholder}\r\n              showLabel={false}\r\n              entry={{ value: cat.name }}\r\n              onChange={(name: string) => this.handleUpdateCategoryName(cat, name)}\r\n            />\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const typeConfig = determineTypeConfig(this.props.nodeSettings);\r\n\r\n    const tabs: Tab[] = [];\r\n\r\n    if (this.state.cases.length > 0) {\r\n      tabs.push({\r\n        name: 'Rule Translations',\r\n        body: (\r\n          <>\r\n            <p data-spec=\"instructions\">\r\n              Sometimes languages need special rules to route things properly. If a translation is\r\n              not provided, the original rule will be used.\r\n            </p>\r\n            {this.renderCases()}\r\n          </>\r\n        )\r\n      });\r\n    }\r\n\r\n    const categories = (\r\n      <Dialog\r\n        title={`${this.props.language.name} Category Names`}\r\n        headerClass={typeConfig.type}\r\n        buttons={this.getButtons()}\r\n        tabs={tabs}\r\n      >\r\n        <p data-spec=\"instructions\">\r\n          When category names are referenced later in the flow, the appropriate language for the\r\n          category will be used. If no translation is provided, the original text will be used.\r\n        </p>\r\n        {this.renderCategories()}\r\n        {renderIssues(this.props)}\r\n      </Dialog>\r\n    );\r\n\r\n    // if we have cases, use a flipper\r\n    return categories;\r\n  }\r\n}\r\n","import { CaseProps } from 'components/flow/routers/caselist/CaseList';\r\nimport { createRenderNode, resolveRoutes } from 'components/flow/routers/helpers';\r\nimport { Operators, Types } from 'config/interfaces';\r\nimport { getType } from 'config/typeConfigs';\r\nimport { Case, Category, HintTypes, Router, RouterTypes, SwitchRouter, WaitTypes } from 'flowTypes';\r\nimport { RenderNode } from 'store/flowContext';\r\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\r\nimport { createUUID } from 'utils';\r\n\r\nimport { MenuRouterFormState } from './MenuRouterForm';\r\nimport { MENU_OPERAND } from 'components/nodeeditor/constants';\r\n\r\nexport const nodeToState = (settings: NodeEditorSettings): MenuRouterFormState => {\r\n  let resultName: StringEntry = { value: '' };\r\n\r\n  const menu: string[] = [];\r\n  for (let i = 0; i < 10; i++) {\r\n    menu.push('');\r\n  }\r\n\r\n  if (getType(settings.originalNode) === Types.wait_for_menu) {\r\n    const router = settings.originalNode.node.router as SwitchRouter;\r\n    for (const kase of router.cases) {\r\n      let idx = parseInt(kase.arguments[0], 10) - 1;\r\n      if (idx === -1) {\r\n        idx = menu.length - 1;\r\n      }\r\n\r\n      menu[idx] = settings.originalNode.node.router.categories.find(\r\n        (category: Category) => category.uuid === kase.category_uuid\r\n      ).name;\r\n    }\r\n    resultName = { value: router.result_name || '' };\r\n  }\r\n\r\n  return {\r\n    resultName,\r\n    menu,\r\n    valid: true\r\n  };\r\n};\r\n\r\nexport const stateToNode = (\r\n  settings: NodeEditorSettings,\r\n  state: MenuRouterFormState\r\n): RenderNode => {\r\n  const optionalRouter: Pick<Router, 'result_name'> = {};\r\n  if (state.resultName.value) {\r\n    optionalRouter.result_name = state.resultName.value;\r\n  }\r\n\r\n  let originalCases: Case[] = [];\r\n  if (getType(settings.originalNode) === Types.wait_for_menu) {\r\n    originalCases = (settings.originalNode.node.router as SwitchRouter).cases;\r\n  }\r\n\r\n  const caseProps = menuToCases(state.menu, originalCases);\r\n  const { cases, exits, defaultCategory: defaultExit, caseConfig, categories } = resolveRoutes(\r\n    caseProps,\r\n    false,\r\n    settings.originalNode.node\r\n  );\r\n\r\n  const router: SwitchRouter = {\r\n    type: RouterTypes.switch,\r\n    operand: MENU_OPERAND,\r\n    default_category_uuid: defaultExit,\r\n    cases,\r\n    categories,\r\n    wait: { type: WaitTypes.msg, hint: { type: HintTypes.digits, count: 1 } },\r\n    ...optionalRouter\r\n  };\r\n\r\n  const newRenderNode = createRenderNode(\r\n    settings.originalNode.node.uuid,\r\n    router,\r\n    exits,\r\n    Types.wait_for_response,\r\n    [],\r\n    { cases: caseConfig }\r\n  );\r\n\r\n  return newRenderNode;\r\n};\r\n\r\nexport const menuToCases = (menu: string[] = [], previousCases: Case[]): CaseProps[] =>\r\n  menu\r\n    .map((categoryName: string, index: number) => {\r\n      const idx = index === 9 ? 0 : index + 1;\r\n\r\n      const kase =\r\n        previousCases.find((c: Case) => c.arguments[0] === '' + idx) ||\r\n        ({\r\n          uuid: createUUID(),\r\n          arguments: ['' + idx],\r\n          type: Operators.has_number_eq,\r\n          category_uuid: ''\r\n        } as Case);\r\n\r\n      return {\r\n        uuid: kase.uuid,\r\n        kase,\r\n        categoryName,\r\n        valid: true\r\n      };\r\n    })\r\n    .filter((caseProps: CaseProps) => caseProps.categoryName.trim().length > 0);\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\r\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\r\nimport { RouterFormProps } from 'components/flow/props';\r\nimport { createResultNameInput } from 'components/flow/routers/widgets';\r\nimport TextInputElement from 'components/form/textinput/TextInputElement';\r\nimport TypeList from 'components/nodeeditor/TypeList';\r\nimport { fakePropType } from 'config/ConfigProvider';\r\nimport * as React from 'react';\r\nimport { FormState, StringEntry } from 'store/nodeEditor';\r\nimport { Alphanumeric, StartIsNonNumeric, validate } from 'store/validators';\r\n\r\nimport { nodeToState, stateToNode } from './helpers';\r\nimport styles from './MenuRouterForm.module.scss';\r\nimport i18n from 'config/i18n';\r\n\r\nconst mutate = require('immutability-helper');\r\n\r\nexport interface MenuRouterFormState extends FormState {\r\n  resultName: StringEntry;\r\n  menu: string[];\r\n}\r\n\r\nexport const leadInSpecId = 'lead-in';\r\n\r\nexport default class MenuRouterForm extends React.Component<RouterFormProps, MenuRouterFormState> {\r\n  constructor(props: RouterFormProps) {\r\n    super(props);\r\n\r\n    this.state = nodeToState(this.props.nodeSettings);\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^on/, /^handle/]\r\n    });\r\n  }\r\n\r\n  public static contextTypes = {\r\n    assetService: fakePropType\r\n  };\r\n\r\n  private handleUpdateResultName(value: string): void {\r\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\r\n      Alphanumeric,\r\n      StartIsNonNumeric\r\n    ]);\r\n    this.setState({\r\n      resultName,\r\n      valid: this.state.valid && !hasErrors(resultName)\r\n    });\r\n  }\r\n\r\n  private handleSave(): void {\r\n    this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\r\n    this.props.onClose(false);\r\n  }\r\n\r\n  private getButtons(): ButtonSet {\r\n    return {\r\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\r\n      secondary: {\r\n        name: i18n.t('buttons.cancel', 'Cancel'),\r\n        onClick: () => this.props.onClose(true)\r\n      }\r\n    };\r\n  }\r\n\r\n  private handleMenuChanged(index: number, value: string): void {\r\n    const menu = mutate(this.state.menu, { [index]: { $set: value } });\r\n    this.setState({ menu });\r\n  }\r\n\r\n  private renderOption(index: number): JSX.Element {\r\n    return (\r\n      <div key={'menuoption-' + index} className={styles.menu_option}>\r\n        <div className={styles.digit}>{index === 9 ? 0 : index + 1}</div>\r\n        <div className={styles.category}>\r\n          <TextInputElement\r\n            name={'Menu ' + index}\r\n            entry={{ value: this.state.menu[index] }}\r\n            onChange={(value: string) => {\r\n              this.handleMenuChanged(index, value);\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderMenu(): any {\r\n    const options: JSX.Element[] = [];\r\n    for (let i = 0; i < 10; i++) {\r\n      options.push(this.renderOption(i));\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  public renderEdit(): JSX.Element {\r\n    const typeConfig = this.props.typeConfig;\r\n\r\n    return (\r\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\r\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\r\n        <div className={styles.menu}>{this.renderMenu()}</div>\r\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\r\n        {renderIssues(this.props)}\r\n      </Dialog>\r\n    );\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    return this.renderEdit();\r\n  }\r\n}\r\n","import { createRenderNode } from 'components/flow/routers/helpers';\nimport { RandomRouterFormState } from 'components/flow/routers/random/RandomRouterForm';\nimport { SelectOption } from 'components/form/select/SelectElement';\nimport { Types } from 'config/interfaces';\nimport { getType } from 'config/typeConfigs';\nimport { Category, Exit, Router, RouterTypes } from 'flowTypes';\nimport { RenderNode } from 'store/flowContext';\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\nimport { createUUID, range } from 'utils';\n\nexport const BUCKET_OPTIONS: SelectOption[] = range(2, 11).map((count: number) => {\n  return { value: count + '', name: count + ' buckets' };\n});\n\nexport const getOption = (value: number): SelectOption => {\n  let option = BUCKET_OPTIONS.find(\n    (bucketOption: SelectOption) => bucketOption.value === value + ''\n  );\n  if (!option) {\n    option = { name: `${value} Buckets`, value: value + '' };\n  }\n  return option;\n};\n\nexport const nodeToState = (settings: NodeEditorSettings): RandomRouterFormState => {\n  // TODO: work out an incremental result name\n  let resultName: StringEntry = { value: '' };\n  let buckets = 2;\n\n  let categories: Category[] = [];\n  if (settings.originalNode && getType(settings.originalNode) === Types.split_by_random) {\n    const router = settings.originalNode.node.router as Router;\n    resultName = { value: router.result_name || '' };\n    buckets = settings.originalNode.node.exits.length;\n\n    // use any existing random buckets if we have any\n    categories = settings.originalNode.node.router.categories;\n  }\n\n  categories = fillOutCategories(categories, buckets);\n\n  return {\n    categories,\n    resultName,\n    bucketChoice: { value: getOption(buckets) },\n    valid: true\n  };\n};\n\nexport const stateToNode = (\n  settings: NodeEditorSettings,\n  state: RandomRouterFormState\n): RenderNode => {\n  const optionalRouter: Pick<Router, 'result_name'> = {};\n  if (state.resultName.value) {\n    optionalRouter.result_name = state.resultName.value;\n  }\n\n  const exits =\n    getType(settings.originalNode) === Types.split_by_random\n      ? settings.originalNode.node.exits\n      : [];\n\n  const count = parseInt(state.bucketChoice.value.value, 10);\n  exits.splice(count, exits.length - count);\n\n  state.categories.forEach((category: Category, idx: number) => {\n    if (idx < exits.length) {\n      category.exit_uuid = exits[idx].uuid;\n    } else {\n      const newExit: Exit = {\n        uuid: createUUID(),\n        destination_uuid: null\n      };\n      category.exit_uuid = newExit.uuid;\n      exits.push(newExit);\n    }\n  });\n\n  const router: Router = {\n    type: RouterTypes.random,\n    categories: state.categories,\n    ...optionalRouter\n  };\n\n  const newRenderNode = createRenderNode(\n    settings.originalNode.node.uuid,\n    router,\n    exits,\n    Types.split_by_random,\n    [],\n    null\n  );\n\n  return newRenderNode;\n};\n\nexport const fillOutCategories = (categories: Category[], buckets: number): Category[] => {\n  // add any that we still need\n  return categories.concat(\n    range(categories.length, buckets).map((idx: number) => {\n      return { uuid: createUUID(), name: `Bucket ${idx + 1}`, exit_uuid: null };\n    })\n  );\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { RouterFormProps } from 'components/flow/props';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport SelectElement, { SelectOption } from 'components/form/select/SelectElement';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { Category } from 'flowTypes';\nimport * as React from 'react';\nimport { FormState, mergeForm, SelectOptionEntry, StringEntry } from 'store/nodeEditor';\nimport { Alphanumeric, StartIsNonNumeric, validate } from 'store/validators';\n\nimport { BUCKET_OPTIONS, fillOutCategories, nodeToState, stateToNode } from './helpers';\nimport styles from './RandomRouterForm.module.scss';\nimport i18n from 'config/i18n';\nimport { TembaSelectStyle } from 'temba/TembaSelect';\n\n// TODO: Remove use of Function\n// tslint:disable:ban-types\nexport enum InputToFocus {\n  args = 'args',\n  min = 'min',\n  max = 'max',\n  exit = 'exit'\n}\n\nexport interface RandomRouterFormState extends FormState {\n  bucketChoice: SelectOptionEntry;\n  resultName: StringEntry;\n  categories: Category[];\n}\n\nexport const leadInSpecId = 'lead-in';\n\nexport default class RandomRouterForm extends React.Component<\n  RouterFormProps,\n  RandomRouterFormState\n> {\n  constructor(props: RouterFormProps) {\n    super(props);\n\n    this.state = nodeToState(this.props.nodeSettings);\n\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  public static contextTypes = {\n    assetService: fakePropType\n  };\n\n  private handleUpdateResultName(value: string): void {\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\n      Alphanumeric,\n      StartIsNonNumeric\n    ]);\n    this.setState({\n      resultName,\n      valid: this.state.valid && !hasErrors(resultName)\n    });\n  }\n\n  private handleBucketsChanged(selected: SelectOption): boolean {\n    // create new exits if needed\n\n    const count = parseInt(selected.value, 10);\n\n    let categories = this.state.categories.concat([]);\n\n    // prune off if we have too many\n    categories = categories.slice(0, count);\n\n    // add any that we still need\n    categories = fillOutCategories(categories, count);\n\n    const updates: Partial<RandomRouterFormState> = {\n      bucketChoice: { value: selected }\n    };\n\n    const updated = mergeForm(this.state, updates);\n    this.setState({ ...updated, categories });\n\n    return updated.valid;\n  }\n\n  public handleSave(): void {\n    this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n    this.props.onClose(false);\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  private handleBucketNameChanged(category: Category, value: string): void {\n    const categories = this.state.categories;\n    categories.find((cat: Category) => cat.uuid === category.uuid).name = value;\n    this.setState({ categories });\n  }\n\n  private renderBucketNames(): any {\n    return this.state.categories.map((cat: Category) => (\n      <TextInputElement\n        key={cat.uuid}\n        __className={styles.bucket_name}\n        name={cat.uuid}\n        entry={{ value: cat.name }}\n        onChange={(value: string) => {\n          this.handleBucketNameChanged(cat, value);\n        }}\n      />\n    ));\n  }\n\n  public renderEdit(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    const OPTIONS = BUCKET_OPTIONS.concat([]);\n    if (BUCKET_OPTIONS.indexOf(this.state.bucketChoice.value) === -1) {\n      OPTIONS.push(this.state.bucketChoice.value);\n    }\n\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <div className={styles.options}>\n          <div className={styles.lead_in}>Split them randomly into one of</div>\n          <div className={styles.bucket_select}>\n            <SelectElement\n              key=\"buckets_select\"\n              style={TembaSelectStyle.small}\n              name={i18n.t('forms.buckets', 'Buckets')}\n              entry={this.state.bucketChoice}\n              onChange={this.handleBucketsChanged}\n              options={OPTIONS}\n            />\n          </div>\n        </div>\n        <div className={styles.bucket_list}>{this.renderBucketNames()}</div>\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n\n  public render(): JSX.Element {\n    return this.renderEdit();\n  }\n}\n","import { CaseProps } from 'components/flow/routers/caselist/CaseList';\r\nimport {\r\n  createCaseProps,\r\n  createRenderNode,\r\n  hasCases,\r\n  resolveRoutes\r\n} from 'components/flow/routers/helpers';\r\nimport { ResponseRouterFormState } from 'components/flow/routers/response/ResponseRouterForm';\r\nimport { DEFAULT_OPERAND } from 'components/nodeeditor/constants';\r\nimport { Types } from 'config/interfaces';\r\nimport { getType } from 'config/typeConfigs';\r\nimport { Router, RouterTypes, SwitchRouter, Wait, WaitTypes } from 'flowTypes';\r\nimport { RenderNode } from 'store/flowContext';\r\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\r\n\r\nexport const nodeToState = (settings: NodeEditorSettings): ResponseRouterFormState => {\r\n  let initialCases: CaseProps[] = [];\r\n\r\n  // TODO: work out an incremental result name\r\n  let resultName: StringEntry = { value: 'Result' };\r\n  let timeout = 0;\r\n\r\n  if (settings.originalNode && getType(settings.originalNode) === Types.wait_for_response) {\r\n    const router = settings.originalNode.node.router as SwitchRouter;\r\n    if (router) {\r\n      if (hasCases(settings.originalNode.node)) {\r\n        initialCases = createCaseProps(router.cases, settings.originalNode);\r\n      }\r\n\r\n      resultName = { value: router.result_name || '' };\r\n    }\r\n\r\n    if (settings.originalNode.node.router.wait && settings.originalNode.node.router.wait.timeout) {\r\n      timeout = settings.originalNode.node.router.wait.timeout.seconds || 0;\r\n    }\r\n  }\r\n\r\n  return {\r\n    cases: initialCases,\r\n    resultName,\r\n    timeout,\r\n    valid: true\r\n  };\r\n};\r\n\r\nexport const stateToNode = (\r\n  settings: NodeEditorSettings,\r\n  state: ResponseRouterFormState\r\n): RenderNode => {\r\n  const { cases, exits, defaultCategory, timeoutCategory, caseConfig, categories } = resolveRoutes(\r\n    state.cases,\r\n    state.timeout > 0,\r\n    settings.originalNode.node\r\n  );\r\n\r\n  const optionalRouter: Pick<Router, 'result_name'> = {};\r\n  if (state.resultName.value) {\r\n    optionalRouter.result_name = state.resultName.value;\r\n  }\r\n\r\n  const wait = { type: WaitTypes.msg } as Wait;\r\n  if (state.timeout > 0) {\r\n    wait.timeout = {\r\n      seconds: state.timeout,\r\n      category_uuid: timeoutCategory\r\n    };\r\n  }\r\n\r\n  const router: SwitchRouter = {\r\n    type: RouterTypes.switch,\r\n    default_category_uuid: defaultCategory,\r\n    cases,\r\n    categories,\r\n    operand: DEFAULT_OPERAND,\r\n    wait,\r\n    ...optionalRouter\r\n  };\r\n\r\n  const newRenderNode = createRenderNode(\r\n    settings.originalNode.node.uuid,\r\n    router,\r\n    exits,\r\n    Types.wait_for_response,\r\n    [],\r\n    { cases: caseConfig }\r\n  );\r\n\r\n  return newRenderNode;\r\n};\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport * as React from 'react';\r\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\r\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\r\nimport { RouterFormProps } from 'components/flow/props';\r\nimport CaseList, { CaseProps } from 'components/flow/routers/caselist/CaseList';\r\nimport { nodeToState, stateToNode } from 'components/flow/routers/response/helpers';\r\nimport { createResultNameInput } from 'components/flow/routers/widgets';\r\nimport TimeoutControl from 'components/form/timeout/TimeoutControl';\r\nimport TypeList from 'components/nodeeditor/TypeList';\r\nimport { FormState, StringEntry } from 'store/nodeEditor';\r\nimport { Alphanumeric, StartIsNonNumeric, validate } from 'store/validators';\r\nimport { WAIT_LABEL } from 'components/flow/routers/constants';\r\nimport i18n from 'config/i18n';\r\n\r\n// TODO: Remove use of Function\r\n// tslint:disable:ban-types\r\nexport enum InputToFocus {\r\n  args = 'args',\r\n  min = 'min',\r\n  max = 'max',\r\n  exit = 'exit'\r\n}\r\n\r\nexport interface ResponseRouterFormState extends FormState {\r\n  cases: CaseProps[];\r\n  resultName: StringEntry;\r\n  timeout: number;\r\n}\r\n\r\nexport const leadInSpecId = 'lead-in';\r\n\r\nexport default class ResponseRouterForm extends React.Component<\r\n  RouterFormProps,\r\n  ResponseRouterFormState\r\n> {\r\n  constructor(props: RouterFormProps) {\r\n    super(props);\r\n\r\n    this.state = nodeToState(this.props.nodeSettings);\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^on/, /^handle/]\r\n    });\r\n  }\r\n\r\n  private handleUpdateResultName(value: string): void {\r\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\r\n      Alphanumeric,\r\n      StartIsNonNumeric\r\n    ]);\r\n    this.setState({\r\n      resultName,\r\n      valid: this.state.valid && !hasErrors(resultName)\r\n    });\r\n  }\r\n\r\n  private handleUpdateTimeout(timeout: number): void {\r\n    this.setState({ timeout });\r\n  }\r\n\r\n  private handleCasesUpdated(cases: CaseProps[]): void {\r\n    const invalidCase = cases.find((caseProps: CaseProps) => !caseProps.valid);\r\n    this.setState({ cases, valid: !invalidCase });\r\n  }\r\n\r\n  private handleSave(): void {\r\n    if (this.state.valid) {\r\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\r\n      this.props.onClose(false);\r\n    }\r\n  }\r\n\r\n  private getButtons(): ButtonSet {\r\n    return {\r\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\r\n      secondary: {\r\n        name: i18n.t('buttons.cancel', 'Cancel'),\r\n        onClick: () => this.props.onClose(true)\r\n      }\r\n    };\r\n  }\r\n\r\n  public renderEdit(): JSX.Element {\r\n    const typeConfig = this.props.typeConfig;\r\n\r\n    return (\r\n      <Dialog\r\n        title={typeConfig.name}\r\n        headerClass={typeConfig.type}\r\n        buttons={this.getButtons()}\r\n        gutter={\r\n          <TimeoutControl timeout={this.state.timeout} onChanged={this.handleUpdateTimeout} />\r\n        }\r\n      >\r\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\r\n        <div>{WAIT_LABEL}</div>\r\n        <CaseList\r\n          data-spec=\"cases\"\r\n          cases={this.state.cases}\r\n          onCasesUpdated={this.handleCasesUpdated}\r\n        />\r\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\r\n        {renderIssues(this.props)}\r\n      </Dialog>\r\n    );\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    return this.renderEdit();\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport CheckboxElement from 'components/form/checkbox/CheckboxElement';\nimport * as React from 'react';\nimport { renderIf } from 'utils';\n\nimport styles from './TimeoutControl.module.scss';\nimport i18n from 'config/i18n';\nimport TembaSelect, { TembaSelectStyle } from 'temba/TembaSelect';\nimport { SelectOption } from '../select/SelectElement';\n\nexport const TIMEOUT_OPTIONS: SelectOption[] = [\n  { value: '60', name: i18n.t('forms.timeout_1 minute', '1 minute') },\n  { value: '120', name: i18n.t('forms.timeout_2 minutes', '2 minutes') },\n  { value: '180', name: i18n.t('forms.timeout_3 minutes', '3 minutes') },\n  { value: '240', name: i18n.t('forms.timeout_4 minutes', '4 minutes') },\n  { value: '300', name: i18n.t('forms.timeout_5 minutes', '5 minutes') },\n  { value: '600', name: i18n.t('forms.timeout_10 minutes', '10 minutes') },\n  { value: '900', name: i18n.t('forms.timeout_15 minutes', '15 minutes') },\n  { value: '3600', name: i18n.t('forms.timeout_1 hour', '1 hour') },\n  { value: '7200', name: i18n.t('forms.timeout_2 hours', '2 hours') },\n  { value: '10800', name: i18n.t('forms.timeout_3 hours', '3 hours') },\n  { value: '21600', name: i18n.t('forms.timeout_6 hours', '6 hours') },\n  { value: '43200', name: i18n.t('forms.timeout_12 hours', '12 hours') },\n  { value: '64800', name: i18n.t('forms.timeout_18 hours', '18 hours') },\n  { value: '86400', name: i18n.t('forms.timeout_1 day', '1 day') },\n  { value: '172800', name: i18n.t('forms.timeout_2 days', '2 days') },\n  { value: '259200', name: i18n.t('forms.timeout_3 days', '3 days') },\n  { value: '604800', name: i18n.t('forms.timeout_1 week', '1 week') }\n];\n\nexport const DEFAULT_TIMEOUT = TIMEOUT_OPTIONS[4];\n\nexport const ellipsize = (str: string) => `${str}...`;\n\nexport interface TimeoutControlProps {\n  timeout: number;\n  onChanged(timeout: number): void;\n}\n\nexport default class TimeoutControl extends React.Component<TimeoutControlProps> {\n  constructor(props: TimeoutControlProps) {\n    super(props);\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  private getSelected(timeout: number): any {\n    for (const [idx, { value }] of TIMEOUT_OPTIONS.entries()) {\n      if (value === '' + timeout) {\n        return TIMEOUT_OPTIONS[idx];\n      }\n    }\n    return null;\n  }\n\n  private isChecked(): boolean {\n    return this.props.timeout > 0;\n  }\n\n  private getInstructions(): string {\n    const base = 'Continue when there is no response';\n    return this.isChecked() ? `${base} for` : ellipsize(base);\n  }\n\n  private handleChecked(): void {\n    if (this.props.timeout > 0) {\n      this.props.onChanged(0);\n    } else {\n      this.props.onChanged(parseInt(DEFAULT_TIMEOUT.value));\n    }\n  }\n\n  private handleTimeoutChanged(selected: any): void {\n    this.props.onChanged(parseInt(selected.value));\n  }\n\n  public render(): JSX.Element {\n    return (\n      <div className={styles.timeout_control_container}>\n        <div className={styles.left_section}>\n          <CheckboxElement\n            name={i18n.t('forms.timeout', 'Timeout')}\n            checked={this.isChecked()}\n            description={this.getInstructions()}\n            checkboxClassName={styles.checkbox}\n            onChange={this.handleChecked}\n          />\n        </div>\n        {renderIf(this.isChecked())(\n          <div className={styles.drop_down}>\n            <TembaSelect\n              name={i18n.t('forms.timeout', 'Timeout')}\n              style={TembaSelectStyle.small}\n              value={this.getSelected(this.props.timeout)}\n              options={TIMEOUT_OPTIONS}\n              onChange={this.handleTimeoutChanged}\n            ></TembaSelect>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n","import { createWebhookBasedNode } from 'components/flow/routers/helpers';\nimport { Types } from 'config/interfaces';\nimport { CallResthook } from 'flowTypes';\nimport { RenderNode } from 'store/flowContext';\nimport { FormEntry, NodeEditorSettings } from 'store/nodeEditor';\nimport { createUUID } from 'utils';\n\nimport { ResthookRouterFormState } from './ResthookRouterForm';\n\nexport const nodeToState = (settings: NodeEditorSettings): ResthookRouterFormState => {\n  let resthookAsset: FormEntry = { value: null };\n  let resultName = { value: 'Result' };\n  let valid = false;\n\n  const originalAction = getOriginalAction(settings) as CallResthook;\n  if (originalAction && originalAction.type === Types.call_resthook) {\n    const resthook = originalAction.resthook;\n    resthookAsset = {\n      value: { resthook }\n    };\n    resultName = { value: originalAction.result_name };\n    valid = true;\n  }\n\n  return {\n    resthook: resthookAsset,\n    resultName,\n    valid\n  };\n};\n\nexport const stateToNode = (\n  settings: NodeEditorSettings,\n  state: ResthookRouterFormState\n): RenderNode => {\n  let uuid = createUUID();\n  const originalAction = getOriginalAction(settings);\n  if (originalAction) {\n    uuid = originalAction.uuid;\n  }\n\n  const newAction: CallResthook = {\n    uuid,\n    resthook: state.resthook.value.resthook,\n    type: Types.call_resthook,\n    result_name: state.resultName.value\n  };\n\n  return createWebhookBasedNode(newAction, settings.originalNode, false);\n};\n\nexport const getOriginalAction = (settings: NodeEditorSettings): CallResthook => {\n  const action =\n    settings.originalAction ||\n    (settings.originalNode.node.actions.length > 0 && settings.originalNode.node.actions[0]);\n\n  if (action.type === Types.call_resthook) {\n    return action as CallResthook;\n  }\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { RouterFormProps } from 'components/flow/props';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport * as React from 'react';\nimport { FormEntry, FormState, mergeForm, StringEntry } from 'store/nodeEditor';\nimport {\n  Alphanumeric,\n  Required,\n  shouldRequireIf,\n  StartIsNonNumeric,\n  validate\n} from 'store/validators';\n\nimport { nodeToState, stateToNode } from './helpers';\nimport styles from './ResthookRouterForm.module.scss';\nimport i18n from 'config/i18n';\nimport { SelectOption } from 'components/form/select/SelectElement';\n\n// TODO: Remove use of Function\nexport interface ResthookRouterFormState extends FormState {\n  resthook: FormEntry;\n  resultName: StringEntry;\n}\n\nexport default class ResthookRouterForm extends React.PureComponent<\n  RouterFormProps,\n  ResthookRouterFormState\n> {\n  options: SelectOption[] = [];\n  constructor(props: RouterFormProps) {\n    super(props);\n\n    this.state = nodeToState(props.nodeSettings);\n\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  public componentDidMount(): void {\n    const items = this.props.assetStore.resthooks ? this.props.assetStore.resthooks.items : {};\n    this.options = Object.keys(items).map((key: string) => {\n      return { name: items[key].name, value: key };\n    });\n  }\n\n  private handleUpdateResultName(result: string): void {\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), result, [\n      Required,\n      Alphanumeric,\n      StartIsNonNumeric\n    ]);\n    this.setState({\n      resultName,\n      valid: this.state.valid && !hasErrors(resultName)\n    });\n  }\n\n  public handleResthookChanged(selected: any[], submitting = false): boolean {\n    const updates: Partial<ResthookRouterFormState> = {\n      resthook: validate(i18n.t('forms.resthook', 'Resthook'), selected[0], [\n        shouldRequireIf(submitting)\n      ])\n    };\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private handleSave(): void {\n    // validate our resthook in case they haven't interacted\n    const valid = this.handleResthookChanged([this.state.resthook.value], true);\n\n    if (valid) {\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  public getButtons(): ButtonSet {\n    return {\n      primary: { name: 'Ok', onClick: this.handleSave },\n      secondary: { name: 'Cancel', onClick: () => this.props.onClose(true) }\n    };\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <AssetSelector\n          name={i18n.t('forms.resthook', 'Resthook')}\n          placeholder={i18n.t('forms.resthook_to_call', 'Select the resthook to call')}\n          assets={this.props.assetStore.resthooks}\n          entry={this.state.resthook}\n          searchable={true}\n          onChange={this.handleResthookChanged}\n          nameKey=\"resthook\"\n          valueKey=\"resthook\"\n        />\n        <div className={styles.result_name}>\n          {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\n        </div>\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { CaseProps } from 'components/flow/routers/caselist/CaseList';\nimport {\n  createCaseProps,\n  createRenderNode,\n  hasCases,\n  resolveRoutes\n} from 'components/flow/routers/helpers';\nimport { SelectOption } from 'components/form/select/SelectElement';\nimport { Types } from 'config/interfaces';\nimport { getType } from 'config/typeConfigs';\nimport { Router, RouterTypes, SwitchRouter } from 'flowTypes';\nimport { AssetStore, AssetType, RenderNode } from 'store/flowContext';\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\n\nimport { ResultRouterFormState } from './ResultRouterForm';\n\nexport const FIELD_NUMBER_OPTIONS: SelectOption[] = [\n  { value: '0', name: 'first' },\n  { value: '1', name: 'second' },\n  { value: '2', name: 'third' },\n  { value: '3', name: 'fourth' },\n  { value: '4', name: 'fifth' },\n  { value: '5', name: 'sixth' },\n  { value: '6', name: 'seventh' },\n  { value: '7', name: 'eighth' },\n  { value: '8', name: 'ninth' },\n  { value: '9', name: 'tenth' },\n  { value: '10', name: '11th' },\n  { value: '11', name: '12th' },\n  { value: '12', name: '13th' },\n  { value: '13', name: '14th' },\n  { value: '14', name: '15th' },\n  { value: '15', name: '16th' },\n  { value: '16', name: '17th' },\n  { value: '17', name: '18th' },\n  { value: '18', name: '19th' },\n  { value: '19', name: '20th' }\n];\n\nexport const getFieldOption = (value: number): SelectOption => {\n  return FIELD_NUMBER_OPTIONS.find((option: SelectOption) => option.value === '' + value);\n};\n\nexport const DELIMITER_OPTIONS: SelectOption[] = [\n  { value: ' ', name: 'spaces' },\n  { value: '.', name: 'periods' },\n  { value: '+', name: 'plusses' }\n];\n\nexport const getDelimiterOption = (value: string): SelectOption => {\n  return DELIMITER_OPTIONS.find((option: SelectOption) => option.value === value);\n};\n\nexport const nodeToState = (\n  settings: NodeEditorSettings,\n  assetStore: AssetStore\n): ResultRouterFormState => {\n  let initialCases: CaseProps[] = [];\n\n  // TODO: work out an incremental result name\n  let resultName: StringEntry = { value: '' };\n\n  let result: any = null;\n  let fieldNumber = 1;\n  let delimiter = ' ';\n  let shouldDelimit = false;\n\n  const type = getType(settings.originalNode);\n\n  if (\n    (settings.originalNode && type === Types.split_by_run_result) ||\n    type === Types.split_by_run_result_delimited\n  ) {\n    const router = settings.originalNode.node.router as SwitchRouter;\n\n    if (router) {\n      if (hasCases(settings.originalNode.node)) {\n        initialCases = createCaseProps(router.cases, settings.originalNode);\n      }\n\n      resultName = { value: router.result_name || '' };\n    }\n\n    const config = settings.originalNode.ui.config;\n    if (config && config.operand) {\n      if (config.operand.id in assetStore.results.items) {\n        result = assetStore.results.items[config.operand.id];\n      } else {\n        result = null;\n      }\n    }\n\n    if (type === Types.split_by_run_result_delimited) {\n      fieldNumber = config.index;\n      delimiter = config.delimiter;\n      shouldDelimit = true;\n    }\n  }\n\n  return {\n    cases: initialCases,\n    resultName,\n    result: { value: result },\n    shouldDelimit,\n    fieldNumber,\n    delimiter,\n    valid: true\n  };\n};\n\nexport const stateToNode = (\n  settings: NodeEditorSettings,\n  state: ResultRouterFormState\n): RenderNode => {\n  const { cases, exits, defaultCategory: defaultExit, caseConfig, categories } = resolveRoutes(\n    state.cases,\n    false,\n    settings.originalNode.node\n  );\n\n  const optionalRouter: Pick<Router, 'result_name'> = {};\n  if (state.resultName.value) {\n    optionalRouter.result_name = state.resultName.value;\n  }\n\n  let nodeType = Types.split_by_run_result;\n\n  const result = state.result.value;\n  let operand = `@results.${result.id}`;\n\n  const config: any = {\n    operand: {\n      name: result.name,\n      id: result.id,\n      type: AssetType.Result\n    },\n    cases: caseConfig\n  };\n\n  if (state.shouldDelimit) {\n    config.index = state.fieldNumber;\n    config.delimiter = state.delimiter;\n    operand = `@(field(results.${result.id}, ${state.fieldNumber}, \"${state.delimiter}\"))`;\n    nodeType = Types.split_by_run_result_delimited;\n  }\n\n  const router: SwitchRouter = {\n    type: RouterTypes.switch,\n    default_category_uuid: defaultExit,\n    categories,\n    cases,\n    operand,\n    ...optionalRouter\n  };\n\n  const newRenderNode = createRenderNode(\n    settings.originalNode.node.uuid,\n    router,\n    exits,\n    nodeType,\n    [],\n    config\n  );\n\n  return newRenderNode;\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet, Tab } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { RouterFormProps } from 'components/flow/props';\nimport CaseList, { CaseProps } from 'components/flow/routers/caselist/CaseList';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport CheckboxElement from 'components/form/checkbox/CheckboxElement';\nimport SelectElement, { SelectOption } from 'components/form/select/SelectElement';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport * as React from 'react';\nimport { Asset } from 'store/flowContext';\nimport { FormEntry, FormState, mergeForm, StringEntry } from 'store/nodeEditor';\nimport { Alphanumeric, shouldRequireIf, StartIsNonNumeric, validate } from 'store/validators';\n\nimport {\n  DELIMITER_OPTIONS,\n  FIELD_NUMBER_OPTIONS,\n  getDelimiterOption,\n  getFieldOption,\n  nodeToState,\n  stateToNode\n} from './helpers';\nimport styles from './ResultRouterForm.module.scss';\nimport i18n from 'config/i18n';\nimport { TembaSelectStyle } from 'temba/TembaSelect';\n\nexport interface ResultRouterFormState extends FormState {\n  result: FormEntry;\n  cases: CaseProps[];\n  resultName: StringEntry;\n  shouldDelimit: boolean;\n\n  fieldNumber: number;\n  delimiter: string;\n}\n\nexport const leadInSpecId = 'lead-in';\n\nexport default class ResultRouterForm extends React.Component<\n  RouterFormProps,\n  ResultRouterFormState\n> {\n  options: SelectOption[] = [];\n\n  constructor(props: RouterFormProps) {\n    super(props);\n\n    this.state = nodeToState(this.props.nodeSettings, this.props.assetStore);\n\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  public componentDidMount(): void {\n    const items = this.props.assetStore.results.items;\n    this.options = Object.keys(items).map((key: string) => {\n      return { name: items[key].name, value: key };\n    });\n  }\n\n  private handleUpdateResultName(value: string): void {\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\n      Alphanumeric,\n      StartIsNonNumeric\n    ]);\n    this.setState({\n      resultName,\n      valid: this.state.valid && !hasErrors(resultName)\n    });\n  }\n\n  private handleResultChanged(selected: Asset[], submitting = false): boolean {\n    const updates: Partial<ResultRouterFormState> = {\n      result: validate(i18n.t('forms.result_to_split_on', 'Result to split on'), selected[0], [\n        shouldRequireIf(submitting)\n      ])\n    };\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private handleCasesUpdated(cases: CaseProps[]): void {\n    this.setState({ cases });\n  }\n\n  private handleSave(): void {\n    const valid = this.handleResultChanged([this.state.result.value], true);\n    if (valid) {\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  private handleShouldDelimitChanged(checked: boolean): void {\n    this.setState({ shouldDelimit: checked });\n  }\n\n  private handleFieldNumberChanged(selected: SelectOption): void {\n    this.setState({ fieldNumber: parseInt(selected.value, 10) });\n  }\n\n  private handleDelimiterChanged(selected: SelectOption): void {\n    this.setState({ delimiter: selected.value });\n  }\n\n  private renderField(): JSX.Element {\n    return (\n      <div className={styles.non_delimited}>\n        <div className={styles.lead_in}>If the flow result</div>\n        <div className={styles.result_select}>\n          <AssetSelector\n            entry={this.state.result}\n            style={TembaSelectStyle.small}\n            name={i18n.t('forms.flow_result', 'Flow Result')}\n            placeholder=\"Select Result\"\n            searchable={false}\n            assets={this.props.assetStore.results}\n            onChange={this.handleResultChanged}\n            additionalOptions={this.options}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  private renderFieldDelimited(): JSX.Element {\n    return (\n      <div className={styles.delimited}>\n        <div className={styles.lead_in}>If the</div>\n        <div className={styles.field_number}>\n          <SelectElement\n            key=\"field_number_select\"\n            style={TembaSelectStyle.small}\n            name={i18n.t('forms.field_number', 'Field Number')}\n            entry={{ value: getFieldOption(this.state.fieldNumber) }}\n            onChange={this.handleFieldNumberChanged}\n            options={FIELD_NUMBER_OPTIONS}\n          />\n        </div>\n        <div className={styles.lead_in_sub}>field of</div>\n        <div className={styles.result_select_delimited}>\n          <AssetSelector\n            entry={this.state.result}\n            style={TembaSelectStyle.small}\n            name={i18n.t('forms.flow_result', 'Flow Result')}\n            placeholder={i18n.t('forms.select_result', 'Select Result')}\n            searchable={false}\n            assets={this.props.assetStore.results}\n            onChange={this.handleResultChanged}\n            additionalOptions={this.options}\n          />\n        </div>\n        <div className={styles.lead_in_sub}>delimited by</div>\n        <div className={styles.delimiter}>\n          <SelectElement\n            key=\"delimiter_select\"\n            style={TembaSelectStyle.small}\n            name={i18n.t('forms.delimiter', 'Delimiter')}\n            entry={{ value: getDelimiterOption(this.state.delimiter) }}\n            onChange={this.handleDelimiterChanged}\n            options={DELIMITER_OPTIONS}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n    const advanced: Tab = {\n      name: 'Advanced',\n      body: (\n        <div className={styles.should_delimit}>\n          <CheckboxElement\n            name={i18n.t('forms.delimit', 'Delimit')}\n            title={i18n.t('forms.delimit_result', 'Delimit Result')}\n            checked={this.state.shouldDelimit}\n            description={i18n.t(\n              'forms.delimit_result_description',\n              'Evaluate your rules against a delimited part of your result'\n            )}\n            onChange={this.handleShouldDelimitChanged}\n          />\n        </div>\n      ),\n      checked: this.state.shouldDelimit\n    };\n\n    return (\n      <Dialog\n        title={typeConfig.name}\n        headerClass={typeConfig.type}\n        buttons={this.getButtons()}\n        // tabs={[advanced]}\n      >\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n\n        {this.state.shouldDelimit ? this.renderFieldDelimited() : this.renderField()}\n\n        <CaseList\n          data-spec=\"cases\"\n          cases={this.state.cases}\n          onCasesUpdated={this.handleCasesUpdated}\n        />\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet, Tab } from 'components/dialog/Dialog';\nimport { RouterFormProps } from 'components/flow/props';\nimport { nodeToState, stateToNode } from 'components/flow/routers/subflow/helpers';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { fakePropType } from 'config/ConfigProvider';\nimport * as React from 'react';\nimport { Asset } from 'store/flowContext';\nimport { FormEntry, FormState, mergeForm, StringEntry } from 'store/nodeEditor';\nimport { shouldRequireIf, validate } from 'store/validators';\nimport i18n from 'config/i18n';\nimport { fetchAsset } from 'external';\nimport styles from './SubflowRouterForm.module.scss';\nimport { Trans } from 'react-i18next';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\n\n// TODO: Remove use of Function\nexport interface SubflowRouterFormState extends FormState {\n  flow: FormEntry;\n  params: { [name: string]: StringEntry };\n}\n\nexport default class SubflowRouterForm extends React.PureComponent<\n  RouterFormProps,\n  SubflowRouterFormState\n> {\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  constructor(props: RouterFormProps) {\n    super(props);\n\n    this.state = nodeToState(props.nodeSettings);\n\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  public componentDidMount() {\n    // we need to resolve our flow for it's parent refs\n    // todo: just fetch this is a plan flow result without the asset translation\n    if (this.state.flow.value) {\n      fetchAsset(this.props.assetStore.flows, this.state.flow.value.uuid).then((flow: Asset) => {\n        if (flow) {\n          this.handleFlowChanged([\n            { name: flow.name, uuid: flow.id, parent_refs: flow.content.parent_refs }\n          ]);\n        }\n      });\n    }\n  }\n\n  public handleFlowChanged(flows: any[], submitting = false): boolean {\n    const flow = flows[0];\n\n    const updates: Partial<SubflowRouterFormState> = {\n      flow: validate(i18n.t('forms.flow', 'Flow'), flow, [shouldRequireIf(submitting)])\n    };\n\n    const params: { [key: string]: StringEntry } = {};\n    // ensure our parameters are initialized\n    if (flow && flow.parent_refs) {\n      for (const key of flow.parent_refs) {\n        if (this.state.params[key]) {\n          params[key] = { ...this.state.params[key] };\n        } else {\n          params[key] = { value: '' };\n        }\n      }\n      updates.params = params;\n    }\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n\n    return updated.valid;\n  }\n\n  private handleSave(): void {\n    // validate our flow in case they haven't interacted\n    this.handleFlowChanged([this.state.flow.value], true);\n\n    const hasFieldErrors = Object.keys(this.state.params).find((key: string) =>\n      hasErrors(this.state.params[key])\n    );\n\n    if (this.state.valid && !hasFieldErrors) {\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  private handleFilter(asset: Asset): boolean {\n    // only show flows that match our flow type\n    return asset.content.type === this.context.config.flowType;\n  }\n\n  private handleParamChanged(text: string, name: string) {\n    const params = { ...this.state.params };\n    params[name] = { value: text };\n    this.setState({ params });\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    const tabs: Tab[] = [];\n    const flow = this.state.flow.value;\n\n    const hasFieldErrors = !!Object.keys(this.state.params).find((key: string) =>\n      hasErrors(this.state.params[key])\n    );\n\n    if (flow && flow.parent_refs && flow.parent_refs.length > 0) {\n      tabs.push({\n        name: i18n.t('forms.enter_flow_parameters_tab', 'Parameters'),\n        body: (\n          <div>\n            <p className={styles.info}>\n              <Trans\n                i18nKey=\"forms.enter_flow_parameters_summary\"\n                values={{\n                  flow: this.state.flow.value.name,\n                  url: this.context.config.endpoints.editor + '/' + this.state.flow.value.id\n                }}\n              >\n                <a\n                  target=\"_\"\n                  href={this.context.config.endpoints.editor + '/' + this.state.flow.value.id}\n                >\n                  [[flow]]\n                </a>{' '}\n                expects the following parameters to be set by this flow. These can be set using a{' '}\n                <span>Save Flow Result</span> action or directly below.\n              </Trans>\n            </p>\n            <table className={styles.params}>\n              <tbody>\n                {flow.parent_refs.map((name: string) => {\n                  return (\n                    <tr key={'param_' + name} className={styles.param}>\n                      <td className={styles.param_name}>{name}</td>\n                      <td className={styles.param_input}>\n                        <TextInputElement\n                          name={name}\n                          showLabel={false}\n                          placeholder={name}\n                          onChange={(updatedText: string) => {\n                            this.handleParamChanged(updatedText, name);\n                          }}\n                          entry={this.state.params[name]}\n                          autocomplete={true}\n                        />\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n        ),\n        hasErrors: hasFieldErrors,\n        checked: !!Object.keys(this.state.params).find(\n          (key: string) => this.state.params[key] && this.state.params[key].value.trim().length > 0\n        )\n      });\n    }\n\n    return (\n      <Dialog\n        title={typeConfig.name}\n        headerClass={typeConfig.type}\n        buttons={this.getButtons()}\n        tabs={tabs}\n      >\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <AssetSelector\n          name={i18n.t('forms.flow', 'Flow')}\n          placeholder=\"Select the flow to start\"\n          assets={this.props.assetStore.flows}\n          entry={this.state.flow}\n          searchable={true}\n          onFilter={this.handleFilter}\n          onChange={this.handleFlowChanged}\n        />\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { createRenderNode } from 'components/flow/routers/helpers';\nimport { SubflowRouterFormState } from 'components/flow/routers/subflow/SubflowRouterForm';\nimport { SUBFLOW_OPERAND } from 'components/nodeeditor/constants';\nimport { Operators, Types } from 'config/interfaces';\nimport { getType } from 'config/typeConfigs';\nimport {\n  Case,\n  Category,\n  Exit,\n  RouterTypes,\n  StartFlow,\n  StartFlowExitNames,\n  SwitchRouter,\n  SetRunResult,\n  AnyAction,\n  Action\n} from 'flowTypes';\nimport { RenderNode } from 'store/flowContext';\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\nimport { createUUID } from 'utils';\n\nexport const nodeToState = (settings: NodeEditorSettings): SubflowRouterFormState => {\n  const params: { [key: string]: StringEntry } = {};\n  if (\n    getType(settings.originalNode) === Types.split_by_subflow ||\n    (settings.originalAction && settings.originalAction.type === Types.enter_flow)\n  ) {\n    let action = settings.originalAction as StartFlow;\n    if (!action || action.type !== Types.enter_flow) {\n      action = settings.originalNode.node.actions.find(\n        (action: Action) => action.type === Types.enter_flow\n      ) as StartFlow;\n    }\n\n    // look for any run result actions\n    settings.originalNode.node.actions.forEach((action: AnyAction) => {\n      if (action.type === Types.set_run_result) {\n        const setRunResult = action as SetRunResult;\n        params[setRunResult.name] = { value: setRunResult.value };\n      }\n    });\n\n    return { flow: { value: action.flow }, params, valid: true };\n  }\n\n  return {\n    flow: { value: null },\n    params: {},\n    valid: false\n  };\n};\n\nexport const stateToNode = (\n  settings: NodeEditorSettings,\n  state: SubflowRouterFormState\n): RenderNode => {\n  const action =\n    settings.originalAction ||\n    (settings.originalNode.node.actions.length > 0 && settings.originalNode.node.actions[0]);\n\n  const startFlowAction: StartFlow = {\n    uuid: action.uuid || createUUID(),\n    type: Types.enter_flow,\n    flow: { uuid: state.flow.value.uuid, name: state.flow.value.name }\n  };\n\n  // If we're already a subflow, lean on those exits and cases\n  let exits: Exit[];\n  let cases: Case[];\n  let categories: Category[];\n\n  if (getType(settings.originalNode) === Types.split_by_subflow) {\n    ({ exits } = settings.originalNode.node);\n    ({ cases, categories } = settings.originalNode.node.router as SwitchRouter);\n  } else {\n    // Otherwise, let's create some new ones\n    exits = [\n      {\n        uuid: createUUID(),\n        destination_uuid: null\n      },\n      {\n        uuid: createUUID(),\n        destination_uuid: null\n      }\n    ];\n\n    categories = [\n      {\n        uuid: createUUID(),\n        name: StartFlowExitNames.Complete,\n        exit_uuid: exits[0].uuid\n      },\n      {\n        uuid: createUUID(),\n        name: StartFlowExitNames.Expired,\n        exit_uuid: exits[1].uuid\n      }\n    ];\n\n    cases = [\n      {\n        uuid: createUUID(),\n        type: Operators.has_only_text,\n        arguments: ['completed'],\n        category_uuid: categories[0].uuid\n      },\n      {\n        uuid: createUUID(),\n        arguments: ['expired'],\n        type: Operators.has_only_text,\n        category_uuid: categories[1].uuid\n      }\n    ];\n  }\n\n  const actions = [];\n\n  // add some set result actions if needed\n  Object.keys(state.params).forEach((key: string) => {\n    const value = state.params[key] ? state.params[key].value || '' : '';\n    if (value.trim().length > 0) {\n      const setResultAction: SetRunResult = {\n        uuid: createUUID(),\n        name: key,\n        value,\n        type: Types.set_run_result\n      };\n      actions.push(setResultAction);\n    }\n  });\n\n  actions.push(startFlowAction);\n\n  const router: SwitchRouter = {\n    type: RouterTypes.switch,\n    operand: SUBFLOW_OPERAND,\n    cases,\n    categories,\n    default_category_uuid: categories[categories.length - 1].uuid\n  };\n\n  const newRenderNode = createRenderNode(\n    settings.originalNode.node.uuid,\n    router,\n    exits,\n    Types.split_by_subflow,\n    actions\n  );\n\n  return newRenderNode;\n};\n","import { createRenderNode, resolveRoutes } from 'components/flow/routers/helpers';\r\nimport { WaitRouterFormState } from 'components/flow/routers/wait/WaitRouterForm';\r\nimport { DEFAULT_OPERAND, MEDIA_OPERAND } from 'components/nodeeditor/constants';\r\nimport { Type, Types } from 'config/interfaces';\r\nimport { HintTypes, Router, RouterTypes, SwitchRouter, Wait, WaitTypes } from 'flowTypes';\r\nimport { RenderNode } from 'store/flowContext';\r\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\r\n\r\nexport const nodeToState = (settings: NodeEditorSettings): WaitRouterFormState => {\r\n  let resultName: StringEntry = { value: 'Result' };\r\n\r\n  // look at the actual ui type instead of the hint here, we want results for any kind of wait\r\n  if (settings.originalNode && settings.originalNode.ui.type === Types.wait_for_response) {\r\n    const router = settings.originalNode.node.router as SwitchRouter;\r\n    if (router) {\r\n      resultName = { value: router.result_name || '' };\r\n    }\r\n  }\r\n\r\n  return {\r\n    resultName,\r\n    valid: true\r\n  };\r\n};\r\n\r\nexport const stateToNode = (\r\n  settings: NodeEditorSettings,\r\n  state: WaitRouterFormState,\r\n  typeConfig: Type\r\n): RenderNode => {\r\n  const { exits, defaultCategory: defaultExit, caseConfig, categories } = resolveRoutes(\r\n    [],\r\n    false,\r\n    settings.originalNode.node\r\n  );\r\n\r\n  const optionalRouter: Pick<Router, 'result_name'> = {};\r\n  if (state.resultName.value) {\r\n    optionalRouter.result_name = state.resultName.value;\r\n  }\r\n\r\n  let operand = DEFAULT_OPERAND;\r\n  const wait = { type: WaitTypes.msg } as Wait;\r\n  switch (typeConfig.type) {\r\n    case Types.wait_for_audio:\r\n      wait.hint = { type: HintTypes.audio };\r\n      operand = MEDIA_OPERAND;\r\n      break;\r\n    case Types.wait_for_image:\r\n      wait.hint = { type: HintTypes.image };\r\n      operand = MEDIA_OPERAND;\r\n      break;\r\n    case Types.wait_for_location:\r\n      wait.hint = { type: HintTypes.location };\r\n      operand = MEDIA_OPERAND;\r\n      break;\r\n    case Types.wait_for_video:\r\n      wait.hint = { type: HintTypes.video };\r\n      operand = MEDIA_OPERAND;\r\n      break;\r\n  }\r\n\r\n  const router: SwitchRouter = {\r\n    type: RouterTypes.switch,\r\n    default_category_uuid: defaultExit,\r\n    cases: [],\r\n    categories,\r\n    wait,\r\n    operand,\r\n    ...optionalRouter\r\n  };\r\n\r\n  const newRenderNode = createRenderNode(\r\n    settings.originalNode.node.uuid,\r\n    router,\r\n    exits,\r\n    Types.wait_for_response,\r\n    [],\r\n    { cases: caseConfig }\r\n  );\r\n\r\n  return newRenderNode;\r\n};\r\n","import { createWebhookBasedNode } from 'components/flow/routers/helpers';\nimport { WebhookRouterFormState } from 'components/flow/routers/webhook/WebhookRouterForm';\nimport { DEFAULT_BODY } from 'components/nodeeditor/constants';\nimport { Types } from 'config/interfaces';\nimport { getType } from 'config/typeConfigs';\nimport { CallWebhook } from 'flowTypes';\nimport { RenderNode } from 'store/flowContext';\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\nimport { ValidatorFunc } from 'store/validators';\nimport { createUUID } from 'utils';\n\nexport enum Methods {\n  GET = 'GET',\n  POST = 'POST',\n  PUT = 'PUT',\n  DELETE = 'DELETE',\n  HEAD = 'HEAD',\n  PATCH = 'PATCH'\n}\n\nexport interface MethodOption {\n  value: string;\n  name: string;\n}\n\ninterface HeaderMap {\n  [name: string]: string;\n}\n\nexport const GET_METHOD: MethodOption = {\n  value: Methods.GET,\n  name: Methods.GET\n};\n\nexport const METHOD_OPTIONS: MethodOption[] = [\n  GET_METHOD,\n  { value: Methods.POST, name: Methods.POST },\n  { value: Methods.PUT, name: Methods.PUT },\n  { value: Methods.DELETE, name: Methods.DELETE },\n  { value: Methods.HEAD, name: Methods.HEAD },\n  { value: Methods.PATCH, name: Methods.PATCH }\n];\n\nexport const getOriginalAction = (settings: NodeEditorSettings): CallWebhook => {\n  const action =\n    settings.originalAction ||\n    (settings.originalNode.node.actions.length > 0 && settings.originalNode.node.actions[0]);\n\n  if (action.type === Types.call_webhook) {\n    return action as CallWebhook;\n  }\n};\n\nexport const nodeToState = (settings: NodeEditorSettings): WebhookRouterFormState => {\n  // TODO: work out an incremental result name\n  const resultName: StringEntry = { value: 'Result' };\n\n  const state: WebhookRouterFormState = {\n    headers: [],\n    resultName,\n    method: { value: GET_METHOD },\n    url: { value: '' },\n    body: { value: getDefaultBody(Methods.GET) },\n    valid: false\n  };\n\n  if (getType(settings.originalNode) === Types.split_by_webhook) {\n    const action = getOriginalAction(settings) as CallWebhook;\n\n    // add in our headers\n    for (const name of Object.keys(action.headers || []).sort()) {\n      state.headers.push({\n        value: {\n          uuid: createUUID(),\n          value: action.headers[name],\n          name\n        }\n      });\n    }\n\n    state.resultName = { value: action.result_name };\n    state.url = { value: action.url };\n    state.method = { value: { name: action.method, value: action.method } };\n    state.body = { value: action.body };\n    state.valid = true;\n  } else {\n    state.headers.push({\n      value: {\n        uuid: createUUID(),\n        name: 'Accept',\n        value: 'application/json'\n      }\n    });\n  }\n\n  // one empty header\n  state.headers.push({\n    value: {\n      uuid: createUUID(),\n      name: '',\n      value: ''\n    }\n  });\n\n  return state;\n};\n\nexport const stateToNode = (\n  settings: NodeEditorSettings,\n  state: WebhookRouterFormState\n): RenderNode => {\n  const headers: HeaderMap = {};\n\n  for (const entry of state.headers) {\n    if (entry.value.name.trim().length !== 0) {\n      headers[entry.value.name] = entry.value.value;\n    }\n  }\n\n  let uuid = createUUID();\n\n  const originalAction = getOriginalAction(settings);\n  if (originalAction) {\n    uuid = originalAction.uuid;\n  }\n\n  const newAction: CallWebhook = {\n    uuid,\n    headers,\n    type: Types.call_webhook,\n    url: state.url.value,\n    body: state.body.value,\n    method: state.method.value.value as Methods,\n    result_name: state.resultName.value\n  };\n\n  return createWebhookBasedNode(newAction, settings.originalNode, false);\n};\n\nexport const getDefaultBody = (method: string): string => {\n  return method === Methods.GET ? '' : DEFAULT_BODY;\n};\n\nexport const isValidJson = (): ValidatorFunc => (name, body: any) => {\n  try {\n    var o = JSON.parse(body);\n\n    if (o && typeof o === 'object') {\n      return { failures: [], value: body };\n    }\n  } catch (e) {\n    return { failures: [{ message: 'Not a valid JSON' }], value: body };\n  }\n};\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\r\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\r\nimport { RouterFormProps } from 'components/flow/props';\r\nimport { createResultNameInput } from 'components/flow/routers/widgets';\r\nimport TypeList from 'components/nodeeditor/TypeList';\r\nimport * as React from 'react';\r\nimport { FormState, StringEntry } from 'store/nodeEditor';\r\nimport { Alphanumeric, StartIsNonNumeric, validate } from 'store/validators';\r\n\r\nimport { nodeToState, stateToNode } from './helpers';\r\nimport styles from './WaitRouterForm.module.scss';\r\nimport i18n from 'config/i18n';\r\n\r\nexport interface WaitRouterFormState extends FormState {\r\n  resultName: StringEntry;\r\n}\r\n\r\nexport default class WaitRouterForm extends React.Component<RouterFormProps, WaitRouterFormState> {\r\n  constructor(props: RouterFormProps) {\r\n    super(props);\r\n\r\n    this.state = nodeToState(this.props.nodeSettings);\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^on/, /^handle/]\r\n    });\r\n  }\r\n\r\n  private handleUpdateResultName(value: string): void {\r\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\r\n      Alphanumeric,\r\n      StartIsNonNumeric\r\n    ]);\r\n    this.setState({\r\n      resultName,\r\n      valid: this.state.valid && !hasErrors(resultName)\r\n    });\r\n  }\r\n\r\n  private handleSave(): void {\r\n    if (this.state.valid) {\r\n      this.props.updateRouter(\r\n        stateToNode(this.props.nodeSettings, this.state, this.props.typeConfig)\r\n      );\r\n      this.props.onClose(false);\r\n    }\r\n  }\r\n\r\n  private getButtons(): ButtonSet {\r\n    return {\r\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\r\n      secondary: {\r\n        name: i18n.t('buttons.cancel', 'Cancel'),\r\n        onClick: () => this.props.onClose(true)\r\n      }\r\n    };\r\n  }\r\n\r\n  public renderEdit(): JSX.Element {\r\n    const typeConfig = this.props.typeConfig;\r\n\r\n    return (\r\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\r\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\r\n        <div className={styles.result_name}>\r\n          {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\r\n        </div>\r\n        {renderIssues(this.props)}\r\n      </Dialog>\r\n    );\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    return this.renderEdit();\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport { getAllErrors } from 'components/flow/actions/helpers';\r\nimport { HeaderEntry } from 'components/flow/routers/webhook/WebhookRouterForm';\r\nimport styles from 'components/flow/routers/webhook/WebhookRouterForm.module.scss';\r\nimport FormElement from 'components/form/FormElement';\r\nimport TextInputElement from 'components/form/textinput/TextInputElement';\r\nimport * as React from 'react';\r\nimport { StringEntry, ValidationFailure } from 'store/nodeEditor';\r\nimport { HeaderName, validate } from 'store/validators';\r\nimport i18n from 'config/i18n';\r\n\r\n// TODO: move this into webhook router component\r\nexport interface Header {\r\n  uuid: string;\r\n  name: string;\r\n  value: string;\r\n}\r\n\r\nexport interface HeaderElementProps {\r\n  entry: HeaderEntry;\r\n  index: number;\r\n  onRemove: (header: Header) => void;\r\n  onChange: (header: Header, validationFailures: ValidationFailure[]) => void;\r\n  empty?: boolean;\r\n}\r\n\r\ninterface HeaderElementState {\r\n  name: StringEntry;\r\n  value: StringEntry;\r\n}\r\n\r\nexport const headerContainerSpecId = 'header-container';\r\nexport const nameContainerSpecId = 'name-container';\r\nexport const valueConatainerSpecId = 'value-container';\r\nexport const removeIcoSpecId = 'remove-icon';\r\n\r\nexport const HEADER_NAME_ERROR = i18n.t(\r\n  'errors.http_header_missing_name',\r\n  'HTTP headers must have a name'\r\n);\r\nexport const NAME_PLACEHOLDER = i18n.t('forms.webhook_header_name', 'Header Name');\r\nexport const VALUE_PLACEHOLDER = i18n.t('forms.value', 'Value');\r\n\r\nexport default class HeaderElement extends React.Component<HeaderElementProps, HeaderElementState> {\r\n  constructor(props: HeaderElementProps) {\r\n    super(props);\r\n\r\n    const header = this.props.entry.value;\r\n    const name = header.name || '';\r\n    const value = header.value || '';\r\n\r\n    this.state = {\r\n      name: { value: name },\r\n      value: { value }\r\n    };\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^on/, /^handle/]\r\n    });\r\n  }\r\n\r\n  private getHeader(): Header {\r\n    return {\r\n      name: this.state.name.value,\r\n      value: this.state.value.value,\r\n      uuid: this.props.entry.value.uuid\r\n    };\r\n  }\r\n\r\n  private handleChangeName(value: string): void {\r\n    const name = validate(i18n.t('forms.header_name', 'Header name'), value, [HeaderName]);\r\n    this.setState({ name: { value: name.value } }, () =>\r\n      this.props.onChange(\r\n        this.getHeader(),\r\n        getAllErrors(this.state.value).concat(getAllErrors(name))\r\n      )\r\n    );\r\n  }\r\n\r\n  private handleChangeValue(value: string): void {\r\n    this.setState({ value: { value } }, () => {\r\n      const name = validate(i18n.t('forms.header_name', 'Header name'), this.state.name.value, [\r\n        HeaderName\r\n      ]);\r\n      this.props.onChange(\r\n        this.getHeader(),\r\n        getAllErrors(this.state.value).concat(getAllErrors(name))\r\n      );\r\n    });\r\n  }\r\n\r\n  private handleRemove(): void {\r\n    this.props.onRemove(this.getHeader());\r\n  }\r\n\r\n  private getRemoveIco(): JSX.Element {\r\n    return (\r\n      <div className={styles.remove_ico} onClick={this.handleRemove} data-spec={removeIcoSpecId}>\r\n        <span className=\"fe-x\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const removeIco: JSX.Element = this.getRemoveIco();\r\n    return (\r\n      <FormElement name={i18n.t('forms.webhook_header', 'Header')} entry={this.props.entry}>\r\n        <div className={styles.header} data-spec={headerContainerSpecId}>\r\n          <div className={styles.header_name} data-spec={nameContainerSpecId}>\r\n            <TextInputElement\r\n              placeholder={NAME_PLACEHOLDER}\r\n              name={NAME_PLACEHOLDER}\r\n              onChange={this.handleChangeName}\r\n              entry={this.state.name}\r\n            />\r\n          </div>\r\n          <div className={styles.header_value} data-spec={valueConatainerSpecId}>\r\n            <TextInputElement\r\n              placeholder={VALUE_PLACEHOLDER}\r\n              name={VALUE_PLACEHOLDER}\r\n              onChange={this.handleChangeValue}\r\n              entry={this.state.value}\r\n              autocomplete={true}\r\n            />\r\n          </div>\r\n          {removeIco}\r\n        </div>\r\n      </FormElement>\r\n    );\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet, Tab } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { RouterFormProps } from 'components/flow/props';\nimport HeaderElement, { Header } from 'components/flow/routers/webhook/header/HeaderElement';\nimport {\n  METHOD_OPTIONS,\n  MethodOption,\n  Methods,\n  nodeToState,\n  stateToNode,\n  getDefaultBody,\n  isValidJson\n} from 'components/flow/routers/webhook/helpers';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport SelectElement from 'components/form/select/SelectElement';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport * as React from 'react';\nimport { FormEntry, FormState, mergeForm, StringEntry, ValidationFailure } from 'store/nodeEditor';\nimport {\n  Alphanumeric,\n  Required,\n  shouldRequireIf,\n  StartIsNonNumeric,\n  validate,\n  ValidURL,\n  validateIf\n} from 'store/validators';\nimport { createUUID } from 'utils';\n\nimport styles from './WebhookRouterForm.module.scss';\nimport { Trans } from 'react-i18next';\nimport i18n from 'config/i18n';\n\nexport interface HeaderEntry extends FormEntry {\n  value: Header;\n}\n\nexport interface MethodEntry extends FormEntry {\n  value: MethodOption;\n}\n\nexport interface WebhookRouterFormState extends FormState {\n  headers: HeaderEntry[];\n  method: MethodEntry;\n  url: StringEntry;\n  body: StringEntry;\n  resultName: StringEntry;\n}\n\nexport default class WebhookRouterForm extends React.Component<\n  RouterFormProps,\n  WebhookRouterFormState\n> {\n  constructor(props: RouterFormProps) {\n    super(props);\n    this.state = nodeToState(this.props.nodeSettings);\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  private handleUpdate(\n    keys: {\n      method?: MethodOption;\n      url?: string;\n      body?: string;\n      header?: Header;\n      removeHeader?: Header;\n      validationFailures?: ValidationFailure[];\n      resultName?: string;\n    },\n    submitting = false\n  ): boolean {\n    const updates: Partial<WebhookRouterFormState> = {};\n\n    let ensureEmptyHeader = false;\n    let toRemove: any[] = [];\n\n    if (keys.hasOwnProperty('method')) {\n      updates.method = { value: keys.method };\n\n      const oldMethod = this.state.method.value.value;\n      const newMethod = keys.method.value;\n\n      if (oldMethod !== newMethod) {\n        const existingContentTypeHeader = this.state.headers.find(\n          (header: HeaderEntry) => header.value.name.toLowerCase() === 'content-type'\n        );\n\n        // whenever our method changes, update the default body\n        updates.body = { value: getDefaultBody(newMethod) };\n\n        // switching from a GET, add a content-type\n        if (oldMethod === Methods.GET && newMethod !== Methods.GET) {\n          if (!existingContentTypeHeader) {\n            let uuid = createUUID();\n            // if we have an empty header, use that one\n            const lastHeader =\n              this.state.headers.length > 0\n                ? this.state.headers[this.state.headers.length - 1]\n                : null;\n            if (lastHeader && !lastHeader.value.name) {\n              uuid = lastHeader.value.uuid;\n            }\n            keys.header = { uuid, name: 'Content-Type', value: 'application/json' };\n          }\n        } else if (oldMethod !== Methods.GET && newMethod === Methods.GET) {\n          // remove content type if switching to a GET\n          if (existingContentTypeHeader) {\n            toRemove = [{ headers: [{ value: existingContentTypeHeader.value }] }];\n          }\n        }\n      }\n    }\n\n    if (keys.hasOwnProperty('url')) {\n      updates.url = validate(i18n.t('forms.url', 'URL'), keys.url, [\n        shouldRequireIf(submitting),\n        validateIf(ValidURL, keys.url.indexOf('@') === -1)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('resultName')) {\n      updates.resultName = validate(i18n.t('forms.result_name', 'Result Name'), keys.resultName, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('body')) {\n      updates.body = validate('POST body', keys.body, [isValidJson()]);\n    }\n\n    if (keys.hasOwnProperty('header')) {\n      updates.headers = [{ value: keys.header, validationFailures: keys.validationFailures }];\n      ensureEmptyHeader = true;\n    }\n\n    if (keys.hasOwnProperty('removeHeader')) {\n      toRemove = [{ headers: [{ value: keys.removeHeader }] }];\n      ensureEmptyHeader = true;\n    }\n\n    const updated = mergeForm(this.state, updates, toRemove);\n\n    // update our form\n    this.setState(updated, () => {\n      // if we updated headers, check if we need a new one\n      if (ensureEmptyHeader) {\n        let needsHeader = true;\n        for (const header of this.state.headers) {\n          if (header.value.name.trim() === '') {\n            needsHeader = false;\n            break;\n          }\n        }\n\n        if (needsHeader) {\n          this.handleCreateHeader();\n        }\n      }\n    });\n    return updated.valid;\n  }\n\n  private handleUpdateResultName(value: string): void {\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\n      Required,\n      Alphanumeric,\n      StartIsNonNumeric\n    ]);\n    this.setState({\n      resultName,\n      valid: this.state.valid && !hasErrors(resultName)\n    });\n  }\n\n  private handleMethodUpdate(method: MethodOption): boolean {\n    return this.handleUpdate({ method });\n  }\n\n  private handleUrlUpdate(url: string, name: string, submitting = false): boolean {\n    return this.handleUpdate({ url }, submitting);\n  }\n\n  private handleHeaderRemoved(removeHeader: Header): boolean {\n    return this.handleUpdate({ removeHeader });\n  }\n\n  private handleHeaderUpdated(header: Header, validationFailures: ValidationFailure[]): boolean {\n    return this.handleUpdate({ header, validationFailures });\n  }\n\n  private handleCreateHeader(): boolean {\n    return this.handleUpdate({\n      header: {\n        uuid: createUUID(),\n        name: '',\n        value: ''\n      }\n    });\n  }\n\n  private handleBodyUpdate(body: string): boolean {\n    return this.handleUpdate({ body });\n  }\n\n  private handleSave(): void {\n    // validate our url in case they haven't interacted\n    const valid = this.handleUpdate(\n      { url: this.state.url.value, resultName: this.state.resultName.value },\n      true\n    );\n\n    if (valid) {\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  private renderEdit(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    const headerElements: JSX.Element[] = this.state.headers.map(\n      (header: HeaderEntry, index: number, arr: HeaderEntry[]) => {\n        return (\n          <div key={`header_${header.value.uuid}`}>\n            <HeaderElement\n              entry={header}\n              onRemove={this.handleHeaderRemoved}\n              onChange={this.handleHeaderUpdated}\n              index={index}\n            />\n          </div>\n        );\n      }\n    );\n\n    const tabs: Tab[] = [];\n    tabs.push({\n      name: 'HTTP Headers',\n      hasErrors: !!this.state.headers.find((header: HeaderEntry) => hasErrors(header)),\n      body: (\n        <>\n          <p className={styles.info}>\n            <Trans i18nKey=\"forms.webhook_header_summary\">\n              Add any additional headers below that you would like to send along with your request.\n            </Trans>\n          </p>\n          {headerElements}\n        </>\n      ),\n      checked: this.state.headers.length > 1\n    });\n\n    const method = this.state.method.value.value;\n    const name = this.state.method.value.name + ' ' + i18n.t('body', 'Body');\n    tabs.push({\n      name,\n      body: (\n        <div key=\"post_body\" className={styles.body_form}>\n          <h4>{name}</h4>\n          <p>\n            <Trans\n              i18nKey=\"forms.webhook_body_summary\"\n              values={{ method: this.state.method.value.name }}\n            >\n              Modify the body of the [[method]] request that will be sent to your webhook.\n            </Trans>\n          </p>\n          <TextInputElement\n            __className={styles.req_body}\n            name={name}\n            showLabel={false}\n            entry={this.state.body}\n            onChange={this.handleBodyUpdate}\n            helpText={\n              <Trans\n                i18nKey=\"forms.webhook_body_summary\"\n                values={{ method: this.state.method.value.name }}\n              >\n                Modify the body of the [[method]] request that will be sent to your webhook.\n              </Trans>\n            }\n            autocomplete={true}\n            textarea={true}\n          />\n        </div>\n      ),\n      checked: this.state.body.value !== getDefaultBody(method),\n      hasErrors: this.state.body.validationFailures\n        ? this.state.body.validationFailures.length > 0\n        : false\n    });\n\n    return (\n      <Dialog\n        title={typeConfig.name}\n        headerClass={typeConfig.type}\n        buttons={this.getButtons()}\n        tabs={tabs}\n      >\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <div style={{ display: 'flex', alignItems: 'flex-end' }}>\n          <div className={styles.method}>\n            <SelectElement\n              key=\"method_select\"\n              name={i18n.t('forms.method', 'Method')}\n              entry={this.state.method}\n              onChange={this.handleMethodUpdate}\n              options={METHOD_OPTIONS}\n            />\n          </div>\n          <div className={styles.url}>\n            <TextInputElement\n              name={i18n.t('forms.url', 'URL')}\n              placeholder={i18n.t('forms.enter_a_url', 'Enter a URL')}\n              entry={this.state.url}\n              onChange={this.handleUrlUpdate}\n              autocomplete={true}\n            />\n          </div>\n        </div>\n        <div className={styles.instructions}>\n          <p>\n            <Trans i18nKey=\"forms.webhook_help\">\n              If your server responds with JSON, each property will be added to the Flow.\n            </Trans>\n          </p>\n          <pre className={styles.code}>\n            {'{ \"product\": \"Solar Charging Kit\", \"stock level\": 32 }'}\n          </pre>\n          <p>\n            <Trans i18nKey=\"forms.webhook_example\">\n              This response would add <span className={styles.example}>@webhook.product</span> and{' '}\n              <span className={styles.example}>@webhook[\"stock level\"]</span> for use in the flow.\n            </Trans>\n          </p>\n        </div>\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n\n  public render(): JSX.Element {\n    return this.renderEdit();\n  }\n}\n","import * as React from 'react';\r\nimport { CallClassifier } from 'flowTypes';\r\nimport { renderAsset } from '../helpers';\r\nimport { AssetType } from 'store/flowContext';\r\nimport { fakePropType } from 'config/ConfigProvider';\r\n\r\nconst CallClassifierComp: React.SFC<CallClassifier> = (\r\n  { classifier },\r\n  context: any\r\n): JSX.Element => {\r\n  return renderAsset(\r\n    {\r\n      id: classifier.uuid,\r\n      name: classifier.name,\r\n      type: AssetType.Classifier\r\n    },\r\n    context.config.endpoints\r\n  );\r\n};\r\n\r\nCallClassifierComp.contextTypes = {\r\n  config: fakePropType\r\n};\r\n\r\nexport default CallClassifierComp;\r\n","import ConfigProvider from 'config/ConfigProvider';\r\nimport { getOperatorConfig, operatorConfigList } from 'config/operatorConfigs';\r\nimport { getTypeConfig, typeConfigList } from 'config/typeConfigs';\r\n\r\nexport { typeConfigList, getTypeConfig, operatorConfigList, getOperatorConfig };\r\n\r\nexport default ConfigProvider;\r\n","import {\n  hasCases,\n  createCaseProps,\n  resolveRoutes,\n  ResolvedRoutes,\n  createRenderNode\n} from 'components/flow/routers/helpers';\nimport { DEFAULT_OPERAND } from 'components/nodeeditor/constants';\nimport { Types, Operators, HIDDEN } from 'config/interfaces';\nimport { getType } from 'config/typeConfigs';\nimport { CallClassifier, SwitchRouter, Case, Exit, Category, RouterTypes } from 'flowTypes';\nimport { RenderNode } from 'store/flowContext';\nimport { NodeEditorSettings, StringEntry, FormEntry } from 'store/nodeEditor';\nimport { createUUID, scalarArrayEquals, snakify } from 'utils';\nimport { ClassifyRouterFormState } from 'components/flow/routers/classify/ClassifyRouterForm';\nimport { CaseProps } from 'components/flow/routers/caselist/CaseList';\nimport { getOperatorConfig } from 'config';\n\nexport const getOriginalAction = (settings: NodeEditorSettings): CallClassifier => {\n  const action =\n    settings.originalAction ||\n    (settings.originalNode.node.actions.length > 0 && settings.originalNode.node.actions[0]);\n\n  if (action.type === Types.call_classifier) {\n    return action as CallClassifier;\n  }\n};\n\nexport const nodeToState = (settings: NodeEditorSettings): ClassifyRouterFormState => {\n  // TODO: work out an incremental result name\n  const resultName: StringEntry = { value: 'Result' };\n  let initialCases: CaseProps[] = [];\n\n  let operand = DEFAULT_OPERAND;\n  let classifier: FormEntry = { value: null };\n\n  let hiddenCases: CaseProps[] = [];\n\n  if (getType(settings.originalNode) === Types.split_by_intent) {\n    const router = settings.originalNode.node.router as SwitchRouter;\n\n    if (hasCases(settings.originalNode.node)) {\n      initialCases = createCaseProps(router.cases, settings.originalNode);\n\n      hiddenCases = initialCases.filter(\n        (kase: CaseProps) => getOperatorConfig(kase.kase.type).visibility === HIDDEN\n      );\n\n      initialCases = initialCases.filter(\n        (kase: CaseProps) => getOperatorConfig(kase.kase.type).visibility !== HIDDEN\n      );\n    }\n\n    const action = getOriginalAction(settings) as CallClassifier;\n    classifier = { value: action.classifier };\n    operand = action.input;\n  }\n\n  const state: ClassifyRouterFormState = {\n    hiddenCases,\n    resultName,\n    classifier,\n    operand: { value: operand },\n    cases: initialCases,\n    valid: true\n  };\n\n  return state;\n};\n\nexport interface Route {\n  type: Operators;\n  arguments: string[];\n  name: 'Other';\n}\n\nexport const ensureRoute = (routes: ResolvedRoutes, route: Route) => {\n  const existingCasePosition = routes.cases.findIndex(\n    kase => kase.type === route.type && scalarArrayEquals(kase.arguments, route.arguments)\n  );\n\n  // if it already exists, make sure it's at the end\n  if (existingCasePosition >= 0) {\n    // already in the right place we are done\n    if (existingCasePosition === routes.cases.length - 1) {\n      return;\n    }\n\n    const [existingCase] = routes.cases.splice(existingCasePosition, 1);\n    routes.cases.push(existingCase);\n\n    return;\n  }\n\n  const exit: Exit = {\n    uuid: createUUID()\n  };\n\n  const category: Category = {\n    uuid: createUUID(),\n    name: route.name,\n    exit_uuid: exit.uuid\n  };\n\n  // otherwise let's add it\n  const kase: Case = {\n    uuid: createUUID(),\n    type: route.type,\n    arguments: route.arguments,\n    category_uuid: category.uuid\n  };\n\n  routes.categories.push(category);\n  routes.cases.push(kase);\n\n  // our new exit should go right in front of the default exit\n  routes.exits.splice(routes.exits.length - 1, 0, exit);\n};\n\nexport const stateToNode = (\n  settings: NodeEditorSettings,\n  state: ClassifyRouterFormState\n): RenderNode => {\n  let uuid = createUUID();\n\n  const routes = resolveRoutes(\n    [...state.cases, ...state.hiddenCases],\n    false,\n    settings.originalNode.node,\n    'Failure'\n  );\n\n  // make sure we have an other route since failure is our default\n  ensureRoute(routes, {\n    type: Operators.has_category,\n    arguments: ['Success', 'Skipped'],\n    name: 'Other'\n  });\n\n  const originalAction = getOriginalAction(settings);\n  if (originalAction) {\n    uuid = originalAction.uuid;\n  }\n\n  const routerResultName = state.resultName.value;\n  const actionResultName = '_' + routerResultName + ' Classification';\n\n  const newAction: CallClassifier = {\n    uuid,\n    type: Types.call_classifier,\n    result_name: actionResultName,\n    input: state.operand.value,\n    classifier: {\n      uuid: state.classifier.value.uuid,\n      name: state.classifier.value.name\n    }\n  };\n\n  const router: SwitchRouter = {\n    cases: routes.cases,\n    operand: `@results.${snakify(actionResultName)}`,\n    categories: routes.categories,\n    type: RouterTypes.switch,\n    default_category_uuid: routes.defaultCategory,\n    result_name: routerResultName\n  };\n\n  return createRenderNode(\n    settings.originalNode.node.uuid,\n    router,\n    routes.exits,\n    Types.split_by_intent,\n    [newAction]\n  );\n};\n\nexport const createEmptyCase = (): CaseProps => {\n  const uuid = createUUID();\n  return {\n    uuid,\n    kase: {\n      uuid,\n      type: Operators.has_top_intent,\n      arguments: ['', ''],\n      category_uuid: null\n    },\n    categoryName: '',\n    valid: true\n  };\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet, Tab } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { RouterFormProps } from 'components/flow/props';\nimport { nodeToState, stateToNode, createEmptyCase } from './helpers';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport * as React from 'react';\nimport { FormState, mergeForm, StringEntry, FormEntry } from 'store/nodeEditor';\nimport {\n  Alphanumeric,\n  Required,\n  shouldRequireIf,\n  StartIsNonNumeric,\n  validate\n} from 'store/validators';\nimport CaseList, { CaseProps } from 'components/flow/routers/caselist/CaseList';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport { Asset } from 'store/flowContext';\nimport { renderIf } from 'utils';\nimport { intentOperatorList } from 'config/operatorConfigs';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\nimport { DEFAULT_OPERAND } from 'components/nodeeditor/constants';\nimport { fetchAsset } from 'external';\nimport styles from './ClassifyRouterForm.module.scss';\nimport i18n from 'config/i18n';\n\nexport interface ClassifyRouterFormState extends FormState {\n  hiddenCases: CaseProps[];\n  resultName: StringEntry;\n  classifier: FormEntry;\n  cases: CaseProps[];\n  operand: StringEntry;\n}\n\nexport default class ClassifyRouterForm extends React.Component<\n  RouterFormProps,\n  ClassifyRouterFormState\n> {\n  constructor(props: RouterFormProps) {\n    super(props);\n\n    this.state = nodeToState(this.props.nodeSettings);\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n\n    // we need to resolve our classifier for intent selection\n    if (this.state.classifier.value) {\n      fetchAsset(this.props.assetStore.classifiers, this.state.classifier.value.id).then(\n        (classifier: Asset) => {\n          if (classifier) {\n            this.handleUpdate({ classifier: { name: classifier.name, uuid: classifier.id } });\n          }\n        }\n      );\n    }\n  }\n\n  private handleUpdate(\n    keys: {\n      resultName?: string;\n      classifier?: any;\n    },\n    submitting = false\n  ): boolean {\n    const updates: Partial<ClassifyRouterFormState> = {};\n\n    if (keys.hasOwnProperty('resultName')) {\n      updates.resultName = validate(i18n.t('forms.result_name', 'Result Name'), keys.resultName, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('classifier')) {\n      updates.classifier = validate(i18n.t('forms.classifier', 'Classifier'), keys.classifier, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    const updated = mergeForm(this.state, updates);\n\n    // update our form\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private handleCasesUpdated(cases: CaseProps[]): void {\n    const invalidCase = cases.find((caseProps: CaseProps) => !caseProps.valid);\n    this.setState({ cases, valid: !invalidCase });\n  }\n\n  private handleUpdateResultName(value: string): void {\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\n      Required,\n      Alphanumeric,\n      StartIsNonNumeric\n    ]);\n    this.setState({\n      resultName,\n      valid: this.state.valid && !hasErrors(resultName)\n    });\n  }\n\n  private handleSave(): void {\n    // if we still have invalid cases, don't move forward\n    const invalidCase = this.state.cases.find((caseProps: CaseProps) => !caseProps.valid);\n    if (invalidCase) {\n      return;\n    }\n\n    // validate our result name in case they haven't interacted\n    const valid = this.handleUpdate(\n      {\n        resultName: this.state.resultName.value,\n        classifier: this.state.classifier.value\n      },\n      true\n    );\n\n    if (valid) {\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  private handleClassifierUpdated(selected: Asset[]): void {\n    this.handleUpdate({ classifier: selected[0] });\n  }\n\n  private handleOperandUpdated(value: string): void {\n    this.setState({\n      operand: validate(i18n.t('forms.operand', 'Operand'), value, [Required])\n    });\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  private dialog: Dialog;\n\n  private renderEdit(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    const tabs: Tab[] = [\n      {\n        name: 'Classifier Input',\n        checked: this.state.operand.value !== DEFAULT_OPERAND,\n        body: (\n          <>\n            <p>\n              Enter an expression to use as the input to your classifier. To classify the last\n              response from the contact use <code>{DEFAULT_OPERAND}</code>.\n            </p>\n            <TextInputElement\n              name={i18n.t('forms.operand', 'Operand')}\n              showLabel={false}\n              autocomplete={true}\n              onChange={this.handleOperandUpdated}\n              entry={this.state.operand}\n            />\n          </>\n        )\n      }\n    ];\n\n    return (\n      <Dialog\n        title={typeConfig.name}\n        headerClass={typeConfig.type}\n        buttons={this.getButtons()}\n        tabs={tabs}\n        ref={ele => {\n          this.dialog = ele;\n        }}\n      >\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <p>\n          <span>Run </span>\n          <span\n            className={styles.link}\n            onClick={() => {\n              this.dialog.showTab(0);\n            }}\n          >\n            {this.state.operand.value === DEFAULT_OPERAND\n              ? 'the last response'\n              : this.state.operand.value}\n          </span>\n          <span> through the classifier...</span>\n        </p>\n        <AssetSelector\n          key=\"select_classifier\"\n          name={i18n.t('forms.classifier', 'Classifier')}\n          placeholder=\"Select the classifier to use\"\n          assets={this.props.assetStore.classifiers}\n          onChange={this.handleClassifierUpdated}\n          entry={this.state.classifier}\n        />\n\n        {renderIf(!!this.state.classifier.value)(\n          <CaseList\n            data-spec=\"cases\"\n            cases={this.state.cases}\n            onCasesUpdated={this.handleCasesUpdated}\n            operators={intentOperatorList}\n            createEmptyCase={createEmptyCase}\n            classifier={this.state.classifier.value}\n          />\n        )}\n\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n\n  public render(): JSX.Element {\n    return this.renderEdit();\n  }\n}\n","import { SCHEMES, Scheme, getType } from 'config/typeConfigs';\nimport { SelectOption } from 'components/form/select/SelectElement';\nimport { NodeEditorSettings } from 'store/nodeEditor';\nimport { SchemeRouterFormState } from './SchemeRouterForm';\nimport { getSwitchRouter, resolveRoutes, createRenderNode } from '../helpers';\nimport { RenderNode } from 'store/flowContext';\nimport { SwitchRouter, FlowNode, RouterTypes, Case } from 'flowTypes';\nimport { CaseProps } from '../caselist/CaseList';\nimport { createUUID } from 'utils';\nimport { Operators, Types } from 'config/interfaces';\nimport { SCHEMES_OPERAND } from 'components/nodeeditor/constants';\n\nexport const getChannelTypeOptions = (): SelectOption[] => {\n  // get our scheme list as select options, ignore hidden schemes\n  return SCHEMES.filter((scheme: Scheme) => !scheme.excludeFromSplit).map((scheme: Scheme) => {\n    return { value: scheme.scheme, name: scheme.name };\n  });\n};\n\nexport const nodeToState = (settings: NodeEditorSettings): SchemeRouterFormState => {\n  const state: SchemeRouterFormState = {\n    schemes: { value: [] },\n    resultName: { value: '' },\n    valid: false\n  };\n\n  if (getType(settings.originalNode) === Types.split_by_scheme) {\n    state.schemes.value = extractSchemes(settings.originalNode.node);\n    state.resultName = {\n      value: (settings.originalNode.node.router as SwitchRouter).result_name || ''\n    };\n    state.valid = true;\n  }\n\n  return state;\n};\n\nexport const stateToNode = (\n  settings: NodeEditorSettings,\n  state: SchemeRouterFormState\n): RenderNode => {\n  let orginalCases: Case[] = [];\n  if (getType(settings.originalNode) === Types.split_by_scheme) {\n    orginalCases = getSwitchRouter(settings.originalNode.node).cases;\n  }\n\n  const currentCases = schemesToCases(state.schemes.value, orginalCases);\n\n  const { cases, exits, defaultCategory: defaultExit, caseConfig, categories } = resolveRoutes(\n    currentCases,\n    false,\n    settings.originalNode.node\n  );\n\n  const router: SwitchRouter = {\n    type: RouterTypes.switch,\n    cases,\n    categories,\n    default_category_uuid: defaultExit,\n    operand: SCHEMES_OPERAND,\n    result_name: state.resultName.value\n  };\n\n  return createRenderNode(\n    settings.originalNode.node.uuid,\n    router,\n    exits,\n    Types.split_by_scheme,\n    [],\n    { cases: caseConfig }\n  );\n};\n\nexport const extractSchemes = (node: FlowNode): SelectOption[] => {\n  let schemes: SelectOption[] = [];\n  const router = getSwitchRouter(node);\n  const selectOptions = getChannelTypeOptions();\n\n  if (router) {\n    schemes = (router as SwitchRouter).cases\n      .map(kase => {\n        if (kase.arguments) {\n          const [scheme] = kase.arguments;\n          return selectOptions.find((option: SelectOption) => option.value === scheme);\n        }\n        return null;\n      })\n      .filter((option: SelectOption) => option !== null);\n  }\n  return schemes;\n};\n\nexport const schemesToCases = (\n  schemes: SelectOption[] = [],\n  originalCases: Case[]\n): CaseProps[] => {\n  return schemes.map(({ value, name }: SelectOption) => {\n    // try to use the same case uuids for consistency\n    const originalCase = originalCases.find((kase: Case) => kase.arguments[0] === value);\n    const uuid = originalCase ? originalCase.uuid : createUUID();\n    return {\n      uuid: createUUID(),\n      kase: {\n        uuid,\n        type: Operators.has_only_phrase,\n        arguments: [value],\n        category_uuid: ''\n      },\n      categoryName: name,\n      valid: true\n    };\n  });\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport * as React from 'react';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { RouterFormProps } from 'components/flow/props';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { FormState, mergeForm, StringEntry, SelectOptionArrayEntry } from 'store/nodeEditor';\nimport { Required, validate } from 'store/validators';\nimport i18n from 'config/i18n';\nimport { getChannelTypeOptions, nodeToState, stateToNode } from './helpers';\nimport SelectElement, { SelectOption } from 'components/form/select/SelectElement';\nimport { renderIssues } from 'components/flow/actions/helpers';\n\nexport interface SchemeRouterFormState extends FormState {\n  schemes: SelectOptionArrayEntry;\n  resultName: StringEntry;\n}\n\nexport default class SchemeRouterForm extends React.Component<\n  RouterFormProps,\n  SchemeRouterFormState\n> {\n  public static contextTypes = {\n    endpoints: fakePropType,\n    assetService: fakePropType\n  };\n\n  constructor(props: RouterFormProps) {\n    super(props);\n    this.state = nodeToState(this.props.nodeSettings);\n\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  private handleSchemesChanged(schemes: SelectOption[]): void {\n    this.handleUpdate({ schemes });\n  }\n\n  private handleUpdateResultName(resultName: string): void {\n    this.handleUpdate({ resultName });\n  }\n\n  private handleUpdate(keys: { schemes?: SelectOption[]; resultName?: string }): boolean {\n    const updates: Partial<SchemeRouterFormState> = {};\n\n    if (keys.hasOwnProperty('schemes')) {\n      updates.schemes = validate(i18n.t('forms.split_by_scheme', 'Channel types'), keys.schemes, [\n        Required\n      ]);\n    }\n\n    if (keys.hasOwnProperty('resultName')) {\n      updates.resultName = { value: keys.resultName };\n    }\n\n    const updated = mergeForm(this.state, updates);\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private handleSave(): void {\n    if (this.state.valid) {\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  public render(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <p>\n          {i18n.t(\n            'forms.split_by_scheme_summary',\n            \"The contact's URN is the address they used to reach you such as their phone number or a Facebook ID. Select which URN types to split by below.\"\n          )}\n        </p>\n        <SelectElement\n          key=\"channel_type_select\"\n          name={i18n.t('forms.channel_type', 'Channel Type')}\n          placeholder={i18n.t(\n            'forms.split_by_channel_placeholder',\n            'Select the channels to split by'\n          )}\n          entry={this.state.schemes}\n          onChange={this.handleSchemesChanged}\n          options={getChannelTypeOptions()}\n          multi={true}\n          hideError={true}\n        />\n        {createResultNameInput(this.state.resultName, this.handleUpdateResultName)}\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n}\n","import { createWebhookBasedNode } from 'components/flow/routers/helpers';\nimport { Types } from 'config/interfaces';\nimport { getType } from 'config/typeConfigs';\nimport { OpenTicket } from 'flowTypes';\nimport { RenderNode } from 'store/flowContext';\nimport { NodeEditorSettings, FormEntry } from 'store/nodeEditor';\nimport { createUUID } from 'utils';\nimport { TicketRouterFormState } from 'components/flow/routers/ticket/TicketRouterForm';\n\nexport const nodeToState = (settings: NodeEditorSettings): TicketRouterFormState => {\n  let ticketer: FormEntry = { value: null };\n  let subject = { value: '@run.flow.name' };\n  let body = { value: '@results' };\n  let resultName = { value: 'Result' };\n\n  if (getType(settings.originalNode) === Types.split_by_ticket) {\n    const action = getOriginalAction(settings) as OpenTicket;\n    ticketer = { value: action.ticketer };\n    subject = { value: action.subject };\n    body = { value: action.body };\n    resultName = { value: action.result_name };\n  }\n\n  const state: TicketRouterFormState = {\n    ticketer,\n    subject,\n    body,\n    resultName,\n    valid: true\n  };\n\n  return state;\n};\n\nexport const stateToNode = (\n  settings: NodeEditorSettings,\n  state: TicketRouterFormState\n): RenderNode => {\n  let uuid = createUUID();\n  const originalAction = getOriginalAction(settings);\n  if (originalAction) {\n    uuid = originalAction.uuid;\n  }\n\n  const newAction: OpenTicket = {\n    uuid,\n    type: Types.open_ticket,\n    ticketer: state.ticketer.value,\n    subject: state.subject.value,\n    body: state.body.value,\n    result_name: state.resultName.value\n  };\n\n  return createWebhookBasedNode(newAction, settings.originalNode, true);\n};\n\nexport const getOriginalAction = (settings: NodeEditorSettings): OpenTicket => {\n  const action =\n    settings.originalAction ||\n    (settings.originalNode.node.actions.length > 0 && settings.originalNode.node.actions[0]);\n\n  if (action.type === Types.open_ticket) {\n    return action as OpenTicket;\n  }\n};\n","import { react as bindCallbacks } from 'auto-bind';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { RouterFormProps } from 'components/flow/props';\nimport { nodeToState, stateToNode } from './helpers';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport * as React from 'react';\nimport { FormState, mergeForm, StringEntry, FormEntry } from 'store/nodeEditor';\nimport {\n  Alphanumeric,\n  Required,\n  shouldRequireIf,\n  StartIsNonNumeric,\n  validate\n} from 'store/validators';\nimport AssetSelector from 'components/form/assetselector/AssetSelector';\nimport { Asset } from 'store/flowContext';\nimport styles from './TicketRouterForm.module.scss';\nimport i18n from 'config/i18n';\nimport TextInputElement from 'components/form/textinput/TextInputElement';\n\nexport interface TicketRouterFormState extends FormState {\n  ticketer: FormEntry;\n  subject: StringEntry;\n  body: StringEntry;\n  resultName: StringEntry;\n}\n\nexport default class TicketRouterForm extends React.Component<\n  RouterFormProps,\n  TicketRouterFormState\n> {\n  constructor(props: RouterFormProps) {\n    super(props);\n    this.state = nodeToState(this.props.nodeSettings);\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  private handleUpdate(\n    keys: {\n      ticketer?: Asset;\n      subject?: string;\n      body?: string;\n      resultName?: string;\n    },\n    submitting = false\n  ): boolean {\n    const updates: Partial<TicketRouterFormState> = {};\n\n    if (keys.hasOwnProperty('ticketer')) {\n      updates.ticketer = validate(i18n.t('forms.ticketer', 'Ticketer'), keys.ticketer, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('subject')) {\n      updates.subject = validate(i18n.t('forms.subject', 'Subject'), keys.subject, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('body')) {\n      updates.body = validate(i18n.t('forms.body', 'Body'), keys.body, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    if (keys.hasOwnProperty('resultName')) {\n      updates.resultName = validate(i18n.t('forms.result_name', 'Result Name'), keys.resultName, [\n        shouldRequireIf(submitting)\n      ]);\n    }\n\n    const updated = mergeForm(this.state, updates);\n\n    // update our form\n    this.setState(updated);\n    return updated.valid;\n  }\n\n  private handleTicketerUpdate(selected: Asset[]): void {\n    this.handleUpdate({ ticketer: selected[0] });\n  }\n\n  private handleSubjectUpdate(subject: string, name: string, submitting = false): boolean {\n    return this.handleUpdate({ subject }, submitting);\n  }\n\n  private handleBodyUpdate(body: string): boolean {\n    return this.handleUpdate({ body });\n  }\n\n  private handleResultNameUpdate(value: string): void {\n    const resultName = validate(i18n.t('forms.result_name', 'Result Name'), value, [\n      Required,\n      Alphanumeric,\n      StartIsNonNumeric\n    ]);\n    this.setState({\n      resultName,\n      valid: this.state.valid && !hasErrors(resultName)\n    });\n  }\n\n  private handleSave(): void {\n    // validate all fields in case they haven't interacted\n    const valid = this.handleUpdate(\n      {\n        ticketer: this.state.ticketer.value,\n        subject: this.state.subject.value,\n        body: this.state.body.value,\n        resultName: this.state.resultName.value\n      },\n      true\n    );\n\n    if (valid) {\n      this.props.updateRouter(stateToNode(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  private renderEdit(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <p>\n          <span>Open ticket via... </span>\n        </p>\n        <AssetSelector\n          key=\"select_ticketer\"\n          name={i18n.t('forms.ticketer', 'Ticketer')}\n          placeholder=\"Select the ticketing service to use\"\n          assets={this.props.assetStore.ticketers}\n          onChange={this.handleTicketerUpdate}\n          entry={this.state.ticketer}\n        />\n        <div className={styles.subject}>\n          <TextInputElement\n            name={i18n.t('forms.subject', 'Subject')}\n            placeholder={i18n.t('forms.enter_a_subject', 'Enter a subject')}\n            entry={this.state.subject}\n            onChange={this.handleSubjectUpdate}\n            autocomplete={true}\n          />\n        </div>\n        <div className={styles.body}>\n          <TextInputElement\n            name={i18n.t('forms.body', 'Body')}\n            placeholder={i18n.t('forms.enter_a_body', 'Enter a body')}\n            entry={this.state.body}\n            onChange={this.handleBodyUpdate}\n            autocomplete={true}\n            textarea={true}\n          />\n        </div>\n\n        {createResultNameInput(this.state.resultName, this.handleResultNameUpdate)}\n        {renderIssues(this.props)}\n      </Dialog>\n    );\n  }\n\n  public render(): JSX.Element {\n    return this.renderEdit();\n  }\n}\n","import * as React from 'react';\nimport { OpenTicket } from 'flowTypes';\nimport { renderAsset } from '../helpers';\nimport { AssetType } from 'store/flowContext';\nimport { fakePropType } from 'config/ConfigProvider';\n\nconst OpenTicketComp: React.SFC<OpenTicket> = ({ ticketer }, context: any): JSX.Element => {\n  return renderAsset(\n    {\n      id: ticketer.uuid,\n      name: ticketer.name,\n      type: AssetType.Ticketer\n    },\n    context.config.endpoints\n  );\n};\n\nOpenTicketComp.contextTypes = {\n  config: fakePropType\n};\n\nexport default OpenTicketComp;\n","import { react as bindCallbacks } from 'auto-bind';\nimport * as React from 'react';\nimport Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { hasErrors, renderIssues } from 'components/flow/actions/helpers';\nimport { ActionFormProps, RouterFormProps } from 'components/flow/props';\nimport CaseList, { CaseProps } from 'components/flow/routers/caselist/CaseList';\n\nimport { actionToState, stateToAction } from 'components/flow/routers/sequence/helpers';\nimport { createResultNameInput } from 'components/flow/routers/widgets';\nimport TimeoutControl from 'components/form/timeout/TimeoutControl';\nimport TypeList from 'components/nodeeditor/TypeList';\nimport { FormState, StringEntry } from 'store/nodeEditor';\nimport { Alphanumeric, StartIsNonNumeric, validate } from 'store/validators';\nimport { WAIT_LABEL } from 'components/flow/routers/constants';\nimport i18n from 'config/i18n';\nimport TextInputElement, { TextInputStyle } from 'components/form/textinput/TextInputElement';\nimport styles from 'components/flow/routers/sequence/SequenceForm.module.scss';\n\nexport interface SequenceFormState extends FormState {\n  days: string;\n  hours: string;\n  minutes: string;\n}\n\nexport default class SequenceForm extends React.Component<ActionFormProps, SequenceFormState> {\n  constructor(props: ActionFormProps) {\n    super(props);\n\n    this.state = actionToState(this.props.nodeSettings);\n\n    bindCallbacks(this, {\n      include: [/^on/, /^handle/]\n    });\n  }\n\n  private handleSave(): void {\n    if (\n      !isNaN(parseInt(this.state.hours) + parseInt(this.state.minutes) + parseInt(this.state.days))\n    ) {\n      this.props.updateAction(stateToAction(this.props.nodeSettings, this.state));\n      this.props.onClose(false);\n    }\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: { name: i18n.t('buttons.ok', 'Ok'), onClick: this.handleSave },\n      secondary: {\n        name: i18n.t('buttons.cancel', 'Cancel'),\n        onClick: () => this.props.onClose(true)\n      }\n    };\n  }\n\n  public renderEdit(): JSX.Element {\n    const typeConfig = this.props.typeConfig;\n\n    return (\n      <Dialog title={typeConfig.name} headerClass={typeConfig.type} buttons={this.getButtons()}>\n        <TypeList __className=\"\" initialType={typeConfig} onChange={this.props.onTypeChange} />\n        <div>Wait for time</div>\n\n        <div className={styles.delay_container}>\n          <div className={styles.input}>\n            <span className={styles.title}>Days</span>\n            <TextInputElement\n              name={i18n.t('forms.state', 'State')}\n              placeholder=\"Enter days\"\n              onChange={props => this.setState({ days: props })}\n              style={TextInputStyle.small}\n              entry={{ value: this.state.days }}\n            />\n          </div>\n          <div className={styles.input}>\n            <span className={styles.title}>Hours</span>\n            <TextInputElement\n              name={i18n.t('forms.state', 'State')}\n              placeholder=\"Enter hours\"\n              onChange={props => this.setState({ hours: props })}\n              showInvalid={isNaN(parseInt(this.state.hours))}\n              style={TextInputStyle.small}\n              entry={{ value: this.state.hours }}\n            />\n          </div>\n          <div className={styles.input}>\n            <span className={styles.title}>Minutes</span>\n            <TextInputElement\n              name={i18n.t('forms.state', 'State')}\n              placeholder=\"Enter minutes\"\n              onChange={props => this.setState({ minutes: props })}\n              style={TextInputStyle.small}\n              entry={{ value: this.state.minutes }}\n            />\n          </div>\n        </div>\n        {isNaN(\n          parseInt(this.state.hours) + parseInt(this.state.minutes) + parseInt(this.state.days)\n        ) ? (\n          <span className={styles.error}>Enter valid numbers</span>\n        ) : null}\n      </Dialog>\n    );\n  }\n\n  public render(): JSX.Element {\n    return this.renderEdit();\n  }\n}\n","import { getActionUUID } from 'components/flow/actions/helpers';\nimport { CaseProps } from 'components/flow/routers/caselist/CaseList';\nimport {\n  createCaseProps,\n  createRenderNode,\n  hasCases,\n  resolveRoutes\n} from 'components/flow/routers/helpers';\nimport { ResponseRouterFormState } from 'components/flow/routers/response/ResponseRouterForm';\nimport { DEFAULT_OPERAND } from 'components/nodeeditor/constants';\nimport { Types } from 'config/interfaces';\nimport { getType } from 'config/typeConfigs';\nimport { Router, RouterTypes, SwitchRouter, Wait, WaitTypes, Delay } from 'flowTypes';\nimport { min } from 'moment';\nimport { RenderNode } from 'store/flowContext';\nimport { NodeEditorSettings, StringEntry } from 'store/nodeEditor';\nimport { SequenceFormState } from './SequenceForm';\n\nexport const actionToState = (settings: NodeEditorSettings): SequenceFormState => {\n  let delayNode: SequenceFormState = {\n    valid: true,\n    days: '0',\n    hours: '0',\n    minutes: '0'\n  };\n  if (settings.originalAction && settings.originalAction.type === 'wait_for_time') {\n    const action = settings.originalAction as Delay;\n\n    if (action.delay) {\n      const delayInSeconds = parseInt(action.delay);\n      delayNode.days = Math.floor(delayInSeconds / (3600 * 24)).toString();\n      delayNode.hours = Math.floor((delayInSeconds % (3600 * 24)) / 3600).toString();\n      delayNode.minutes = Math.floor((delayInSeconds % 3600) / 60).toString();\n    }\n  }\n\n  return delayNode;\n};\n\nexport const stateToAction = (settings: NodeEditorSettings, state: SequenceFormState): any => {\n  const { days, hours, minutes } = state;\n\n  const delayInSeconds = parseInt(days) * 86400 + parseInt(hours) * 3600 + parseInt(minutes) * 60;\n\n  const result = {\n    type: Types.wait_for_time,\n    uuid: getActionUUID(settings, Types.send_msg),\n    delay: delayInSeconds.toString()\n  };\n\n  return result;\n};\n","import Pill from 'components/pill/Pill';\nimport * as React from 'react';\n\nimport styles from './SendMsg.module.scss';\nimport i18n from 'config/i18n';\nimport { Delay } from 'flowTypes';\n\nconst Sequence: React.SFC<Delay> = (action: Delay): JSX.Element => {\n  const delayInSeconds = parseInt(action.delay ? action.delay : '0');\n  const days = Math.floor(delayInSeconds / (3600 * 24));\n  const noOfDays = days > 0 ? days + (days > 1 ? ' days ' : ' day ') : '';\n\n  const hours = Math.floor((delayInSeconds % (3600 * 24)) / 3600);\n  const noOfHours = hours > 0 ? hours + (hours > 1 ? ' hours ' : ' hour ') : '';\n\n  const minutes = Math.floor((delayInSeconds % 3600) / 60);\n  const noOfMinutes = minutes > 0 ? minutes + (minutes > 1 ? ' minutes ' : ' minute ') : '';\n\n  let waitForTime = `Waiting for ${noOfDays} ${noOfHours} ${noOfMinutes}`;\n\n  if (delayInSeconds === 0) {\n    waitForTime = 'Not waiting';\n  }\n  return <div>{waitForTime}</div>;\n};\n\nexport default Sequence;\n","import AddLabelsComp from 'components/flow/actions/addlabels/AddLabels';\nimport AddLabelsForm from 'components/flow/actions/addlabels/AddLabelsForm';\nimport AddURNComp from 'components/flow/actions/addurn/AddURN';\nimport AddURNForm from 'components/flow/actions/addurn/AddURNForm';\nimport CallResthookComp from 'components/flow/actions/callresthook/CallResthook';\nimport CallWebhookComp from 'components/flow/actions/callwebhook/CallWebhook';\nimport AddGroupsForm from 'components/flow/actions/changegroups/addgroups/AddGroupsForm';\nimport ChangeGroupsComp from 'components/flow/actions/changegroups/ChangeGroups';\nimport RemoveGroupsForm from 'components/flow/actions/changegroups/removegroups/RemoveGroupsForm';\nimport KeyLocalizationForm from 'components/flow/actions/localization/KeyLocalizationForm';\nimport MsgLocalizationForm from 'components/flow/actions/localization/MsgLocalizationForm';\nimport MissingComp from 'components/flow/actions/missing/Missing';\nimport PlayAudioComp from 'components/flow/actions/playaudio/PlayAudio';\nimport PlayAudioForm from 'components/flow/actions/playaudio/PlayAudioForm';\nimport SayMsgComp from 'components/flow/actions/saymsg/SayMsg';\nimport SayMsgForm from 'components/flow/actions/saymsg/SayMsgForm';\nimport SendBroadcastComp from 'components/flow/actions/sendbroadcast/SendBroadcast';\nimport SendBroadcastForm from 'components/flow/actions/sendbroadcast/SendBroadcastForm';\nimport SendEmailComp from 'components/flow/actions/sendemail/SendEmail';\nimport SendEmailForm from 'components/flow/actions/sendemail/SendEmailForm';\nimport SendMsgComp from 'components/flow/actions/sendmsg/SendMsg';\nimport SendMsgForm from 'components/flow/actions/sendmsg/SendMsgForm';\nimport SetRunResultComp from 'components/flow/actions/setrunresult/SetRunResult';\nimport SetRunResultForm from 'components/flow/actions/setrunresult/SetRunResultForm';\nimport StartFlowComp from 'components/flow/actions/startflow/StartFlow';\nimport StartSessionComp from 'components/flow/actions/startsession/StartSession';\nimport StartSessionForm from 'components/flow/actions/startsession/StartSessionForm';\nimport TransferAirtimeComp from 'components/flow/actions/transferairtime/TransferAirtime';\nimport UpdateContactComp from 'components/flow/actions/updatecontact/UpdateContact';\nimport UpdateContactForm from 'components/flow/actions/updatecontact/UpdateContactForm';\nimport AirtimeRouterForm from 'components/flow/routers/airtime/AirtimeRouterForm';\nimport DigitsRouterForm from 'components/flow/routers/digits/DigitsRouterForm';\nimport ExpressionRouterForm from 'components/flow/routers/expression/ExpressionRouterForm';\nimport FieldRouterForm from 'components/flow/routers/field/FieldRouterForm';\nimport GroupsRouterForm from 'components/flow/routers/groups/GroupsRouterForm';\nimport RouterLocalizationForm from 'components/flow/routers/localization/RouterLocalizationForm';\nimport MenuRouterForm from 'components/flow/routers/menu/MenuRouterForm';\nimport RandomRouterForm from 'components/flow/routers/random/RandomRouterForm';\nimport ResponseRouterForm from 'components/flow/routers/response/ResponseRouterForm';\nimport ResthookRouterForm from 'components/flow/routers/resthook/ResthookRouterForm';\nimport ResultRouterForm from 'components/flow/routers/result/ResultRouterForm';\nimport SubflowRouterForm from 'components/flow/routers/subflow/SubflowRouterForm';\nimport WaitRouterForm from 'components/flow/routers/wait/WaitRouterForm';\nimport WebhookRouterForm from 'components/flow/routers/webhook/WebhookRouterForm';\nimport {\n  FlowTypes,\n  HIDDEN,\n  ONLINE,\n  SURVEY,\n  TEXT_TYPES,\n  Type,\n  Types,\n  VOICE,\n  FeatureFilter\n} from 'config/interfaces';\nimport { HintTypes, RouterTypes, FlowEditorConfig, SendMsg } from 'flowTypes';\nimport { RenderNode } from 'store/flowContext';\nimport CallClassifierComp from 'components/flow/actions/callclassifier/CallClassifier';\nimport ClassifyRouterForm from 'components/flow/routers/classify/ClassifyRouterForm';\nimport i18n from 'config/i18n';\nimport SchemeRouterForm from 'components/flow/routers/scheme/SchemeRouterForm';\nimport TicketRouterForm from 'components/flow/routers/ticket/TicketRouterForm';\nimport OpenTicketComp from 'components/flow/actions/openticket/OpenTicket';\nimport SequenceForm from 'components/flow/routers/sequence/SequenceForm';\nimport Sequence from 'components/flow/routers/sequence/Sequence';\n\nconst dedupeTypeConfigs = (typeConfigs: Type[]) => {\n  const map: any = {};\n  return typeConfigs.filter(config => {\n    if (config.type === 'missing') {\n      return false;\n    }\n    const { name: key } = config;\n    return map[key] ? false : (map[key] = true);\n  });\n};\n\nexport interface TypeMap {\n  [propName: string]: Type;\n}\n\nexport type GetTypeConfig = (type: string) => Type;\n\nexport interface Scheme {\n  scheme: string;\n  name: string;\n  path: string;\n  excludeFromSplit?: boolean;\n}\n\nexport const SCHEMES: Scheme[] = [\n  {\n    scheme: 'tel',\n    name: i18n.t('schemes.phone.name', 'SMS'),\n    path: i18n.t('schemes.phone.path', 'Phone Number')\n  },\n  {\n    scheme: 'whatsapp',\n    name: i18n.t('schemes.whatsapp.name', 'WhatsApp'),\n    path: i18n.t('schemes.whatsapp.path', 'WhatsApp Number')\n  },\n  {\n    scheme: 'facebook',\n    name: i18n.t('schemes.facebook.path', 'Facebook'),\n    path: i18n.t('schemes.facebook.path', 'Facebook ID')\n  },\n  {\n    scheme: 'twitterid',\n    name: i18n.t('schemes.twitterid.name', 'Twitter'),\n    path: i18n.t('schemes.twitterid.path', 'Twitter ID')\n  },\n  {\n    scheme: 'telegram',\n    name: i18n.t('schemes.telegram.name', 'Telegram'),\n    path: i18n.t('schemes.telegram.path', 'Telegram ID')\n  },\n  {\n    scheme: 'viber',\n    name: i18n.t('schemes.viber.name', 'Viber'),\n    path: i18n.t('schemes.viber.path', 'Viber ID')\n  },\n  {\n    scheme: 'line',\n    name: i18n.t('schemes.line.name', 'Line'),\n    path: i18n.t('schemes.line.path', 'Line ID')\n  },\n  {\n    scheme: 'wechat',\n    name: i18n.t('schemes.wechat.name', 'Wechat'),\n    path: i18n.t('schemes.wechat.path', 'Wechat ID')\n  },\n  {\n    scheme: 'fcm',\n    name: i18n.t('schemes.firebase.name', 'Firebase'),\n    path: i18n.t('schemes.firebase.path', 'Firebase ID')\n  },\n  {\n    scheme: 'jiochat',\n    name: i18n.t('schemes.jiojach.name', 'Jiochat'),\n    path: i18n.t('schemes.jiochat.path', 'Jiochat ID')\n  },\n  {\n    scheme: 'freshchat',\n    name: i18n.t('schemes.freschat.name', 'Freshchat'),\n    path: i18n.t('schemes.freshchat.path', 'Freshchat ID')\n  },\n  {\n    scheme: 'mailto',\n    name: i18n.t('schemes.email.name', 'Email'),\n    path: i18n.t('schemes.email.path', 'Email Address'),\n    excludeFromSplit: true\n  },\n  {\n    scheme: 'twitter',\n    name: i18n.t('schemes.twitter.name', 'Twitter'),\n    path: i18n.t('schemes.twitter.path', 'Twitter Handle'),\n    excludeFromSplit: true\n  },\n  {\n    scheme: 'ext',\n    name: i18n.t('schemes.external.name', 'External'),\n    path: i18n.t('schemes.external.path', 'External ID')\n  }\n];\n\nexport const typeConfigList: Type[] = [\n  {\n    type: Types.missing,\n    name: 'Missing',\n    description: ' ** Unsupported ** ',\n    component: MissingComp,\n    visibility: HIDDEN\n  },\n  {\n    type: Types.say_msg,\n    name: i18n.t('actions.play_message.name', 'Play Message'),\n    description: i18n.t('actions.play_message.description', 'Play a message'),\n    form: SayMsgForm,\n    localization: MsgLocalizationForm,\n    localizeableKeys: ['text', 'audio_url'],\n    component: SayMsgComp,\n    visibility: VOICE\n  },\n\n  {\n    type: Types.wait_for_menu,\n    name: i18n.t('actions.wait_for_menu.name', 'Wait for Menu Selection'),\n    description: i18n.t('actions.wait_for_menu.description', 'Wait for menu selection'),\n    form: MenuRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    visibility: VOICE\n  },\n  {\n    type: Types.wait_for_digits,\n    name: i18n.t('actions.wait_for_digits.name', 'Wait for Digits'),\n    description: i18n.t('actions.wait_for_digits.description', 'Wait for multiple digits'),\n    form: DigitsRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits', 'cases'],\n    visibility: VOICE\n  },\n\n  {\n    type: Types.wait_for_audio,\n    name: i18n.t('actions.wait_for_audio.name', 'Wait for Audio'),\n    description: i18n.t('actions.wait_for_audio.description', 'Wait for an audio recording'),\n    form: WaitRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    visibility: [FlowTypes.SURVEY, FlowTypes.VOICE]\n  },\n\n  {\n    type: Types.send_msg,\n    name: i18n.t('actions.send_msg.name', 'Send Message'),\n    description: i18n.t('actions.send_msg.description', 'Send the contact a message'),\n    form: SendMsgForm,\n    localization: MsgLocalizationForm,\n    localizeableKeys: ['text', 'quick_replies', 'templating.variables', 'attachments'],\n    component: SendMsgComp,\n    massageForDisplay: (action: SendMsg) => {\n      // quick replies are optional in the definition, make sure we have\n      // at least an empty array so the localization has a proper cue\n      action.quick_replies = action.quick_replies || [];\n    }\n  },\n  {\n    type: Types.wait_for_response,\n    name: i18n.t('actions.wait_for_response.name', 'Wait for Response'),\n    description: i18n.t('actions.wait_for_response.description', 'Wait for the contact to respond'),\n    form: ResponseRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['categories', 'cases'],\n    aliases: [RouterTypes.switch],\n    visibility: TEXT_TYPES\n  },\n\n  {\n    type: Types.wait_for_time,\n    name: i18n.t('actions.wait_for_time.name', 'Wait for Time'),\n    description: i18n.t('actions.wait_for_time.description', 'Wait for time'),\n    form: SequenceForm,\n    component: Sequence\n  },\n\n  {\n    type: Types.send_broadcast,\n    name: i18n.t('actions.send_broadcast.name', 'Send Broadcast'),\n    description: i18n.t('actions.send_broadcast.description', 'Send a staff member a message'),\n    form: SendBroadcastForm,\n    localization: KeyLocalizationForm,\n    localizeableKeys: ['text'],\n    component: SendBroadcastComp\n  },\n  {\n    type: Types.add_input_labels,\n    name: i18n.t('actions.add_input.name', 'Add Labels'),\n    description: i18n.t('actions.add_input.description', 'Label the incoming message'),\n    form: AddLabelsForm,\n    component: AddLabelsComp\n  },\n  {\n    type: Types.add_contact_urn,\n    name: i18n.t('actions.add_contact_urn.name', 'Add URN'),\n    description: i18n.t('actions.add_contact_urn.description', 'Add a URN for the contact'),\n    form: AddURNForm,\n    component: AddURNComp\n  },\n  {\n    type: Types.add_contact_groups,\n    name: i18n.t('actions.add_contact_groups.name', 'Add to Collection'),\n    description: i18n.t(\n      'actions.add_contact_groups.description',\n      'Add the contact to a collection'\n    ),\n    form: AddGroupsForm,\n    component: ChangeGroupsComp\n  },\n  {\n    type: Types.remove_contact_groups,\n    name: i18n.t('actions.remove_contact_groups.name', 'Remove from Collection'),\n    description: i18n.t(\n      'actions.remove_contact_groups.description',\n      'Remove the contact from a collection'\n    ),\n    form: RemoveGroupsForm,\n    component: ChangeGroupsComp\n  },\n  {\n    type: Types.set_contact_field,\n    aliases: [\n      Types.set_contact_name,\n      Types.set_contact_language,\n      Types.set_contact_channel,\n      Types.set_contact_status\n    ],\n    name: i18n.t('actions.set_contact_field.name', 'Update Contact'),\n    description: i18n.t('actions.set_contact_field.description', 'Update the contact'),\n    form: UpdateContactForm,\n    component: UpdateContactComp\n  },\n  {\n    type: Types.send_email,\n    name: i18n.t('actions.send_email.name', 'Send Email'),\n    description: i18n.t('actions.send_email.description', 'Send an email'),\n    form: SendEmailForm,\n    localization: KeyLocalizationForm,\n    localizeableKeys: ['subject', 'body'],\n    component: SendEmailComp,\n    visibility: ONLINE\n  },\n  {\n    type: Types.set_run_result,\n    name: i18n.t('actions.set_run_result.name', 'Save Flow Result'),\n    description: i18n.t('actions.set_run_result.description', 'Save a result for this flow'),\n    form: SetRunResultForm,\n    component: SetRunResultComp\n  },\n\n  {\n    type: Types.play_audio,\n    name: i18n.t('actions.play_audio.name', 'Play Recording'),\n    description: i18n.t('actions.play_audio.description', 'Play a contact recording'),\n    form: PlayAudioForm,\n    component: PlayAudioComp,\n    visibility: VOICE\n  },\n\n  {\n    type: Types.call_webhook,\n    name: i18n.t('actions.call_webhook.name', 'Call Webhook'),\n    description: i18n.t('actions.call_webhook.description', 'Call a webhook'),\n    form: WebhookRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    component: CallWebhookComp,\n    aliases: [Types.split_by_webhook],\n    visibility: ONLINE\n  },\n  {\n    type: Types.call_resthook,\n    name: i18n.t('actions.call_resthook.name', 'Call Zapier'),\n    description: i18n.t('actions.call_resthook.description', 'Call Zapier'),\n    form: ResthookRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    component: CallResthookComp,\n    aliases: [Types.split_by_resthook],\n    filter: FeatureFilter.HAS_RESTHOOK,\n    visibility: ONLINE\n  },\n  {\n    type: Types.enter_flow,\n    name: i18n.t('actions.enter_flow.name', 'Enter a Flow'),\n    description: i18n.t('actions.enter_flow.description', 'Enter another flow'),\n    form: SubflowRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    component: StartFlowComp,\n    aliases: [Types.split_by_subflow]\n  },\n  {\n    type: Types.start_session,\n    name: i18n.t('actions.start_session.name', 'Start Somebody Else'),\n    description: i18n.t('actions.start_session.description', 'Start somebody else in a flow'),\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    form: StartSessionForm,\n    component: StartSessionComp,\n    visibility: ONLINE\n  },\n  {\n    type: Types.open_ticket,\n    name: i18n.t('actions.open_ticket.name', 'Open Ticket'),\n    description: i18n.t('actions.open_ticket.description', 'Open a ticket with a human agent'),\n    form: TicketRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    component: OpenTicketComp,\n    aliases: [Types.split_by_ticket],\n    visibility: ONLINE,\n    filter: FeatureFilter.HAS_TICKETER\n  },\n  {\n    type: Types.transfer_airtime,\n    name: i18n.t('actions.transfer_airtime.name', 'Send Airtime'),\n    description: i18n.t('actions.transfer_airtime.description', 'Send the contact airtime'),\n    form: AirtimeRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    component: TransferAirtimeComp,\n    aliases: [Types.split_by_airtime],\n    visibility: ONLINE,\n    filter: FeatureFilter.HAS_AIRTIME\n  },\n\n  /** Routers */\n\n  {\n    type: Types.wait_for_image,\n    name: i18n.t('actions.wait_for_image.name', 'Wait for Image'),\n    description: i18n.t('actions.wait_for_image.description', 'Wait for an image'),\n    form: WaitRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    visibility: SURVEY\n  },\n  {\n    type: Types.wait_for_video,\n    name: i18n.t('actions.wait_for_video.name', 'Wait for Video'),\n    description: i18n.t('actions.wait_for_video.description', 'Wait for a video'),\n    form: WaitRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    visibility: SURVEY\n  },\n  {\n    type: Types.wait_for_location,\n    name: i18n.t('actions.wait_for_location.name', 'Wait for Location'),\n    description: i18n.t(\n      'actions.wait_for_location.description',\n      'Wait for location GPS coordinates'\n    ),\n    form: WaitRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    visibility: SURVEY\n  },\n  {\n    type: Types.split_by_intent,\n    name: i18n.t('actions.split_by_intent.name', 'Split by Intent'),\n    description: i18n.t('actions.split_by_intent.description', 'Split by intent'),\n    form: ClassifyRouterForm,\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    component: CallClassifierComp,\n    aliases: [Types.call_classifier],\n    visibility: ONLINE,\n    filter: FeatureFilter.HAS_CLASSIFIER\n  },\n  {\n    type: Types.split_by_expression,\n    name: i18n.t('actions.split_by_expression.name', 'Split by Expression'),\n    description: i18n.t('actions.split_by_expression.description', 'Split by a custom expression'),\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits', 'cases'],\n    form: ExpressionRouterForm\n  },\n  {\n    type: Types.split_by_contact_field,\n    name: i18n.t('actions.split_by_contact_field.name', 'Split by Contact Field'),\n    description: i18n.t('actions.split_by_contact_field.description', 'Split by a contact field'),\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits', 'cases'],\n    form: FieldRouterForm\n  },\n  {\n    type: Types.split_by_run_result,\n    aliases: [Types.split_by_run_result_delimited],\n    name: i18n.t('actions.split_by_run_result.name', 'Split by Flow Result'),\n    description: i18n.t('actions.split_by_run_result.description', 'Split by a result in the flow'),\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits', 'cases'],\n    form: ResultRouterForm\n  },\n  {\n    type: Types.split_by_random,\n    name: i18n.t('actions.split_by_random.name', 'Split Randomly'),\n    description: i18n.t('actions.split_by_random.description', 'Split by random chance'),\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    form: RandomRouterForm\n  },\n  {\n    type: Types.split_by_groups,\n    name: i18n.t('actions.split_by_groups.name', 'Split by Collection Membership'),\n    description: i18n.t('actions.split_by_groups.description', 'Split by Collection Membership'),\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    form: GroupsRouterForm\n  },\n  {\n    type: Types.split_by_scheme,\n    name: i18n.t('actions.split_by_scheme.name', 'Split by URN Type'),\n    description: i18n.t('actions.split_by_scheme.description', 'Split by URN type'),\n    localization: RouterLocalizationForm,\n    localizeableKeys: ['exits'],\n    form: SchemeRouterForm\n  }\n  // {type: 'random', name: 'Random Split', description: 'Split them up randomly', form: RandomRouterForm}\n];\n\nexport const configsToDisplay = dedupeTypeConfigs(typeConfigList);\n\nexport const typeConfigMap: TypeMap = typeConfigList.reduce((map: TypeMap, typeConfig: Type) => {\n  map[typeConfig.type] = typeConfig;\n  if (typeConfig.aliases) {\n    typeConfig.aliases.forEach((alias: string) => (map[alias] = typeConfig));\n  }\n  return map;\n}, {});\n\n/**\n * Shortcut for constant lookup of type config in type configs map\n * @param {string} type - The type of the type config to return, e.g. 'send_msg'\n * @returns {Object} - The type config found at typeConfigs[type] or -1\n */\nexport const getTypeConfig = (type: Types | RouterTypes): Type => {\n  let config = typeConfigMap[type];\n\n  if (!config) {\n    config = typeConfigMap.missing;\n  }\n  return config;\n};\n\nexport const getType = (renderNode: RenderNode): any => {\n  const wait = renderNode.node.router && renderNode.node.router.wait;\n  if (wait && wait.hint) {\n    switch (wait.hint.type) {\n      case HintTypes.digits:\n        if (wait.hint.count === 1) {\n          return Types.wait_for_menu;\n        }\n        return Types.wait_for_digits;\n      case HintTypes.audio:\n        return Types.wait_for_audio;\n      case HintTypes.image:\n        return Types.wait_for_image;\n      case HintTypes.location:\n        return Types.wait_for_location;\n      case HintTypes.video:\n        return Types.wait_for_video;\n    }\n  }\n\n  // if we are splitting by field, but don't know the name, force it into split by expression\n  if (renderNode.ui.type === Types.split_by_contact_field && !renderNode.ui.config.operand.name) {\n    return Types.split_by_expression;\n  }\n\n  return renderNode.ui.type;\n};\n\nexport const hasFeature = (config: FlowEditorConfig, filter: FeatureFilter) => {\n  return !!(config.filters || []).find((name: string) => name === filter);\n};\n","import { getActionUUID } from 'components/flow/actions/helpers';\nimport {\n  CHANNEL_PROPERTY,\n  LANGUAGE_PROPERTY,\n  NAME_PROPERTY,\n  STATUS_PROPERTY\n} from 'components/flow/props';\nimport { Types, ContactStatus } from 'config/interfaces';\nimport { getTypeConfig } from 'config/typeConfigs';\nimport {\n  Field,\n  SetContactAttribute,\n  SetContactChannel,\n  SetContactField,\n  SetContactLanguage,\n  SetContactName,\n  SetContactStatus\n} from 'flowTypes';\nimport { Asset, AssetMap, AssetStore, AssetType, REMOVE_VALUE_ASSET } from 'store/flowContext';\nimport {\n  FormState,\n  NodeEditorSettings,\n  StringEntry,\n  SelectOptionEntry,\n  FormEntry\n} from 'store/nodeEditor';\nimport {\n  CONTACT_STATUS_OPTIONS,\n  CONTACT_STATUS_ACTIVE\n} from 'components/flow/actions/updatecontact/UpdateContactForm';\n\nexport interface UpdateContactFormState extends FormState {\n  type: Types;\n  name: StringEntry;\n  channel: FormEntry;\n  language: FormEntry;\n  status: SelectOptionEntry;\n  field: FormEntry;\n  fieldValue: StringEntry;\n}\n\nexport const initializeForm = (\n  settings: NodeEditorSettings,\n  assetStore: AssetStore\n): UpdateContactFormState => {\n  const state: UpdateContactFormState = {\n    type: Types.set_contact_name,\n    valid: false,\n    name: { value: '' },\n    channel: { value: null },\n    language: { value: null },\n    status: { value: CONTACT_STATUS_ACTIVE },\n    field: { value: NAME_PROPERTY },\n    fieldValue: { value: '' }\n  };\n\n  if (settings.originalAction) {\n    const originalType = settings.originalAction.type;\n    // these have aliases, so compare the config we resolve to\n    if (getTypeConfig(originalType) === getTypeConfig(Types.set_contact_field)) {\n      state.type = originalType;\n\n      switch (originalType) {\n        case Types.set_contact_field:\n          const fieldAction = settings.originalAction as SetContactField;\n          state.field = { value: { key: fieldAction.field.key, label: fieldAction.field.name } };\n          state.fieldValue = { value: fieldAction.value };\n          state.valid = true;\n          return state;\n        case Types.set_contact_channel:\n          const channelAction = settings.originalAction as SetContactChannel;\n          state.field = { value: CHANNEL_PROPERTY };\n          state.channel = {\n            value: channelAction.channel ? channelAction.channel : REMOVE_VALUE_ASSET\n          };\n          state.valid = true;\n          return state;\n        case Types.set_contact_language:\n          const languageAction = settings.originalAction as SetContactLanguage;\n          state.field = { value: LANGUAGE_PROPERTY };\n          state.valid = true;\n          state.language = {\n            value: languageAction.language\n              ? {\n                  iso: languageAction.language,\n                  name: getLanguageForCode(languageAction.language, assetStore.languages.items)\n                }\n              : REMOVE_VALUE_ASSET\n          };\n          return state;\n        case Types.set_contact_status:\n          const statusAction = settings.originalAction as SetContactStatus;\n          state.field = { value: STATUS_PROPERTY };\n          state.valid = true;\n          state.status = {\n            value: CONTACT_STATUS_OPTIONS.find(o => o.value === statusAction.status)\n          };\n          return state;\n        case Types.set_contact_name:\n          const nameAction = settings.originalAction as SetContactName;\n          state.valid = true;\n          state.name = {\n            value: nameAction.name\n          };\n          return state;\n      }\n    }\n  }\n\n  // default is updating name\n  return state;\n};\n\nexport const stateToAction = (\n  settings: NodeEditorSettings,\n  state: UpdateContactFormState\n): SetContactAttribute => {\n  /* istanbul ignore else */\n  const field = state.field.value;\n  if (state.type === Types.set_contact_field) {\n    return {\n      uuid: getActionUUID(settings, Types.set_contact_field),\n      type: state.type,\n      field: { name: field.label, key: field.key },\n      value: state.fieldValue.value\n    };\n  } else if (state.type === Types.set_contact_channel) {\n    if (state.channel.value.type === REMOVE_VALUE_ASSET.type) {\n      return {\n        uuid: getActionUUID(settings, Types.set_contact_channel),\n        type: state.type\n      } as any;\n    }\n    return {\n      uuid: getActionUUID(settings, Types.set_contact_channel),\n      type: state.type,\n      channel: state.channel.value\n    };\n  } else if (state.type === Types.set_contact_language) {\n    if (state.language.value.type === REMOVE_VALUE_ASSET.type) {\n      return {\n        uuid: getActionUUID(settings, Types.set_contact_language),\n        type: state.type\n      } as any;\n    }\n    return {\n      uuid: getActionUUID(settings, Types.set_contact_language),\n      type: state.type,\n      language: state.language.value.iso\n    };\n  } else if (state.type === Types.set_contact_status) {\n    return {\n      uuid: getActionUUID(settings, Types.set_contact_status),\n      type: state.type,\n      status: state.status.value.value as ContactStatus\n    };\n  } else if (state.type === Types.set_contact_name) {\n    return {\n      uuid: getActionUUID(settings, Types.set_contact_name),\n      type: state.type,\n      name: state.name.value\n    };\n  }\n};\n\nexport const sortFieldsAndProperties = (a: any, b: any): number => {\n  const aType = a.type || '';\n  const bType = b.type || '';\n\n  const aName = a.name || a.label || '';\n  const bName = b.name || b.label || '';\n\n  // Name always goes first\n  /* istanbul ignore else */\n  if (a.id === NAME_PROPERTY.id && b.id !== NAME_PROPERTY.id) {\n    return -1;\n  } else if (b.id === NAME_PROPERTY.id && a.id !== NAME_PROPERTY.id) {\n    return 1;\n  }\n\n  if (aType === bType) {\n    return aName.localeCompare(bName);\n  }\n\n  if (aType === AssetType.Scheme) {\n    return 1;\n  }\n\n  if (bType === AssetType.Scheme) {\n    return -1;\n  }\n\n  // go with alpha-sort for everthing else\n  else if (aType !== bType) {\n    if (aType === AssetType.ContactProperty) {\n      return -1;\n    }\n\n    if (bType === AssetType.ContactProperty) {\n      return 1;\n    }\n  }\n  // non-name non-fields go last\n  return aName.localeCompare(bName);\n};\n\nexport const fieldToAsset = (field: Field = { key: '', name: '' }): Asset => ({\n  id: field.key,\n  name: field.name,\n  type: AssetType.Field\n});\n\nexport const assetToField = (asset: Asset): Field => ({\n  key: asset.id,\n  name: asset.name\n});\n\nexport const assetToChannel = (asset: Asset): any => {\n  if (asset.id === REMOVE_VALUE_ASSET.id) {\n    return {};\n  }\n\n  return {\n    uuid: asset.id,\n    name: asset.name\n  };\n};\n\nexport const getLanguageForCode = (code: string, languages: AssetMap) => {\n  let lang = code;\n  if (languages && lang in languages) {\n    lang = languages[lang].name;\n  }\n  return lang;\n};\n\nexport const getName = (asset: any): string => {\n  return asset.label || asset.name || asset.key;\n};\n","import { FlowPosition } from 'flowTypes';\r\nimport ActionTypes, { UpdateEditorState } from 'store/actionTypes';\r\nimport Constants from 'store/constants';\r\nimport { Asset, RenderNode, CompletionOption } from 'store/flowContext';\r\nimport { CompletionSchema } from 'utils/completion';\r\n\r\n// tslint:disable:no-shadowed-variable\r\nexport interface DragSelection {\r\n  startX?: number;\r\n  startY?: number;\r\n  currentX?: number;\r\n  currentY?: number;\r\n}\r\n\r\nexport interface DebugState {\r\n  showUUIDs: boolean;\r\n}\r\n\r\nexport interface CanvasPositions {\r\n  [uuid: string]: FlowPosition;\r\n}\r\n\r\nexport interface Activity {\r\n  nodes: { [uuid: string]: number };\r\n  segments: { [exitToNodeKey: string]: number };\r\n  recentMessages?: { [key: string]: RecentMessage[] };\r\n  is_starting?: boolean;\r\n}\r\n\r\nexport interface RecentMessage {\r\n  sent: string;\r\n  text: string;\r\n}\r\n\r\nexport interface Warning {\r\n  name: string;\r\n  type: string;\r\n}\r\n\r\nexport type Warnings = { [uuid: string]: Warning };\r\n\r\nexport interface EditorState {\r\n  currentRevision: number | null;\r\n  simulating: boolean;\r\n  language: Asset | null;\r\n  translating: boolean;\r\n  fetchingFlow: boolean;\r\n  ghostNode: RenderNode | null;\r\n  dragActive: boolean;\r\n  dragStartTime: number;\r\n  dragDownPosition: FlowPosition | null;\r\n  dragNodeUUID: string | null;\r\n  dragGroup: boolean;\r\n  dragSelection: DragSelection | null;\r\n  debug?: DebugState | null;\r\n\r\n  // which poptab is popped\r\n  popped: string;\r\n\r\n  warnings: Warnings;\r\n\r\n  modalMessage?: ModalMessage;\r\n  saving?: boolean;\r\n\r\n  // our schema for peform dot completion\r\n  completionSchema: CompletionSchema;\r\n\r\n  // our function list for completion\r\n  functions: CompletionOption[];\r\n\r\n  // the currently shown activity, can be\r\n  // simulation or live\r\n  activity: Activity;\r\n\r\n  // the current live activity\r\n  liveActivity: Activity;\r\n\r\n  // interval in millis we should refresh activity\r\n  activityInterval: number;\r\n\r\n  // is our page visible or tabbed away\r\n  visible: boolean;\r\n\r\n  scrollToNode: string;\r\n  scrollToAction: string;\r\n}\r\n\r\nexport interface ModalMessage {\r\n  title: string;\r\n  body: string;\r\n}\r\n\r\nexport const EMPTY_DRAG_STATE: any = {\r\n  dragStartTime: 0,\r\n  dragDownPosition: null,\r\n  dragActive: false,\r\n  dragNodeUUID: null,\r\n  dragGroup: false,\r\n  dragSelection: null\r\n};\r\n\r\n// Initial state\r\nexport const initialState: EditorState = {\r\n  completionSchema: { types: [], root: [] },\r\n  functions: [],\r\n  currentRevision: null,\r\n  simulating: false,\r\n  translating: false,\r\n  language: null,\r\n  fetchingFlow: false,\r\n  dragStartTime: 0,\r\n  dragDownPosition: null,\r\n  dragActive: false,\r\n  dragNodeUUID: null,\r\n  dragGroup: false,\r\n  dragSelection: null,\r\n  ghostNode: null,\r\n  debug: null,\r\n  warnings: {},\r\n\r\n  popped: null,\r\n\r\n  activity: { segments: {}, nodes: {} },\r\n  liveActivity: { segments: {}, nodes: {} },\r\n  activityInterval: 5000,\r\n  visible: true,\r\n\r\n  scrollToNode: null,\r\n  scrollToAction: null\r\n};\r\n\r\n// Action Creator\r\nexport const updateEditorState = (editorState: EditorState): UpdateEditorState => ({\r\n  type: Constants.UPDATE_EDITOR_STATE,\r\n  payload: {\r\n    editorState\r\n  }\r\n});\r\n\r\n/* Reducer */\r\nexport const editorState = (editorState: EditorState = initialState, action: ActionTypes) => {\r\n  switch (action.type) {\r\n    case Constants.UPDATE_EDITOR_STATE:\r\n      return action.payload!.editorState;\r\n    default:\r\n      return editorState;\r\n  }\r\n};\r\n\r\n// export our reducer\r\nexport default editorState;\r\n","import { determineTypeConfig } from 'components/flow/helpers';\nimport { getResultName } from 'components/flow/node/helpers';\nimport { getSwitchRouter } from 'components/flow/routers/helpers';\nimport { SaveResult } from 'components/revisions/RevisionExplorer';\nimport { FlowTypes, Type, Types } from 'config/interfaces';\nimport { getTypeConfig } from 'config/typeConfigs';\nimport {\n  createAssetStore,\n  getCompletionSchema,\n  getFlowDetails,\n  saveRevision,\n  getFunctions\n} from 'external';\nimport isEqual from 'fast-deep-equal';\nimport {\n  Action,\n  AnyAction,\n  Category,\n  Dimensions,\n  Endpoints,\n  Exit,\n  FlowDefinition,\n  FlowNode,\n  SendMsg,\n  SetContactField,\n  SetRunResult,\n  StickyNote,\n  FlowDetails\n} from 'flowTypes';\nimport mutate from 'immutability-helper';\nimport { Dispatch } from 'redux';\nimport { CanvasPositions, EditorState, EMPTY_DRAG_STATE, updateEditorState } from 'store/editor';\nimport {\n  Asset,\n  AssetStore,\n  DEFAULT_LANGUAGE,\n  RenderNode,\n  RenderNodeMap,\n  updateAssets,\n  updateBaseLanguage,\n  updateContactFields,\n  updateDefinition,\n  updateNodes,\n  updateMetadata,\n  updateIssues\n} from 'store/flowContext';\nimport {\n  createEmptyNode,\n  fetchFlowActivity,\n  getActionIndex,\n  getCurrentDefinition,\n  getFlowComponents,\n  getLocalizations,\n  getNode,\n  guessNodeType,\n  mergeAssetMaps,\n  createFlowIssueMap\n} from 'store/helpers';\nimport * as mutators from 'store/mutators';\nimport {\n  NodeEditorSettings,\n  updateNodeEditorSettings,\n  updateTypeConfig,\n  updateUserAddingAction\n} from 'store/nodeEditor';\nimport AppState from 'store/state';\nimport { createUUID, hasString, NODE_SPACING, timeEnd, timeStart, ACTIVITY_INTERVAL } from 'utils';\nimport { AxiosError } from 'axios';\nimport i18n from 'config/i18n';\nimport { TembaStore } from 'temba-components';\n\n// TODO: Remove use of Function\n// tslint:disable:ban-types\nexport type DispatchWithState = Dispatch<AppState>;\n\nexport type GetState = () => AppState;\n\nexport type Thunk<T> = (dispatch: Dispatch<AppState>, getState?: GetState) => T;\n\nexport type AsyncThunk = Thunk<Promise<void>>;\n\nexport type OnAddToNode = (node: FlowNode) => Thunk<void>;\n\nexport type HandleTypeConfigChange = (typeConfig: Type) => Thunk<void>;\n\nexport type UpdateTranslationFilters = (translationFilters: {\n  categories: boolean;\n  rules: boolean;\n}) => Thunk<void>;\n\nexport type OnOpenNodeEditor = (settings: NodeEditorSettings) => Thunk<void>;\n\nexport type OnUpdateCanvasPositions = (positions: CanvasPositions) => Thunk<RenderNodeMap>;\n\nexport type OnRemoveNodes = (nodeUUIDs: string[]) => Thunk<RenderNodeMap>;\n\nexport type AddAsset = (assetType: string, asset: Asset) => Thunk<void>;\n\nexport type RemoveNode = (nodeToRemove: FlowNode) => Thunk<RenderNodeMap>;\n\nexport type UpdateDimensions = (uuid: string, dimensions: Dimensions) => Thunk<void>;\n\nexport type FetchFlow = (\n  endpoints: Endpoints,\n  uuid: string,\n  forceSave: boolean\n) => Thunk<Promise<void>>;\n\nexport type LoadFlowDefinition = (details: FlowDetails, assetStore: AssetStore) => Thunk<void>;\n\nexport type CreateNewRevision = () => Thunk<void>;\n\nexport type NoParamsAC = () => Thunk<void>;\n\nexport type UpdateConnection = (source: string, target: string) => Thunk<RenderNodeMap>;\n\nexport type OnConnectionDrag = (event: ConnectionEvent, flowType: FlowTypes) => Thunk<void>;\n\nexport type OnUpdateLocalizations = (\n  language: string,\n  changes: LocalizationUpdates\n) => Thunk<FlowDefinition>;\n\nexport type UpdateSticky = (stickyUUID: string, sticky: StickyNote) => Thunk<void>;\n\nexport type OnUpdateAction = (\n  action: AnyAction,\n  onUpdated?: (dispatch: DispatchWithState, getState: GetState) => void\n) => Thunk<RenderNodeMap>;\n\nexport type ActionAC = (nodeUUID: string, action: AnyAction) => Thunk<RenderNodeMap>;\n\nexport type DisconnectExit = (nodeUUID: string, exitUUID: string) => Thunk<RenderNodeMap>;\n\nexport type HandleLanguageChange = (language: Asset) => Thunk<void>;\n\nexport type MergeEditorState = (state: Partial<EditorState>) => Thunk<EditorState>;\n\nexport interface ReplaceAction {\n  nodeUUID: string;\n  actionUUID: string;\n}\n\nexport type OnUpdateRouter = (node: RenderNode) => Thunk<RenderNodeMap>;\n\nexport interface Connection {\n  previousConnection: Connection;\n}\n\nexport interface ConnectionEvent {\n  connection: Connection;\n  source: Element;\n  target: Element;\n  sourceId: string;\n  targetId: string;\n  suspendedElementId: string;\n  endpoints: any[];\n}\n\nexport interface ErrorMessage {\n  status: string;\n  description: string;\n}\n\nexport type LocalizationUpdates = Array<{ uuid: string; translations?: any }>;\nconst QUIET_SAVE = 1000;\nconst SAVE_ALERT_MILLIS = 1000 * 60;\n\nlet markDirty: (quiet?: number) => void = () => {};\nlet lastDirtyAttemptTimeout: any = null;\nlet postingRevision = false;\n\nlet lastDirtyMillis: number = 0;\nlet lastSuccessfulMillis: number = 0;\n\nconst NETWORK_ERROR = i18n.t(\n  'errors.network',\n  'Hmm, we ran into a problem trying to save your changes. It could just be that your internet connection is not working well at the moment. Please wait a minute or so and try again.'\n);\n\nexport const createSaveMonitor = (dispatch: DispatchWithState) => {\n  window.setInterval(() => {\n    if (\n      lastSuccessfulMillis < lastDirtyMillis &&\n      new Date().getTime() - lastDirtyMillis > SAVE_ALERT_MILLIS\n    ) {\n      dispatch(\n        mergeEditorState({\n          modalMessage: {\n            title: \"Uh oh, we couldn't save your changes\",\n            body: NETWORK_ERROR\n          },\n          saving: false\n        })\n      );\n    }\n  }, 5000);\n};\n\nexport const createDirty = (\n  revisionsEndpoint: string,\n  dispatch: DispatchWithState,\n  getState: GetState\n) => (quiet: number = QUIET_SAVE) => {\n  lastDirtyMillis = new Date().getTime();\n\n  if (lastDirtyAttemptTimeout) {\n    window.clearTimeout(lastDirtyAttemptTimeout);\n  }\n\n  const {\n    flowContext: { definition, nodes, assetStore, issues },\n    editorState: { currentRevision }\n  } = getState();\n\n  dispatch(mergeEditorState({ saving: true }));\n\n  // make sure we have the most current revision number we know about\n  const newDefinition = getCurrentDefinition(definition, nodes, true);\n  newDefinition.revision = currentRevision;\n\n  if (postingRevision) {\n    lastDirtyAttemptTimeout = window.setTimeout(() => {\n      markDirty();\n    }, QUIET_SAVE);\n    return;\n  }\n\n  lastDirtyAttemptTimeout = window.setTimeout(() => {\n    postingRevision = true;\n    saveRevision(revisionsEndpoint, newDefinition).then(\n      (result: SaveResult) => {\n        const revision = result.revision;\n        definition.revision = revision.revision;\n        dispatch(updateDefinition(definition));\n\n        if (result.metadata) {\n          dispatch(updateMetadata(result.metadata));\n          dispatch(updateIssues(createFlowIssueMap(issues, result.metadata.issues)));\n        }\n\n        const updatedAssets = mutators.addRevision(assetStore, revision);\n        dispatch(updateAssets(updatedAssets));\n        dispatch(\n          mergeEditorState({\n            currentRevision: revision.revision,\n            saving: false,\n            activityInterval: ACTIVITY_INTERVAL\n          })\n        );\n\n        lastSuccessfulMillis = new Date().getTime();\n        postingRevision = false;\n      },\n      (error: AxiosError) => {\n        const errorMessage = error.response\n          ? (error.response.data as ErrorMessage).description\n          : NETWORK_ERROR;\n\n        const body = errorMessage;\n        dispatch(\n          mergeEditorState({\n            modalMessage: {\n              title: \"Uh oh, we couldn't save your changes\",\n              body\n            },\n            saving: false\n          })\n        );\n        postingRevision = false;\n      }\n    );\n  }, quiet);\n};\n\nexport const mergeEditorState = (changes: Partial<EditorState>) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): EditorState => {\n  const { editorState } = getState();\n  const updated = mutate(editorState, { $merge: changes });\n  dispatch(updateEditorState(updated));\n  return updated;\n};\n\nexport const createNewRevision = () => (dispatch: DispatchWithState, getState: GetState): void => {\n  // mark us dirty with no quiet period\n  markDirty(0);\n};\n\nexport const loadFlowDefinition = (details: FlowDetails, assetStore: AssetStore) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): void => {\n  // first see if we need our asset store initialized\n\n  const definition = details.definition;\n\n  const {\n    flowContext: { issues },\n    editorState: { fetchingFlow }\n  } = getState();\n\n  if (!fetchingFlow) {\n    // mark us as underway\n    dispatch(mergeEditorState({ fetchingFlow: true }));\n  }\n\n  // while we don't officially support doing it, lets make a best effort to load\n  // definitions that don't have _ui information (created outside of the editor)\n  definition.localization = definition.localization || {};\n  definition._ui = definition._ui || { nodes: {}, languages: [], stickies: {} };\n\n  // make sure we have a ui entry for each node\n  let currentTop = 0;\n  for (const node of definition.nodes) {\n    if (!definition._ui.nodes[node.uuid]) {\n      definition._ui.nodes[node.uuid] = {\n        position: { left: 0, top: currentTop },\n        type: guessNodeType(node)\n      };\n      currentTop += 150;\n    }\n  }\n\n  // add assets we found in our flow to our asset store\n  const components = getFlowComponents(definition);\n  mergeAssetMaps(assetStore.fields.items, components.fields);\n  mergeAssetMaps(assetStore.groups.items, components.groups);\n  mergeAssetMaps(assetStore.labels.items, components.labels);\n  mergeAssetMaps(assetStore.results.items, components.results);\n\n  // initialize our language\n  let language: Asset;\n  if (definition.language) {\n    language = assetStore.languages.items[definition.language];\n  }\n\n  if (!language) {\n    language = DEFAULT_LANGUAGE;\n    dispatch(mergeEditorState({ language: DEFAULT_LANGUAGE }));\n    mergeAssetMaps(assetStore.languages.items, { base: DEFAULT_LANGUAGE });\n  }\n\n  if (details.metadata && details.metadata.issues) {\n    dispatch(updateIssues(createFlowIssueMap(issues, details.metadata.issues)));\n  } else {\n    dispatch(updateIssues({}));\n  }\n\n  dispatch(updateBaseLanguage(language));\n  dispatch(updateMetadata(details.metadata));\n\n  // store our flow definition without any nodes\n  dispatch(updateDefinition(mutators.pruneDefinition(definition)));\n  dispatch(updateNodes(components.renderNodeMap));\n\n  // finally update our assets, and mark us as fetched\n  dispatch(updateAssets(assetStore));\n  dispatch(mergeEditorState({ language, fetchingFlow: false }));\n\n  const store: TembaStore = document.querySelector('temba-store');\n  if (store) {\n    store.setKeyedAssets('results', Object.keys(assetStore.results.items));\n  }\n};\n\n/**\n * Fetches a flow. Fetches all assets as well if the haven't been initialized yet\n * @param endpoints where our assets live\n * @param uuid the uuid for the flow to fetch\n */\nexport const fetchFlow = (endpoints: Endpoints, uuid: string, forceSave = false) => async (\n  dispatch: DispatchWithState,\n  getState: GetState\n) => {\n  // mark us as underway\n  dispatch(mergeEditorState({ fetchingFlow: true }));\n\n  // first see if we need our asset store initialized\n  let {\n    flowContext: { assetStore }\n  } = getState();\n\n  if (!Object.keys(assetStore).length) {\n    assetStore = await createAssetStore(endpoints);\n  }\n\n  fetchFlowActivity(endpoints.activity, dispatch, getState, uuid);\n  (window as any).triggerActivityUpdate = () => {\n    fetchFlowActivity(endpoints.activity, dispatch, getState, uuid);\n  };\n\n  const completionSchema = await getCompletionSchema(endpoints.completion);\n  const functions = await getFunctions(endpoints.functions);\n\n  getFlowDetails(assetStore.revisions)\n    .then((response: any) => {\n      // backwards compatibitly for during deployment\n      const details: FlowDetails = response.definition\n        ? response\n        : { definition: response as FlowDefinition, metadata: { issues: [] } };\n\n      dispatch(loadFlowDefinition(details, assetStore));\n      dispatch(\n        mergeEditorState({\n          currentRevision: details.definition.revision,\n          completionSchema,\n          functions\n        })\n      );\n\n      markDirty = createDirty(assetStore.revisions.endpoint, dispatch, getState);\n      if (forceSave) {\n        markDirty(0);\n      }\n\n      createSaveMonitor(dispatch);\n    })\n    .catch(error => {\n      // not much we can do without our flow definition\n      // log it to the console, this should really only happen if\n      // misconfigured or the endpoint is unavailable\n      console.error(error);\n    });\n};\n\nexport const addAsset: AddAsset = (assetType: string, asset: Asset) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): void => {\n  const {\n    flowContext: { assetStore }\n  } = getState();\n\n  const updated = mutate(assetStore, {\n    [assetType]: { items: { $merge: { [asset.id]: asset } } }\n  });\n\n  // update our temba store if we have one\n  const store: TembaStore = document.querySelector('temba-store');\n  if (store) {\n    store.setKeyedAssets(assetType, Object.keys(updated[assetType]));\n  }\n\n  dispatch(updateAssets(updated));\n};\n\nexport const handleLanguageChange: HandleLanguageChange = language => (dispatch, getState) => {\n  const {\n    flowContext: { baseLanguage },\n    editorState: { translating, language: currentLanguage }\n  } = getState();\n\n  // determine translating state\n  if (!isEqual(language, baseLanguage)) {\n    if (!translating) {\n      dispatch(mergeEditorState({ translating: true }));\n    }\n  } else {\n    dispatch(mergeEditorState({ translating: false }));\n  }\n\n  // update language\n  if (!isEqual(language, currentLanguage)) {\n    dispatch(mergeEditorState({ language }));\n  }\n};\n\nexport const onUpdateLocalizations = (language: string, changes: LocalizationUpdates) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): FlowDefinition => {\n  const {\n    flowContext: { definition }\n  } = getState();\n  const updated = mutators.updateLocalization(definition, language, changes);\n  dispatch(updateDefinition(updated));\n\n  markDirty();\n  return updated;\n};\n\nexport const updateExitDestination = (nodeUUID: string, exitUUID: string, destination: string) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): RenderNodeMap => {\n  const {\n    flowContext: { nodes }\n  } = getState();\n  const updated = mutators.updateConnection(nodes, nodeUUID, exitUUID, destination);\n  dispatch(updateNodes(updated));\n  markDirty();\n  return updated;\n};\n\nexport const disconnectExit = (nodeUUID: string, exitUUID: string) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): RenderNodeMap => dispatch(updateExitDestination(nodeUUID, exitUUID, null));\n\nexport const updateConnection = (source: string, target: string) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): RenderNodeMap => {\n  const [nodeUUID, exitUUID] = source.split(':');\n  return dispatch(updateExitDestination(nodeUUID, exitUUID, target));\n};\n\nexport const removeNode = (node: FlowNode) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): RenderNodeMap => {\n  // Remove result name if node has one\n  const {\n    flowContext: { nodes, assetStore }\n  } = getState();\n\n  // update asset store to remove results that no longer exist\n  if (node.router && node.router.result_name) {\n    const updatedAssets = mutators.removeResultFromStore(node.router.result_name, assetStore, {\n      nodeUUID: node.uuid\n    });\n    dispatch(updateAssets(updatedAssets));\n  }\n\n  const updated = mutators.removeNode(nodes, node.uuid);\n  dispatch(updateNodes(updated));\n  markDirty();\n  return updated;\n};\n\nexport const removeAction = (nodeUUID: string, action: AnyAction) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): RenderNodeMap => {\n  const {\n    flowContext: { nodes, assetStore }\n  } = getState();\n  const renderNode = nodes[nodeUUID];\n\n  // update asset store to remove results that no longer exist\n  if (action.type === Types.set_run_result) {\n    const resultAction = action as SetRunResult;\n    const updatedAssets = mutators.removeResultFromStore(resultAction.name, assetStore, {\n      nodeUUID,\n      actionUUID: action.uuid\n    });\n    dispatch(updateAssets(updatedAssets));\n  }\n\n  // If it's our last action, then nuke the node\n  if (renderNode.node.actions.length === 1) {\n    const updated = dispatch(removeNode(renderNode.node));\n    markDirty();\n    return updated;\n  } else {\n    // Otherwise, just remove that action\n    const updated = mutators.removeAction(nodes, nodeUUID, action.uuid);\n    dispatch(updateNodes(updated));\n    markDirty();\n    return updated;\n  }\n};\n\nexport const moveActionUp = (nodeUUID: string, action: AnyAction) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): RenderNodeMap => {\n  const {\n    flowContext: { nodes }\n  } = getState();\n  const updated = mutators.moveActionUp(nodes, nodeUUID, action.uuid);\n  dispatch(updateNodes(updated));\n  markDirty();\n  return updated;\n};\n\n/**\n * Splices a router into a list of actions creating up to three nodes where there\n * was once one node.\n * @param nodeUUID the node to replace\n * @param node the new node being added (shares the previous node uuid)\n * @param type the type of the new router\n * @param previousAction the previous action that is being replaced with our router\n * @returns a list of RenderNodes that were created\n */\nexport const spliceInRouter = (\n  newRouterNode: RenderNode,\n  previousAction: { nodeUUID: string; actionUUID: string }\n) => (dispatch: DispatchWithState, getState: GetState): RenderNodeMap => {\n  const {\n    flowContext: { nodes }\n  } = getState();\n  const previousNode = nodes[previousAction.nodeUUID];\n\n  // remove our old node, we'll make new ones\n  let updatedNodes = nodes;\n  updatedNodes = mutators.removeNode(updatedNodes, previousNode.node.uuid, false);\n\n  newRouterNode.node = mutators.uniquifyNode(newRouterNode.node);\n\n  const actionIdx = getActionIndex(previousNode.node, previousAction.actionUUID);\n\n  // we need to splice a wait node where our previousAction was\n  const topActions: Action[] =\n    actionIdx > 0 ? [...previousNode.node.actions.slice(0, actionIdx)] : [];\n  const bottomActions: Action[] = previousNode.node.actions.slice(\n    actionIdx + 1,\n    previousNode.node.actions.length\n  );\n\n  // tslint:disable-next-line:prefer-const\n  let { left, top } = previousNode.ui.position;\n\n  let topNode: RenderNode;\n  let bottomNode: RenderNode;\n\n  // add our top node if we have one\n  if (topActions.length > 0) {\n    topNode = {\n      node: {\n        uuid: createUUID(),\n        actions: topActions,\n        exits: [\n          {\n            uuid: createUUID(),\n            destination_uuid: null\n          }\n        ]\n      },\n      ui: { position: { left, top } },\n      inboundConnections: { ...previousNode.inboundConnections }\n    };\n\n    updatedNodes = mutators.mergeNode(updatedNodes, topNode);\n    top += NODE_SPACING;\n\n    // update our routerNode for the presence of a top node\n    newRouterNode.inboundConnections = {\n      [topNode.node.exits[0].uuid]: topNode.node.uuid\n    };\n    newRouterNode.ui.position.top += NODE_SPACING;\n  } else {\n    newRouterNode.inboundConnections = { ...previousNode.inboundConnections };\n  }\n\n  // now add our routerNode\n  updatedNodes = mutators.mergeNode(updatedNodes, newRouterNode);\n\n  // add our bottom\n  if (bottomActions.length > 0) {\n    bottomNode = {\n      node: {\n        uuid: createUUID(),\n        actions: bottomActions,\n        exits: [\n          {\n            uuid: createUUID(),\n            destination_uuid: previousNode.node.exits[0].destination_uuid\n          }\n        ]\n      },\n      ui: {\n        position: { left, top }\n      },\n      inboundConnections: {\n        [newRouterNode.node.exits[0].uuid]: newRouterNode.node.uuid\n      }\n    };\n    updatedNodes = mutators.mergeNode(updatedNodes, bottomNode);\n  } else {\n    // if we don't have a bottom, route our routerNode to the previous destination\n    updatedNodes = mutators.updateConnection(\n      updatedNodes,\n      newRouterNode.node.uuid,\n      newRouterNode.node.exits[0].uuid,\n      previousNode.node.exits[0].destination_uuid\n    );\n  }\n\n  dispatch(updateNodes(updatedNodes));\n\n  markDirty();\n  return updatedNodes;\n};\n\nexport const handleTypeConfigChange = (typeConfig: Type) => (dispatch: DispatchWithState) => {\n  // TODO: Generate suggested result name if user is changing to a `wait_for_response` router.\n  dispatch(updateTypeConfig(typeConfig));\n};\n\nexport const resetNodeEditingState = () => (dispatch: DispatchWithState, getState: GetState) => {\n  dispatch(mergeEditorState({ ghostNode: null }));\n  dispatch(updateNodeEditorSettings(null));\n};\n\nexport const onUpdateAction = (\n  action: AnyAction,\n  onUpdated?: (dispatch: DispatchWithState, getState: GetState) => void\n) => (dispatch: DispatchWithState, getState: GetState) => {\n  timeStart('onUpdateAction');\n\n  const {\n    nodeEditor: { userAddingAction, settings },\n    flowContext: { nodes, contactFields, assetStore }\n  } = getState();\n\n  if (settings == null || settings.originalNode == null) {\n    throw new Error('Need originalNode in settings to update an action');\n  }\n  const { originalNode, originalAction } = settings;\n\n  let updatedAssets = assetStore;\n\n  // remove our result reference\n  if (originalAction && originalAction.type === Types.set_run_result) {\n    const { name: resultName } = originalAction as SetRunResult;\n    updatedAssets = mutators.removeResultFromStore(resultName, updatedAssets, {\n      nodeUUID: originalNode.node.uuid,\n      actionUUID: action.uuid\n    });\n  }\n\n  let updatedNodes = nodes;\n  const creatingNewNode = !!(originalNode !== null && originalNode.ghost);\n\n  let nodeUUID: string = null;\n\n  if (creatingNewNode) {\n    const newNode: RenderNode = {\n      node: {\n        uuid: createUUID(),\n        actions: [action],\n        exits: [{ uuid: createUUID(), destination_uuid: null }]\n      },\n      ui: { position: originalNode.ui.position, type: Types.execute_actions },\n      inboundConnections: originalNode.inboundConnections\n    };\n    updatedNodes = mutators.mergeNode(nodes, newNode);\n\n    nodeUUID = newNode.node.uuid;\n  } else {\n    nodeUUID = originalNode.node.uuid;\n\n    if (userAddingAction) {\n      updatedNodes = mutators.addAction(nodes, originalNode.node.uuid, action);\n    } else if (originalNode.node.hasOwnProperty('router')) {\n      updatedNodes = mutators.spliceInAction(nodes, originalNode.node.uuid, action);\n    } else {\n      updatedNodes = mutators.updateAction(nodes, originalNode.node.uuid, action, originalAction);\n    }\n  }\n\n  dispatch(updateNodes(updatedNodes));\n  dispatch(updateUserAddingAction(false));\n\n  // Add result to store.\n  if (action.type === Types.set_run_result) {\n    const { name: resultName } = action as SetRunResult;\n    updatedAssets = mutators.addResultToStore(resultName, updatedAssets, {\n      nodeUUID,\n      actionUUID: action.uuid\n    });\n    dispatch(updateAssets(updatedAssets));\n  }\n\n  // Add contact field to our store.\n  if (action.type === Types.set_contact_field) {\n    const { field } = action as SetContactField;\n    dispatch(updateContactFields({ ...contactFields, [field.key]: field.name }));\n  }\n\n  markDirty(0);\n\n  timeEnd('onUpdateAction');\n\n  if (onUpdated) {\n    onUpdated(dispatch, getState);\n  }\n  return updatedNodes;\n};\n\n/**\n * Opens the NodeEditor in the state for adding to a provided node\n * @param node the node to add to\n */\nexport const onAddToNode = (node: FlowNode) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n) => {\n  const {\n    flowContext: { nodes }\n  } = getState();\n\n  // TODO: remove the need for this once we all have formHelpers\n  const newAction: SendMsg = {\n    uuid: createUUID(),\n    type: Types.send_msg,\n    text: ''\n  };\n\n  dispatch(\n    updateNodeEditorSettings({\n      originalNode: getNode(nodes, node.uuid),\n      originalAction: newAction,\n      showAdvanced: false\n    })\n  );\n\n  markDirty();\n  dispatch(updateUserAddingAction(true));\n  dispatch(handleTypeConfigChange(getTypeConfig(Types.send_msg)));\n  dispatch(mergeEditorState(EMPTY_DRAG_STATE));\n};\n\nexport const onRemoveNodes = (uuids: string[]) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): RenderNodeMap => {\n  const {\n    flowContext: { nodes, definition }\n  } = getState();\n\n  let updatedNodes = nodes;\n  let updatedDefinition = definition;\n  let didNodes = false;\n  let didDef = false;\n\n  uuids.forEach((uuid: string) => {\n    if (uuid in updatedNodes) {\n      updatedNodes = mutators.removeNode(updatedNodes, uuid, true);\n      didNodes = true;\n    } else if (uuid in updatedDefinition._ui.stickies) {\n      updatedDefinition = mutators.updateStickyNote(updatedDefinition, uuid, null);\n      didDef = true;\n    }\n  });\n\n  if (didNodes) {\n    dispatch(updateNodes(updatedNodes));\n  }\n\n  if (didDef) {\n    dispatch(updateDefinition(updatedDefinition));\n  }\n\n  if (didDef || didNodes) {\n    markDirty();\n  }\n\n  return nodes;\n};\n\nexport const onUpdateCanvasPositions = (positions: CanvasPositions) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): RenderNodeMap => {\n  const {\n    flowContext: { nodes, definition }\n  } = getState();\n\n  let updatedDefinition = definition;\n  let updatedNodes = nodes;\n\n  let updatedNodePosition = false;\n  let updatedStickyPosition = false;\n\n  for (const uuid in positions) {\n    if (updatedNodes[uuid]) {\n      updatedNodes = mutators.updatePosition(updatedNodes, uuid, positions[uuid]);\n      updatedNodePosition = true;\n    } else if (updatedDefinition._ui.stickies[uuid]) {\n      updatedDefinition = mutators.updateStickyNotePosition(\n        updatedDefinition,\n        uuid,\n        positions[uuid]\n      );\n      updatedStickyPosition = true;\n    }\n  }\n\n  let updated = false;\n\n  if (updatedNodePosition) {\n    updated = true;\n    dispatch(updateNodes(updatedNodes));\n  }\n\n  if (updatedStickyPosition) {\n    updated = true;\n    dispatch(updateDefinition(updatedDefinition));\n  }\n\n  if (updated) {\n    markDirty();\n  }\n\n  return updatedNodes;\n};\n\n/**\n * Called when a connection begins to be dragged from an endpoint both\n * when a new connection is desired or when an existing one is being moved.\n * @param event\n */\nexport const onConnectionDrag = (event: ConnectionEvent, flowType: FlowTypes) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n) => {\n  const {\n    flowContext: { nodes, assetStore }\n  } = getState();\n\n  // We finished dragging a ghost node, create the spec for our new ghost component\n  const [fromNodeUUID, fromExitUUID] = event.sourceId.split(':');\n\n  const fromNode = nodes[fromNodeUUID];\n\n  const names = Object.keys(assetStore.results ? assetStore.results.items : {});\n\n  let resultCount = names.length + 1;\n  let key = `result_${resultCount}`;\n\n  while (hasString(names, key)) {\n    resultCount++;\n    key = `result_${resultCount}`;\n  }\n\n  // set our ghost node\n  const ghostNode = createEmptyNode(fromNode, fromExitUUID, resultCount, flowType);\n  ghostNode.inboundConnections = { [fromExitUUID]: fromNodeUUID };\n  dispatch(mergeEditorState({ ghostNode }));\n};\n\nexport const updateSticky = (uuid: string, sticky: StickyNote) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): void => {\n  const {\n    flowContext: { definition }\n  } = getState();\n\n  const updated = mutators.updateStickyNote(definition, uuid, sticky);\n  dispatch(updateDefinition(updated));\n  markDirty();\n};\n\nexport const onUpdateRouter = (renderNode: RenderNode) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n): RenderNodeMap => {\n  const {\n    flowContext: { nodes, assetStore },\n    nodeEditor: {\n      settings: { originalNode, originalAction }\n    }\n  } = getState();\n\n  let updated = nodes;\n  if (originalNode) {\n    const previousPosition = originalNode.ui.position;\n    renderNode.ui.position = previousPosition;\n    renderNode.inboundConnections = originalNode.inboundConnections;\n  }\n\n  if (originalNode.ghost) {\n    renderNode.inboundConnections = originalNode.inboundConnections;\n    const { left, top } = originalNode.ui.position;\n    renderNode.ui.position = { left, top };\n    renderNode.node = mutators.uniquifyNode(renderNode.node);\n  }\n\n  // update our results\n  const resultName = getResultName(renderNode.node);\n  if (resultName) {\n    let updatedAssets = assetStore;\n\n    // remove our original result name\n    const originalResultName = getResultName(originalNode.node);\n    if (originalResultName) {\n      updatedAssets = mutators.removeResultFromStore(originalResultName, updatedAssets, {\n        nodeUUID: originalNode.node.uuid\n      });\n    }\n\n    updatedAssets = mutators.addFlowResult(updatedAssets, renderNode.node);\n    dispatch(updateAssets(updatedAssets));\n  }\n\n  if (\n    originalNode &&\n    originalAction &&\n    !originalNode.ghost &&\n    !getSwitchRouter(originalNode.node)\n  ) {\n    const actionToSplice = originalNode.node.actions.find(\n      (action: Action) => action.uuid === originalAction.uuid\n    );\n\n    if (actionToSplice) {\n      // if we are splicing using the original top\n      renderNode.ui.position.top = originalNode.ui.position.top;\n\n      return dispatch(\n        spliceInRouter(renderNode, {\n          nodeUUID: originalNode.node.uuid,\n          actionUUID: actionToSplice.uuid\n        })\n      );\n    }\n\n    // didn't recognize that action, let's add a new router node\n    // if we are appendeng in, see if we need to route through\n    const switchRouter = getSwitchRouter(renderNode.node);\n    if (switchRouter) {\n      const defaultCategory = switchRouter.categories.find(\n        (cat: Category) => cat.uuid === switchRouter.default_category_uuid\n      );\n      const exitToUpdate = renderNode.node.exits.find(\n        (exit: Exit) => exit.uuid === defaultCategory.exit_uuid\n      );\n\n      exitToUpdate.destination_uuid = originalNode.node.exits[0].destination_uuid;\n    }\n\n    renderNode.inboundConnections = {\n      [originalNode.node.exits[0].uuid]: originalNode.node.uuid\n    };\n    renderNode.node = mutators.uniquifyNode(renderNode.node);\n    renderNode.ui.position.top += NODE_SPACING;\n    updated = mutators.mergeNode(updated, renderNode);\n  } else {\n    updated = mutators.mergeNode(updated, renderNode);\n  }\n\n  dispatch(updateNodes(updated));\n\n  markDirty(0);\n  return updated;\n};\n\nexport const onOpenNodeEditor = (settings: NodeEditorSettings) => (\n  dispatch: DispatchWithState,\n  getState: GetState\n) => {\n  const {\n    flowContext: {\n      definition: { localization }\n    },\n    editorState: { language, translating }\n  } = getState();\n\n  const { originalNode: renderNode } = settings;\n  let { originalAction: action } = settings;\n\n  const node = renderNode.node;\n\n  // stuff our localization objects in our settings\n  settings.localizations = [];\n  if (translating) {\n    let actionToTranslate = action;\n\n    // TODO: this is a hack, would be nice to find how to make that area respond differently\n    // if they clicked just below the actions, treat it as the last action\n    if (!actionToTranslate && node.actions.length > 0) {\n      actionToTranslate = node.actions[node.actions.length - 1];\n      if (\n        actionToTranslate.type !== Types.send_msg &&\n        actionToTranslate.type !== Types.send_broadcast\n      ) {\n        return;\n      }\n    }\n\n    const translations = localization[language.id];\n    settings.localizations.push(\n      ...getLocalizations(node, actionToTranslate, language, translations)\n    );\n  }\n\n  // Account for hybrids or clicking on the empty exit table\n  if (!action && node.actions.length > 0) {\n    action = node.actions[node.actions.length - 1];\n  }\n\n  const typeConfig = determineTypeConfig(settings);\n  dispatch(handleTypeConfigChange(typeConfig));\n  dispatch(updateNodeEditorSettings(settings));\n  dispatch(mergeEditorState(EMPTY_DRAG_STATE));\n};\n\nexport const updateTranslationFilters = (translationFilters: {\n  categories: boolean;\n  rules: boolean;\n}) => (dispatch: DispatchWithState, getState: GetState): void => {\n  const {\n    flowContext: { definition }\n  } = getState();\n\n  definition._ui.translation_filters = translationFilters;\n  dispatch(updateDefinition(definition));\n  markDirty();\n};\n","import { fieldToAsset } from 'components/flow/actions/updatecontact/helpers';\nimport { getResultName } from 'components/flow/node/helpers';\nimport { DefaultExitNames } from 'components/flow/routers/constants';\nimport { getSwitchRouter } from 'components/flow/routers/helpers';\nimport { GROUPS_OPERAND } from 'components/nodeeditor/constants';\nimport { FlowTypes, Types } from 'config/interfaces';\nimport { getType } from 'config/typeConfigs';\nimport { getActivity } from 'external';\nimport {\n  AddLabels,\n  AnyAction,\n  Category,\n  ChangeGroups,\n  FlowDefinition,\n  FlowNode,\n  FlowPosition,\n  HintTypes,\n  RouterTypes,\n  SetContactField,\n  SetRunResult,\n  StickyNote,\n  SwitchRouter,\n  UIMetaData,\n  Wait,\n  WaitTypes,\n  SendMsg,\n  FlowIssue,\n  FlowIssueType\n} from 'flowTypes';\nimport Localization, { LocalizedObject } from 'services/Localization';\nimport { Activity, EditorState, Warnings } from 'store/editor';\nimport {\n  Asset,\n  AssetMap,\n  AssetType,\n  RenderNode,\n  RenderNodeMap,\n  FlowIssueMap\n} from 'store/flowContext';\nimport { addResult } from 'store/mutators';\nimport { DispatchWithState, GetState, mergeEditorState } from 'store/thunks';\nimport { createUUID, snakify } from 'utils';\n\nexport interface Bounds {\n  left: number;\n  top: number;\n  right: number;\n  bottom: number;\n}\n\ninterface Reflow {\n  uuid: string;\n  bounds: Bounds;\n}\n\n// track if we have an active timeout before issuing a new one\nlet activityTimeout: any = null;\n\nexport const getNodeWithAction = (nodes: RenderNodeMap, actionUUID: string): RenderNode => {\n  for (const nodeUUID of Object.keys(nodes)) {\n    const renderNode = nodes[nodeUUID];\n    for (const action of renderNode.node.actions) {\n      if (action.uuid === actionUUID) {\n        return renderNode;\n      }\n    }\n  }\n};\n\nexport const getNode = (nodes: RenderNodeMap, nodeUUID: string) => {\n  const node = nodes[nodeUUID];\n  if (!node) {\n    throw new Error('Cannot find node ' + nodeUUID);\n  }\n  return node;\n};\n\nexport const getExitIndex = (node: FlowNode, exitUUID: string) => {\n  for (const [exitIdx, exit] of node.exits.entries()) {\n    if (exit.uuid === exitUUID) {\n      return exitIdx;\n    }\n  }\n  throw new Error('Cannot find exit ' + exitUUID);\n};\n\nexport const getActionIndex = (node: FlowNode, actionUUID: string) => {\n  for (const [actionIdx, action] of node.actions.entries()) {\n    if (action.uuid === actionUUID) {\n      return actionIdx;\n    }\n  }\n  throw new Error('Cannot find action ' + actionUUID);\n};\n\nexport const getSuggestedResultName = (count: number) => `Result ${count}`;\n\nexport const hasRouter = (renderNode: RenderNode): boolean => {\n  return !!(renderNode && renderNode.node.router);\n};\n\nexport const hasWait = (renderNode: RenderNode): boolean => {\n  return !!(renderNode.node.router && renderNode.node.router.wait);\n};\n\nexport const hasLoopSplit = (renderNode: RenderNode): boolean => {\n  const type = getType(renderNode);\n\n  return (\n    hasWait(renderNode) || type === Types.split_by_expression || type === Types.split_by_subflow\n  );\n};\n\n/**\n * Follows every path from fromNodeUUID to toNodeUUID and throws\n * an error if we hit ourselves again without hitting a wait\n * @param nodes the entire node map\n * @param fromNodeUUID which node we are originating from\n * @param toNodeUUID where we are trying to go\n * @param path the path we have tried so far\n */\nexport const detectLoops = (\n  nodes: RenderNodeMap,\n  fromNodeUUID: string,\n  toNodeUUID: string,\n  path: string[] = []\n): void => {\n  const fromNode = nodes[fromNodeUUID];\n  const toNode = nodes[toNodeUUID];\n\n  if (fromNodeUUID === toNodeUUID) {\n    throw new Error(\"Flow loop detected, can't point to self\");\n  }\n\n  if (hasLoopSplit(toNode) || hasLoopSplit(fromNode)) {\n    return;\n  }\n\n  if (path.length === 0) {\n    path.push(fromNodeUUID);\n    for (const exit of toNode.node.exits) {\n      if (exit.destination_uuid) {\n        detectLoops(nodes, toNode.node.uuid, exit.destination_uuid, path);\n      }\n    }\n    return;\n  }\n\n  // we're back where we started\n  if (toNodeUUID === path[0]) {\n    throw new Error('Flow loop detected, route through a wait first');\n  }\n\n  // add us to the path\n  path.push(toNodeUUID);\n\n  // follow each of our exits\n  for (const exit of toNode.node.exits) {\n    if (exit.destination_uuid) {\n      detectLoops(nodes, toNodeUUID, exit.destination_uuid, path);\n    }\n  }\n\n  return;\n};\n\nexport const getLocalizations = (\n  node: FlowNode,\n  action: AnyAction,\n  language: Asset,\n  translations?: { [uuid: string]: any }\n): LocalizedObject[] => {\n  const localizations: LocalizedObject[] = [];\n\n  // Account for localized cases\n  if (node.router && node.router.type === RouterTypes.switch) {\n    const router = node.router as SwitchRouter;\n\n    router.cases.forEach(kase =>\n      localizations.push(Localization.translate(kase, language, translations))\n    );\n  }\n\n  if (action) {\n    localizations.push(Localization.translate(action, language, translations));\n    // check for localized template variables]\n    if (action.type === Types.send_msg) {\n      const sendMsgAction = action as SendMsg;\n      if (sendMsgAction.templating) {\n        localizations.push(\n          Localization.translate(sendMsgAction.templating, language, translations)\n        );\n      }\n    }\n  }\n\n  // Account for localized categories\n  if (node.router) {\n    node.router.categories.forEach(category => {\n      if (category.name) {\n        localizations.push(Localization.translate(category, language, translations));\n      }\n    });\n  }\n\n  return localizations;\n};\n\nexport const getUniqueDestinations = (node: FlowNode): string[] => {\n  const destinations: any = {};\n  for (const exit of node.exits) {\n    if (exit.destination_uuid) {\n      destinations[exit.destination_uuid] = true;\n    }\n  }\n  return Object.keys(destinations);\n};\n\nexport const getCurrentDefinition = (\n  definition: FlowDefinition,\n  nodeMap: RenderNodeMap,\n  includeUI: boolean = true\n): FlowDefinition => {\n  const renderNodes = getOrderedNodes(nodeMap);\n  const nodes: FlowNode[] = [];\n  renderNodes.forEach((renderNode: RenderNode) => nodes.push(renderNode.node));\n\n  // tslint:disable-next-line:variable-name\n  const uiNodes: any = {};\n  for (const uuid of Object.keys(nodeMap)) {\n    uiNodes[uuid] = nodeMap[uuid].ui;\n  }\n\n  const result = {\n    ...definition,\n    nodes\n  };\n\n  if (includeUI) {\n    // tslint:disable-next-line:variable-name\n    result._ui = {\n      nodes: uiNodes,\n      stickies: definition._ui.stickies,\n      languages: definition._ui.languages,\n      translation_filters: definition._ui.translation_filters\n    } as UIMetaData;\n  }\n\n  return result;\n};\n\nexport const newPosition = (left: number, top: number): FlowPosition => {\n  return { left, top };\n};\n\nexport const addPosition = (a: FlowPosition, b: FlowPosition): FlowPosition => {\n  const width = a.right - a.left;\n  const height = a.bottom - a.top;\n\n  // we allow dragging out of bounds\n  const top = a.top + b.top;\n  const left = a.left + b.left;\n\n  if (width && height) {\n    return {\n      left,\n      top,\n      right: left + width,\n      bottom: top + height\n    };\n  }\n\n  return { top, left };\n};\n\nexport const subtractPosition = (a: FlowPosition, b: FlowPosition): FlowPosition => {\n  return { left: a.left - b.left, top: a.top - b.top };\n};\n\nexport const getOrderedNodes = (nodes: RenderNodeMap): RenderNode[] => {\n  const sorted: RenderNode[] = [];\n  Object.keys(nodes).forEach((nodeUUID: string) => {\n    sorted.push(nodes[nodeUUID]);\n  });\n  return sorted.sort((a: RenderNode, b: RenderNode) => {\n    let diff = a.ui.position.top - b.ui.position.top;\n    if (diff === 0) {\n      diff = a.ui.position.left - b.ui.position.left;\n    }\n    return diff;\n  });\n};\n\nexport const getCollisions = (\n  nodes: RenderNodeMap,\n  stickies: { [key: string]: StickyNote },\n  box: FlowPosition\n): { [uuid: string]: FlowPosition } => {\n  const collisions: any = {};\n  for (const nodeUUID of Object.keys(nodes)) {\n    const node = nodes[nodeUUID];\n    if (collides(box, node.ui.position)) {\n      collisions[node.node.uuid] = node.ui.position;\n    }\n  }\n\n  for (const uuid in stickies) {\n    const sticky = stickies[uuid];\n    if (collides(box, sticky.position)) {\n      collisions[uuid] = sticky.position;\n    }\n  }\n\n  return collisions;\n};\n\nexport const collides = (a: FlowPosition, b: FlowPosition) => {\n  // don't bother with collision if we don't have full dimensions\n  /* istanbul ignore next */\n  if (!a.bottom || !b.bottom) {\n    return false;\n  }\n\n  return !(b.left > a.right || b.right < a.left || b.top > a.bottom || b.bottom < a.top);\n};\n\n/**\n * Gets the first collsion in the node map returning the original node,\n * the node it collides with and optionally an additional node it\n * collides with if inserting between two nodes\n * @param nodes\n */\nexport const getCollision = (nodes: RenderNodeMap): RenderNode[] => {\n  const sortedNodes = getOrderedNodes(nodes);\n\n  for (let i = 0; i < sortedNodes.length; i++) {\n    const current = sortedNodes[i];\n    if (i + 1 < sortedNodes.length) {\n      for (let j = i + 1; j < sortedNodes.length; j++) {\n        const other = sortedNodes[j];\n        if (collides(current.ui.position, other.ui.position)) {\n          // if the next node collides too, include it\n          // to deal with inserting between two closely\n          // positioned nodes\n          if (j + 1 < sortedNodes.length) {\n            const cascaded = sortedNodes[j + 1];\n            if (collides(other.ui.position, cascaded.ui.position)) {\n              return [current, other, cascaded];\n            }\n          }\n          return [current, other];\n        }\n      }\n    }\n  }\n  return [];\n};\n\nexport const createEmptyNode = (\n  fromNode: RenderNode,\n  fromExitUUID: string,\n  suggestedResultNameCount: number,\n  flowType: FlowTypes\n): RenderNode => {\n  const emptyNode: FlowNode = {\n    uuid: createUUID(),\n    actions: [],\n    exits: [\n      {\n        uuid: createUUID(),\n        destination_uuid: null\n      }\n    ]\n  };\n\n  let type = Types.execute_actions;\n\n  // Add an action next if we are coming from a router\n  if (!fromNode || hasRouter(fromNode)) {\n    const replyType = flowType === FlowTypes.VOICE ? Types.say_msg : Types.send_msg;\n    const replyAction = {\n      uuid: createUUID(),\n      text: '',\n      type: replyType\n    };\n\n    emptyNode.actions.push(replyAction);\n  } else {\n    // Otherwise we are going to a switch\n    const categories: Category[] = [\n      {\n        uuid: createUUID(),\n        name: DefaultExitNames.All_Responses,\n        exit_uuid: emptyNode.exits[0].uuid\n      }\n    ];\n\n    const wait: Wait = { type: WaitTypes.msg };\n    type = Types.wait_for_response;\n    if (flowType === FlowTypes.VOICE) {\n      wait.hint = { type: HintTypes.digits, count: 1 };\n    }\n\n    emptyNode.router = {\n      type: RouterTypes.switch,\n      result_name: getSuggestedResultName(suggestedResultNameCount),\n      default_category_uuid: categories[0].uuid,\n      categories,\n      wait,\n      cases: []\n    } as SwitchRouter;\n  }\n\n  let inboundConnections = {};\n  if (fromNode) {\n    inboundConnections = { [fromExitUUID]: fromNode.node.uuid };\n  }\n\n  return {\n    node: emptyNode,\n    ui: { position: { left: 0, top: 0 }, type },\n    inboundConnections,\n    ghost: true\n  };\n};\n\nexport interface FlowComponents {\n  renderNodeMap: RenderNodeMap;\n  groups: AssetMap;\n  fields: AssetMap;\n  labels: AssetMap;\n  results: AssetMap;\n  warnings: Warnings;\n}\n\nexport const isGroupAction = (actionType: string) => {\n  return (\n    actionType === Types.add_contact_groups ||\n    actionType === Types.remove_contact_groups ||\n    actionType === Types.send_broadcast\n  );\n};\n\n/**\n * This isn't necessarily supported, but lets make a best effort to guess node\n * types from cues within the definition if somebody loads a flow without _ui details.\n * @param node\n */\nexport const guessNodeType = (node: FlowNode) => {\n  // router based nodes\n  if (node.router) {\n    // hybrid nodes\n    if (node.actions.length === 1) {\n      if (node.actions[0].type === Types.call_webhook) {\n        return Types.split_by_webhook;\n      }\n\n      if (node.actions[0].type === Types.transfer_airtime) {\n        return Types.split_by_airtime;\n      }\n\n      if (node.actions[0].type === Types.call_resthook) {\n        return Types.split_by_resthook;\n      }\n\n      if (node.actions[0].type === Types.enter_flow) {\n        return Types.split_by_subflow;\n      }\n    }\n\n    if (node.router.wait) {\n      return Types.wait_for_response;\n    }\n\n    if (node.router.type === RouterTypes.random) {\n      return Types.split_by_random;\n    }\n\n    const switchRouter = getSwitchRouter(node);\n    if (switchRouter) {\n      if (switchRouter.operand === GROUPS_OPERAND) {\n        return Types.split_by_groups;\n      }\n    }\n\n    return Types.split_by_expression;\n  }\n\n  return Types.execute_actions;\n};\n\nexport const generateResultQuery = (resultName: string) => `@run.results.${snakify(resultName)}`;\n\n/**\n * Converts a list of assets to a map keyed by their id\n */\nexport const assetListToMap = (assets: Asset[]): AssetMap => {\n  const assetMap: any = {};\n  for (const asset of assets) {\n    assetMap[asset.id] = asset;\n  }\n  return assetMap;\n};\n\nexport const assetMapToList = (assets: AssetMap): any[] => {\n  return Object.keys(assets).map(key => {\n    const asset = assets[key];\n    return { uuid: asset.id, name: asset.name };\n  });\n};\n\n/**\n * Processes an initial FlowDefinition for details necessary for the editor\n */\nexport const getFlowComponents = (definition: FlowDefinition): FlowComponents => {\n  const renderNodeMap: RenderNodeMap = {};\n  const warnings: Warnings = {};\n  const { nodes, _ui } = definition;\n\n  // initialize our nodes\n  const pointerMap: { [uuid: string]: { [uuid: string]: string } } = {};\n\n  const groups: AssetMap = {};\n  const fields: AssetMap = {};\n  const labels: AssetMap = {};\n  let results: AssetMap = {};\n\n  for (const node of nodes) {\n    if (!node.actions) {\n      node.actions = [];\n    }\n\n    const ui = _ui.nodes[node.uuid];\n    const renderNode: RenderNode = {\n      node,\n      ui,\n      inboundConnections: {}\n    };\n\n    renderNodeMap[node.uuid] = renderNode;\n\n    const resultName = getResultName(node);\n    if (resultName) {\n      results = addResult(resultName, results, { nodeUUID: node.uuid });\n    }\n\n    const type = getType(renderNode);\n\n    // if we are split by group, look at our categories for groups\n    if (type === Types.split_by_groups) {\n      const router = getSwitchRouter(node);\n\n      for (const kase of router.cases) {\n        const groupUUID = kase.arguments[0];\n        const category = router.categories.find((cat: Category) => {\n          return cat.uuid === kase.category_uuid;\n        });\n\n        /* istanbul ignore else */\n        if (category) {\n          if (groupUUID) {\n            groups[groupUUID] = {\n              name: category.name,\n              id: groupUUID,\n              type: AssetType.Group\n            };\n          }\n        }\n      }\n    }\n\n    for (const action of node.actions) {\n      if (isGroupAction(action.type)) {\n        const groupsToChange = (action as ChangeGroups).groups;\n        if (groupsToChange) {\n          for (const group of groupsToChange) {\n            if (group.uuid) {\n              groups[group.uuid] = {\n                name: group.name,\n                id: group.uuid,\n                type: AssetType.Group\n              };\n            }\n          }\n        }\n      } else if (action.type === Types.set_contact_field) {\n        const fieldAction = action as SetContactField;\n        fields[fieldAction.field.key] = {\n          name: fieldAction.field.name,\n          id: fieldAction.field.key,\n          type: AssetType.Field\n        };\n      } else if (action.type === Types.add_input_labels) {\n        for (const label of (action as AddLabels).labels) {\n          labels[label.uuid] = {\n            name: label.name,\n            id: label.uuid,\n            type: AssetType.Label\n          };\n        }\n      } else if (action.type === Types.set_run_result) {\n        const resultAction = action as SetRunResult;\n        const key = snakify(resultAction.name);\n\n        if (key in results) {\n          results[key].references.push({\n            nodeUUID: node.uuid,\n            actionUUID: action.uuid\n          });\n        } else {\n          results[key] = {\n            name: resultAction.name,\n            id: key,\n            type: AssetType.Result,\n            references: [{ nodeUUID: node.uuid, actionUUID: action.uuid }]\n          };\n        }\n      }\n    }\n\n    for (const exit of node.exits) {\n      if (exit.destination_uuid) {\n        let pointers: { [uuid: string]: string } = pointerMap[exit.destination_uuid];\n\n        if (!pointers) {\n          pointers = {};\n        }\n\n        pointers[exit.uuid] = node.uuid;\n        pointerMap[exit.destination_uuid] = pointers;\n      }\n    }\n  }\n\n  // store our pointers with their associated nodes\n  for (const nodeUUID of Object.keys(pointerMap)) {\n    renderNodeMap[nodeUUID].inboundConnections = pointerMap[nodeUUID];\n  }\n\n  return { renderNodeMap, groups, fields, labels, results, warnings };\n};\n\n/**\n * Extracts contact fields from a list of nodes\n */\nexport const extractContactFields = (nodes: FlowNode[]): Asset[] =>\n  nodes.reduce((fieldList, { actions }) => {\n    actions.forEach(action => {\n      if (action.type === Types.set_contact_field) {\n        fieldList.push(fieldToAsset((action as SetContactField).field));\n      }\n    });\n    return fieldList;\n  }, []);\n\n/** Adds all the items from toAdd if that don't already exist in assets */\nexport const mergeAssetMaps = (assets: AssetMap, toAdd: AssetMap): void => {\n  Object.keys(toAdd).forEach((key: string) => {\n    assets[key] = assets[key] || toAdd[key];\n  });\n};\n\nexport const createFlowIssueMap = (\n  previousIssues: FlowIssueMap,\n  issues: FlowIssue[]\n): FlowIssueMap => {\n  const issueMap: FlowIssueMap = (issues || [])\n    .filter((issue: FlowIssue) => issue.type !== FlowIssueType.LEGACY_EXTRA)\n    .reduce((issueMap: FlowIssueMap, issue: FlowIssue) => {\n      const nodeIssues: FlowIssue[] = issueMap[issue.node_uuid] || [];\n      nodeIssues.push(issue);\n      issueMap[issue.node_uuid] = nodeIssues;\n      return issueMap;\n    }, {});\n\n  for (const [nodeUUID, nodeIssues] of Object.entries(issueMap)) {\n    // would be nice not to use stringify as a deepequals here\n    if (JSON.stringify(previousIssues[nodeUUID]) === JSON.stringify(nodeIssues)) {\n      issueMap[nodeUUID] = previousIssues[nodeUUID];\n    }\n  }\n  return issueMap;\n};\n\nexport const fetchFlowActivity = (\n  endpoint: string,\n  dispatch: DispatchWithState,\n  getState: GetState,\n  uuid: string\n): void => {\n  const {\n    editorState: { simulating, activityInterval, visible }\n  } = getState();\n\n  if (visible) {\n    getActivity(endpoint, uuid).then((activity: Activity) => {\n      // every interval we back off a bit up to 5 minutes\n      if (activity) {\n        const updates: Partial<EditorState> = {\n          liveActivity: activity,\n          activityInterval: Math.min(60000 * 5, activityInterval + 200)\n        };\n\n        if (!simulating) {\n          updates.activity = activity;\n        }\n\n        dispatch(mergeEditorState(updates));\n\n        if (activityTimeout) {\n          window.clearTimeout(activityTimeout);\n        }\n\n        activityTimeout = window.setTimeout(() => {\n          fetchFlowActivity(endpoint, dispatch, getState, uuid);\n        }, activityInterval);\n      }\n    });\n  } else {\n    if (activityTimeout) {\n      window.clearTimeout(activityTimeout);\n    }\n\n    activityTimeout = window.setTimeout(() => {\n      fetchFlowActivity(endpoint, dispatch, getState, uuid);\n    }, 1000);\n  }\n};\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport { Dimensions, FlowPosition } from 'flowTypes';\r\nimport * as React from 'react';\r\nimport { newPosition } from 'store/helpers';\r\n\r\nimport styles from './CanvasDraggable.module.scss';\r\nimport { onNextRender } from 'utils';\r\n\r\nexport interface CanvasDraggableProps {\r\n  position: FlowPosition;\r\n  uuid: string;\r\n  idx: number;\r\n  elementCreator: (props: CanvasDraggableProps) => JSX.Element;\r\n  config?: any;\r\n  // should our draggable be initialized as dragged\r\n  dragOnAdd?: boolean;\r\n\r\n  selected?: boolean;\r\n\r\n  onAnimated?: (uuid: string) => void;\r\n  updateDimensions?: (uuid: string, position: Dimensions) => void;\r\n  onDragStart?: (uuid: string, clickedPosition: FlowPosition) => void;\r\n  onDragStop?: () => void;\r\n}\r\n\r\nexport interface CanvasDraggableState {\r\n  width?: number;\r\n  height?: number;\r\n}\r\n\r\nexport class CanvasDraggable extends React.Component<CanvasDraggableProps, CanvasDraggableState> {\r\n  private ele!: HTMLDivElement;\r\n\r\n  constructor(props: CanvasDraggableProps) {\r\n    super(props);\r\n    bindCallbacks(this, {\r\n      include: [/^handle/, 'ref']\r\n    });\r\n\r\n    this.state = {};\r\n  }\r\n\r\n  private ref(ref: HTMLDivElement): any {\r\n    return (this.ele = ref);\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    if (this.ele) {\r\n      if (this.props.updateDimensions) {\r\n        const width = this.ele.clientWidth || this.props.position.right - this.props.position.left;\r\n        const height =\r\n          this.ele.clientHeight || this.props.position.bottom - this.props.position.top;\r\n        this.setState({ width, height }, () => {\r\n          this.props.updateDimensions(this.props.uuid, {\r\n            width,\r\n            height\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  public shouldComponentUpdate(nextProps: CanvasDraggableProps, state: any, context: any): boolean {\r\n    return (\r\n      nextProps.position.left !== this.props.position.left ||\r\n      nextProps.position.top !== this.props.position.top ||\r\n      nextProps.position.right !== this.props.position.right ||\r\n      nextProps.position.bottom !== this.props.position.bottom ||\r\n      nextProps.idx !== this.props.idx ||\r\n      nextProps.selected !== this.props.selected ||\r\n      nextProps.config !== this.props.config\r\n    );\r\n  }\r\n\r\n  public componentDidUpdate(\r\n    prevProps: CanvasDraggableProps,\r\n    prevState: CanvasDraggableState\r\n  ): void {\r\n    // traceUpdate(this, prevProps, prevState);\r\n\r\n    // we want to check our dimensions after our next render\r\n    onNextRender(() => {\r\n      if (this.ele) {\r\n        if (this.ele.clientWidth && this.ele.clientHeight) {\r\n          if (\r\n            this.state.width !== this.ele.clientWidth ||\r\n            this.state.height !== this.ele.clientHeight\r\n          ) {\r\n            if (this.props.updateDimensions) {\r\n              const height = this.ele.clientHeight;\r\n              const width = this.ele.clientWidth;\r\n\r\n              this.setState({ width, height }, () => {\r\n                this.props.updateDimensions(this.props.uuid, { width, height });\r\n              });\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private handleMouseUp(event: React.MouseEvent<HTMLDivElement>): void {\r\n    if (event.nativeEvent.which === 3) {\r\n      return;\r\n    }\r\n    if (this.props.onDragStop) {\r\n      this.props.onDragStop();\r\n    }\r\n  }\r\n\r\n  private handleMouseDown(event: React.MouseEvent<HTMLDivElement>) {\r\n    // ignore clicks in textareas\r\n    if (!this.props.selected && (event.target as any).tagName.toUpperCase() === 'TEXTAREA') {\r\n      return;\r\n    }\r\n\r\n    // ignore right clicks\r\n    if (event.nativeEvent.which === 3) {\r\n      return;\r\n    }\r\n    if (this.props.onDragStart) {\r\n      this.props.onDragStart(\r\n        this.props.uuid,\r\n        newPosition(event.pageX - this.props.position.left, event.pageY - this.props.position.top)\r\n      );\r\n    }\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const classes = [styles.draggable];\r\n\r\n    if (this.props.selected) {\r\n      classes.push(styles.selected);\r\n    }\r\n\r\n    const handleAnimated = () => {\r\n      if (this.props.onAnimated) {\r\n        this.props.onAnimated(this.props.uuid);\r\n      }\r\n    };\r\n\r\n    return (\r\n      <div\r\n        data-testid={'draggable_' + this.props.uuid}\r\n        onTransitionEnd={handleAnimated}\r\n        ref={this.ref}\r\n        className={classes.join(' ')}\r\n        style={{\r\n          left: this.props.position.left,\r\n          top: this.props.position.top\r\n        }}\r\n        onMouseDown={this.handleMouseDown}\r\n        onMouseUp={this.handleMouseUp}\r\n      >\r\n        {this.props.elementCreator(this.props)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { FlowPosition } from 'flowTypes';\r\nimport { CanvasPositions } from 'store/editor';\r\nimport {\r\n  MAX_REFLOW_ATTEMPTS,\r\n  NODE_SPACING,\r\n  set,\r\n  snapPositionToGrid,\r\n  timeEnd,\r\n  timeStart\r\n} from 'utils';\r\n\r\nconst mutate = require('immutability-helper');\r\n\r\nexport const collides = (a: FlowPosition, b: FlowPosition, fudge: number) => {\r\n  // don't bother with collision if we don't have full dimensions\r\n  /* istanbul ignore next */\r\n  if (!a.bottom || !b.bottom) {\r\n    return false;\r\n  }\r\n\r\n  a.bottom += fudge;\r\n\r\n  return !(b.left > a.right! || b.right! < a.left || b.top > a.bottom || b.bottom < a.top);\r\n};\r\n\r\nexport const getDraggablesInBox = (\r\n  positions: CanvasPositions,\r\n  box: FlowPosition\r\n): { [uuid: string]: FlowPosition } => {\r\n  const collisions: any = {};\r\n  for (const nodeUUID of Object.keys(positions)) {\r\n    const position = positions[nodeUUID];\r\n    if (collides(box, position, 0)) {\r\n      collisions[nodeUUID] = position;\r\n    }\r\n  }\r\n  return collisions;\r\n};\r\n\r\ninterface DraggablePosition extends FlowPosition {\r\n  uuid: string;\r\n}\r\n\r\nexport const getOrderedDraggables = (positions: CanvasPositions): DraggablePosition[] => {\r\n  const sorted: DraggablePosition[] = [];\r\n  Object.keys(positions).forEach((uuid: string) => {\r\n    sorted.push({ ...positions[uuid], uuid });\r\n  });\r\n\r\n  return sorted.sort((a: DraggablePosition, b: DraggablePosition) => {\r\n    let diff = a.top - b.top;\r\n    if (diff === 0) {\r\n      diff = a.left - b.left;\r\n    }\r\n    return diff;\r\n  });\r\n};\r\n\r\n/**\r\n * Gets the first collsion in the node map returning the original node,\r\n * the node it collides with and optionally an additional node it\r\n * collides with if inserting between two nodes\r\n * @param nodes\r\n */\r\nconst getFirstCollision = (\r\n  positions: CanvasPositions,\r\n  changed: string[],\r\n  fudge: number\r\n): DraggablePosition[] => {\r\n  const sortedDraggables = getOrderedDraggables(positions);\r\n\r\n  for (let i = 0; i < sortedDraggables.length; i++) {\r\n    const current = sortedDraggables[i];\r\n\r\n    if (i + 1 < sortedDraggables.length) {\r\n      for (let j = i + 1; j < sortedDraggables.length; j++) {\r\n        const other = sortedDraggables[j];\r\n\r\n        if (collides(current, other, fudge)) {\r\n          // if the next node collides too, include it\r\n          // to deal with inserting between two closely\r\n          // positioned nodes\r\n          if (j + 1 < sortedDraggables.length) {\r\n            const cascaded = sortedDraggables[j + 1];\r\n            if (collides(other, cascaded, fudge)) {\r\n              return [current, other, cascaded];\r\n            }\r\n          }\r\n\r\n          if (\r\n            !!changed.find((uuid: string) => other.uuid === uuid) &&\r\n            !!!changed.find((uuid: string) => current.uuid === uuid)\r\n          ) {\r\n            return [other, current];\r\n          }\r\n\r\n          return [current, other];\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return [];\r\n};\r\n\r\nconst setTop = (position: FlowPosition, newTop: number) => {\r\n  return snapPositionToGrid({\r\n    top: newTop,\r\n    left: position.left,\r\n    bottom: newTop + (position.bottom! - position.top),\r\n    right: position.right\r\n  });\r\n};\r\n\r\n/**\r\n * Reflow positions to account for any collisions\r\n * @param positions\r\n */\r\nexport const reflow = (\r\n  positions: CanvasPositions,\r\n  fudge: number\r\n): { positions: CanvasPositions; changed: string[] } => {\r\n  let newPositions = positions;\r\n  const changed: string[] = [];\r\n\r\n  // if for some reason we can't reflow, don't blow up\r\n  let attempts = 0;\r\n\r\n  timeStart('reflow');\r\n\r\n  let collision = getFirstCollision(positions, changed, fudge);\r\n  while (collision.length > 0 && attempts < MAX_REFLOW_ATTEMPTS) {\r\n    attempts++;\r\n    if (collision.length) {\r\n      const [top, bottom, cascade] = collision;\r\n      newPositions = mutate(newPositions, {\r\n        [bottom.uuid]: set(setTop(bottom, top.bottom! + NODE_SPACING))\r\n      });\r\n      changed.push(bottom.uuid);\r\n\r\n      if (cascade) {\r\n        // start with the top of the bottom node\r\n        let cascadeTop = top.bottom! + NODE_SPACING;\r\n\r\n        // and add its height\r\n        cascadeTop += bottom.bottom! - bottom.top;\r\n        newPositions = mutate(newPositions, {\r\n          [cascade.uuid]: set(setTop(cascade, cascadeTop))\r\n        });\r\n\r\n        changed.push(cascade.uuid);\r\n      }\r\n    }\r\n\r\n    collision = getFirstCollision(newPositions, changed, fudge);\r\n  }\r\n\r\n  timeEnd('reflow');\r\n\r\n  return { positions: newPositions, changed };\r\n};\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport { CanvasDraggable, CanvasDraggableProps } from 'components/canvas/CanvasDraggable';\r\nimport { getDraggablesInBox, reflow } from 'components/canvas/helpers';\r\nimport { DRAG_THRESHOLD } from 'components/flow/Flow';\r\nimport { Dimensions, FlowPosition } from 'flowTypes';\r\nimport mutate from 'immutability-helper';\r\nimport React from 'react';\r\nimport { CanvasPositions, DragSelection } from 'store/editor';\r\nimport { addPosition } from 'store/helpers';\r\nimport { MergeEditorState } from 'store/thunks';\r\nimport { COLLISION_FUDGE, snapPositionToGrid, throttle, snapToGrid } from 'utils';\r\n\r\nimport styles from './Canvas.module.scss';\r\n\r\nexport const CANVAS_PADDING = 300;\r\nexport const REFLOW_QUIET = 200;\r\n\r\nexport interface CanvasProps {\r\n  uuid: string;\r\n  dragActive: boolean;\r\n  draggingNew: boolean;\r\n  newDragElement: JSX.Element;\r\n  draggables: CanvasDraggableProps[];\r\n  mutable: boolean;\r\n  onLoaded: () => void;\r\n  onDragging: (draggedUUIDs: string[]) => void;\r\n  onUpdatePositions: (positions: CanvasPositions) => void;\r\n  onRemoveNodes: (nodeUUIDs: string[]) => void;\r\n  onDoubleClick: (position: FlowPosition) => void;\r\n  mergeEditorState: MergeEditorState;\r\n}\r\n\r\ninterface CanvasState {\r\n  dragDownPosition: FlowPosition | null;\r\n  dragUUID: string | null;\r\n  dragGroup: boolean;\r\n  dragSelection: DragSelection | null;\r\n  uuid: string;\r\n  positions: CanvasPositions;\r\n  selected: CanvasPositions;\r\n  height: number;\r\n}\r\n\r\nexport class Canvas extends React.PureComponent<CanvasProps, CanvasState> {\r\n  private ele!: HTMLDivElement;\r\n  private isScrolling: any;\r\n\r\n  private reflowTimeout: any;\r\n\r\n  // when auto scrolling we need to move dragged elements\r\n  private lastX!: number | null;\r\n  private lastY!: number | null;\r\n\r\n  // did we just select something\r\n  private justSelected = false;\r\n\r\n  private onDragThrottled: (uuids: string[]) => void = throttle(this.props.onDragging, 300);\r\n  private onMouseThrottled: (event: any) => void = throttle(this.handleMouseMove.bind(this), 10);\r\n\r\n  constructor(props: CanvasProps) {\r\n    super(props);\r\n\r\n    let height = document.documentElement.clientHeight;\r\n\r\n    const positions: { [uuid: string]: FlowPosition } = {};\r\n    this.props.draggables.forEach((draggable: CanvasDraggableProps) => {\r\n      positions[draggable.uuid] = draggable.position;\r\n      if (draggable.position.bottom) {\r\n        height = Math.max(height, draggable.position.bottom + CANVAS_PADDING);\r\n      }\r\n    });\r\n\r\n    this.state = {\r\n      height,\r\n      dragDownPosition: null,\r\n      dragUUID: null,\r\n      dragGroup: false,\r\n      dragSelection: null,\r\n      uuid: this.props.uuid,\r\n      selected: {},\r\n      positions\r\n    };\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^handle/, /^render/, /^mark/, /^do/, /^ensure/]\r\n    });\r\n  }\r\n\r\n  private handleWindowResize(): void {\r\n    const windowHeight = document.documentElement.clientHeight;\r\n    this.setState({ height: Math.max(windowHeight, this.state.height) });\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    /* istanbul ignore next */\r\n    window.addEventListener('resize', this.handleWindowResize);\r\n    document.addEventListener('keydown', this.handleKeyDown);\r\n\r\n    this.props.onLoaded();\r\n  }\r\n\r\n  private handleKeyDown(event: any): void {\r\n    if (this.state.selected && event.key === 'Backspace') {\r\n      const nodeUUIDs = Object.keys(this.state.selected);\r\n      if (nodeUUIDs.length > 0) {\r\n        this.props.onRemoveNodes(Object.keys(this.state.selected));\r\n      }\r\n    }\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    window.removeEventListener('resize', this.handleWindowResize);\r\n    document.removeEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: CanvasProps, prevState: CanvasState): void {\r\n    // traceUpdate(this, prevProps, prevState);\r\n\r\n    let updated = false;\r\n    let updatedPositions = { ...this.state.positions };\r\n\r\n    // are we being given something new\r\n    this.props.draggables.forEach((draggable: CanvasDraggableProps) => {\r\n      if (!this.state.positions[draggable.uuid]) {\r\n        updatedPositions = mutate(updatedPositions, {\r\n          $merge: { [draggable.uuid]: draggable.position }\r\n        });\r\n        updated = true;\r\n      }\r\n    });\r\n\r\n    // have we removed something\r\n    Object.keys(updatedPositions).forEach((uuid: string) => {\r\n      if (\r\n        !this.props.draggables.find((draggable: CanvasDraggableProps) => draggable.uuid === uuid)\r\n      ) {\r\n        updatedPositions = mutate(updatedPositions, { $unset: [[uuid]] } as any);\r\n        updated = true;\r\n      }\r\n    });\r\n\r\n    if (updated) {\r\n      this.setState({ positions: updatedPositions });\r\n    }\r\n  }\r\n\r\n  public renderSelectionBox(): JSX.Element | null {\r\n    const drag = this.state.dragSelection;\r\n\r\n    if (drag && drag.startX && drag.startY && drag.currentX && drag.currentY) {\r\n      const left = Math.min(drag.startX, drag.currentX);\r\n      const top = Math.min(drag.startY, drag.currentY);\r\n      const width = Math.max(drag.startX, drag.currentX) - left;\r\n      const height = Math.max(drag.startY, drag.currentY) - top;\r\n\r\n      if (this.state.dragSelection && this.state.dragSelection.startX) {\r\n        return <div className={styles.drag_selection} style={{ left, top, width, height }} />;\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  private isClickOnCanvas(event: React.MouseEvent<HTMLDivElement>): boolean {\r\n    // ignore right clicks\r\n    if (event.nativeEvent.which === 3) {\r\n      return false;\r\n    }\r\n    return (event.target as any).id === 'canvas';\r\n  }\r\n\r\n  private handleMouseDown(event: React.MouseEvent<HTMLDivElement>): void {\r\n    // ignore right clicks\r\n    if (event.nativeEvent.which === 3) {\r\n      return;\r\n    }\r\n\r\n    if (!this.props.mutable) {\r\n      return;\r\n    }\r\n\r\n    const offset = this.ele.getBoundingClientRect();\r\n\r\n    this.justSelected = false;\r\n    if (this.isClickOnCanvas(event)) {\r\n      const startX = event.pageX - offset.left;\r\n      const startY = event.pageY - offset.top - window.scrollY;\r\n\r\n      this.setState({\r\n        dragSelection: { startX, startY, currentX: startX, currentY: startY }\r\n      });\r\n    }\r\n  }\r\n\r\n  private handleMouseMove(event: React.MouseEvent<HTMLDivElement>): void {\r\n    if (!this.props.mutable) {\r\n      return;\r\n    }\r\n\r\n    if (this.props.draggingNew) {\r\n      this.lastX = event.pageX;\r\n      this.lastY = event.pageY;\r\n      this.updateStateWithScroll(event.clientY, event.pageY);\r\n      if (this.state.dragUUID) {\r\n        this.updatePositions(event.pageX, event.pageY, event.clientY, false);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (this.state.dragSelection && this.state.dragSelection.startX) {\r\n      const drag = this.state.dragSelection;\r\n\r\n      if (drag && drag.startX && drag.startY && drag.currentX && drag.currentY) {\r\n        const left = Math.min(drag.startX, drag.currentX);\r\n        const top = Math.min(drag.startY, drag.currentY);\r\n        const right = Math.max(drag.startX, drag.currentX);\r\n        const bottom = Math.max(drag.startY, drag.currentY);\r\n\r\n        const selected = getDraggablesInBox(this.state.positions, {\r\n          left,\r\n          top,\r\n          right,\r\n          bottom\r\n        });\r\n\r\n        const offset = this.ele.getBoundingClientRect();\r\n\r\n        this.setState({\r\n          dragSelection: {\r\n            startX: drag.startX,\r\n            startY: drag.startY,\r\n            currentX: event.pageX - offset.left,\r\n            currentY: event.pageY - offset.top - window.scrollY\r\n          }\r\n        });\r\n\r\n        this.setState({ selected });\r\n\r\n        if (Object.keys(selected).length > 0) {\r\n          this.justSelected = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (this.state.dragUUID) {\r\n      this.updatePositions(event.pageX, event.pageY, event.clientY, false);\r\n    }\r\n  }\r\n\r\n  private scrollCanvas(amount: number): void {\r\n    if (!this.isScrolling) {\r\n      this.isScrolling = true;\r\n\r\n      let speed = amount;\r\n      if (window.scrollY + amount < 0) {\r\n        speed = 0;\r\n      }\r\n\r\n      this.isScrolling = window.setInterval(() => {\r\n        if (this.lastX && this.lastY) {\r\n          // as we scroll we need to move our dragged items along with us\r\n          this.updatePositions(this.lastX, this.lastY + speed, 0, false);\r\n          window.scrollBy(0, speed);\r\n        }\r\n      }, 30);\r\n    }\r\n  }\r\n\r\n  private handleMouseUpCapture(event: React.MouseEvent<HTMLDivElement>): void {\r\n    if (!this.props.mutable) {\r\n      return;\r\n    }\r\n\r\n    // ignore right clicks\r\n    if (event.nativeEvent.which === 3) {\r\n      return;\r\n    }\r\n\r\n    this.lastX = null;\r\n    this.lastY = null;\r\n    if (this.state.dragUUID) {\r\n      this.setState({\r\n        dragDownPosition: null,\r\n        dragSelection: null,\r\n        dragUUID: null\r\n      });\r\n    }\r\n\r\n    if (!this.justSelected) {\r\n      this.props.mergeEditorState({\r\n        dragActive: false\r\n      });\r\n\r\n      this.setState({ selected: {} });\r\n    }\r\n\r\n    if (this.state.dragSelection && this.state.dragSelection.startX) {\r\n      this.setState({\r\n        dragSelection: {\r\n          startX: undefined,\r\n          startY: undefined,\r\n          currentX: undefined,\r\n          currentY: undefined\r\n        }\r\n      });\r\n    }\r\n\r\n    this.justSelected = false;\r\n  }\r\n\r\n  public handleUpdateDimensions(uuid: string, dimensions: Dimensions): void {\r\n    if (dimensions.width && dimensions.height) {\r\n      let pos = this.state.positions[uuid];\r\n      if (!pos) {\r\n        pos = this.props.draggables.find((item: CanvasDraggableProps) => item.uuid === uuid)!\r\n          .position;\r\n      }\r\n\r\n      const newPosition = {\r\n        left: pos.left,\r\n        top: pos.top,\r\n        right: pos.left + dimensions.width,\r\n        bottom: pos.top + dimensions.height\r\n      };\r\n\r\n      if (newPosition.bottom !== pos.bottom || newPosition.right !== pos.right) {\r\n        this.setState((prevState: CanvasState) => {\r\n          const newPositions = mutate(prevState.positions, {\r\n            $merge: {\r\n              [uuid]: newPosition\r\n            }\r\n          });\r\n\r\n          return {\r\n            positions: newPositions,\r\n            height: Math.max(newPosition.bottom + CANVAS_PADDING, prevState.height)\r\n          };\r\n        }, this.markReflow);\r\n      }\r\n    }\r\n  }\r\n\r\n  public ensureCanvasHeight() {\r\n    let height = this.state.height;\r\n    Object.keys(this.state.positions).forEach(uuid => {\r\n      const bottom = this.state.positions[uuid].bottom + CANVAS_PADDING;\r\n      if (bottom > height) {\r\n        height = bottom;\r\n      }\r\n    });\r\n\r\n    if (height > this.state.height) {\r\n      this.setState({ height });\r\n    }\r\n  }\r\n\r\n  public doReflow(): void {\r\n    const reflowPositions = { ...this.state.positions };\r\n    delete reflowPositions[this.state.dragUUID];\r\n    const { positions, changed } = reflow(reflowPositions, COLLISION_FUDGE);\r\n\r\n    if (changed) {\r\n      this.setState({ positions });\r\n\r\n      if (changed) {\r\n        this.props.onUpdatePositions(\r\n          changed.reduce((results: CanvasPositions, uuid: string) => {\r\n            results[uuid] = positions[uuid];\r\n            return results;\r\n          }, {})\r\n        );\r\n      }\r\n    }\r\n\r\n    this.props.onDragging(changed);\r\n  }\r\n\r\n  private markReflow(): void {\r\n    if (this.reflowTimeout) {\r\n      clearTimeout(this.reflowTimeout);\r\n    }\r\n\r\n    this.reflowTimeout = setTimeout(() => {\r\n      // only reflow if we aren't dragging\r\n      if (!this.state.dragUUID) {\r\n        this.doReflow();\r\n      }\r\n    }, REFLOW_QUIET);\r\n  }\r\n\r\n  /**\r\n   * Updates the state of the canvas, expanding and scrolling as needed\r\n   * @param windowY the mouse position in the viewport\r\n   * @param pageY the mouse position in the full canvas\r\n   * @param otherState optional state to set\r\n   */\r\n  private updateStateWithScroll(\r\n    windowY: number,\r\n    pageY: number,\r\n    otherState: Partial<CanvasState> = {}\r\n  ): void {\r\n    const viewportHeight = document.documentElement.clientHeight;\r\n    this.setState(\r\n      (prevState: CanvasState) => {\r\n        return {\r\n          ...(otherState as CanvasState),\r\n          height: Math.max(pageY + CANVAS_PADDING, prevState.height)\r\n        };\r\n      },\r\n      () => {\r\n        // check if we need to scroll our canvas\r\n\r\n        if (!this.isScrolling && windowY !== 0) {\r\n          if (windowY + 100 > viewportHeight) {\r\n            this.scrollCanvas(15);\r\n          } else if (windowY < 100) {\r\n            this.scrollCanvas(-15);\r\n          }\r\n        }\r\n        // if we are scrolling but given a clientY then user is mousing\r\n        else if (windowY !== 0 && (windowY > 100 && windowY + 100 < viewportHeight)) {\r\n          window.clearInterval(this.isScrolling);\r\n          this.isScrolling = null;\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  private updatePositions(pageX: number, pageY: number, clientY: number, snap: boolean): void {\r\n    if (this.state.dragUUID) {\r\n      const { dragUUID } = this.state;\r\n\r\n      // save off the last update, if we scroll on the user's behalf we'll need this\r\n      this.lastX = pageX;\r\n      this.lastY = pageY;\r\n\r\n      const startPosition = this.props.dragActive\r\n        ? this.state.selected[dragUUID]\r\n        : this.state.positions[dragUUID];\r\n\r\n      const offset = this.ele.getBoundingClientRect();\r\n\r\n      if (this.state.dragDownPosition) {\r\n        const xd = pageX - offset.left - this.state.dragDownPosition.left - startPosition.left;\r\n\r\n        const yd =\r\n          pageY - offset.top - this.state.dragDownPosition.top - startPosition.top - window.scrollY;\r\n\r\n        let lowestNode: number | undefined = 0;\r\n        if (this.props.dragActive) {\r\n          const delta = { left: xd, top: yd };\r\n          const prevState = this.state;\r\n          const uuids = Object.keys(prevState.selected);\r\n          let newPositions: { [uuid: string]: FlowPosition } = {};\r\n\r\n          uuids.forEach((uuid: string) => {\r\n            let newPosition = addPosition(prevState.selected[uuid], delta);\r\n            if (snap) {\r\n              newPosition = snapPositionToGrid(newPosition);\r\n            }\r\n\r\n            if (newPosition && newPosition.bottom! > lowestNode!) {\r\n              lowestNode = newPosition.bottom;\r\n            }\r\n            newPositions[uuid] = newPosition;\r\n          });\r\n\r\n          newPositions = mutate(prevState.positions, {\r\n            $merge: newPositions\r\n          });\r\n\r\n          this.updateStateWithScroll(clientY, lowestNode, {\r\n            positions: newPositions\r\n          });\r\n\r\n          if (uuids.length <= 5) {\r\n            this.props.onDragging(uuids);\r\n          } else {\r\n            this.onDragThrottled(uuids);\r\n          }\r\n        } else {\r\n          if (Math.abs(xd) + Math.abs(yd) > DRAG_THRESHOLD) {\r\n            let selected = this.state.selected;\r\n            if (!(this.state.dragUUID in selected)) {\r\n              selected = { [dragUUID]: this.state.positions[dragUUID] };\r\n            }\r\n\r\n            this.props.mergeEditorState({\r\n              dragActive: true\r\n            });\r\n\r\n            this.setState({ selected });\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleDragStart(uuid: string, position: FlowPosition): void {\r\n    const offset = this.ele.getBoundingClientRect();\r\n\r\n    this.setState({\r\n      dragUUID: uuid,\r\n      dragDownPosition: {\r\n        left: position.left - offset.left,\r\n        top: position.top - offset.top - window.scrollY\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Gets all the positions for nodes that were dragged */\r\n  private getSelectedPositions(): CanvasPositions {\r\n    return Object.keys(this.state.selected).reduce((result: CanvasPositions, uuid: string) => {\r\n      result[uuid] = this.state.positions[uuid];\r\n      return result;\r\n    }, {});\r\n  }\r\n\r\n  private handleDragStop(): void {\r\n    if (this.state.dragUUID) {\r\n      this.updatePositions(this.lastX!, this.lastY!, 0, true);\r\n    }\r\n\r\n    this.props.onUpdatePositions(this.getSelectedPositions());\r\n    this.setState({\r\n      dragUUID: null,\r\n      dragDownPosition: null,\r\n      dragSelection: null\r\n    });\r\n\r\n    this.markReflow();\r\n\r\n    this.props.mergeEditorState({\r\n      dragActive: false\r\n    });\r\n  }\r\n\r\n  private handleAnimated(uuid: string): void {\r\n    this.props.onDragging([uuid]);\r\n  }\r\n\r\n  private handleDoubleClick(event: React.MouseEvent<HTMLDivElement>): void {\r\n    if (this.isClickOnCanvas(event)) {\r\n      const offset = this.ele.getBoundingClientRect();\r\n      this.props.onDoubleClick(\r\n        snapToGrid(event.pageX - offset.left, event.pageY - offset.top - window.scrollY)\r\n      );\r\n    }\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    return (\r\n      <div\r\n        id=\"canvas-container\"\r\n        className={styles.canvas_container}\r\n        onMouseDown={this.handleMouseDown}\r\n        onMouseMove={this.onMouseThrottled}\r\n        onMouseUp={this.handleMouseUpCapture}\r\n        onDoubleClick={this.handleDoubleClick}\r\n      >\r\n        <div className={styles.canvas_background}>\r\n          <div\r\n            data-testid=\"canvas\"\r\n            style={{ height: this.state.height }}\r\n            id=\"canvas\"\r\n            ref={(ele: HTMLDivElement) => {\r\n              this.ele = ele;\r\n            }}\r\n            className={styles.canvas}\r\n          >\r\n            {this.props.newDragElement}\r\n            {this.props.draggables.map((draggable: CanvasDraggableProps, idx: number) => {\r\n              const pos = this.state.positions[draggable.uuid] || draggable.position;\r\n              return (\r\n                <CanvasDraggable\r\n                  onAnimated={this.handleAnimated}\r\n                  key={'draggable_' + draggable.uuid}\r\n                  uuid={draggable.uuid}\r\n                  updateDimensions={this.handleUpdateDimensions}\r\n                  position={pos}\r\n                  idx={draggable.idx}\r\n                  selected={!!this.state.selected[draggable.uuid]}\r\n                  elementCreator={draggable.elementCreator}\r\n                  onDragStart={this.handleDragStart}\r\n                  onDragStop={this.handleDragStop}\r\n                  dragOnAdd={draggable.dragOnAdd}\r\n                  config={draggable.config}\r\n                />\r\n              );\r\n            })}\r\n            {this.renderSelectionBox()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport styles from 'components/counter/Counter.module.scss';\r\nimport * as React from 'react';\r\nimport { addCommas } from 'utils';\r\n\r\nexport interface CounterProps {\r\n  keepVisible: boolean;\r\n  containerStyle: string;\r\n  countStyle: string;\r\n  count: number;\r\n  onClick?: () => void;\r\n  onMouseEnter?: () => void;\r\n  onMouseLeave?: () => void;\r\n}\r\n\r\nexport default class Counter extends React.Component<CounterProps> {\r\n  private ele!: HTMLDivElement;\r\n\r\n  constructor(props: CounterProps) {\r\n    super(props);\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^handle/, /^get/]\r\n    });\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    this.handleScrollIntoView();\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: CounterProps): void {\r\n    if (prevProps.count !== this.props.count) {\r\n      this.handleScrollIntoView();\r\n    }\r\n  }\r\n\r\n  private handleScrollIntoView(): void {\r\n    if (!!this.ele) {\r\n      if (this.props.count > 0 && this.props.keepVisible) {\r\n        window.setTimeout(() => {\r\n          window.scrollTo({\r\n            top: this.ele.getBoundingClientRect().top - 200 + window.scrollY,\r\n            behavior: 'smooth'\r\n          });\r\n        }, 200);\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleMouseEvent(event: React.MouseEvent<HTMLDivElement>, callback: () => void): void {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    if (callback) {\r\n      callback();\r\n    }\r\n  }\r\n\r\n  private handleMouseEnter(event: React.MouseEvent<HTMLDivElement>): void {\r\n    this.handleMouseEvent(event, this.props.onMouseEnter!);\r\n  }\r\n\r\n  private handleMouseLeave(event: React.MouseEvent<HTMLDivElement>): void {\r\n    this.handleMouseEvent(event, this.props.onMouseLeave!);\r\n  }\r\n\r\n  private handleClick(event: React.MouseEvent<HTMLDivElement>): void {\r\n    this.handleMouseEvent(event, this.props.onClick!);\r\n  }\r\n\r\n  public render(): JSX.Element | null {\r\n    const count = addCommas(this.props.count);\r\n    return (\r\n      <div\r\n        ref={(ele: HTMLDivElement) => {\r\n          this.ele = ele;\r\n        }}\r\n        className={\r\n          styles.counter +\r\n          ' ' +\r\n          this.props.containerStyle +\r\n          ' ' +\r\n          (this.props.onClick ? styles.clickable : '') +\r\n          ' ' +\r\n          (this.props.count > 0 ? styles.visible : '')\r\n        }\r\n        onClick={this.handleClick}\r\n        data-spec=\"counter-outter\"\r\n      >\r\n        <div\r\n          onMouseEnter={this.handleMouseEnter}\r\n          onMouseLeave={this.handleMouseLeave}\r\n          className={this.props.countStyle}\r\n          data-spec=\"counter-inner\"\r\n        >\r\n          {count}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from 'react';\r\nimport { createClickHandler } from 'utils';\r\n\r\nimport styles from './TitleBar.module.scss';\r\nimport { fakePropType } from 'config/ConfigProvider';\r\nimport i18n from 'config/i18n';\r\n\r\nexport interface TitleBarProps {\r\n  title: string;\r\n  onRemoval(event: React.MouseEvent<HTMLElement>): any;\r\n  __className?: string;\r\n  showRemoval?: boolean;\r\n  showMove?: boolean;\r\n  onMoveUp?(event: React.MouseEvent<HTMLElement>): any;\r\n  shouldCancelClick?: () => boolean;\r\n}\r\n\r\ninterface TitleBarState {\r\n  confirmingRemoval: boolean;\r\n}\r\n\r\nexport const confirmationTime = 2000;\r\n\r\nexport const titlebarContainerSpecId = 'titlebar-container';\r\nexport const titlebarSpecId = 'titlebar';\r\nexport const moveIconSpecId = 'move-icon';\r\nexport const moveSpecId = 'move';\r\nexport const removeIconSpecId = 'remove-icon';\r\nexport const confirmationSpecId = 'confirmation';\r\nexport const confirmRemovalSpecId = 'confirm-removal';\r\n\r\n/**\r\n * Simple title bar with confirmation removal\r\n */\r\nexport default class TitleBar extends React.Component<TitleBarProps, TitleBarState> {\r\n  private confirmationTimeout: number;\r\n\r\n  public static contextTypes = {\r\n    config: fakePropType\r\n  };\r\n\r\n  constructor(props: TitleBarProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      confirmingRemoval: false\r\n    };\r\n\r\n    this.handleConfirmRemoval = this.handleConfirmRemoval.bind(this);\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    if (this.confirmationTimeout) {\r\n      window.clearTimeout(this.confirmationTimeout);\r\n    }\r\n  }\r\n\r\n  public handleMouseUpCapture(event: React.MouseEvent<HTMLElement>): void {\r\n    if (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    }\r\n  }\r\n\r\n  public handleConfirmRemoval(event: React.MouseEvent<HTMLElement>): void {\r\n    if (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    }\r\n\r\n    this.setState({\r\n      confirmingRemoval: true\r\n    });\r\n\r\n    this.confirmationTimeout = window.setTimeout(\r\n      () =>\r\n        this.setState({\r\n          confirmingRemoval: false\r\n        }),\r\n      confirmationTime\r\n    );\r\n  }\r\n\r\n  private getMoveArrow(): JSX.Element {\r\n    let moveArrow: JSX.Element = null;\r\n\r\n    if (this.props.showMove && this.context.config.mutable) {\r\n      moveArrow = (\r\n        <div\r\n          className={styles.up_button}\r\n          {...createClickHandler(\r\n            this.props.onMoveUp,\r\n            this.props.shouldCancelClick,\r\n            this.handleMouseUpCapture\r\n          )}\r\n          data-testid={moveIconSpecId}\r\n        >\r\n          <span className=\"fe-arrow-up\" />\r\n        </div>\r\n      );\r\n    } else {\r\n      moveArrow = <div className={styles.up_button} data-spec={moveSpecId} />;\r\n    }\r\n\r\n    return moveArrow;\r\n  }\r\n\r\n  private getRemove(): JSX.Element {\r\n    let remove: JSX.Element = (\r\n      <div className={styles.remove_button} data-testid={removeIconSpecId}></div>\r\n    );\r\n\r\n    if (this.props.showRemoval && this.context.config.mutable) {\r\n      remove = (\r\n        <div\r\n          className={styles.remove_button}\r\n          {...createClickHandler(\r\n            this.handleConfirmRemoval,\r\n            this.props.shouldCancelClick,\r\n            this.handleMouseUpCapture\r\n          )}\r\n          data-testid={removeIconSpecId}\r\n        >\r\n          <span className=\"fe-x\" />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return remove;\r\n  }\r\n\r\n  private getConfirmationEl(): JSX.Element {\r\n    let confirmation: JSX.Element;\r\n\r\n    if (this.state.confirmingRemoval && this.context.config.mutable) {\r\n      confirmation = (\r\n        <div className={styles.remove_confirm} data-spec={confirmationSpecId}>\r\n          <div className={styles.up_button} data-spec={moveSpecId} />\r\n          <div className={styles.titletext}>{i18n.t('removal_confirmation', 'Remove?')}</div>\r\n          <div\r\n            className={styles.remove_button}\r\n            {...createClickHandler(\r\n              this.props.onRemoval,\r\n              this.props.shouldCancelClick,\r\n              this.handleMouseUpCapture\r\n            )}\r\n            data-testid={confirmRemovalSpecId}\r\n          >\r\n            <span className=\"fe-x\" />\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return confirmation;\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const confirmation: JSX.Element = this.getConfirmationEl();\r\n    const moveArrow: JSX.Element = this.getMoveArrow();\r\n    const remove: JSX.Element = this.getRemove();\r\n    return (\r\n      <div className={styles.titlebar} data-spec={titlebarContainerSpecId}>\r\n        <div className={`${this.props.__className} ${styles.normal}`} data-spec={titlebarSpecId}>\r\n          {moveArrow}\r\n          <div className={styles.titletext}>{this.props.title}</div>\r\n          {remove}\r\n        </div>\r\n        {confirmation}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames/bind';\r\nimport styles from './MountScroll.module.scss';\r\n\r\nconst cx: any = classNames.bind(styles);\r\n\r\ninterface MountScrollProps {\r\n  pulseAfterScroll?: boolean;\r\n}\r\n\r\ninterface MountScrollState {\r\n  pulse: boolean;\r\n}\r\n\r\nexport default class MountScroll extends React.Component<MountScrollProps, MountScrollState> {\r\n  private ele!: HTMLDivElement;\r\n  private handleScroll: () => void;\r\n\r\n  constructor(props: MountScrollProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      pulse: false\r\n    };\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    const handleScrollCompleted = this.handleScrollCompleted.bind(this);\r\n\r\n    let timer: number = null;\r\n    this.handleScroll = () => {\r\n      if (timer !== null) {\r\n        window.clearTimeout(timer);\r\n      }\r\n      timer = window.setTimeout(() => {\r\n        handleScrollCompleted();\r\n        window.removeEventListener('scroll', this.handleScroll);\r\n      }, 50);\r\n    };\r\n\r\n    window.addEventListener('scroll', this.handleScroll);\r\n    this.handleScrollIntoView();\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    window.removeEventListener('scroll', this.handleScroll);\r\n  }\r\n\r\n  private handleScrollCompleted(): void {\r\n    this.setState({ pulse: true });\r\n  }\r\n\r\n  private handleScrollIntoView(): void {\r\n    if (!!this.ele) {\r\n      const scrollTo = this.ele.getBoundingClientRect().top - 200 + window.scrollY;\r\n\r\n      if (scrollTo !== window.scrollY) {\r\n        const atBottom = window.innerHeight + window.scrollY >= document.body.scrollHeight - 2;\r\n        if (atBottom && scrollTo > window.scrollY) {\r\n          this.handleScrollCompleted();\r\n        } else {\r\n          window.setTimeout(() => {\r\n            window.scrollTo({\r\n              top: scrollTo,\r\n              behavior: 'smooth'\r\n            });\r\n          }, 0);\r\n        }\r\n      } else {\r\n        this.handleScrollCompleted();\r\n      }\r\n    }\r\n  }\r\n\r\n  public render(): JSX.Element | null {\r\n    const classes = cx({\r\n      [styles.wrapper]: true,\r\n      [styles.pulse]: this.state.pulse\r\n    });\r\n\r\n    return (\r\n      <div\r\n        className={classes}\r\n        ref={(ele: HTMLDivElement) => {\r\n          this.ele = ele;\r\n        }}\r\n      >\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport classNames from 'classnames/bind';\r\nimport shared from 'components/shared.module.scss';\r\nimport TitleBar from 'components/titlebar/TitleBar';\r\nimport { fakePropType } from 'config/ConfigProvider';\r\nimport { Types } from 'config/interfaces';\r\nimport { getTypeConfig } from 'config/typeConfigs';\r\nimport { Action, AnyAction, Endpoints, LocalizationMap, FlowIssue } from 'flowTypes';\r\nimport * as React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\nimport { Asset, RenderNode, AssetStore } from 'store/flowContext';\r\nimport AppState from 'store/state';\r\nimport {\r\n  ActionAC,\r\n  DispatchWithState,\r\n  moveActionUp,\r\n  OnOpenNodeEditor,\r\n  onOpenNodeEditor,\r\n  removeAction\r\n} from 'store/thunks';\r\nimport { createClickHandler, getLocalization } from 'utils';\r\n\r\nimport styles from './Action.module.scss';\r\nimport { hasIssues } from 'components/flow/helpers';\r\nimport MountScroll from 'components/mountscroll/MountScroll';\r\n\r\nexport interface ActionWrapperPassedProps {\r\n  first: boolean;\r\n  action: AnyAction;\r\n  localization: LocalizationMap;\r\n  selected: boolean;\r\n  issues: FlowIssue[];\r\n  render: (action: AnyAction, endpoints: Endpoints) => React.ReactNode;\r\n}\r\n\r\nexport interface ActionWrapperStoreProps {\r\n  assetStore: AssetStore;\r\n  renderNode: RenderNode;\r\n  language: Asset;\r\n  translating: boolean;\r\n  onOpenNodeEditor: OnOpenNodeEditor;\r\n  removeAction: ActionAC;\r\n  moveActionUp: ActionAC;\r\n  scrollToAction: string;\r\n}\r\n\r\nexport type ActionWrapperProps = ActionWrapperPassedProps & ActionWrapperStoreProps;\r\n\r\nexport const actionContainerSpecId = 'action-container';\r\nexport const actionOverlaySpecId = 'action-overlay';\r\nexport const actionInteractiveDivSpecId = 'interactive-div';\r\nexport const actionBodySpecId = 'action-body';\r\n\r\nconst cx: any = classNames.bind({ ...shared, ...styles });\r\n\r\n// Note: this needs to be a ComponentClass in order to work w/ react-flip-move\r\nexport class ActionWrapper extends React.Component<ActionWrapperProps> {\r\n  public static contextTypes = {\r\n    config: fakePropType\r\n  };\r\n\r\n  constructor(props: ActionWrapperProps) {\r\n    super(props);\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^on/, /^handle/]\r\n    });\r\n  }\r\n\r\n  public handleActionClicked(event: React.MouseEvent<HTMLElement>): void {\r\n    const target = event.target as any;\r\n\r\n    const showAdvanced =\r\n      target && target.attributes && target.getAttribute('data-advanced') === 'true';\r\n\r\n    this.props.onOpenNodeEditor({\r\n      originalNode: this.props.renderNode,\r\n      originalAction: this.props.action,\r\n      showAdvanced\r\n    });\r\n  }\r\n\r\n  public handleRemoval(event: React.MouseEvent<HTMLDivElement>): void {\r\n    if (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    }\r\n    this.props.removeAction(this.props.renderNode.node.uuid, this.props.action);\r\n  }\r\n\r\n  public handleMoveUp(event: React.MouseEvent<HTMLDivElement>): void {\r\n    if (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    }\r\n    this.props.moveActionUp(this.props.renderNode.node.uuid, this.props.action);\r\n  }\r\n\r\n  public getAction(): Action {\r\n    // if we are translating, us our localized version\r\n    if (this.props.translating) {\r\n      const localization = getLocalization(\r\n        this.props.action,\r\n        this.props.localization,\r\n        this.props.language\r\n      );\r\n      return localization.getObject() as AnyAction;\r\n    }\r\n\r\n    return this.props.action;\r\n  }\r\n\r\n  private getClasses(): string {\r\n    const localizedKeys = [];\r\n    let missingLocalization = false;\r\n\r\n    if (this.props.translating) {\r\n      if (\r\n        this.props.action.type === Types.send_msg ||\r\n        this.props.action.type === Types.send_broadcast ||\r\n        this.props.action.type === Types.say_msg\r\n      ) {\r\n        localizedKeys.push('text');\r\n      }\r\n\r\n      if (this.props.action.type === Types.send_email) {\r\n        localizedKeys.push('subject');\r\n      }\r\n\r\n      if (localizedKeys.length !== 0) {\r\n        const localization = getLocalization(\r\n          this.props.action,\r\n          this.props.localization,\r\n          this.props.language\r\n        );\r\n\r\n        if (localization.isLocalized()) {\r\n          for (const key of localizedKeys) {\r\n            if (!(key in localization.localizedKeys)) {\r\n              missingLocalization = true;\r\n              break;\r\n            }\r\n          }\r\n        } else {\r\n          missingLocalization = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    const notLocalizable = this.props.translating && localizedKeys.length === 0;\r\n\r\n    return cx({\r\n      [styles.action]: true,\r\n      [styles.has_router]:\r\n        this.props.renderNode.node.hasOwnProperty('router') &&\r\n        this.props.renderNode.node.router !== null,\r\n      [styles.translating]: this.props.translating,\r\n      [styles.not_localizable]: notLocalizable,\r\n      [styles.missing_localization]: missingLocalization,\r\n      [styles.localized]: !notLocalizable && !missingLocalization\r\n    });\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const { name } = getTypeConfig(this.props.action.type);\r\n\r\n    const classes = this.getClasses();\r\n    const actionToInject = this.getAction();\r\n\r\n    let titleBarClass = (shared as any)[this.props.action.type] || shared.missing;\r\n    const actionClass = (styles as any)[this.props.action.type] || styles.missing;\r\n    const showRemoval = !this.props.translating;\r\n    const showMove = !this.props.first && !this.props.translating;\r\n\r\n    if (hasIssues(this.props.issues, this.props.translating, this.props.language)) {\r\n      titleBarClass = shared.missing;\r\n    }\r\n\r\n    const events = this.context.config.mutable\r\n      ? createClickHandler(this.handleActionClicked, () => this.props.selected)\r\n      : {};\r\n\r\n    const body = (\r\n      <>\r\n        <TitleBar\r\n          __className={titleBarClass}\r\n          title={name}\r\n          onRemoval={this.handleRemoval}\r\n          showRemoval={showRemoval}\r\n          showMove={showMove}\r\n          onMoveUp={this.handleMoveUp}\r\n          shouldCancelClick={() => this.props.selected}\r\n        />\r\n        <div className={styles.body + ' ' + actionClass} data-spec={actionBodySpecId}>\r\n          {this.props.render(actionToInject, this.context.config.endpoints)}\r\n        </div>\r\n      </>\r\n    );\r\n    return (\r\n      <div\r\n        id={`action-${this.props.action.uuid}`}\r\n        className={classes}\r\n        data-spec={actionContainerSpecId}\r\n      >\r\n        <div className={styles.overlay} data-spec={actionOverlaySpecId} />\r\n        <div {...events} data-spec={actionInteractiveDivSpecId}>\r\n          {this.props.scrollToAction && this.props.scrollToAction === this.props.action.uuid ? (\r\n            <MountScroll pulseAfterScroll={true}>{body}</MountScroll>\r\n          ) : (\r\n            body\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n/* istanbul ignore next */\r\nconst mapStateToProps = ({\r\n  flowContext: {\r\n    assetStore,\r\n    definition: { localization }\r\n  },\r\n  editorState: { language, translating, scrollToAction }\r\n}: AppState) => ({\r\n  scrollToAction,\r\n  assetStore,\r\n  language,\r\n  translating,\r\n  localization\r\n});\r\n\r\n/* istanbul ignore next */\r\nconst mapDispatchToProps = (dispatch: DispatchWithState) =>\r\n  bindActionCreators(\r\n    {\r\n      onOpenNodeEditor,\r\n      removeAction,\r\n      moveActionUp\r\n    },\r\n    dispatch\r\n  );\r\n\r\nconst ConnectedActionWrapper = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps,\r\n  null,\r\n  { forwardRef: true }\r\n)(ActionWrapper);\r\n\r\nexport default ConnectedActionWrapper;\r\n","import * as React from 'react';\r\n\r\nimport styles from './DragHelper.module.scss';\r\nimport { Trans } from 'react-i18next';\r\n\r\ninterface DragHelperState {\r\n  visible: boolean;\r\n}\r\n\r\nexport default class DragHelper extends React.Component<{}, DragHelperState> {\r\n  constructor(props: {}) {\r\n    super(props);\r\n    this.state = {\r\n      visible: false\r\n    };\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    window.setTimeout(() => {\r\n      if (!this.state.visible) {\r\n        this.setState({ visible: true });\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    return (\r\n      <div className={styles.drag_helper + ' ' + (this.state.visible ? styles.visible : '')}>\r\n        <div className={styles.arrow}>\r\n          <div className={styles.tail} />\r\n          <div className={styles.head} />\r\n        </div>\r\n        <div className={styles.help_text}>\r\n          <Trans i18nKey=\"drag_helper\">\r\n            To connect nodes, <span className={styles.bold}>drag</span> from the red circle.\r\n          </Trans>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { Exit } from 'flowTypes';\r\n\r\nexport const getExitActivityKey = (exit: Exit) => {\r\n  return exit.uuid + ':' + exit.destination_uuid;\r\n};\r\n","import * as React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nexport interface PortalProps {\r\n  id?: string;\r\n}\r\n\r\nexport class Portal extends React.Component<PortalProps> {\r\n  private el: HTMLDivElement = null;\r\n  private portalRoot: HTMLElement = null;\r\n\r\n  constructor(props: PortalProps) {\r\n    super(props);\r\n    this.el = document.createElement('div');\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.setTimeout(() => {\r\n      this.portalRoot = document.getElementById(this.props.id || 'portal-root');\r\n      if (this.portalRoot) {\r\n        this.portalRoot.appendChild(this.el);\r\n      }\r\n    }, 100);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.portalRoot) {\r\n      this.el.remove();\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps: PortalProps) {\r\n    if (this.props.id && prevProps.id !== this.props.id) {\r\n      window.setTimeout(() => {\r\n        this.portalRoot = document.getElementById(this.props.id || 'portal-root');\r\n        this.portalRoot.appendChild(this.el);\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return ReactDOM.createPortal(this.props.children, this.el);\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport classNames from 'classnames/bind';\nimport Counter from 'components/counter/Counter';\nimport DragHelper from 'components/draghelper/DragHelper';\nimport { getExitActivityKey } from 'components/flow/exit/helpers';\nimport Loading from 'components/loading/Loading';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { Cancel, getRecentMessages } from 'external';\nimport { Category, Exit, FlowNode, LocalizationMap } from 'flowTypes';\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { RecentMessage } from 'store/editor';\nimport { Asset } from 'store/flowContext';\nimport AppState from 'store/state';\nimport { DisconnectExit, disconnectExit, DispatchWithState } from 'store/thunks';\nimport { createClickHandler, getLocalization, renderIf } from 'utils';\n\nimport * as moment from 'moment';\nimport styles from './Exit.module.scss';\nimport { Portal } from 'components/Portal';\n\nexport interface RenderCategory extends Category {\n  missing: boolean;\n}\n\nexport interface ExitPassedProps {\n  exit: Exit;\n  categories: Category[];\n  node: FlowNode;\n  showDragHelper: boolean;\n  plumberMakeSource: (id: string) => void;\n  plumberRemove: (id: string) => void;\n  plumberConnectExit: (node: FlowNode, exit: Exit) => void;\n  plumberUpdateClass: (\n    node: FlowNode,\n    exit: Exit,\n    className: string,\n    confirmDelete: boolean\n  ) => void;\n}\n\nexport interface ExitStoreProps {\n  translating: boolean;\n  dragging: boolean;\n  language: Asset;\n  localization: LocalizationMap;\n  disconnectExit: DisconnectExit;\n  segmentCount: number;\n  recentMessages: RecentMessage[];\n}\n\nexport type ExitProps = ExitPassedProps & ExitStoreProps;\n\nexport interface ExitState {\n  confirmDelete: boolean;\n  recentMessages: RecentMessage[];\n  fetchingRecentMessages: boolean;\n  showDragHelper: boolean;\n}\n\nconst cx: any = classNames.bind(styles);\nexport class ExitComp extends React.PureComponent<ExitProps, ExitState> {\n  private timeout: number;\n  private hideDragHelper: number;\n  private pendingMessageFetch: Cancel = {};\n  private ele: HTMLDivElement;\n\n  constructor(props: ExitProps) {\n    super(props);\n\n    this.state = {\n      confirmDelete: false,\n      recentMessages: null,\n      fetchingRecentMessages: false,\n      showDragHelper: props.showDragHelper\n    };\n\n    bindCallbacks(this, {\n      include: [/^on/, /^get/, /^handle/, /^connect/]\n    });\n  }\n\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  public getSourceId(): string {\n    return `${this.props.node.uuid}:${this.props.exit.uuid}`;\n  }\n\n  public handleDisconnect(): void {\n    this.setState({ showDragHelper: false });\n  }\n\n  public componentDidMount(): void {\n    this.props.plumberMakeSource(this.getSourceId());\n\n    if (this.ele) {\n      this.ele.addEventListener('disconnect', this.handleDisconnect);\n    }\n\n    if (this.props.exit.destination_uuid) {\n      this.connect();\n    }\n  }\n\n  public componentDidUpdate(prevProps: ExitProps): void {\n    if (this.props.exit.destination_uuid !== prevProps.exit.destination_uuid) {\n      this.connect();\n      if (this.state.confirmDelete) {\n        this.setState({ confirmDelete: false });\n      }\n    }\n\n    if (this.state.showDragHelper && prevProps.showDragHelper && !this.props.showDragHelper) {\n      this.setState({ showDragHelper: false });\n    }\n\n    this.props.plumberUpdateClass(\n      this.props.node,\n      this.props.exit,\n      'confirm-delete',\n      this.state.confirmDelete\n    );\n  }\n\n  public componentWillUnmount(): void {\n    if (this.props.exit.destination_uuid) {\n      this.props.plumberRemove(this.getSourceId());\n    }\n\n    if (this.ele) {\n      this.ele.removeEventListener('disconnect', this.handleDisconnect);\n    }\n  }\n\n  private handleMouseDown(event: React.MouseEvent<HTMLElement>): void {\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  private handleClick(event: React.MouseEvent<HTMLElement>): void {\n    if (!this.props.translating) {\n      if (this.props.exit.destination_uuid) {\n        event.preventDefault();\n        event.stopPropagation();\n        this.setState(\n          {\n            confirmDelete: true\n          },\n          () => {\n            this.timeout = window.setTimeout(() => {\n              this.setState({\n                confirmDelete: false\n              });\n            }, 2000);\n          }\n        );\n      } else {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!this.state.showDragHelper) {\n          this.setState({ showDragHelper: true }, () => {\n            if (this.hideDragHelper) {\n              window.clearTimeout(this.hideDragHelper);\n            }\n            this.hideDragHelper = window.setTimeout(() => {\n              this.setState({ showDragHelper: false });\n            }, 3000);\n          });\n        }\n      }\n    }\n  }\n\n  private onDisconnect(event: React.MouseEvent<HTMLElement>): void {\n    if (this.timeout) {\n      window.clearTimeout(this.timeout);\n    }\n\n    if (this.hideDragHelper) {\n      window.clearTimeout(this.hideDragHelper);\n    }\n\n    this.props.disconnectExit(this.props.node.uuid, this.props.exit.uuid);\n  }\n\n  private connect(): void {\n    this.props.plumberConnectExit(this.props.node, this.props.exit);\n  }\n\n  private handleShowRecentMessages(): void {\n    if (this.props.recentMessages) {\n      this.setState({ recentMessages: this.props.recentMessages });\n      return;\n    }\n\n    this.setState({ fetchingRecentMessages: true }, () => {\n      getRecentMessages(\n        this.context.config.endpoints.recents,\n        this.props.exit,\n        this.pendingMessageFetch\n      )\n        .then((recentMessages: RecentMessage[]) => {\n          this.setState({ recentMessages, fetchingRecentMessages: false });\n        })\n        .catch(() => {\n          // we may have been canceled\n        });\n    });\n  }\n\n  private handleHideRecentMessages(): void {\n    if (this.pendingMessageFetch.reject) {\n      this.pendingMessageFetch.reject();\n      this.pendingMessageFetch = {};\n    }\n\n    this.setState({ fetchingRecentMessages: false, recentMessages: null });\n  }\n\n  private getSegmentCount(): JSX.Element {\n    // Only exits with a destination have activity\n    if (this.props.segmentCount > 0) {\n      const key = `${this.props.exit.uuid}-label`;\n      return (\n        <div style={{ position: 'absolute', bottom: '-25px' }}>\n          <Counter\n            key={key}\n            count={this.props.segmentCount}\n            containerStyle={styles.activity}\n            countStyle={styles.count}\n            keepVisible={false}\n            onMouseEnter={this.handleShowRecentMessages}\n            onMouseLeave={this.handleHideRecentMessages}\n          />\n        </div>\n      );\n    }\n  }\n\n  public getName(): { name: string; localized?: boolean } {\n    if (this.props.translating) {\n      let name: string = '';\n      let delim: string = '';\n\n      let localized: boolean = false;\n\n      this.props.categories.forEach((category: Category) => {\n        const localization = getLocalization(\n          category,\n          this.props.localization,\n          this.props.language\n        );\n\n        localized = localized || 'name' in localization.localizedKeys;\n        const localizedObject = localization.getObject() as Category;\n        name += delim + localizedObject.name;\n        delim = ', ';\n      });\n\n      return { name, localized };\n    } else {\n      const names: string[] = [];\n      this.props.categories.forEach((cat: Category) => {\n        names.push(cat.name);\n      });\n\n      return {\n        name: names.join(', ')\n      };\n    }\n  }\n\n  private getRecentMessages(): JSX.Element {\n    if (this.state.fetchingRecentMessages || this.state.recentMessages !== null) {\n      const recentMessages = this.state.recentMessages || [];\n      const hasRecents = recentMessages.length !== 0;\n\n      const recentStyles = [styles.recent_messages];\n\n      let title = 'Recent Messages';\n      if (!hasRecents && !this.state.fetchingRecentMessages) {\n        title = 'No Recent Messages';\n        recentStyles.push(styles.no_recents);\n      }\n\n      const canvas = document.getElementById('canvas-container');\n      let left = 0;\n      let top = 0;\n\n      if (canvas) {\n        const canvasBounds = canvas.getBoundingClientRect();\n        const canvasOffset = canvasBounds.top + window.scrollY;\n        const rect = this.ele.getBoundingClientRect();\n        left = rect.left + window.scrollX + 5;\n        top = rect.top + window.scrollY - canvasOffset + 30;\n      }\n\n      return (\n        <Portal id=\"activity_recent_messages\">\n          <div className={recentStyles.join(' ')} style={{ position: 'absolute', left, top }}>\n            <div className={styles.title}>{title}</div>\n            {recentMessages.map((recentMessage: RecentMessage, idx: number) => (\n              <div key={'recent_' + idx} className={styles.message}>\n                <div className={styles.text}>{recentMessage.text}</div>\n                <div className={styles.sent}>{moment.utc(recentMessage.sent).fromNow()}</div>\n              </div>\n            ))}\n            {this.state.recentMessages === null ? (\n              <div className={styles.loading}>\n                <Loading size={10} units={6} color=\"#999999\" />\n              </div>\n            ) : null}\n          </div>\n        </Portal>\n      );\n    }\n    return null;\n  }\n\n  public render(): JSX.Element {\n    const { name, localized } = this.getName();\n\n    const nameStyle = name ? styles.name : '';\n    const connected = this.props.exit.destination_uuid ? ' jtk-connected' : '';\n    const dragNodeClasses = cx(styles.endpoint, connected);\n    const confirmDelete =\n      this.state.confirmDelete && this.props.exit.hasOwnProperty('destination_uuid');\n    const confirm: JSX.Element =\n      confirmDelete && this.context.config.mutable ? (\n        <div\n          className={styles.confirm_x + ' fe-x'}\n          {...createClickHandler(this.onDisconnect, () => this.props.dragging)}\n        />\n      ) : null;\n    const exitClasses: string = cx({\n      [styles.exit]: true,\n      'plumb-exit': true,\n      [styles.translating]: this.props.translating,\n      [styles.unnamed_exit]: name == null,\n      [styles.missing_localization]: name && this.props.translating && !localized,\n      [styles.confirm_delete]: confirmDelete\n    });\n\n    const activity = this.getSegmentCount();\n    const recents = this.getRecentMessages();\n\n    const events = this.context.config.mutable\n      ? createClickHandler(\n          this.handleClick,\n          () => {\n            return this.props.dragging;\n          },\n          this.handleMouseDown\n        )\n      : {};\n\n    return (\n      <div className={exitClasses}>\n        {name ? <div className={nameStyle}>{name}</div> : null}\n        <div\n          ref={(ref: HTMLDivElement) => (this.ele = ref)}\n          {...events}\n          id={`${this.props.node.uuid}:${this.props.exit.uuid}`}\n          className={dragNodeClasses}\n        >\n          {confirm}\n        </div>\n        {activity}\n        {recents}\n        {renderIf(this.state.showDragHelper)(<DragHelper />)}\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (\n  {\n    flowContext: {\n      definition: { localization }\n    },\n    editorState: { translating, language, dragActive, activity }\n  }: AppState,\n  props: ExitPassedProps\n) => {\n  // see if we have some passed in (simulated) messages\n  let recentMessages: RecentMessage[] = null;\n  const key = getExitActivityKey(props.exit);\n  if (key in (activity.recentMessages || {})) {\n    recentMessages = activity.recentMessages[key];\n  }\n  const segmentCount = activity.segments[getExitActivityKey(props.exit)] || 0;\n\n  return {\n    dragging: dragActive,\n    segmentCount,\n    translating,\n    language,\n    localization,\n    recentMessages\n  };\n};\n\nconst mapDispatchToProps = (dispatch: DispatchWithState) =>\n  bindActionCreators({ disconnectExit }, dispatch);\n\nconst ConnectedExit = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(ExitComp);\n\nexport default ConnectedExit;\n","import { react as bindCallbacks } from 'auto-bind';\nimport classNames from 'classnames/bind';\nimport Counter from 'components/counter/Counter';\nimport ActionWrapper from 'components/flow/actions/action/Action';\nimport ExitComp from 'components/flow/exit/Exit';\nimport {\n  getCategoriesForExit,\n  getResultName,\n  getVisibleActions,\n  filterIssuesForAction\n} from 'components/flow/node/helpers';\nimport { getSwitchRouter } from 'components/flow/routers/helpers';\nimport shared from 'components/shared.module.scss';\nimport TitleBar from 'components/titlebar/TitleBar';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { Types } from 'config/interfaces';\nimport { getType, getTypeConfig } from 'config/typeConfigs';\nimport { AnyAction, Exit, FlowNode, FlowIssue } from 'flowTypes';\nimport * as React from 'react';\nimport FlipMove from 'react-flip-move';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { DebugState } from 'store/editor';\nimport { AssetMap, RenderNode, Asset } from 'store/flowContext';\nimport AppState from 'store/state';\nimport {\n  DispatchWithState,\n  MergeEditorState,\n  mergeEditorState,\n  OnAddToNode,\n  onAddToNode,\n  OnOpenNodeEditor,\n  onOpenNodeEditor,\n  RemoveNode,\n  removeNode\n} from 'store/thunks';\nimport { ClickHandler, createClickHandler } from 'utils';\n\nimport styles from './Node.module.scss';\nimport { hasIssues } from '../helpers';\nimport MountScroll from 'components/mountscroll/MountScroll';\n\nexport interface NodePassedProps {\n  nodeUUID: string;\n  plumberMakeTarget: (id: string) => void;\n  plumberRecalculate: (id: string) => void;\n  plumberMakeSource: (id: string) => void;\n  plumberRemove: (id: string) => void;\n  plumberConnectExit: (node: FlowNode, exit: Exit) => void;\n  plumberUpdateClass: (\n    node: FlowNode,\n    exit: Exit,\n    className: string,\n    confirmDelete: boolean\n  ) => void;\n  startingNode: boolean;\n  onlyNode: boolean;\n  selected: boolean;\n  ghostRef?: any;\n  ghost?: boolean;\n}\n\nexport interface NodeStoreProps {\n  results: AssetMap;\n  language: Asset;\n  languages: AssetMap;\n  activeCount: number;\n  translating: boolean;\n  simulating: boolean;\n  debug: DebugState;\n  renderNode: RenderNode;\n  issues: FlowIssue[];\n  onAddToNode: OnAddToNode;\n  onOpenNodeEditor: OnOpenNodeEditor;\n  removeNode: RemoveNode;\n  mergeEditorState: MergeEditorState;\n  scrollToNode: string;\n  scrollToAction: string;\n}\n\nexport type NodeProps = NodePassedProps & NodeStoreProps;\n\nconst cx: any = classNames.bind({ ...shared, ...styles });\n\nconst EMPTY: any[] = [];\n/**\n * A single node in the rendered flow\n */\nexport class NodeComp extends React.PureComponent<NodeProps> {\n  public ele: HTMLDivElement;\n  private firstAction: any;\n  private clicking: boolean;\n  private events: ClickHandler;\n\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  constructor(props: NodeProps, context: any) {\n    super(props);\n\n    bindCallbacks(this, {\n      include: [/Ref$/, /^on/, /^get/, /^handle/]\n    });\n\n    this.events = context.config.mutable\n      ? createClickHandler(this.onClick, this.handleShouldCancelClick)\n      : {};\n  }\n\n  private handleShouldCancelClick(): boolean {\n    return this.props.selected;\n  }\n\n  private eleRef(ref: HTMLDivElement): HTMLDivElement {\n    return (this.ele = ref);\n  }\n\n  private getGhostListener(): any {\n    return (e: MouseEvent) => {\n      if (this.ele) {\n        let canvas = this.ele.parentElement;\n        if (this.ele.parentElement.parentElement) {\n          canvas = this.ele.parentElement.parentElement;\n        }\n\n        const canvasBounds = canvas.getBoundingClientRect();\n\n        // move our ghost node into position\n        const width = this.ele.getBoundingClientRect().width;\n        const left = e.pageX - width / 2 - 15 - canvasBounds.left;\n        const top = e.pageY - canvasBounds.top - window.scrollY;\n        const style = this.ele.style;\n        style.left = left + 'px';\n        style.top = top + 'px';\n\n        // Hide ourselves if there's a drop target\n        style.visibility = document.querySelector('.plumb-drop-hover') ? 'hidden' : 'visible';\n      }\n    };\n  }\n\n  public componentDidMount(): void {\n    // Make ourselves a target\n    this.props.plumberMakeTarget(this.props.renderNode.node.uuid);\n\n    // Move our drag node around as necessary\n    if (this.props.ghost) {\n      // We store our listener on the window so flow can remove it\n      // this is a bit hacky but allows us to remove our dependency on jquery\n      // TODO: rework ghost node to manage its location like other nodes\n      const ghostListener: any = this.getGhostListener();\n      (window as any).ghostListener = ghostListener;\n      document.addEventListener('mousemove', ghostListener);\n    }\n  }\n\n  public componentDidUpdate(prevProps: any): void {\n    // traceUpdate(this, prevProps);\n\n    // when our exits change, we need to recalculate the endpoints\n    if (!this.props.ghost) {\n      try {\n        this.props.plumberRecalculate(this.props.renderNode.node.uuid);\n        for (const exit of this.props.renderNode.node.exits) {\n          this.props.plumberRecalculate(this.props.renderNode.node.uuid + ':' + exit.uuid);\n        }\n      } catch (error) {\n        // console.log(error);\n      }\n    }\n  }\n\n  public componentWillUnmount(): void {\n    this.props.plumberRemove(this.props.renderNode.node.uuid);\n  }\n\n  /* istanbul ignore next */\n  private handleUUIDClicked(event: React.MouseEvent<HTMLElement>): void {\n    const selection = window.getSelection();\n    const range = document.createRange();\n    range.selectNodeContents(event.currentTarget);\n    selection.removeAllRanges();\n    selection.addRange(range);\n    document.execCommand('copy');\n    selection.removeAllRanges();\n    console.log(event.currentTarget.textContent + ' copied to clipboard.');\n  }\n\n  private handleAddToNode(): void {\n    this.props.onAddToNode(this.props.renderNode.node);\n  }\n\n  // Applies only to router nodes;\n  // ./Action/Action handles click logic for Action nodes.\n  private onClick(event: React.MouseEvent<HTMLElement>): void {\n    this.props.onOpenNodeEditor({\n      originalNode: this.props.renderNode\n    });\n  }\n\n  private handleRemoval(event: React.MouseEvent<HTMLElement>): void {\n    event.preventDefault();\n    event.stopPropagation();\n    this.props.removeNode(this.props.renderNode.node);\n  }\n\n  private getExits(): JSX.Element[] {\n    if (this.props.renderNode.node.exits) {\n      return this.props.renderNode.node.exits.map((exit: Exit, idx: number) => (\n        <ExitComp\n          key={exit.uuid}\n          node={this.props.renderNode.node}\n          categories={getCategoriesForExit(this.props.renderNode, exit)}\n          exit={exit}\n          showDragHelper={this.props.onlyNode && idx === 0}\n          plumberMakeSource={this.props.plumberMakeSource}\n          plumberRemove={this.props.plumberRemove}\n          plumberConnectExit={this.props.plumberConnectExit}\n          plumberUpdateClass={this.props.plumberUpdateClass}\n        />\n      ));\n    }\n    return [];\n  }\n\n  private isSelected(): boolean {\n    return this.props.selected;\n  }\n\n  private isStartNodeVisible(): boolean {\n    return this.props.startingNode;\n  }\n\n  /* istanbul ignore next */\n  private renderDebug(): JSX.Element {\n    if (this.props.debug) {\n      if (this.props.debug.showUUIDs) {\n        return (\n          <span\n            id={`uuid-${this.props.renderNode.node.uuid}`}\n            onClick={this.handleUUIDClicked}\n            className={styles.uuid}\n          >\n            {this.props.renderNode.node.uuid}\n          </span>\n        );\n      }\n    }\n  }\n\n  public render(): JSX.Element {\n    const actions: JSX.Element[] = [];\n\n    let actionList: JSX.Element = null;\n    if (this.props.renderNode.node.actions) {\n      // Save the first reference off to manage our clicks\n      let firstRef: { ref: (ref: any) => any } | {} = {\n        ref: (ref: any) => (this.firstAction = ref)\n      };\n\n      getVisibleActions(this.props.renderNode).forEach((action: AnyAction, idx: number) => {\n        const actionConfig = getTypeConfig(action.type);\n\n        const issues: FlowIssue[] = filterIssuesForAction(\n          this.props.nodeUUID,\n          action,\n          this.props.issues\n        );\n\n        if (actionConfig.hasOwnProperty('component') && actionConfig.component) {\n          const { component: ActionComponent } = actionConfig;\n          if (actionConfig.massageForDisplay) {\n            actionConfig.massageForDisplay(action);\n          }\n\n          actions.push(\n            <ActionWrapper\n              {...firstRef}\n              key={action.uuid}\n              renderNode={this.props.renderNode}\n              selected={this.props.selected}\n              action={action}\n              first={idx === 0}\n              issues={issues}\n              render={(anyAction: AnyAction) => {\n                return (\n                  <ActionComponent\n                    {...anyAction}\n                    languages={this.props.languages}\n                    issues={issues}\n                  />\n                );\n              }}\n            />\n          );\n        }\n\n        firstRef = {};\n      });\n\n      actionList =\n        actions.length > 0 ? (\n          <FlipMove enterAnimation=\"fade\" leaveAnimation=\"fade\" duration={300} easing=\"ease-out\">\n            {actions}\n          </FlipMove>\n        ) : null;\n    }\n\n    let header: JSX.Element = null;\n    let addActions: JSX.Element = null;\n    let summary: JSX.Element = null;\n\n    // Router node display logic\n    const type = getType(this.props.renderNode);\n    if (type !== Types.execute_actions) {\n      const config = getTypeConfig(type);\n      let title: string = config.name;\n\n      const switchRouter = getSwitchRouter(this.props.renderNode.node);\n      if (switchRouter) {\n        if (type === Types.split_by_contact_field && this.props.renderNode.ui.config.operand.name) {\n          title = `Split by ${this.props.renderNode.ui.config.operand.name}`;\n        }\n      }\n\n      const resultName = getResultName(this.props.renderNode.node);\n      if (resultName) {\n        summary = (\n          <div {...this.events} className={styles.save_result}>\n            <div className={styles.save_as}>Save as </div>\n            <div className={styles.result_name}>{resultName}</div>\n          </div>\n        );\n      }\n\n      if (\n        title === null &&\n        (type === Types.split_by_run_result || type === Types.split_by_run_result_delimited)\n      ) {\n        title = `Split by ${this.props.results[this.props.renderNode.ui.config.operand.id].name}`;\n      }\n\n      if (title === null) {\n        title = config.name;\n      }\n\n      if (!this.props.renderNode.node.actions || !this.props.renderNode.node.actions.length) {\n        // Router headers are introduced here while action headers are introduced in ./Action/Action\n        header = (\n          // Wrap in a relative parent so it honors node clipping\n          <div style={{ position: 'relative' }}>\n            <div {...this.events}>\n              <TitleBar\n                __className={\n                  (shared as any)[\n                    hasIssues(this.props.issues, this.props.translating, this.props.language)\n                      ? 'missing'\n                      : config.type\n                  ]\n                }\n                showRemoval={!this.props.translating}\n                onRemoval={this.handleRemoval}\n                shouldCancelClick={this.handleShouldCancelClick}\n                title={title}\n              />\n            </div>\n          </div>\n        );\n      }\n    } else {\n      // Don't show add actions option if we are translating\n      if (!this.props.translating && this.context.config.mutable) {\n        addActions = (\n          <div\n            className={styles.add}\n            {...createClickHandler(this.handleAddToNode, this.handleShouldCancelClick)}\n          >\n            <span className=\"fe-add\" />\n          </div>\n        );\n      }\n    }\n\n    const exits: JSX.Element[] = this.getExits();\n\n    const classes = cx({\n      'plumb-drag': true,\n      [styles.ghost]: this.props.ghost,\n      [styles.flow_start]: this.isStartNodeVisible(),\n      [styles.selected]: this.isSelected(),\n      [styles.immutable]: !this.context.config.mutable\n    });\n\n    const uuid: JSX.Element = this.renderDebug();\n\n    const body = (\n      <div className={styles.node}>\n        {this.isStartNodeVisible() ? (\n          <div className={styles.flow_start_message}>Flow Start</div>\n        ) : null}\n\n        {uuid}\n        <Counter\n          count={this.props.activeCount}\n          containerStyle={styles.active}\n          countStyle={''}\n          keepVisible={this.props.simulating}\n          onClick={() => {\n            if (this.context.config.onActivityClicked) {\n              this.context.config.onActivityClicked(this.props.nodeUUID, this.props.activeCount);\n            }\n          }}\n        />\n\n        <div className={styles.cropped}>\n          {header}\n          {actionList}\n          {summary}\n        </div>\n\n        <div className={`${styles.exit_table}`}>\n          <div className={styles.exits} {...this.events}>\n            {exits}\n          </div>\n          {addActions}\n        </div>\n      </div>\n    );\n\n    const renderedNode = (\n      <div\n        id={this.props.renderNode.node.uuid}\n        className={`${styles.node_container} ${classes}`}\n        ref={this.eleRef}\n      >\n        {!this.props.scrollToAction &&\n        this.props.scrollToNode &&\n        this.props.scrollToNode === this.props.nodeUUID ? (\n          <MountScroll pulseAfterScroll={true}>{body}</MountScroll>\n        ) : (\n          body\n        )}\n      </div>\n    );\n    return renderedNode;\n  }\n}\n\nconst mapStateToProps = (\n  {\n    flowContext: {\n      nodes,\n      issues,\n      assetStore: {\n        results: { items: results },\n        languages: { items: languages }\n      }\n    },\n    editorState: {\n      translating,\n      debug,\n      ghostNode,\n      simulating,\n      activity,\n      language,\n      scrollToAction,\n      scrollToNode\n    }\n  }: AppState,\n  props: NodePassedProps\n) => {\n  let renderNode: RenderNode = null;\n\n  // if we match our ghost node use that\n  if (ghostNode && ghostNode.node.uuid === props.nodeUUID) {\n    renderNode = ghostNode;\n  }\n\n  // otherwise look up our node from the list\n  else if (props.nodeUUID in nodes) {\n    renderNode = nodes[props.nodeUUID];\n  }\n\n  if (!renderNode) {\n    throw Error(\"Couldn't find node for \" + props.nodeUUID);\n  }\n\n  const activeCount = activity.nodes[props.nodeUUID] || 0;\n\n  // only set our scroll flags if they affect us\n  const scrollNode = scrollToNode && scrollToNode === props.nodeUUID ? scrollToNode : null;\n  const scrollAction = scrollToAction && scrollNode ? scrollToAction : null;\n\n  return {\n    issues: (issues || {})[props.nodeUUID] || EMPTY,\n    results,\n    language,\n    languages,\n    activeCount,\n    translating,\n    debug,\n    renderNode,\n    simulating,\n    scrollToNode: scrollNode,\n    scrollToAction: scrollAction\n  };\n};\n\nconst mapDispatchToProps = (dispatch: DispatchWithState) =>\n  bindActionCreators(\n    {\n      onAddToNode,\n      onOpenNodeEditor,\n      removeNode,\n      mergeEditorState\n    },\n    dispatch\n  );\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n  null,\n  { forwardRef: true }\n)(NodeComp);\n","import Dialog, { ButtonSet } from 'components/dialog/Dialog';\nimport { MediaPlayer } from 'components/mediaplayer/MediaPlayer';\nimport Modal from 'components/modal/Modal';\nimport styles from 'components/simulator/LogEvent.module.scss';\nimport { Types } from 'config/interfaces';\nimport { Flow, Group, Label } from 'flowTypes';\nimport * as React from 'react';\nimport { createUUID, getURNPath } from 'utils';\nimport i18n from 'config/i18n';\nimport { Trans } from 'react-i18next';\n\nconst MAP_THUMB = require('static/images/map.jpg');\n\ninterface MsgProps {\n  text: string;\n  uuid: string;\n  urn: string;\n  attachments?: string[];\n  quick_replies?: string[];\n}\n\ninterface WebRequestLog {\n  url: string;\n  request: string;\n  response: string;\n}\n\ninterface ClassifierIntent {\n  name: string;\n  confidence: number;\n}\n\ninterface ClassifierEntity {\n  value: string;\n  confidence: number;\n}\n\nexport interface EventProps {\n  step_uuid: string;\n  uuid?: string;\n  created_on?: string;\n  type?: string;\n  field?: { key: string; name: string };\n  field_uuid?: string;\n  result_name?: string;\n  text?: string;\n  name?: string;\n  value?: string | { text: string };\n  body?: string;\n  addresses?: string[];\n  to?: string[];\n  subject?: string;\n  url?: string;\n  status?: string;\n  status_code?: number;\n  request?: string;\n  response?: string;\n  resthook?: string;\n  base_language?: string;\n  language?: string;\n  translations?: { [lang: string]: { [text: string]: string } };\n  groups?: Group[];\n  flow?: Flow;\n  groups_added?: Group[];\n  groups_removed?: Group[];\n  labels?: Label[];\n  msg?: MsgProps;\n  http_logs?: WebRequestLog[];\n  extra?: any;\n  urns?: string[];\n  service?: string;\n  classifier?: { uuid: string; name: string };\n  ticketer?: { uuid: string; name: string };\n}\n\ninterface FlowEvent {\n  step_uuid: string;\n  type: string;\n}\n\ninterface AirtimeTransferEvent extends FlowEvent {\n  actual_amount: number;\n  desired_amount: number;\n  currency: string;\n  http_logs: WebRequestLog[];\n  recipient: string;\n  sender: string;\n}\n\ninterface LogEventState {\n  detailsVisible: boolean;\n}\n\nexport enum Direction {\n  MT,\n  MO\n}\n\nconst getStyleForDirection = (direction: Direction): string => {\n  return direction === Direction.MO ? styles.msg_received : styles.send_msg;\n};\n\nconst renderError = (error: string): JSX.Element => {\n  return (\n    <div className={styles.error}>\n      <span>Error: {error}</span>\n    </div>\n  );\n};\n\nconst renderInfo = (info: string): JSX.Element => {\n  // localized text can have html entities, so this isn't as dangerous as it looks\n  return (\n    <div key={info} className={styles.info}>\n      <span dangerouslySetInnerHTML={{ __html: info }} />\n    </div>\n  );\n};\n\nconst renderAttachment = (attachment: string): JSX.Element => {\n  const idx = attachment.indexOf(':');\n  if (idx > -1) {\n    const type = attachment.substr(0, idx);\n    const url = attachment.substr(idx + 1);\n    if (type.startsWith('audio')) {\n      return (\n        <div className={styles.audio_attachment}>\n          <div className={styles.media_player}>\n            <MediaPlayer url={url} />\n          </div>\n          <div className={styles.audio_text}>Audio Recording</div>\n        </div>\n      );\n    } else if (type.startsWith('image')) {\n      return <img src={url} alt=\"Attachment\" />;\n    } else if (type.startsWith('application')) {\n      return (\n        <div\n          onClick={() => {\n            window.open(url);\n          }}\n          style={{\n            cursor: 'pointer',\n            textDecoration: 'none',\n            padding: '10px 12px',\n            background: '#e6e6e6',\n            color: '#666'\n          }}\n        >\n          <div style={{ display: 'flex', alignItems: 'center' }}>\n            <div\n              className=\"fe-document-file-pdf\"\n              style={{\n                textDecoration: 'none',\n                fontSize: '20px'\n              }}\n            />\n            <div style={{ marginLeft: '5px', lineHeight: '16px' }}>\n              {i18n.t('document', 'Document')}\n            </div>\n          </div>\n        </div>\n      );\n    } else if (type.startsWith('geo')) {\n      return <img src={MAP_THUMB} alt=\"Attachment\" />;\n    } else if (type.startsWith('video')) {\n      return (\n        <div className={styles.video_attachment}>\n          <video controls={true} src={url} />\n        </div>\n      );\n    }\n  }\n  return null;\n};\n\nconst renderMessage = (text: string, attachments: string[], direction: Direction): JSX.Element => {\n  const attaches = attachments || [];\n\n  return (\n    <div className={getStyleForDirection(direction)}>\n      {attaches.map((attachment: string) => (\n        <div key={text + attachment}>{renderAttachment(attachment)}</div>\n      ))}\n      {text\n        ? text\n            .trim()\n            .split('\\n')\n            .map((item, key) => {\n              return (\n                <div key={createUUID()} className={styles.msg_text}>\n                  {item}\n                </div>\n              );\n            })\n        : null}\n    </div>\n  );\n};\n\n/**\n * Viewer for log events\n */\nexport default class LogEvent extends React.Component<EventProps, LogEventState> {\n  constructor(props: EventProps) {\n    super(props);\n    this.state = {\n      detailsVisible: false\n    };\n\n    this.showDetails = this.showDetails.bind(this);\n    this.getButtons = this.getButtons.bind(this);\n  }\n\n  private getButtons(): ButtonSet {\n    return {\n      primary: {\n        name: 'Ok',\n        onClick: () => {\n          this.setState({ detailsVisible: false });\n        }\n      }\n    };\n  }\n\n  private showDetails(): void {\n    this.setState({ detailsVisible: true });\n  }\n\n  private renderGroupsChanged(): JSX.Element {\n    let parts: string[] = [];\n    if (this.props.groups_added) {\n      const info = i18n.t('simulator.added_to_group', 'Added to ');\n      parts.push(info + this.renderValueList(this.props.groups_added.map(group => group.name)));\n    }\n    if (this.props.groups_removed) {\n      const info = i18n.t('simulator.removed_from_group', 'Removed from ');\n      parts.push(info + this.renderValueList(this.props.groups_removed.map(group => group.name)));\n    }\n\n    return renderInfo(parts.join('. '));\n  }\n\n  private renderLabelsAdded(): JSX.Element {\n    let info = i18n.t('simulator.input_labels_added', 'Message labeled with ');\n\n    return renderInfo(info + this.renderValueList(this.props.labels.map(label => label.name)));\n  }\n\n  private renderEmailSent(): JSX.Element {\n    const recipients = this.props.to || this.props.addresses;\n    return this.renderClickable(\n      <div className={styles.info + ' ' + styles.email}>\n        <Trans\n          i18nKey=\"simulator.sent_email.summary\"\n          values={{ recipients: this.renderValueList(recipients), subject: this.props.subject }}\n        >\n          Sent email to [[recipients]] with subject \"[[subject]]\"\n        </Trans>\n      </div>,\n      <Dialog\n        title={i18n.t('simulator.sent_email.title', 'Email Details')}\n        headerClass={Types.send_email}\n        buttons={this.getButtons()}\n        noPadding={true}\n      >\n        <div className={styles.email_details}>\n          <div className={styles.to}>\n            {i18n.t('email.to', 'To')}: {this.renderValueList(recipients)}\n          </div>\n          <div className={styles.subject}>\n            {i18n.t('email.subject', 'Subject')}: {this.props.subject}\n          </div>\n          <div className={styles.body}>{this.props.body}</div>\n        </div>\n      </Dialog>\n    );\n  }\n\n  private renderHTTPRequest(headerClass: Types, log: WebRequestLog): JSX.Element {\n    return this.renderClickable(\n      <div className={styles.info + ' ' + styles.webhook}>\n        <span>Called {log.url}</span>\n      </div>,\n      <Dialog\n        title={i18n.t('simulator.httplog_dialog', 'HTTP Request Details')}\n        headerClass={headerClass}\n        buttons={this.getButtons()}\n        noPadding={true}\n      >\n        <div className={styles.webhook_details}>\n          <div className={''}>{log.request}</div>\n          <div className={styles.response}>{log.response}</div>\n        </div>\n      </Dialog>\n    );\n  }\n\n  private renderWebhook(headerClass: Types): JSX.Element {\n    if (this.props.http_logs) {\n      return (\n        <>\n          {this.props.http_logs.map((log: WebRequestLog) => {\n            return this.renderHTTPRequest(headerClass, log);\n          })}\n        </>\n      );\n    }\n    if (this.props.url) {\n      return this.renderHTTPRequest(headerClass, this.props as WebRequestLog);\n    }\n  }\n\n  private renderClickable(element: JSX.Element, details: JSX.Element): JSX.Element {\n    return (\n      <div key={this.props.step_uuid}>\n        <div className={styles.has_detail} onClick={this.showDetails}>\n          {element}\n        </div>\n        <Modal show={this.state.detailsVisible}>\n          <div className={styles.event_viewer}>{details}</div>\n        </Modal>\n      </div>\n    );\n  }\n\n  private renderClassification(): JSX.Element {\n    return (\n      <table className={styles.classification}>\n        <tbody>\n          {(this.props.extra.intents || []).map((intent: ClassifierIntent) => (\n            <tr key={intent.name + intent.confidence}>\n              <td>{intent.name}</td>\n              <td>intent</td>\n              <td>{intent.confidence.toFixed(3)}</td>\n            </tr>\n          ))}\n\n          {Object.keys(this.props.extra.entities || []).map((key: string) => {\n            const entities = this.props.extra.entities[key];\n            return entities.map((entity: ClassifierEntity) =>\n              key !== entity.value ? (\n                <tr key={entity.value + entity.confidence}>\n                  <td>{entity.value}</td>\n                  <td>{key}</td>\n                  <td>{entity.confidence.toFixed(3)}</td>\n                </tr>\n              ) : null\n            );\n          })}\n        </tbody>\n      </table>\n    );\n  }\n\n  public renderLogEvent(): JSX.Element {\n    if (this.props.extra && this.props.extra.intents) {\n      return this.renderClassification();\n    }\n\n    switch (this.props.type) {\n      case 'msg_received':\n        return renderMessage(this.props.msg.text, this.props.msg.attachments, Direction.MO);\n      case 'msg_created':\n        return renderMessage(this.props.msg.text, this.props.msg.attachments, Direction.MT);\n      case 'ivr_created':\n        return renderMessage(this.props.msg.text, this.props.msg.attachments, Direction.MT);\n      case 'error':\n        return renderError(this.props.text);\n      case 'failure':\n        return renderError(this.props.text);\n      case 'msg_wait':\n        return renderInfo(i18n.t('simulator.msg_wait', 'Waiting for reply'));\n      case 'contact_groups_changed':\n        return this.renderGroupsChanged();\n      case 'contact_urns_changed':\n        return renderInfo('Added a URN for the contact');\n      case 'contact_field_changed':\n        const value = this.getValue(this.props.value);\n        if (value !== '') {\n          return renderInfo(\n            i18n.t('simulator.contact_field_changed', 'Set contact \"[[field]]\" to \"[[value]]\"', {\n              field: this.props.field.name,\n              value: this.getValue(this.props.value)\n            })\n          );\n        } else {\n          return renderInfo(\n            i18n.t('simulator.contact_field_cleared', 'Cleared contact \"[[field]]\"', {\n              field: this.props.field.name\n            })\n          );\n        }\n      case 'run_result_changed':\n        return renderInfo(\n          i18n.t('simulator.run_result_changed', 'Set result \"[[field]]\" to \"[[value]]\"', {\n            field: this.props.name,\n            value: this.getValue(this.props.value)\n          })\n        );\n      case 'contact_name_changed':\n        return renderInfo(\n          i18n.t('simulator.contact_name_changed', 'Set contact name to \"[[name]]\"', {\n            name: this.props.name\n          })\n        );\n      case 'email_created':\n      case 'email_sent':\n        return this.renderEmailSent();\n      case 'broadcast_created':\n        return renderMessage(\n          this.props.translations[this.props.base_language].text,\n          this.props.msg ? this.props.msg.attachments : [],\n          Direction.MT\n        );\n      case 'resthook_called':\n        return renderInfo(\n          i18n.t('simulator.resthook_called', 'Triggered flow event \"[[resthook]]\"', {\n            resthook: this.props.resthook\n          })\n        );\n      case 'service_called':\n        if (this.props.service === 'classifier') {\n          return this.renderWebhook(Types.call_classifier);\n        }\n        break;\n      case 'webhook_called':\n        return this.renderWebhook(Types.call_webhook);\n      case 'flow_entered':\n        return renderInfo(\n          i18n.t('simulator.flow_entered', 'Entered flow \"[[flow]]\"', {\n            flow: this.props.flow.name\n          })\n        );\n      case 'session_triggered':\n        return renderInfo(\n          i18n.t('simulator.session_triggered', 'Started somebody else in \"[[flow]]\"', {\n            flow: this.props.flow.name\n          })\n        );\n      case 'contact_language_changed':\n        return renderInfo(\n          i18n.t('simulator.contact_language_changed', 'Set preferred language to \"[[language]]\"', {\n            language: this.props.language\n          })\n        );\n      case 'contact_status_changed':\n        return renderInfo(\n          i18n.t('simulator.contact_status_changed', 'Set status to \"[[status]]\"', {\n            status: this.props.status\n          })\n        );\n      case 'info':\n        return renderInfo(this.props.text);\n      case 'input_labels_added':\n        return this.renderLabelsAdded();\n      case 'environment_refreshed':\n        return null;\n      case 'ticket_opened':\n        return renderInfo(\n          i18n.t('simulator.ticket_opened', 'Ticket opened with subject \"[[subject]]\"', {\n            subject: this.props.subject\n          })\n        );\n      case 'airtime_transferred':\n        const event = this.props as AirtimeTransferEvent;\n        return (\n          <>\n            {this.renderWebhook(Types.transfer_airtime)}\n\n            {renderInfo(\n              i18n.t(\n                'simulator.airtime_transferred',\n                'Transferred [[amount]] [[currency]] to [[recipient]]',\n                {\n                  amount: event.actual_amount,\n                  currency: event.currency,\n                  recipient: getURNPath(event.recipient)\n                }\n              )\n            )}\n          </>\n        );\n    }\n\n    // should only get here if we are get an unexpected event\n    console.log('Simulator render missing', this.props);\n    return null;\n  }\n\n  public render(): JSX.Element {\n    return <div className={styles.evt}>{this.renderLogEvent()}</div>;\n  }\n\n  /**\n   * Helper to render a list of values with each value quoted\n   */\n  private renderValueList(values: string[]): string {\n    let text = '';\n    let delim = '';\n    values.forEach(value => {\n      text += `${delim}\"${value}\"`;\n      delim = ', ';\n    });\n    return text;\n  }\n\n  /**\n   * Helper for value fields which can be an object (contact_field_changed) or string (run_result_changed)\n   */\n  private getValue(value: string | { text: string } | null): string {\n    if (!value) {\n      return '';\n    } else if (typeof value === 'string') {\n      return value;\n    }\n    return value.text;\n  }\n}\n","import * as React from 'react';\r\nimport ReactModal from 'react-modal';\r\n\r\ninterface CustomStyles {\r\n  content: { [cssProperty: string]: string | number };\r\n}\r\n\r\nexport interface ModalProps {\r\n  show: boolean;\r\n  onClose?(): void;\r\n\r\n  onModalOpen?: any;\r\n  width?: string;\r\n}\r\n\r\n// A base modal for displaying messages or performing single button actions\r\nexport default class Modal extends React.Component<ModalProps> {\r\n  public render(): JSX.Element {\r\n    const customStyles: CustomStyles = {\r\n      content: {\r\n        marginLeft: 'auto',\r\n        marginRight: 'auto',\r\n        marginTop: '40px',\r\n        bottom: 'initial',\r\n        padding: 'none',\r\n        borderRadius: 'none',\r\n        outline: 'none',\r\n        width: this.props.width ? this.props.width : '700px',\r\n        border: 'none'\r\n      }\r\n    };\r\n    return (\r\n      <ReactModal\r\n        ariaHideApp={false}\r\n        isOpen={this.props.show}\r\n        onAfterOpen={this.props.onModalOpen}\r\n        onRequestClose={this.props.onClose}\r\n        style={customStyles}\r\n        shouldCloseOnOverlayClick={false}\r\n        contentLabel=\"Modal\"\r\n      >\r\n        {this.props.children}\r\n      </ReactModal>\r\n    );\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport { getDraggedFrom } from 'components/helpers';\r\nimport Modal from 'components/modal/Modal';\r\nimport { Type } from 'config/interfaces';\r\nimport { Action, AnyAction, FlowDefinition, FlowIssue } from 'flowTypes';\r\nimport * as React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\nimport { UpdateUserAddingAction } from 'store/actionTypes';\r\nimport { Asset, AssetStore, RenderNode } from 'store/flowContext';\r\nimport { NodeEditorSettings, updateUserAddingAction } from 'store/nodeEditor';\r\nimport AppState from 'store/state';\r\nimport {\r\n  AddAsset,\r\n  addAsset,\r\n  DispatchWithState,\r\n  GetState,\r\n  HandleTypeConfigChange,\r\n  handleTypeConfigChange,\r\n  LocalizationUpdates,\r\n  MergeEditorState,\r\n  mergeEditorState,\r\n  NoParamsAC,\r\n  onUpdateAction,\r\n  OnUpdateAction,\r\n  OnUpdateLocalizations,\r\n  onUpdateLocalizations,\r\n  OnUpdateRouter,\r\n  onUpdateRouter,\r\n  resetNodeEditingState\r\n} from 'store/thunks';\r\nimport { CompletionSchema } from 'utils/completion';\r\nimport { LocalizationFormProps } from 'components/flow/props';\r\n\r\nexport type UpdateLocalizations = (language: string, changes: LocalizationUpdates) => void;\r\n\r\n// TODO: Remove use of Function\r\n// tslint:disable:ban-types\r\nexport interface NodeEditorPassedProps {\r\n  plumberConnectExit: Function;\r\n  helpArticles: { [key: string]: string };\r\n}\r\n\r\nexport interface NodeEditorStoreProps {\r\n  assetStore: AssetStore;\r\n  addAsset: AddAsset;\r\n  language: Asset;\r\n  definition: FlowDefinition;\r\n  translating: boolean;\r\n  typeConfig: Type;\r\n  settings: NodeEditorSettings;\r\n  nodes: { [uuid: string]: RenderNode };\r\n  handleTypeConfigChange: HandleTypeConfigChange;\r\n  resetNodeEditingState: NoParamsAC;\r\n  issues: FlowIssue[];\r\n  mergeEditorState: MergeEditorState;\r\n  onUpdateLocalizations: OnUpdateLocalizations;\r\n  onUpdateAction: OnUpdateAction;\r\n  onUpdateRouter: OnUpdateRouter;\r\n  updateUserAddingAction: UpdateUserAddingAction;\r\n  completionSchema: CompletionSchema;\r\n}\r\n\r\nexport type NodeEditorProps = NodeEditorPassedProps & NodeEditorStoreProps;\r\n\r\nexport interface FormProps {\r\n  // our two ways of updating\r\n  updateRouter(renderNode: RenderNode): void;\r\n  updateAction(action: AnyAction): void;\r\n\r\n  addAsset(assetType: string, asset: Asset): void;\r\n  completionSchema: CompletionSchema;\r\n\r\n  assetStore: AssetStore;\r\n  issues: FlowIssue[];\r\n  helpArticles: { [key: string]: string };\r\n\r\n  nodeSettings?: NodeEditorSettings;\r\n  typeConfig?: Type;\r\n  onTypeChange?(config: Type): void;\r\n  onClose?(canceled: boolean): void;\r\n}\r\n\r\n/* export interface LocalizationProps {\r\n  nodeSettings?: NodeEditorSettings;\r\n  typeConfig?: Type;\r\n  onClose?(canceled: boolean): void;\r\n\r\n  issues: FlowIssue[];\r\n  updateLocalizations: UpdateLocalizations;\r\n  language: Asset;\r\n}*/\r\n\r\nexport class NodeEditor extends React.Component<NodeEditorProps> {\r\n  constructor(props: NodeEditorProps) {\r\n    super(props);\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^close/, /^update/, /^handle/]\r\n    });\r\n  }\r\n\r\n  private updateLocalizations(language: string, changes: LocalizationUpdates) {\r\n    this.props.onUpdateLocalizations(language, changes);\r\n  }\r\n\r\n  public close(canceled: boolean): void {\r\n    // Make sure we re-wire the old connection\r\n    if (canceled) {\r\n      const dragPoint = getDraggedFrom(this.props.settings.originalNode);\r\n      if (dragPoint) {\r\n        const renderNode = this.props.nodes[dragPoint.nodeUUID];\r\n        for (const exit of renderNode.node.exits) {\r\n          if (exit.uuid === dragPoint.exitUUID) {\r\n            // TODO: should this just be taking literal uuids instead of objects?\r\n            this.props.plumberConnectExit(renderNode.node, exit);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    this.props.resetNodeEditingState();\r\n    this.props.updateUserAddingAction(false);\r\n  }\r\n\r\n  private updateAction(\r\n    action: Action,\r\n    onUpdated?: (dispatch: DispatchWithState, getState: GetState) => void\r\n  ): void {\r\n    this.props.onUpdateAction(action, onUpdated);\r\n  }\r\n\r\n  private updateRouter(renderNode: RenderNode): void {\r\n    this.props.onUpdateRouter(renderNode);\r\n  }\r\n\r\n  private handleAddAsset(assetType: string, asset: Asset): void {\r\n    this.props.addAsset(assetType, asset);\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    if (this.props.settings) {\r\n      const { typeConfig } = this.props;\r\n\r\n      // see if we should use the localization form\r\n      if (this.props.translating) {\r\n        const { localization: LocalizationForm } = typeConfig;\r\n\r\n        if (LocalizationForm) {\r\n          const localizationProps: LocalizationFormProps = {\r\n            updateLocalizations: this.updateLocalizations,\r\n            nodeSettings: this.props.settings,\r\n            onClose: this.close,\r\n            language: this.props.language,\r\n            helpArticles: this.props.helpArticles,\r\n            issues: this.props.issues.filter(\r\n              (issue: FlowIssue) => issue.language === this.props.language.id\r\n            )\r\n          };\r\n\r\n          return (\r\n            <Modal width=\"600px\" show={true}>\r\n              <LocalizationForm {...{ ...localizationProps }} />\r\n            </Modal>\r\n          );\r\n        }\r\n      }\r\n\r\n      const { form: Form } = typeConfig;\r\n\r\n      const formProps: FormProps = {\r\n        assetStore: this.props.assetStore,\r\n        completionSchema: this.props.completionSchema,\r\n        addAsset: this.handleAddAsset,\r\n        updateAction: this.updateAction,\r\n        updateRouter: this.updateRouter,\r\n        nodeSettings: this.props.settings,\r\n        helpArticles: this.props.helpArticles,\r\n        issues: this.props.issues.filter((issue: FlowIssue) => !issue.language),\r\n        typeConfig: this.props.typeConfig,\r\n        onTypeChange: this.props.handleTypeConfigChange,\r\n        onClose: this.close\r\n      };\r\n\r\n      return (\r\n        <Modal width=\"600px\" show={true}>\r\n          <Form {...{ ...formProps }} />\r\n        </Modal>\r\n      );\r\n    }\r\n    return null;\r\n  }\r\n}\r\n\r\n/* istanbul ignore next */\r\nconst mapStateToProps = ({\r\n  flowContext: { definition, nodes, assetStore, issues },\r\n  editorState: { language, translating, completionSchema },\r\n  nodeEditor: { typeConfig, settings }\r\n}: AppState) => {\r\n  const filteredIssues = (issues[settings.originalNode.node.uuid] || []).filter(\r\n    (issue: FlowIssue) =>\r\n      !settings.originalAction || settings.originalAction.uuid === issue.action_uuid\r\n  );\r\n\r\n  return {\r\n    issues: filteredIssues,\r\n    language,\r\n    definition,\r\n    nodes,\r\n    translating,\r\n    typeConfig,\r\n    settings,\r\n    assetStore,\r\n    completionSchema\r\n  };\r\n};\r\n\r\n/* istanbul ignore next */\r\nconst mapDispatchToProps = (dispatch: DispatchWithState) =>\r\n  bindActionCreators(\r\n    {\r\n      addAsset,\r\n      resetNodeEditingState,\r\n      mergeEditorState,\r\n      handleTypeConfigChange,\r\n      onUpdateLocalizations,\r\n      onUpdateAction,\r\n      onUpdateRouter,\r\n      updateUserAddingAction\r\n    },\r\n    dispatch\r\n  );\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(NodeEditor);\r\n","import { EventProps } from 'components/simulator/LogEvent';\r\nimport { FlowDefinition } from 'flowTypes';\r\nimport { AssetStore, AssetType } from 'store/flowContext';\r\nimport { assetMapToList } from 'store/helpers';\r\nimport { createUUID } from 'utils';\r\n\r\nexport const DEFAULT_KEY = '__default__';\r\n\r\nconst SIMULATOR_CHANNEL = {\r\n  uuid: createUUID(),\r\n  name: 'Simulator',\r\n  address: '+12065550000',\r\n  schemes: ['tel'],\r\n  roles: ['send', 'receive']\r\n};\r\n\r\ninterface SimAsset {\r\n  type: AssetType;\r\n  url: string;\r\n  content: any;\r\n}\r\n\r\nexport const getTime = (): string => {\r\n  const now = new Date();\r\n  const mins = now.getMinutes();\r\n  let minStr = '' + mins;\r\n  if (mins < 10) {\r\n    minStr = '0' + mins;\r\n  }\r\n  return Math.abs(12 - now.getHours()) + ':' + minStr;\r\n};\r\n\r\nexport const getSimulationAssets = (assets: AssetStore, flow: FlowDefinition): any => {\r\n  const simAssets: SimAsset[] = [];\r\n\r\n  // our group set asset\r\n  simAssets.push({\r\n    type: AssetType.Group,\r\n    url: assets.groups.endpoint,\r\n    content: assetMapToList(assets.groups.items)\r\n  });\r\n\r\n  // our fields\r\n  simAssets.push({\r\n    type: AssetType.Field,\r\n    url: assets.fields.endpoint,\r\n    content: assetMapToList(assets.fields.items)\r\n  });\r\n\r\n  // our labels\r\n  simAssets.push({\r\n    type: AssetType.Label,\r\n    url: assets.labels.endpoint,\r\n    content: assetMapToList(assets.labels.items)\r\n  });\r\n\r\n  // our channels\r\n  simAssets.push({\r\n    type: AssetType.Channel,\r\n    url: assets.channels.endpoint,\r\n    content: [SIMULATOR_CHANNEL]\r\n  });\r\n\r\n  simAssets.push({\r\n    type: AssetType.Flow,\r\n    url: assets.flows.endpoint + `${flow.uuid}/`,\r\n    content: flow\r\n  });\r\n\r\n  const payload = {\r\n    assets: simAssets,\r\n    asset_server: {\r\n      type_urls: {\r\n        [AssetType.Flow]: assets.flows.endpoint,\r\n        [AssetType.Field]: assets.fields.endpoint,\r\n        [AssetType.Channel]: assets.channels.endpoint,\r\n        [AssetType.Group]: assets.groups.endpoint,\r\n        [AssetType.Label]: assets.labels.endpoint\r\n      }\r\n    }\r\n  };\r\n\r\n  return payload;\r\n};\r\n\r\nexport const isMessage = (event: EventProps): boolean => {\r\n  return !!['msg_created', 'msg_received', 'ivr_created'].find(type => type === event.type);\r\n};\r\n\r\nexport const isMT = (event: EventProps): boolean => {\r\n  return !!['msg_created', 'ivr_created'].find(type => type === event.type);\r\n};\r\n\r\nexport const hasPopulatedKey = (obj: any): boolean => {\r\n  if (obj) {\r\n    Object.keys(obj).forEach((key: string) => {\r\n      return true;\r\n    });\r\n  }\r\n  return false;\r\n};\r\n\r\nexport const pruneEmpty = (obj: any): any => {\r\n  if (typeof obj === 'object') {\r\n    Object.keys(obj).forEach((key: string) => {\r\n      if (\r\n        !obj[key] ||\r\n        (Object.keys(obj[key]).length === 1 && obj[key].hasOwnProperty(DEFAULT_KEY))\r\n      ) {\r\n        delete obj[key];\r\n      } else {\r\n        pruneEmpty(obj[key]);\r\n\r\n        // now see if we have any new leaves\r\n        if (obj[key] !== null && typeof obj[key] === 'object') {\r\n          if (Object.keys(obj[key]).length === 0) {\r\n            delete obj[key];\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  return obj;\r\n};\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport * as axios from 'axios';\nimport { getTime, isMessage, isMT } from 'components/simulator/helpers';\nimport LogEvent, { EventProps } from 'components/simulator/LogEvent';\nimport ContextExplorer from './ContextExplorer';\nimport styles from 'components/simulator/Simulator.module.scss';\nimport { ConfigProviderContext, fakePropType } from 'config/ConfigProvider';\nimport { getURL } from 'external';\nimport { FlowDefinition, Group, Wait } from 'flowTypes';\nimport update from 'immutability-helper';\nimport { ReactNode } from 'react';\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { Activity, RecentMessage } from 'store/editor';\nimport { AssetStore, RenderNodeMap, Asset } from 'store/flowContext';\nimport { getCurrentDefinition } from 'store/helpers';\nimport AppState from 'store/state';\nimport { DispatchWithState, MergeEditorState } from 'store/thunks';\nimport { createUUID } from 'utils';\nimport { PopTabType } from 'config/interfaces';\n\nconst MESSAGE_DELAY_MS = 200;\n\nconst MAP_THUMB = require('static/images/map.jpg');\nconst IMAGE_A = 'https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_image_a.jpg';\nconst IMAGE_B = 'https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_image_b.jpg';\nconst IMAGE_C = 'https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_image_c.jpg';\nconst AUDIO_A = 'https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_audio_a.mp3';\nconst VIDEO_A = 'https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_video_a.mp4';\n\nconst VIDEO_A_THUMB =\n  'https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_video_a_thumb.jpg';\n\ninterface PostMessage {\n  text: string;\n  uuid: string;\n  urn: string;\n  attachments: string[];\n}\n\ninterface Message {\n  text: string;\n  inbound: boolean;\n}\n\nexport interface SimulatorStoreProps {\n  nodes: RenderNodeMap;\n  definition: FlowDefinition;\n  assetStore: AssetStore;\n\n  activity: Activity;\n\n  language: Asset;\n\n  // TODO: take away responsibility of simulator for resetting this\n  liveActivity: Activity;\n}\n\nexport interface SimulatorPassedProps {\n  mergeEditorState: MergeEditorState;\n  onToggled: (visible: boolean, tab: PopTabType) => void;\n  popped: string;\n}\n\nexport type SimulatorProps = SimulatorStoreProps & SimulatorPassedProps;\n\nenum DrawerType {\n  audio = 'audio',\n  images = 'images',\n  videos = 'videos',\n  location = 'location',\n  digit = 'digit',\n  digits = 'digits',\n  quickReplies = 'quickReplies'\n}\n\ninterface SimulatorState {\n  visible: boolean;\n  session?: Session;\n  context?: any;\n  contact: Contact;\n  channel: string;\n  events: EventProps[];\n  active: boolean;\n  time: string;\n\n  keypadEntry: string;\n\n  quickReplies?: string[];\n\n  // are we currently simulating a sprint\n  sprinting: boolean;\n\n  // is our drawer open\n  drawerOpen: boolean;\n\n  // what type of drawer are we looking at\n  drawerType?: DrawerType;\n\n  // how tall our drawer is\n  drawerHeight: number;\n\n  // is our attachment type selection open\n  attachmentOptionsVisible: boolean;\n\n  // if we can see our context explorer\n  contextExplorerVisible: boolean;\n\n  // are we at a wait hint, ie, a forced attachment\n  waitingForHint: boolean;\n}\n\ninterface Contact {\n  uuid: string;\n  urns: string[];\n  fields: {};\n  groups: Group[];\n}\n\ninterface Step {\n  arrived_on: Date;\n  uuid: string;\n  exit_uuid: string;\n  node_uuid: string;\n}\n\ninterface Run {\n  path: Step[];\n  flow_uuid: string;\n  status: string;\n  events?: EventProps[];\n  wait?: Wait;\n}\n\ninterface RunContext {\n  contact: Contact;\n  session: Session;\n  context?: any;\n  events: EventProps[];\n}\n\ninterface Session {\n  runs: Run[];\n  contact: Contact;\n  input?: any;\n  wait?: Wait;\n  status?: string;\n}\n\n/**\n * Our dev console for simulating or testing expressions\n */\nexport class Simulator extends React.Component<SimulatorProps, SimulatorState> {\n  private debug: Session[] = [];\n  private flows: FlowDefinition[] = [];\n  private currentFlow: string;\n  private inputBox: HTMLInputElement;\n\n  private drawerEle: HTMLDivElement;\n\n  // marks the bottom of our chat\n  private bottom: any;\n\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  constructor(props: SimulatorProps, context: ConfigProviderContext) {\n    super(props);\n    this.state = {\n      active: false,\n      visible: false,\n      events: [],\n      contact: {\n        uuid: createUUID(),\n        urns: ['tel:+12065551212'],\n        fields: {},\n        groups: []\n      },\n      keypadEntry: '',\n      drawerHeight: 0,\n      channel: createUUID(),\n      time: getTime(),\n      waitingForHint: false,\n      drawerOpen: false,\n      attachmentOptionsVisible: false,\n      contextExplorerVisible: false,\n      sprinting: false\n    };\n    this.bottomRef = this.bottomRef.bind(this);\n    this.inputBoxRef = this.inputBoxRef.bind(this);\n    this.currentFlow = this.props.definition.uuid;\n\n    bindCallbacks(this, {\n      include: [/^on/, /^get/, /^handle/]\n    });\n  }\n\n  private bottomRef(ref: any): void {\n    return (this.bottom = ref);\n  }\n\n  private inputBoxRef(ref: any): void {\n    this.inputBox = ref;\n  }\n\n  private updateActivity(recentMessages: { [key: string]: RecentMessage[] } = {}): void {\n    if (this.state.session) {\n      // if we are resetting, clear our recent messages\n\n      let lastExit: string = null;\n      const paths: { [key: string]: number } = {};\n      const active: { [nodeUUID: string]: number } = {};\n      let activeFlow: string;\n\n      for (const run of this.state.session.runs) {\n        let finalStep: Step = null;\n\n        for (const step of run.path) {\n          if (lastExit) {\n            const key = lastExit + ':' + step.node_uuid;\n            let pathCount = paths[key];\n            if (!pathCount) {\n              pathCount = 0;\n            }\n            paths[key] = ++pathCount;\n            if (!(key in recentMessages)) {\n              recentMessages[key] = [];\n            }\n          }\n          lastExit = step.exit_uuid;\n          finalStep = step;\n        }\n\n        if (finalStep) {\n          let count = active[finalStep.node_uuid];\n          if (!count) {\n            count = 0;\n          }\n\n          if (lastExit) {\n            const lastKey = lastExit + ':' + null;\n            paths[lastKey] = 1;\n\n            if (!(lastKey in recentMessages)) {\n              recentMessages[lastKey] = [];\n            }\n          }\n\n          if (this.state.session.status === 'waiting') {\n            active[finalStep.node_uuid] = ++count;\n          }\n          activeFlow = run.flow_uuid;\n        }\n      }\n\n      // if we are resetting, clear our recent messages\n      const simulatedMessages = this.state.session.input\n        ? this.props.activity.recentMessages || {}\n        : {};\n\n      for (const key in recentMessages) {\n        let messages = simulatedMessages[key] || [];\n        messages = recentMessages[key].concat(messages);\n        simulatedMessages[key] = messages;\n      }\n\n      const activity: Activity = {\n        segments: paths,\n        nodes: active,\n        recentMessages: simulatedMessages\n      };\n\n      this.props.mergeEditorState({ activity });\n      if (activeFlow && activeFlow !== this.currentFlow) {\n        this.currentFlow = activeFlow;\n      }\n    }\n  }\n\n  private updateEvents(\n    events: EventProps[],\n    session: Session,\n    recentMessages: { [key: string]: RecentMessage[] },\n    callback: () => void\n  ): void {\n    if (events && events.length > 0) {\n      const toAdd = [];\n\n      let quickReplies: string[] = null;\n\n      let messageFound = false;\n      while (events.length > 0 && !messageFound) {\n        const event = events.shift();\n\n        if (isMessage(event)) {\n          messageFound = true;\n\n          // if it's a message add it to our recent messages\n          let fromUUID = '';\n          let toUUID = '';\n\n          // work backwards, since our events are recent\n          for (let i = session.runs.length - 1; i >= 0; i--) {\n            const path = session.runs[i].path;\n\n            // start at the penultimate node since we have nowhere to render recent messages for the last node\n            for (let j = path.length - 1; j >= 0; j--) {\n              if (path[j].uuid === event.step_uuid) {\n                fromUUID = path[j].exit_uuid;\n                toUUID = path.length > j + 1 ? path[j + 1].node_uuid : null;\n                break;\n              }\n            }\n\n            if (fromUUID) {\n              const key = `${fromUUID}:${toUUID}`;\n              const msg: RecentMessage = {\n                sent: event.created_on,\n                text: event.msg.text\n              };\n              if (key in recentMessages) {\n                recentMessages[key].unshift(msg);\n              } else {\n                recentMessages[key] = [msg];\n              }\n            }\n          }\n\n          if (isMT(event)) {\n            // save off any quick replies we might have\n            if (event.msg.quick_replies) {\n              quickReplies = event.msg.quick_replies;\n            }\n          }\n        }\n\n        toAdd.push(event);\n      }\n\n      const newEvents = update(this.state.events, {\n        $push: toAdd\n      }) as EventProps[];\n      const newState: Partial<SimulatorState> = { events: newEvents };\n\n      if (quickReplies !== null) {\n        newState.quickReplies = quickReplies;\n      }\n\n      this.scrollToBottom();\n\n      this.setState(newState as SimulatorState, () => {\n        if (events.length === 0) {\n          callback();\n        } else {\n          window.setTimeout(() => {\n            this.updateEvents(events, session, recentMessages, callback);\n          }, MESSAGE_DELAY_MS);\n        }\n      });\n    } else {\n      callback();\n    }\n  }\n\n  private updateRunContext(runContext: RunContext, msg?: PostMessage): void {\n    const wasJustActive = this.state.active || (runContext.events && runContext.events.length > 0);\n    this.setState({ quickReplies: [] }, () => {\n      if (!runContext.events || (runContext.events.length === 0 && msg)) {\n        const runs = runContext.session.runs;\n        const run = runs[runs.length - 1];\n        const step = run.path[run.path.length - 1];\n\n        runContext.events = [\n          {\n            msg: {\n              uuid: createUUID(),\n              urn: this.state.contact.urns[0],\n              text: msg.text,\n              attachments: msg.attachments\n            },\n            type: 'msg_created',\n            created_on: new Date().toISOString(),\n            step_uuid: step.uuid\n          }\n        ];\n      }\n\n      const newlyRecentMessages = {};\n\n      this.updateEvents(runContext.events, runContext.session, newlyRecentMessages, () => {\n        let active = false;\n        for (const run of runContext.session.runs) {\n          if (run.status === 'waiting') {\n            active = true;\n            break;\n          }\n        }\n\n        let newEvents = this.state.events;\n        if (!active && wasJustActive) {\n          newEvents = update(this.state.events, {\n            $push: [\n              {\n                type: 'info',\n                text: 'Exited flow',\n                created_on: new Date()\n              } as any\n            ]\n          }) as EventProps[];\n        }\n\n        const waitingForHint =\n          runContext.session &&\n          runContext.session.wait &&\n          runContext.session.wait.hint !== undefined;\n\n        let drawerType = null;\n        if (waitingForHint) {\n          switch (runContext.session.wait.hint.type) {\n            case 'audio':\n              drawerType = DrawerType.audio;\n              break;\n            case 'video':\n              drawerType = DrawerType.videos;\n              break;\n            case 'image':\n              drawerType = DrawerType.images;\n              break;\n            case 'location':\n              drawerType = DrawerType.location;\n              break;\n            case 'digits':\n              drawerType = DrawerType.digit;\n              if (runContext.session.wait.hint.count !== 1) {\n                drawerType = DrawerType.digits;\n              }\n              break;\n            default:\n              console.log('Unknown hint', runContext.session.wait.hint.type);\n          }\n        }\n\n        let drawerOpen = waitingForHint;\n\n        // if we have quick replies, open our drawe with attachment options\n        if (!drawerType && this.hasQuickReplies()) {\n          drawerType = DrawerType.quickReplies;\n          drawerOpen = true;\n        }\n\n        this.setState(\n          {\n            active,\n            context: runContext.context,\n            sprinting: false,\n            session: runContext.session,\n            events: newEvents,\n            drawerOpen,\n            drawerType,\n            waitingForHint\n          },\n          () => {\n            this.updateActivity(newlyRecentMessages);\n            this.handleFocusUpdate();\n          }\n        );\n      });\n    });\n  }\n\n  private startFlow(): void {\n    const now = new Date().toISOString();\n    const contact: any = {\n      uuid: createUUID(),\n      urns: ['tel:+12065551212'],\n      fields: {},\n      groups: [],\n      created_on: now\n    };\n\n    // use the current displayed language when simulating\n    if (this.props.language) {\n      contact.language = this.props.language.id;\n    }\n\n    // reset our events and contact\n    this.setState(\n      {\n        sprinting: true,\n        drawerOpen: false,\n        attachmentOptionsVisible: false,\n        events: []\n      },\n      () => {\n        const body: any = {\n          contact: this.state.contact,\n          flow: getCurrentDefinition(this.props.definition, this.props.nodes, false),\n          trigger: {\n            type: 'manual',\n            environment: {\n              date_format: 'DD-MM-YYYY',\n              time_format: 'hh:mm',\n              timezone: 'America/New_York',\n              languages: []\n            },\n            contact,\n            flow: {\n              uuid: this.props.definition.uuid,\n              name: this.props.definition.name\n            },\n            params: {},\n            triggered_on: now\n          }\n        };\n\n        axios.default\n          .post(getURL(this.context.config.endpoints.simulateStart), JSON.stringify(body, null, 2))\n          .then((response: axios.AxiosResponse) => {\n            this.updateRunContext(response.data as RunContext);\n          });\n      }\n    );\n  }\n\n  private resume(text: string, attachment?: string): void {\n    if (!text && !attachment) {\n      return;\n    }\n\n    if (text === '\\\\debug') {\n      console.log(JSON.stringify(this.debug, null, 2));\n      return;\n    }\n\n    if (text === '\\\\recalc') {\n      console.log('recal..');\n      // this.props.plumberRepaint();\n      return;\n    }\n\n    this.setState({ sprinting: true, attachmentOptionsVisible: false, drawerOpen: false }, () => {\n      const now = new Date().toISOString();\n\n      const msg: PostMessage = {\n        text,\n        uuid: createUUID(),\n        urn: this.state.session.contact.urns[0],\n        attachments: attachment ? [attachment] : []\n      };\n\n      const body: any = {\n        flow: getCurrentDefinition(this.props.definition, this.props.nodes, false),\n        session: this.state.session,\n        resume: {\n          type: 'msg',\n          msg,\n          resumed_on: now,\n          contact: this.state.session.contact\n        }\n      };\n\n      axios.default\n        .post(getURL(this.context.config.endpoints.simulateResume), JSON.stringify(body, null, 2))\n        .then((response: axios.AxiosResponse) => {\n          this.updateRunContext(response.data as RunContext, msg);\n        })\n        .catch(error => {\n          if (error.response.status) {\n          }\n          const events = update(this.state.events, {\n            $push: [\n              {\n                type: 'error',\n                text:\n                  error.response.status > 499\n                    ? 'Server error, try again later'\n                    : error.response.data.error\n              } as any\n            ]\n          }) as EventProps[];\n          this.setState({ events });\n        });\n    });\n  }\n\n  private onReset(event: any): void {\n    this.startFlow();\n  }\n\n  private scrollToBottom(delay?: number): void {\n    const wait = delay || 0;\n    if (this.bottom) {\n      window.setTimeout(() => {\n        if (this.bottom) {\n          this.bottom.scrollIntoView(false);\n        }\n      }, wait);\n    }\n  }\n\n  public componentDidUpdate(prevProps: SimulatorProps, prevState: SimulatorState): void {\n    if (this.drawerEle !== null) {\n      if (\n        prevState.drawerHeight !== this.drawerEle.clientHeight ||\n        prevState.drawerOpen !== this.state.drawerOpen\n      ) {\n        this.setState({ drawerHeight: this.drawerEle.clientHeight }, () => {\n          this.scrollToBottom(800);\n        });\n      }\n    }\n  }\n\n  private onKeyUp(event: any): void {\n    if (event.key === 'Enter') {\n      const ele = event.target;\n      const text = ele.value;\n      ele.value = '';\n      this.resume(text);\n    }\n  }\n\n  private onToggle(event: any): void {\n    const newVisible = !this.state.visible;\n\n    this.props.onToggled(newVisible, PopTabType.SIMULATOR);\n\n    this.props.mergeEditorState({ simulating: newVisible });\n\n    this.setState({ visible: newVisible, contextExplorerVisible: false }, () => {\n      // clear our viewing definition\n      if (!this.state.visible) {\n        window.setTimeout(() => {\n          this.props.mergeEditorState({ activity: this.props.liveActivity });\n        }, 500);\n      } else {\n        this.updateActivity();\n\n        // start our flow if we haven't already\n        if (this.state.events.length === 0) {\n          this.startFlow();\n        }\n\n        this.handleFocusUpdate();\n      }\n    });\n  }\n\n  private handleFocusUpdate(): void {\n    if (this.inputBox) {\n      this.inputBox.focus();\n    }\n  }\n\n  private sendAttachment(attachment: string): void {\n    this.setState({ drawerOpen: false, attachmentOptionsVisible: false }, () => {\n      window.setTimeout(() => {\n        this.resume(null, attachment);\n      }, 200);\n    });\n  }\n\n  private getImageDrawer(): JSX.Element {\n    return (\n      <div className={styles.drawer_items}>\n        <div\n          className={styles.drawer_item}\n          onClick={() => {\n            this.sendAttachment('image/jpeg:' + IMAGE_A);\n          }}\n        >\n          <img src={IMAGE_A} alt=\"Attachment\" />\n        </div>\n        <div\n          className={styles.drawer_item}\n          onClick={() => {\n            this.sendAttachment('image/jpeg:' + IMAGE_B);\n          }}\n        >\n          <img src={IMAGE_B} alt=\"Attachment\" />\n        </div>\n        <div\n          className={styles.drawer_item}\n          onClick={() => {\n            this.sendAttachment('image/jpeg:' + IMAGE_C);\n          }}\n        >\n          <img src={IMAGE_C} alt=\"Attachment\" />\n        </div>\n      </div>\n    );\n  }\n\n  public getLocationDrawer(): JSX.Element {\n    return (\n      <div\n        className={styles.map_thumb}\n        onClick={() => {\n          this.sendAttachment('geo:2.904194,-79.003418');\n        }}\n      >\n        <img src={MAP_THUMB} alt=\"Attachment\" />\n      </div>\n    );\n  }\n\n  private getAudioDrawer(): JSX.Element {\n    return (\n      <div\n        className={styles.audio_picker}\n        onClick={() => {\n          this.sendAttachment('audio/mp3:' + AUDIO_A);\n        }}\n      >\n        <div className={styles.audio_icon + ' fe-mic'} />\n        <div className={styles.audio_message}>Upload Audio</div>\n      </div>\n    );\n  }\n\n  private getVideoDrawer(): JSX.Element {\n    return (\n      <div className={styles.drawer_items}>\n        <div\n          className={styles.drawer_item}\n          onClick={() => {\n            this.sendAttachment('video/mp4:' + VIDEO_A);\n          }}\n        >\n          <img src={VIDEO_A_THUMB} alt=\"Attachment\" />\n        </div>\n        <div\n          className={styles.drawer_item}\n          onClick={() => {\n            this.sendAttachment('video/mp4:' + VIDEO_A);\n          }}\n        >\n          <img src={VIDEO_A_THUMB} alt=\"Attachment\" />\n        </div>\n        <div\n          className={styles.drawer_item}\n          onClick={() => {\n            this.sendAttachment('video/mp4:' + VIDEO_A);\n          }}\n        >\n          <img src={VIDEO_A_THUMB} alt=\"Attachment\" />\n        </div>\n      </div>\n    );\n  }\n\n  private getQuickRepliesDrawer(): JSX.Element {\n    return (\n      <div className={styles.quick_replies}>\n        {this.state.quickReplies.map(reply => (\n          <div\n            className={styles.quick_reply}\n            onClick={() => {\n              this.resume(reply);\n            }}\n            key={`reply_${reply}`}\n          >\n            {reply}\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  private handleKeyPress(btn: string, multiple: boolean): void {\n    if (!multiple) {\n      this.resume(btn);\n    } else {\n      if (btn === '#') {\n        this.resume(this.state.keypadEntry);\n        this.setState({ keypadEntry: '' });\n      } else {\n        this.setState((prevState: SimulatorState) => {\n          return { keypadEntry: prevState.keypadEntry += btn };\n        });\n      }\n    }\n  }\n\n  private getKeyRow(keys: string[], multiple: boolean): JSX.Element {\n    return (\n      <div className={styles.row}>\n        {keys.map((key: string) => {\n          return (\n            <div\n              key={'btn_' + key}\n              onClick={() => {\n                this.handleKeyPress(key, multiple);\n              }}\n              className={styles.key}\n            >\n              {key}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  private getKeypadDrawer(multiple: boolean): JSX.Element {\n    return (\n      <div className={styles.keypad}>\n        {multiple ? <div className={styles.keypad_entry}>{this.state.keypadEntry}</div> : null}\n        <div className={styles.keys}>\n          {this.getKeyRow(['1', '2', '3'], multiple)}\n          {this.getKeyRow(['4', '5', '6'], multiple)}\n          {this.getKeyRow(['7', '8', '9'], multiple)}\n          {this.getKeyRow(['*', '0', '#'], multiple)}\n        </div>\n      </div>\n    );\n  }\n\n  private getDrawerContents(): JSX.Element {\n    switch (this.state.drawerType) {\n      case DrawerType.location:\n        return this.getLocationDrawer();\n      case DrawerType.audio:\n        return this.getAudioDrawer();\n      case DrawerType.images:\n        return this.getImageDrawer();\n      case DrawerType.videos:\n        return this.getVideoDrawer();\n      case DrawerType.quickReplies:\n        return this.getQuickRepliesDrawer();\n      case DrawerType.digits:\n      case DrawerType.digit:\n        return this.getKeypadDrawer(this.state.drawerType === DrawerType.digits);\n    }\n    return null;\n  }\n\n  private handleDrawerRef(ref: HTMLDivElement): HTMLDivElement {\n    return (this.drawerEle = ref);\n  }\n\n  public getDrawer(): JSX.Element {\n    const style: any = {};\n\n    if (this.state.drawerOpen) {\n      style.bottom = 50;\n\n      // are we being forced open\n      if (this.state.waitingForHint) {\n        style.bottom = 25;\n        style.zIndex = 150;\n        style.paddingBottom = 10;\n      }\n    } else {\n      style.bottom = -this.state.drawerHeight;\n    }\n\n    return (\n      <div\n        ref={this.handleDrawerRef}\n        style={style}\n        className={\n          styles.drawer +\n          ' ' +\n          (this.state.drawerOpen ? styles.drawer_visible : '') +\n          ' ' +\n          (this.state.attachmentOptionsVisible ? '' : styles.forced)\n        }\n      >\n        {this.getDrawerContents()}\n      </div>\n    );\n  }\n\n  private hasQuickReplies(): boolean {\n    return (this.state.quickReplies || []).length > 0;\n  }\n\n  private handleHideAttachments(): void {\n    this.setState(\n      {\n        attachmentOptionsVisible: false,\n        drawerOpen: false\n      },\n      () => {\n        if (this.hasQuickReplies()) {\n          window.setTimeout(() => {\n            this.showAttachmentDrawer(DrawerType.quickReplies);\n          }, 300);\n        }\n      }\n    );\n  }\n\n  private getAttachmentButton(icon: string, drawerType: DrawerType): JSX.Element {\n    return (\n      <div\n        className={icon}\n        onClick={() => {\n          this.showAttachmentDrawer(drawerType);\n        }}\n      />\n    );\n  }\n\n  private getAttachmentOptions(): JSX.Element {\n    return (\n      <div\n        className={\n          styles.attachment_buttons +\n          ' ' +\n          (this.state.attachmentOptionsVisible ? styles.visible : '')\n        }\n      >\n        <div className=\"fe-x\" onClick={this.handleHideAttachments} />\n        {this.getAttachmentButton('fe-picture2', DrawerType.images)}\n        {this.getAttachmentButton('fe-video', DrawerType.videos)}\n        {this.getAttachmentButton('fe-mic', DrawerType.audio)}\n        {this.getAttachmentButton('fe-map-marker', DrawerType.location)}\n      </div>\n    );\n  }\n\n  private handleContextExplorerClose(): void {\n    this.setState({ contextExplorerVisible: false });\n  }\n\n  private getContextExplorer(): JSX.Element {\n    return (\n      <ContextExplorer\n        visible={this.state.contextExplorerVisible}\n        onClose={this.handleContextExplorerClose}\n        contents={this.state.context}\n      />\n    );\n  }\n\n  private handleHideAttachmentDrawer(): void {\n    this.setState({ drawerOpen: false });\n  }\n\n  private showAttachmentDrawer(drawerType: DrawerType): void {\n    // if we are already open but a different type, hide ourselves and reopen with the new type\n    if (this.state.drawerOpen) {\n      // if that type is already open, its a noop\n      if (drawerType === this.state.drawerType) {\n        return;\n      }\n\n      this.handleHideAttachmentDrawer();\n      window.setTimeout(() => {\n        this.showAttachmentDrawer(drawerType);\n      }, 300);\n    } else {\n      this.setState((prevState: SimulatorState) => {\n        return { drawerOpen: true, drawerType };\n      });\n    }\n  }\n\n  public render(): ReactNode {\n    const messages: JSX.Element[] = [];\n    for (const event of this.state.events) {\n      messages.push(<LogEvent {...event} key={event.type + '_' + String(event.created_on)} />);\n    }\n\n    const hidden = this.props.popped && this.props.popped !== PopTabType.SIMULATOR;\n    const simHidden = hidden || !this.state.visible ? styles.sim_hidden : '';\n    const tabHidden = hidden || this.state.visible ? styles.tab_hidden : '';\n\n    const messagesStyle: any = {\n      height: 366 - (this.state.drawerOpen ? this.state.drawerHeight - 20 : 0)\n    };\n\n    // if attachments are forced open, account for missing attachment choice panel\n    if (this.state.drawerOpen && this.state.waitingForHint) {\n      messagesStyle.height += 25;\n    }\n\n    return (\n      <div id=\"sim_container\" className={styles.sim_container}>\n        <div>\n          <div id=\"simulator\" className={styles.simulator + ' ' + simHidden} key={'sim'}>\n            {this.getContextExplorer()}\n\n            <div className={styles.screen}>\n              <div className={styles.header}>\n                <div className={styles.close + ' fe-x'} onClick={this.onToggle} />\n              </div>\n              <div className={styles.messages} style={messagesStyle}>\n                {messages}\n                <div\n                  id=\"bottom\"\n                  style={{ float: 'left', clear: 'both', marginTop: 20 }}\n                  ref={this.bottomRef}\n                />\n              </div>\n              <div className={styles.controls}>\n                <input\n                  ref={this.inputBoxRef}\n                  type=\"text\"\n                  onKeyUp={this.onKeyUp}\n                  disabled={this.state.sprinting}\n                  placeholder={this.state.active ? 'Enter message' : 'Press home to start again'}\n                />\n                <div className={styles.show_attachments_button}>\n                  <div\n                    className=\"fe-paperclip\"\n                    onClick={() => {\n                      this.setState({\n                        attachmentOptionsVisible: true,\n                        drawerOpen: false\n                      });\n                    }}\n                  />\n                </div>\n              </div>\n              {this.getAttachmentOptions()}\n              {this.getDrawer()}\n              <div className={styles.footer}>\n                {!this.state.contextExplorerVisible ? (\n                  <div className={styles.show_context_button}>\n                    <div\n                      className=\"context-button\"\n                      onClick={() => {\n                        this.setState({\n                          contextExplorerVisible: true\n                        });\n                      }}\n                    >\n                      <span className=\"fe-at-sign\"></span>\n                    </div>\n                  </div>\n                ) : (\n                  <div className={styles.show_context_button}>\n                    <div\n                      className=\"context-button\"\n                      onClick={() => {\n                        this.setState({\n                          contextExplorerVisible: false\n                        });\n                      }}\n                    >\n                      <span className=\"fe-x\"></span>\n                    </div>\n                  </div>\n                )}\n\n                <span\n                  className={\n                    styles.reset + ' ' + (this.state.active ? styles.active : styles.inactive)\n                  }\n                  onClick={this.onReset}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n        <div className={styles.simulator_tab + ' ' + tabHidden} onClick={this.onToggle}>\n          <div className={styles.simulator_tab_icon + ' fe-smartphone'} />\n          <div className={styles.simulator_tab_text}>\n            Run in\n            <br />\n            Simulator\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\n/* istanbul ignore next */\nconst mapStateToProps = ({\n  flowContext: { definition, nodes, assetStore },\n  editorState: { liveActivity, activity, language }\n}: AppState) => ({\n  liveActivity,\n  activity,\n  assetStore,\n  definition,\n  nodes,\n  language\n});\n\n/* istanbul ignore next */\nconst mapDispatchToProps = (dispatch: DispatchWithState) => bindActionCreators({}, dispatch);\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Simulator);\n","import * as React from 'react';\r\nimport styles from './ContextExplorer.module.scss';\r\nimport { react as bindCallbacks } from 'auto-bind';\r\nimport classNames from 'classnames/bind';\r\nimport { copyToClipboard } from 'utils';\r\nimport i18n from 'config/i18n';\r\nimport { Trans } from 'react-i18next';\r\nimport { DEFAULT_KEY, pruneEmpty } from './helpers';\r\n\r\nconst cx: any = classNames.bind(styles);\r\n\r\nconst EXCLUDED_PATHS: { [path: string]: boolean } = {\r\n  'parent.run': true,\r\n  'child.run': true,\r\n  legacy_extra: true\r\n};\r\n\r\ntype PathStep = number | string;\r\n\r\nexport interface ContextExplorerProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  contents: any;\r\n}\r\n\r\ninterface ContextExplorerState {\r\n  opened: {};\r\n  expression: string;\r\n  messageVisible: boolean;\r\n  message: string;\r\n  showEmpty: boolean;\r\n}\r\n\r\nexport default class ContextExplorer extends React.Component<\r\n  ContextExplorerProps,\r\n  ContextExplorerState\r\n> {\r\n  constructor(props: ContextExplorerProps) {\r\n    super(props);\r\n    this.state = {\r\n      opened: {},\r\n      expression: null,\r\n      messageVisible: false,\r\n      showEmpty: false,\r\n      message: null\r\n    };\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^handle/]\r\n    });\r\n  }\r\n\r\n  private handleHide(): void {\r\n    this.props.onClose();\r\n  }\r\n\r\n  private isOpen(path: PathStep[]): boolean {\r\n    let openState: any = this.state.opened;\r\n    for (const step of path) {\r\n      openState = openState[step];\r\n      if (!openState) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private handleCopyPath(key: PathStep, prevPath: PathStep[]) {\r\n    const path: PathStep[] = [...prevPath, key];\r\n    const expression = '@' + path.join('.');\r\n    copyToClipboard(expression);\r\n    this.setState({ expression, messageVisible: true, message: null }, () => {\r\n      window.setTimeout(() => {\r\n        if (this.state.expression === expression) {\r\n          this.setState({ messageVisible: false });\r\n        }\r\n      }, 1500);\r\n    });\r\n  }\r\n\r\n  private handleToggleHide(): void {\r\n    const message = this.state.showEmpty\r\n      ? i18n.t('context_explorer.hide_empty', 'Showing keys with values')\r\n      : i18n.t('context_explorer.show_empty', 'Showing all keys');\r\n    this.setState(\r\n      { showEmpty: !this.state.showEmpty, message, expression: null, messageVisible: true },\r\n      () => {\r\n        window.setTimeout(() => {\r\n          if (this.state.message === message) {\r\n            this.setState({ messageVisible: false });\r\n          }\r\n        }, 1000);\r\n      }\r\n    );\r\n  }\r\n\r\n  private handlePathClick(key: PathStep, prevPath: PathStep[]) {\r\n    const opened = { ...this.state.opened };\r\n    const path: PathStep[] = [...prevPath, key];\r\n\r\n    let openPath: any = opened;\r\n    while (path.length > 0) {\r\n      const next = path.shift();\r\n\r\n      let closing = false;\r\n      // if it's the last one, check if toggling\r\n      if (path.length === 0) {\r\n        if (openPath[next]) {\r\n          closing = true;\r\n        }\r\n      }\r\n\r\n      if (closing) {\r\n        delete openPath[next];\r\n      } else {\r\n        const existing = openPath[next] || {};\r\n        // make sure it exists\r\n        openPath[next] = existing;\r\n      }\r\n\r\n      // dive down\r\n      openPath = openPath[next];\r\n    }\r\n\r\n    this.setState({ opened });\r\n  }\r\n\r\n  private renderContextNode(name: string, value: any, path: PathStep[]): JSX.Element {\r\n    if (!name) {\r\n      return null;\r\n    }\r\n\r\n    const newPath = [...path, name];\r\n    if (EXCLUDED_PATHS[newPath.join('.')]) {\r\n      return null;\r\n    }\r\n\r\n    const valueType = typeof value;\r\n    let text = valueType !== 'object' ? value : '';\r\n    let hasChildren = value && valueType === 'object' && Object.keys(value).length > 0;\r\n\r\n    if (value && value.hasOwnProperty(DEFAULT_KEY)) {\r\n      text = value[DEFAULT_KEY];\r\n      if (Object.keys(value).length === 1) {\r\n        hasChildren = false;\r\n      }\r\n    }\r\n\r\n    const isOpen = this.isOpen(newPath);\r\n\r\n    const arrowStyles = cx({\r\n      [styles.arrow_right]: true,\r\n      [styles.has_children]: hasChildren,\r\n      [styles.open]: isOpen\r\n    });\r\n    const keyStyles = cx({ [styles.key]: true, [styles.has_children]: hasChildren });\r\n    const keySummary = Array.isArray(value) ? `[${value.length}]` : null;\r\n\r\n    const onClick = (evt: React.MouseEvent<HTMLDivElement>) => {\r\n      if (evt.shiftKey) {\r\n        this.handleCopyPath(name, path);\r\n      } else {\r\n        if (hasChildren) {\r\n          this.handlePathClick(name, path);\r\n        }\r\n      }\r\n    };\r\n\r\n    return (\r\n      <div key={name + path.length}>\r\n        <div\r\n          className={styles.row}\r\n          style={{ marginLeft: path.length * 10 + 'px' }}\r\n          onClick={onClick}\r\n        >\r\n          <div className={arrowStyles}></div>\r\n          <div className={keyStyles}>\r\n            {name}\r\n            <div className={styles.key_summary}>{keySummary}</div>\r\n            <div\r\n              className={styles.clipboard + ' fe-clipboard-empty'}\r\n              onClick={(evt: React.MouseEvent<HTMLDivElement>) => {\r\n                evt.stopPropagation();\r\n                this.handleCopyPath(name, path);\r\n              }}\r\n            ></div>\r\n          </div>\r\n          <div className={styles.str_value}>{text}</div>\r\n        </div>\r\n        {isOpen ? this.renderProperties(value, newPath) : null}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private renderProperties(value: any, path: PathStep[] = []): JSX.Element {\r\n    if (!value) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <>\r\n        {Object.keys(value).map((key: string) => {\r\n          // don't show default key as a property\r\n          if (key !== DEFAULT_KEY) {\r\n            return this.renderContextNode(key, value[key], path);\r\n          }\r\n          return null;\r\n        })}\r\n      </>\r\n    );\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    let context = this.props.contents;\r\n    if (this.props.contents && !this.state.showEmpty) {\r\n      context = pruneEmpty(JSON.parse(JSON.stringify(this.props.contents)));\r\n    }\r\n\r\n    let message = null;\r\n    if (this.state.message || this.state.expression) {\r\n      if (this.state.message) {\r\n        message = this.state.message;\r\n      } else if (this.state.expression) {\r\n        message = (\r\n          <Trans\r\n            i18nKey=\"context_explorer.copied_expression\"\r\n            values={{ expression: this.state.expression }}\r\n          >\r\n            Copied <span className={styles.expression}>[[expression]]</span> to clipboard\r\n          </Trans>\r\n        );\r\n      }\r\n    }\r\n\r\n    const messageStyle = cx({\r\n      [styles.message]: true,\r\n      [styles.visible]: this.state.messageVisible\r\n    });\r\n\r\n    return (\r\n      <div className={styles.context_explorer + ' ' + (this.props.visible ? styles.visible : '')}>\r\n        <div className={messageStyle}>{message}</div>\r\n        <div className={styles.panel}>{this.renderProperties(context)}</div>\r\n        <div className={styles.footer}>\r\n          <div\r\n            className={styles.empty_toggle}\r\n            onClick={() => {\r\n              this.handleToggleHide();\r\n            }}\r\n          >\r\n            <div className={this.state.showEmpty ? 'fe-eye' : 'fe-eye-crossed'}></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport { FlowDefinition, StickyNote } from 'flowTypes';\r\nimport * as React from 'react';\r\nimport TextareaAutosize from 'react-autosize-textarea/lib';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\nimport { DragEvent } from 'services/Plumber';\r\nimport AppState from 'store/state';\r\nimport { DispatchWithState, UpdateSticky, updateSticky } from 'store/thunks';\r\nimport { CONFIRMATION_TIME, QUIET_NOTE, snapToGrid } from 'utils';\r\n\r\nimport styles from './Sticky.module.scss';\r\nimport i18n from 'config/i18n';\r\n\r\ntype DragFunction = (event: DragEvent) => void;\r\nexport const STICKY_SPEC_ID: string = 'sticky-container';\r\nexport const STICKY_TITLE = i18n.t('sticky.title', 'New Note');\r\nexport const STICKY_BODY = i18n.t('sticky.body', '...');\r\n\r\nexport interface StickyPassedProps {\r\n  uuid: string;\r\n  sticky: StickyNote;\r\n  selected: boolean;\r\n}\r\n\r\nexport interface StickyStoreProps {\r\n  definition: FlowDefinition;\r\n  updateSticky: UpdateSticky;\r\n}\r\n\r\nexport type StickyProps = StickyPassedProps & StickyStoreProps;\r\n\r\n/**\r\n * We have internal state to track as the user types so\r\n * we can debounce updates to the store.\r\n */\r\ninterface StickyState {\r\n  title: string;\r\n  body: string;\r\n  color: string;\r\n  showConfirmation: boolean;\r\n}\r\n\r\nconst COLOR_OPTIONS: any = {\r\n  yellow: styles.yellow,\r\n  blue: styles.blue,\r\n  green: styles.green,\r\n  purple: styles.purple,\r\n  gray: styles.gray\r\n};\r\n\r\nexport class Sticky extends React.Component<StickyProps, StickyState> {\r\n  private dragging = false;\r\n  private ele: HTMLDivElement;\r\n  private debounceTextChanges: number;\r\n  private showConfirmation: number;\r\n\r\n  public DEFUALT_TITLE = 'New Note';\r\n  public DEFUALT_BODY = '...';\r\n\r\n  constructor(props: StickyProps & StickyStoreProps) {\r\n    super(props);\r\n    bindCallbacks(this, {\r\n      include: [/^on/, /^get/, /^is/, /^handle/]\r\n    });\r\n\r\n    this.state = {\r\n      title: this.props.sticky.title,\r\n      body: this.props.sticky.body,\r\n      color: this.props.sticky.color,\r\n      showConfirmation: false\r\n    };\r\n  }\r\n\r\n  private isSelected(): boolean {\r\n    return this.props.selected;\r\n  }\r\n\r\n  private onRef(ref: HTMLDivElement): HTMLDivElement {\r\n    return (this.ele = ref);\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    if (this.showConfirmation) {\r\n      window.clearTimeout(this.showConfirmation);\r\n    }\r\n\r\n    if (this.debounceTextChanges) {\r\n      window.clearTimeout(this.debounceTextChanges);\r\n    }\r\n  }\r\n\r\n  public handleDrag(event: DragEvent): void {\r\n    // noop\r\n  }\r\n\r\n  public handleDragStop(event: DragEvent): void {\r\n    // snap us to the same grid\r\n    const { left, top } = snapToGrid(event.finalPos[0], event.finalPos[1]);\r\n    this.ele.style.left = `${left}px`;\r\n    this.ele.style.top = `${top}px`;\r\n\r\n    this.props.sticky.position = { left, top };\r\n    this.props.updateSticky(this.props.uuid, this.props.sticky);\r\n  }\r\n\r\n  private onUpdateText(): void {\r\n    if (this.debounceTextChanges) {\r\n      window.clearTimeout(this.debounceTextChanges);\r\n    }\r\n\r\n    this.debounceTextChanges = window.setTimeout(() => {\r\n      const updated = { ...this.props.sticky };\r\n      updated.title = this.state.title;\r\n      updated.body = this.state.body;\r\n      this.props.updateSticky(this.props.uuid, updated);\r\n      this.debounceTextChanges = null;\r\n    }, QUIET_NOTE);\r\n  }\r\n\r\n  private handleChangeTitle(event: React.FormEvent<HTMLTextAreaElement>): void {\r\n    this.setState({ title: event.currentTarget.value });\r\n    this.onUpdateText();\r\n  }\r\n\r\n  private handleChangeBody(event: React.FormEvent<HTMLTextAreaElement>): void {\r\n    this.setState({ body: event.currentTarget.value });\r\n    this.onUpdateText();\r\n  }\r\n\r\n  public handleClickRemove(event: React.MouseEvent<HTMLDivElement>): void {\r\n    if (this.state.showConfirmation) {\r\n      this.props.updateSticky(this.props.uuid, null);\r\n    } else {\r\n      this.setState({ showConfirmation: true });\r\n      this.showConfirmation = window.setTimeout(() => {\r\n        this.setState({ showConfirmation: false });\r\n      }, CONFIRMATION_TIME);\r\n    }\r\n  }\r\n\r\n  private handleChangeColor(color: string): void {\r\n    this.props.sticky.color = color;\r\n    this.props.updateSticky(this.props.uuid, this.props.sticky);\r\n    this.setState({ color });\r\n  }\r\n\r\n  private handleSelectForValue(element: HTMLTextAreaElement, text: string): void {\r\n    if (element.value === text) {\r\n      window.setTimeout(() => {\r\n        element.select();\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  private handleTitleFocused(e: React.FocusEvent<HTMLTextAreaElement>): void {\r\n    this.handleSelectForValue(e.currentTarget, STICKY_TITLE);\r\n  }\r\n\r\n  private handleBodyFocused(e: React.FocusEvent<HTMLTextAreaElement>): void {\r\n    this.handleSelectForValue(e.currentTarget, STICKY_BODY);\r\n  }\r\n\r\n  private getColorChooser(): JSX.Element {\r\n    return (\r\n      <div className={styles.color_chooser_container}>\r\n        <div className={styles.color_chooser}>\r\n          {Object.keys(COLOR_OPTIONS).map((color: string) => {\r\n            return (\r\n              <div\r\n                key={this.props.uuid + color}\r\n                onClick={() => {\r\n                  this.handleChangeColor(color);\r\n                }}\r\n                className={styles.color_option + ' ' + COLOR_OPTIONS[color]}\r\n              />\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    // add our removal class if necessary\r\n    const titleClasses = [styles.title_wrapper];\r\n    if (this.state.showConfirmation) {\r\n      titleClasses.push(styles.removal);\r\n    }\r\n\r\n    const containerClasses = [styles.sticky_container];\r\n    if (!this.props.sticky.color) {\r\n      this.props.sticky.color = 'yellow';\r\n    }\r\n\r\n    const stickyClasses = [styles.sticky];\r\n    if (this.isSelected()) {\r\n      stickyClasses.push(styles.selected);\r\n    }\r\n\r\n    containerClasses.push(COLOR_OPTIONS[this.props.sticky.color]);\r\n    const colorChooser = this.getColorChooser();\r\n\r\n    return (\r\n      <div\r\n        key={this.props.uuid}\r\n        className={containerClasses.join(' ')}\r\n        data-spec={STICKY_SPEC_ID}\r\n        ref={this.onRef}\r\n        id={this.props.uuid}\r\n      >\r\n        <div className={stickyClasses.join(' ')}>\r\n          <div className={titleClasses.join(' ')}>\r\n            <div className={styles.remove_button} onClick={this.handleClickRemove}>\r\n              <span className=\"fe-x\" />\r\n            </div>\r\n            <div className={styles.confirmation}>Remove?</div>\r\n            <TextareaAutosize\r\n              className={styles.title}\r\n              value={this.state.title}\r\n              onChange={this.handleChangeTitle}\r\n              onFocusCapture={this.handleTitleFocused}\r\n            />\r\n          </div>\r\n          <div className={styles.body_wrapper}>\r\n            <TextareaAutosize\r\n              className={styles.body}\r\n              value={this.state.body}\r\n              onChange={this.handleChangeBody}\r\n              onFocusCapture={this.handleBodyFocused}\r\n            />\r\n            {colorChooser}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n/* istanbul ignore next */\r\nconst mapStateToProps = ({ flowContext: { definition } }: AppState) => ({\r\n  definition\r\n});\r\n\r\n/* istanbul ignore next */\r\nconst mapDispatchToProps = (dispatch: DispatchWithState) => {\r\n  return bindActionCreators({ updateSticky }, dispatch);\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps,\r\n  null,\r\n  { forwardRef: false }\r\n)(Sticky);\r\n","import { Exit, FlowNode } from 'flowTypes';\nimport { GRID_SIZE, timeStart, timeEnd, debounce } from 'utils';\n\n// TODO: Remove use of Function\n// tslint:disable:ban-types\nconst {\n  jsPlumb: { importDefaults }\n} = require('../../node_modules/jsplumb/dist/js/jsplumb');\nexport interface DragEvent {\n  el: Element;\n  pos: number[];\n  finalPos: number[];\n  e: MouseEvent;\n  clientX: number;\n  clientY: number;\n  target: Element;\n}\n\nexport interface PendingConnections {\n  [id: string]: {\n    source: string;\n    target: string;\n    className: string;\n    slot: number;\n    totalSlots: number;\n  };\n}\n\nexport const REPAINT_DURATION = 600;\n\nexport const TARGET_DEFAULTS = {\n  anchor: ['Continuous', { shape: 'Rectangle', faces: ['top', 'left', 'right'] }],\n  endpoint: [\n    'Rectangle',\n    {\n      width: 23,\n      height: 23,\n      cssClass: 'plumb-endpoint',\n      hoverClass: 'plumb-endpoint-hover'\n    }\n  ],\n  dropOptions: {\n    tolerance: 'touch',\n    hoverClass: 'plumb-drop-hover',\n    isTarget: false\n  },\n  dragAllowedWhenFull: false,\n  deleteEndpointsOnEmpty: true,\n  isTarget: false\n};\n\nexport const SOURCE_DEFAULTS = {\n  anchor: 'BottomCenter',\n  maxConnections: 1,\n  dragAllowedWhenFull: false,\n  deleteEndpointsOnEmpty: true,\n  isSource: true\n};\n\nexport const getAnchor = (sourceEle: any, targetEle: any): any[] => {\n  return [\n    'Continuous',\n    {\n      shape: 'Dot',\n      faces:\n        sourceEle.getBoundingClientRect().bottom + GRID_SIZE / 3 <\n        targetEle.getBoundingClientRect().top\n          ? ['top']\n          : ['right', 'left']\n    }\n  ];\n};\n\nconst defaultConnector = [\n  'Flowchart',\n  {\n    stub: 12,\n    midpoint: 0.75,\n    alwaysRespectStubs: false,\n    gap: [0, 5],\n    cornerRadius: 3\n  }\n];\n\n/* istanbul ignore next */\nexport default class Plumber {\n  public jsPlumb: any;\n\n  // we batch up connections to apply them together\n  private pendingConnections: PendingConnections = {};\n  private pendingConnectionTimeout: any;\n\n  private animateInterval: any = null;\n\n  private onLoadFunction: () => void = null;\n\n  constructor() {\n    this.jsPlumb = importDefaults({\n      DragOptions: { cursor: 'pointer', zIndex: 1000 },\n      DropOptions: { tolerance: 'touch', hoverClass: 'plumb-hover' },\n      Endpoint: 'Rectangle',\n      EndpointStyle: { strokeStyle: 'transparent' },\n      PaintStyle: { strokeWidth: 3.5 },\n      ConnectionsDetachable: true,\n      Connector: defaultConnector,\n      ConnectionOverlays: [\n        [\n          'PlainArrow',\n          {\n            location: 0.999,\n            width: 12,\n            length: 12,\n            cssClass: 'jtk-arrow'\n          }\n        ]\n      ]\n    });\n\n    this.debug = this.debug.bind(this);\n    this.setSourceEnabled = this.setSourceEnabled.bind(this);\n    this.makeSource = this.makeSource.bind(this);\n    this.makeTarget = this.makeTarget.bind(this);\n    this.connectExit = this.connectExit.bind(this);\n    this.setDragSelection = this.setDragSelection.bind(this);\n    this.clearDragSelection = this.clearDragSelection.bind(this);\n    this.removeFromDragSelection = this.removeFromDragSelection.bind(this);\n    this.cancelDurationRepaint = this.cancelDurationRepaint.bind(this);\n    this.remove = this.remove.bind(this);\n    this.handlePendingConnections = this.handlePendingConnections.bind(this);\n    this.checkForPendingConnections = this.checkForPendingConnections.bind(this);\n    this.connect = this.connect.bind(this);\n    this.bind = this.bind.bind(this);\n    this.repaint = this.repaint.bind(this);\n    this.recalculate = this.recalculate.bind(this);\n    this.reset = this.reset.bind(this);\n    this.updateClass = this.updateClass.bind(this);\n    this.rerouteAnchors = this.rerouteAnchors.bind(this);\n  }\n\n  public setContainer(containerId: string) {\n    this.jsPlumb.setContainer(containerId);\n  }\n\n  public debug(): any {\n    return this.jsPlumb;\n  }\n\n  public setSourceEnabled(uuid: string, enabled: boolean): void {\n    this.jsPlumb.setSourceEnabled(uuid, enabled);\n  }\n\n  public makeSource(uuid: string): any {\n    return this.jsPlumb.makeSource(uuid, SOURCE_DEFAULTS);\n  }\n\n  public makeTarget(uuid: string): void {\n    this.jsPlumb.makeTarget(uuid, TARGET_DEFAULTS);\n  }\n\n  public connectExit(node: FlowNode, exit: Exit, className: string = null): void {\n    this.connect(\n      `${node.uuid}:${exit.uuid}`,\n      exit.destination_uuid,\n      className,\n      node.exits.findIndex((e: Exit) => e.uuid === exit.uuid),\n      node.exits.length\n    );\n  }\n\n  public updateClass(node: FlowNode, exit: Exit, className: string, add: boolean): void {\n    const source = `${node.uuid}:${exit.uuid}`;\n    const connection = this.jsPlumb.select({ source });\n    if (add) {\n      connection.addClass(className);\n    } else {\n      connection.removeClass(className);\n    }\n  }\n\n  public removeFromDragSelection(uuid: string): void {\n    this.jsPlumb.removeFromDragSelection(uuid);\n  }\n\n  public setDragSelection(selected: { [uuid: string]: boolean }): void {\n    this.cancelDurationRepaint();\n    this.jsPlumb.clearDragSelection();\n\n    Object.keys(selected).forEach(uuid => this.jsPlumb.addToDragSelection(uuid));\n  }\n\n  public clearDragSelection(): void {\n    this.jsPlumb.clearDragSelection();\n  }\n\n  public cancelDurationRepaint(): void {\n    if (this.animateInterval) {\n      window.clearInterval(this.animateInterval);\n      this.animateInterval = null;\n    }\n  }\n\n  private handlePendingConnections(): void {\n    const targets: { [id: string]: boolean } = {};\n\n    const batch = Object.keys(this.pendingConnections).length;\n    if (batch > 1) {\n      timeStart('Batched ' + batch + ' connections');\n    }\n\n    this.jsPlumb.batch(() => {\n      for (const key in this.pendingConnections) {\n        if (this.pendingConnections.hasOwnProperty(key)) {\n          const connection = this.pendingConnections[key];\n          const { source, target, className, slot, totalSlots } = connection;\n\n          const anchors = target\n            ? [\n                'Bottom',\n                getAnchor(document.getElementById(source), document.getElementById(target))\n              ]\n            : [];\n\n          if (source != null) {\n            // any existing connections for our source need to be deleted\n            this.jsPlumb.select({ source }).delete({ fireEvent: false });\n\n            const start = totalSlots < 5 ? 0.75 : 0.35;\n            let midpoint = start + slot * 0.15;\n            const exitMiddle = totalSlots / 2;\n            if (slot > exitMiddle) {\n              midpoint = start - 0.05 + (totalSlots - slot) * 0.15;\n            }\n\n            // add reasonable boundaries for midpoints\n            midpoint = Math.max(Math.min(0.9, midpoint), 0.1);\n\n            const connector: any = [...defaultConnector];\n            connector[1].midpoint = midpoint;\n\n            // now make our new connection\n            if (target != null) {\n              this.jsPlumb.connect({\n                source,\n                target,\n                anchors,\n                fireEvent: false,\n                cssClass: className,\n                detachable: !className,\n                connector\n              });\n            }\n          }\n\n          if (target != null) {\n            targets[target] = true;\n          }\n\n          delete this.pendingConnections[key];\n        }\n      }\n    }, false);\n\n    if (batch > 1) {\n      timeEnd('Batched ' + batch + ' connections');\n    }\n\n    // fire our callback for who is embedding us\n    if (this.onLoadFunction) {\n      this.onLoadFunction();\n      this.onLoadFunction = null;\n    }\n  }\n\n  public triggerLoaded(onLoad: () => void): void {\n    if (onLoad) {\n      if (Object.keys(this.pendingConnections).length === 0) {\n        onLoad();\n      }\n      this.onLoadFunction = onLoad;\n    }\n  }\n\n  private checkForPendingConnections(): void {\n    if (this.pendingConnectionTimeout) {\n      window.clearTimeout(this.pendingConnectionTimeout);\n    }\n\n    this.pendingConnectionTimeout = window.setTimeout(() => {\n      this.handlePendingConnections();\n    }, 0);\n  }\n\n  public connect(\n    source: string,\n    target: string,\n    className: string = null,\n    slot: number = 0,\n    totalSlots: number = 0\n  ): void {\n    this.pendingConnections[`${source}:${target}:${className}`] = {\n      source,\n      target,\n      className,\n      slot,\n      totalSlots\n    };\n    this.checkForPendingConnections();\n  }\n\n  public bind(event: string, onEvent: Function): void {\n    return this.jsPlumb.bind(event, onEvent);\n  }\n\n  public repaint(uuid?: string): void {\n    if (!uuid) {\n      this.jsPlumb.recalculateOffsets();\n      this.jsPlumb.repaintEverything();\n    } else {\n      this.jsPlumb.recalculateOffsets(uuid);\n      this.jsPlumb.repaint(uuid);\n    }\n  }\n\n  public remove(uuid: string): void {\n    if (this.jsPlumb.isSource(uuid)) {\n      this.jsPlumb.unmakeSource(uuid);\n      this.jsPlumb.remove(uuid);\n    } else if (this.jsPlumb.isTarget(uuid)) {\n      this.jsPlumb.deleteConnectionsForElement(uuid);\n    }\n  }\n\n  /**\n   *\n   * Reroutes the connections for actively moving nodes. We try to direct\n   * connections as much as possible.\n   * @param elements the targets and sources that ar moving around\n   */\n  public rerouteAnchors(elements: Element[]): void {\n    elements.forEach((ele: Element) => {\n      const uuid = ele.id;\n      const connections = this.jsPlumb\n        .getConnections({ target: uuid })\n        .concat(this.jsPlumb.getConnections({ source: uuid }));\n      for (const c of connections) {\n        c.endpoints[1].setAnchor(getAnchor(c.endpoints[0].element, c.endpoints[1].element));\n      }\n    });\n  }\n\n  public revalidate(elements: Element[]): void {\n    this.jsPlumb.revalidate(elements);\n\n    // reroute our anchors but only after we stop moving for a bit\n    debounce(this.rerouteAnchors, 200, () => {\n      this.rerouteAnchors(elements);\n    });\n  }\n\n  public recalculate(uuid: string): void {\n    window.setTimeout(() => {\n      this.jsPlumb.revalidate(uuid);\n    }, 100);\n  }\n\n  public reset(): void {\n    this.jsPlumb.reset();\n  }\n\n  public getPlumb(): any {\n    return this.jsPlumb;\n  }\n}\n","import { FlowStoreProps } from 'components/flow/Flow';\r\nimport { DebugState } from 'store/editor';\r\n\r\nconst mutate = require('immutability-helper');\r\n\r\n/* istanbul ignore next */\r\nexport default class Debug {\r\n  private props: FlowStoreProps;\r\n  private state: DebugState;\r\n\r\n  constructor(props: FlowStoreProps, initial: DebugState) {\r\n    this.props = props;\r\n    this.state = initial || { showUUIDs: false };\r\n  }\r\n\r\n  public showUUIDs(): DebugState {\r\n    const updated = mutate(this.state, { $merge: { showUUIDs: true } });\r\n    this.props.mergeEditorState({ debug: updated });\r\n    return updated;\r\n  }\r\n}\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport Button from 'components/button/Button';\nimport { Canvas } from 'components/canvas/Canvas';\nimport { CanvasDraggableProps } from 'components/canvas/CanvasDraggable';\nimport Node from 'components/flow/node/Node';\nimport { getDraggedFrom } from 'components/helpers';\nimport NodeEditor from 'components/nodeeditor/NodeEditor';\nimport Simulator from 'components/simulator/Simulator';\nimport Sticky, { STICKY_BODY, STICKY_TITLE } from 'components/sticky/Sticky';\nimport { ConfigProviderContext, fakePropType } from 'config/ConfigProvider';\nimport { FlowDefinition, FlowMetadata, FlowPosition } from 'flowTypes';\nimport * as React from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport Plumber from 'services/Plumber';\nimport { DragSelection, DebugState } from 'store/editor';\nimport { RenderNode } from 'store/flowContext';\nimport { createEmptyNode, detectLoops, getOrderedNodes } from 'store/helpers';\nimport { NodeEditorSettings } from 'store/nodeEditor';\nimport AppState from 'store/state';\nimport {\n  ConnectionEvent,\n  DispatchWithState,\n  mergeEditorState,\n  MergeEditorState,\n  NoParamsAC,\n  onConnectionDrag,\n  OnConnectionDrag,\n  OnOpenNodeEditor,\n  onOpenNodeEditor,\n  onRemoveNodes,\n  OnRemoveNodes,\n  OnUpdateCanvasPositions,\n  onUpdateCanvasPositions,\n  resetNodeEditingState,\n  UpdateConnection,\n  updateConnection,\n  updateSticky,\n  UpdateSticky\n} from 'store/thunks';\nimport {\n  createUUID,\n  isRealValue,\n  NODE_PADDING,\n  renderIf,\n  snapToGrid,\n  timeEnd,\n  timeStart\n} from 'utils';\nimport Debug from 'utils/debug';\n\nimport styles from './Flow.module.scss';\nimport { Trans } from 'react-i18next';\nimport { PopTabType } from 'config/interfaces';\nimport i18n from 'config/i18n';\n\ndeclare global {\n  interface Window {\n    fe: any;\n  }\n}\n\nexport interface FlowStoreProps {\n  ghostNode: RenderNode;\n  debug: DebugState;\n  translating: boolean;\n  popped: string;\n  dragActive: boolean;\n\n  mergeEditorState: MergeEditorState;\n\n  definition: FlowDefinition;\n  nodes: { [uuid: string]: RenderNode };\n  metadata: FlowMetadata;\n  nodeEditorSettings: NodeEditorSettings;\n\n  updateConnection: UpdateConnection;\n  onOpenNodeEditor: OnOpenNodeEditor;\n  onUpdateCanvasPositions: OnUpdateCanvasPositions;\n  onRemoveNodes: OnRemoveNodes;\n  resetNodeEditingState: NoParamsAC;\n  onConnectionDrag: OnConnectionDrag;\n  updateSticky: UpdateSticky;\n}\n\nexport interface Translations {\n  [uuid: string]: any;\n}\n\nexport const DRAG_THRESHOLD = 3;\nexport const REPAINT_TIMEOUT = 500;\nexport const GHOST_POSITION_INITIAL = { left: -1000, top: -1000 };\n\nexport const nodeSpecId = 'node';\nexport const nodesContainerSpecId = 'node-container';\nexport const ghostNodeSpecId = 'ghost-node';\nexport const dragSelectSpecId = 'drag-select';\n\nexport const isDraggingBack = (event: ConnectionEvent) => {\n  return event.suspendedElementId === event.targetId && event.source !== null;\n};\n\nexport const getDragStyle = (drag: DragSelection) => {\n  const left = Math.min(drag.startX, drag.currentX);\n  const top = Math.min(drag.startY, drag.currentY);\n  const width = Math.max(drag.startX, drag.currentX) - left;\n  const height = Math.max(drag.startY, drag.currentY) - top;\n  return {\n    left,\n    top,\n    width,\n    height\n  };\n};\n\nexport class Flow extends React.PureComponent<FlowStoreProps, {}> {\n  private Plumber: Plumber;\n  private nodeContainerUUID: string;\n\n  // Refs\n  private ghost: any;\n\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  constructor(props: FlowStoreProps, context: ConfigProviderContext) {\n    super(props, context);\n\n    this.nodeContainerUUID = createUUID();\n\n    this.Plumber = new Plumber();\n\n    /* istanbul ignore next */\n    if (context.config.debug) {\n      window.fe = new Debug(props, this.props.debug);\n    }\n\n    bindCallbacks(this, {\n      include: [/Ref$/, /^on/, /^is/, /^get/, /^handle/]\n    });\n\n    timeStart('Loaded Flow');\n  }\n\n  private ghostRef(ref: any): any {\n    return (this.ghost = ref);\n  }\n\n  public componentDidMount(): void {\n    this.Plumber.bind('connection', (event: ConnectionEvent) =>\n      this.props.updateConnection(event.sourceId, event.targetId)\n    );\n    this.Plumber.bind('beforeDrag', (event: ConnectionEvent) => {\n      this.beforeConnectionDrag(event);\n    });\n\n    this.Plumber.bind('connectionDrag', (event: ConnectionEvent) => {\n      this.props.onConnectionDrag(event, this.context.config.flowType);\n    });\n\n    this.Plumber.bind('connectionDragStop', (event: ConnectionEvent) =>\n      this.onConnectorDrop(event)\n    );\n    this.Plumber.bind(\n      'beforeStartDetach',\n      (event: ConnectionEvent) => !this.props.translating && this.context.config.mutable\n    );\n    this.Plumber.bind('beforeDetach', (event: ConnectionEvent) => true);\n    this.Plumber.bind('beforeDrop', (event: ConnectionEvent) => this.onBeforeConnectorDrop(event));\n    this.Plumber.triggerLoaded(this.context.config.onLoad);\n\n    timeEnd('Loaded Flow');\n  }\n\n  public componentWillUnmount(): void {\n    this.Plumber.reset();\n  }\n\n  /**\n   * Called right before a connector is dropped onto a new node\n   */\n  private onBeforeConnectorDrop(event: ConnectionEvent): boolean {\n    this.props.resetNodeEditingState();\n    const fromNodeUUID = event.sourceId.split(':')[0];\n    try {\n      detectLoops(this.props.nodes, fromNodeUUID, event.targetId);\n    } catch {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Called the moment a connector is done dragging, whether it is dropped on an\n   * existing node or on to empty space.\n   */\n  private onConnectorDrop(event: ConnectionEvent): boolean {\n    const ghostNode = this.props.ghostNode;\n    // Don't show the node editor if we a dragging back to where we were\n    if (isRealValue(ghostNode) && !isDraggingBack(event)) {\n      // Wire up the drag from to our ghost node\n      this.Plumber.recalculate(ghostNode.node.uuid);\n\n      const dragPoint = getDraggedFrom(ghostNode);\n\n      this.Plumber.connect(dragPoint.nodeUUID + ':' + dragPoint.exitUUID, ghostNode.node.uuid);\n\n      // Save our position for later\n      const { left, top } = (this.ghost &&\n        snapToGrid(this.ghost.ele.offsetLeft, this.ghost.ele.offsetTop)) || { left: 0, top: 0 };\n\n      this.props.ghostNode.ui.position = { left, top };\n\n      let originalAction = null;\n      if (ghostNode.node.actions && ghostNode.node.actions.length === 1) {\n        originalAction = ghostNode.node.actions[0];\n      }\n\n      // Bring up the node editor\n      this.props.onOpenNodeEditor({\n        originalNode: ghostNode,\n        originalAction\n      });\n    }\n\n    if (isDraggingBack(event)) {\n      this.props.mergeEditorState({ ghostNode: null });\n    }\n\n    /* istanbul ignore next */\n    document.removeEventListener('mousemove', (window as any).ghostListener);\n\n    return true;\n  }\n\n  private beforeConnectionDrag(event: ConnectionEvent): boolean {\n    if (event.source) {\n      event.source.dispatchEvent(new Event('disconnect'));\n    }\n    return !this.props.translating;\n  }\n\n  private handleStickyCreation(props: CanvasDraggableProps) {\n    const stickyMap = this.props.definition._ui.stickies || {};\n    const uuid = props.uuid;\n    return <Sticky key={uuid} uuid={uuid} sticky={stickyMap[uuid]} selected={props.selected} />;\n  }\n\n  private handleNodeCreation(props: CanvasDraggableProps) {\n    const onlyNode = Object.keys(this.props.nodes).length === 1;\n    return (\n      <Node\n        onlyNode={onlyNode}\n        startingNode={props.idx === 0}\n        selected={props.selected}\n        key={props.uuid}\n        data-spec={nodeSpecId}\n        nodeUUID={props.uuid}\n        plumberMakeTarget={this.Plumber.makeTarget}\n        plumberRemove={this.Plumber.remove}\n        plumberRecalculate={this.Plumber.recalculate}\n        plumberMakeSource={this.Plumber.makeSource}\n        plumberConnectExit={this.Plumber.connectExit}\n        plumberUpdateClass={this.Plumber.updateClass}\n      />\n    );\n  }\n\n  private getNodes(): CanvasDraggableProps[] {\n    return getOrderedNodes(this.props.nodes).map((renderNode: RenderNode, idx: number) => {\n      return {\n        uuid: renderNode.node.uuid,\n        position: renderNode.ui.position,\n        elementCreator: this.handleNodeCreation,\n        config: renderNode,\n        idx\n      };\n    });\n  }\n\n  private getStickies(): CanvasDraggableProps[] {\n    const stickyMap = this.props.definition._ui.stickies || {};\n    return Object.keys(stickyMap).map((uuid: string, idx: number) => {\n      return {\n        uuid,\n        elementCreator: this.handleStickyCreation,\n        position: stickyMap[uuid].position,\n        idx\n      };\n    });\n  }\n\n  private getDragNode(): JSX.Element {\n    return isRealValue(this.props.ghostNode) ? (\n      <div\n        data-spec={ghostNodeSpecId}\n        key={this.props.ghostNode.node.uuid}\n        style={{ position: 'absolute', display: 'block', visibility: 'hidden' }}\n      >\n        <Node\n          onlyNode={false}\n          selected={false}\n          startingNode={false}\n          ref={this.ghostRef}\n          ghost={true}\n          nodeUUID={this.props.ghostNode.node.uuid}\n          plumberMakeTarget={this.Plumber.makeTarget}\n          plumberRemove={this.Plumber.remove}\n          plumberRecalculate={this.Plumber.recalculate}\n          plumberMakeSource={this.Plumber.makeSource}\n          plumberConnectExit={this.Plumber.connectExit}\n          plumberUpdateClass={this.Plumber.updateClass}\n        />\n      </div>\n    ) : null;\n  }\n\n  private getSimulator(): JSX.Element {\n    return renderIf(this.context.config.endpoints && this.context.config.endpoints.simulateStart)(\n      <Simulator\n        key=\"simulator\"\n        popped={this.props.popped}\n        mergeEditorState={this.props.mergeEditorState}\n        onToggled={(visible: boolean, tab: PopTabType) => {\n          this.props.mergeEditorState({\n            popped: visible ? tab : null\n          });\n        }}\n      />\n    );\n  }\n\n  private getNodeEditor(): JSX.Element {\n    return renderIf(this.props.nodeEditorSettings !== null)(\n      <NodeEditor\n        key=\"node-editor\"\n        helpArticles={this.context.config.help}\n        plumberConnectExit={this.Plumber.connectExit}\n      />\n    );\n  }\n\n  // TODO: this should be a callback from the canvas\n  private handleDoubleClick(position: FlowPosition): void {\n    const { left, top } = position;\n    this.props.updateSticky(createUUID(), {\n      position: snapToGrid(left - 90 + NODE_PADDING, top - 40),\n      title: STICKY_TITLE,\n      body: STICKY_BODY\n    });\n  }\n\n  private getEmptyFlow(): JSX.Element {\n    return (\n      <div key=\"create_node\" className={styles.empty_flow}>\n        <Trans i18nKey=\"empty_flow_message\">\n          <h1>Let's get started</h1>\n          <div>\n            We recommend starting your flow by sending a message. This message will be sent to\n            anybody right after they join the flow. This is your chance to send a single message or\n            ask them a question.\n          </div>\n        </Trans>\n\n        <Button\n          name={i18n.t('buttons.create_message', 'Create Message')}\n          onClick={() => {\n            const emptyNode = createEmptyNode(null, null, 1, this.context.config.flowType);\n            this.props.onOpenNodeEditor({\n              originalNode: emptyNode,\n              originalAction: emptyNode.node.actions[0]\n            });\n          }}\n        />\n      </div>\n    );\n  }\n\n  /* \n  public componentDidUpdate(prevProps: FlowStoreProps): void {\n    traceUpdate(this, prevProps);\n  }\n  */\n\n  public handleDragging(uuids: string[]): void {\n    uuids.forEach((uuid: string) => {\n      try {\n        const ele = document.getElementById(uuid);\n        const exits = ele.querySelectorAll('.jtk-connected');\n        this.Plumber.revalidate([ele, ...exits]);\n      } catch (error) {}\n    });\n  }\n\n  public handleCanvasLoaded(): void {\n    this.Plumber.setContainer('canvas');\n  }\n\n  public render(): JSX.Element {\n    const nodes = this.getNodes();\n\n    const draggables = this.getStickies().concat(nodes);\n    return (\n      <div>\n        {nodes.length === 0 ? this.getEmptyFlow() : <>{this.getSimulator()}</>}\n        {this.getNodeEditor()}\n\n        <Canvas\n          mutable={this.context.config.mutable}\n          draggingNew={!!this.props.ghostNode && !this.props.nodeEditorSettings}\n          newDragElement={this.getDragNode()}\n          onDragging={this.handleDragging}\n          uuid={this.nodeContainerUUID}\n          dragActive={this.props.dragActive}\n          mergeEditorState={this.props.mergeEditorState}\n          onRemoveNodes={this.props.onRemoveNodes}\n          draggables={draggables}\n          onDoubleClick={this.handleDoubleClick}\n          onUpdatePositions={this.props.onUpdateCanvasPositions}\n          onLoaded={this.handleCanvasLoaded}\n        ></Canvas>\n        <div id=\"activity_recent_messages\"></div>\n      </div>\n    );\n  }\n}\n\n/* istanbul ignore next */\nconst mapStateToProps = ({\n  flowContext: { definition, metadata, nodes },\n  editorState: { ghostNode, debug, translating, popped, dragActive },\n  // tslint:disable-next-line: no-shadowed-variable\n  nodeEditor: { settings }\n}: AppState) => {\n  return {\n    nodeEditorSettings: settings,\n    definition,\n    nodes,\n    metadata,\n    ghostNode,\n    debug,\n    translating,\n    popped,\n    dragActive\n  };\n};\n\n/* istanbul ignore next */\nconst mapDispatchToProps = (dispatch: DispatchWithState) =>\n  bindActionCreators(\n    {\n      mergeEditorState,\n      resetNodeEditingState,\n      onConnectionDrag,\n      onOpenNodeEditor,\n      onUpdateCanvasPositions,\n      onRemoveNodes,\n      updateConnection,\n      updateSticky\n    },\n    dispatch\n  );\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(Flow);\n","import { desnake } from 'utils';\r\nimport i18next from 'i18next';\r\nimport { Translation, TranslationType, TranslationBundle } from './TranslatorTab';\r\n\r\nexport enum TranslationState {\r\n  COMPLETE = 'complete',\r\n  MISSING = 'missing'\r\n}\r\n\r\nexport const getMergedByType = (\r\n  bundle: TranslationBundle,\r\n  state: TranslationState,\r\n  type: TranslationType\r\n) => {\r\n  return bundle.translations\r\n    .filter(translation => {\r\n      switch (state) {\r\n        case TranslationState.COMPLETE:\r\n          return !!translation.to && translation.type === type;\r\n        case TranslationState.MISSING:\r\n          return !translation.to && translation.type === type;\r\n      }\r\n      return true;\r\n    })\r\n    .map(translation => (translation as any)[state === TranslationState.MISSING ? 'from' : 'to'])\r\n    .join(', ');\r\n};\r\n\r\nexport const findTranslations = (\r\n  type: TranslationType,\r\n  localizeableKeys: string[],\r\n  localizable: any,\r\n  localization: { [uuid: string]: any }\r\n): Translation[] => {\r\n  const translations: Translation[] = [];\r\n\r\n  localizeableKeys.forEach((attribute: string) => {\r\n    let keys = attribute.split('.');\r\n    let from = localizable as any;\r\n    let to: any = [];\r\n\r\n    while (keys.length > 0 && from) {\r\n      if (keys.length > 0 && from['uuid']) {\r\n        to = (localization || {})[from['uuid']];\r\n      }\r\n\r\n      const path = keys.shift();\r\n      if (to) {\r\n        to = to[path];\r\n      }\r\n      from = from[path];\r\n    }\r\n\r\n    if (from) {\r\n      if (to) {\r\n        to = to.join(', ');\r\n      }\r\n\r\n      if (Array.isArray(from)) {\r\n        from = from\r\n          .map((obj: any) => {\r\n            if (obj['name']) {\r\n              return obj['name'];\r\n            }\r\n            if (obj['arguments']) {\r\n              return obj['arguments'].join(' ');\r\n            }\r\n            return obj;\r\n          })\r\n          .join(', ');\r\n      }\r\n\r\n      if (from) {\r\n        translations.push({\r\n          type,\r\n          attribute,\r\n          from,\r\n          to\r\n        });\r\n      }\r\n    }\r\n  });\r\n\r\n  return translations;\r\n};\r\n\r\nexport const getFriendlyAttribute = (attribute: string) => {\r\n  if (attribute === 'categories') {\r\n    return i18next.t('translation.attributes.categories', 'Categories');\r\n  }\r\n\r\n  if (attribute === 'cases') {\r\n    return i18next.t('translation.attributes.cases', 'Rules');\r\n  }\r\n\r\n  if (attribute === 'text') {\r\n    return i18next.t('translation.attributes.text', 'Message');\r\n  }\r\n\r\n  if (attribute === 'quick_replies') {\r\n    return i18next.t('translation.attributes.quick_relpies', 'Quick Replies');\r\n  }\r\n\r\n  if (attribute === 'templating.variables') {\r\n    return i18next.t('translation.attributes.templates', 'Template Variables');\r\n  }\r\n\r\n  if (attribute === 'subject') {\r\n    return i18next.t('translation.attributes.subject', 'Subject');\r\n  }\r\n\r\n  if (attribute === 'body') {\r\n    return i18next.t('translation.attributes.body', 'Body');\r\n  }\r\n\r\n  return desnake(attribute);\r\n};\r\n\r\nexport const getBundleKey = (bundle: TranslationBundle) => {\r\n  return bundle.node_uuid + bundle.action_uuid;\r\n};\r\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport { ConfigProviderContext } from 'config/ConfigProvider';\r\nimport * as React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from 'redux';\r\nimport { Asset, Assets } from 'store/flowContext';\r\nimport AppState from 'store/state';\r\nimport { DispatchWithState, HandleLanguageChange, handleLanguageChange } from 'store/thunks';\r\n\r\nimport styles from './LanguageSelector.module.scss';\r\n\r\nexport interface LanguageSelectorProps {\r\n  language: Asset;\r\n  languages: Assets;\r\n  handleLanguageChange: HandleLanguageChange;\r\n}\r\n\r\nexport const containerClasses = 'language-selector';\r\n\r\nexport class LanguageSelector extends React.Component<LanguageSelectorProps> {\r\n  constructor(props: LanguageSelectorProps, context: ConfigProviderContext) {\r\n    super(props, context);\r\n    bindCallbacks(this, {\r\n      include: [/^handle/]\r\n    });\r\n  }\r\n\r\n  public handleLanguageChanged(language: Asset): void {\r\n    this.props.handleLanguageChange(language);\r\n  }\r\n\r\n  public handleLanguageSort(a: Asset, b: Asset): number {\r\n    if (a.id === 'base') {\r\n      return -1;\r\n    }\r\n\r\n    if (b.id === 'base') {\r\n      return 1;\r\n    }\r\n\r\n    if (a.order !== undefined && b.order !== undefined) {\r\n      return a.order - b.order;\r\n    }\r\n\r\n    return a.name.localeCompare(b.name);\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    if (!this.props.language) {\r\n      return null;\r\n    }\r\n\r\n    const languages = Object.keys(this.props.languages.items)\r\n      .map((iso: string) => this.props.languages.items[iso])\r\n      .sort(this.handleLanguageSort);\r\n\r\n    if (languages.length === 1) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div className={containerClasses}>\r\n        {languages.map((lang: Asset, idx: number) => {\r\n          return (\r\n            <div key={'lang_' + lang.id} className={styles.language}>\r\n              {idx > 0 ? <div className={styles.separator}>|</div> : null}\r\n              <div\r\n                className={\r\n                  styles.language_link +\r\n                  ' ' +\r\n                  (this.props.language.id === lang.id ? styles.active : '')\r\n                }\r\n                onClick={() => {\r\n                  this.handleLanguageChanged(lang);\r\n                }}\r\n              >\r\n                {lang.name}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\n/* istanbul ignore next */\r\nconst mapStateToProps = ({ flowContext: { assetStore }, editorState: { language } }: AppState) => ({\r\n  languages: assetStore.languages,\r\n  language\r\n});\r\n\r\n/* istanbul ignore next */\r\nconst mapDispatchToProps = (dispatch: DispatchWithState) =>\r\n  bindActionCreators(\r\n    {\r\n      handleLanguageChange\r\n    },\r\n    dispatch\r\n  );\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(LanguageSelector);\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport * as React from 'react';\n\nimport styles from './PopTab.module.scss';\n\nexport interface PopTabProps {\n  color: string;\n  icon: string;\n  label: string;\n  header: string;\n  top: string;\n  visible: boolean;\n  onShow: () => void;\n  onHide: () => void;\n}\n\nexport interface PopTabState {\n  width: number;\n}\n\nexport class PopTab extends React.Component<PopTabProps, PopTabState> {\n  private poppedEle: HTMLDivElement;\n\n  constructor(props: PopTabProps) {\n    super(props);\n    this.state = { width: 258 };\n\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  public componentDidUpdate(): void {\n    if (this.state.width !== this.poppedEle.offsetWidth) {\n      this.setState({ width: this.poppedEle.offsetWidth });\n    }\n  }\n\n  private handlePoppedRef(ref: HTMLDivElement): HTMLDivElement {\n    return (this.poppedEle = ref);\n  }\n\n  private handleTabClick(): void {\n    this.props.onShow();\n  }\n\n  private handleClose(): void {\n    this.props.onHide();\n  }\n  public render(): JSX.Element {\n    return (\n      <div\n        className={\n          'pop_wrapper ' + styles.pop_wrapper + ' ' + (this.props.visible ? styles.visible : '')\n        }\n        style={{\n          right: -this.state.width,\n          top: this.props.top\n        }}\n      >\n        <div className={styles.tab_wrapper}>\n          <div\n            className={styles.tab}\n            style={{ background: this.props.color }}\n            onClick={this.handleTabClick}\n          >\n            <div className={styles.icon}>\n              <span className={this.props.icon} />\n            </div>\n            <div className={styles.label}>{this.props.label}</div>\n          </div>\n        </div>\n        <div\n          ref={this.handlePoppedRef}\n          className={styles.popped}\n          style={{\n            borderColor: this.props.color,\n            right: this.props.visible ? 15 + this.state.width : 0,\n            top: -100\n          }}\n        >\n          <div className={styles.header} style={{ background: this.props.color }}>\n            <div className={styles.close + ' fe-x'} onClick={this.handleClose} />\n            <div className={styles.header_label}>{this.props.header}</div>\n          </div>\n          <div className={styles.body} style={{ background: this.props.color }}>\n            {this.props.children}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import { react as bindCallbacks } from 'auto-bind';\nimport classNames from 'classnames/bind';\nimport { PopTab } from 'components/poptab/PopTab';\nimport dateFormat from 'dateformat';\nimport { getAssets, getFlowDetails } from 'external';\nimport { FlowDefinition, SPEC_VERSION, FlowDetails, FlowMetadata } from 'flowTypes';\nimport React from 'react';\nimport { Asset, AssetStore } from 'store/flowContext';\nimport { renderIf } from 'utils';\n\nimport styles from './RevisionExplorer.module.scss';\nimport i18n from 'config/i18n';\nimport { PopTabType } from 'config/interfaces';\n\nconst cx: any = classNames.bind(styles);\n\nexport interface User {\n  email: string;\n  name: string;\n}\n\nexport interface SaveResult {\n  revision: Revision;\n  metadata: FlowMetadata;\n}\n\nexport interface Revision {\n  id: number;\n  version: string;\n  revision: number;\n  created_on: string;\n  user: User;\n  current: boolean;\n  status: string;\n}\n\nexport interface RevisionExplorerProps {\n  assetStore: AssetStore;\n  loadFlowDefinition: (details: FlowDetails, assetStore: AssetStore) => void;\n  createNewRevision: () => void;\n  onToggled: (visible: boolean, tab: PopTabType) => void;\n  utc?: boolean;\n  popped: string;\n}\n\nexport interface RevisionExplorerState {\n  revisions: Asset[];\n  revision: Asset;\n  definition: FlowDefinition;\n  visible: boolean;\n}\n\nexport class RevisionExplorer extends React.Component<\n  RevisionExplorerProps,\n  RevisionExplorerState\n> {\n  constructor(props: RevisionExplorerProps) {\n    super(props);\n    this.state = {\n      revisions: [],\n      revision: null,\n      definition: null,\n      visible: false\n    };\n\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  public handleUpdateRevisions(): Promise<void> {\n    if (this.props.assetStore !== null) {\n      const assets = this.props.assetStore.revisions;\n      return getAssets(\n        assets.endpoint + '?version=' + SPEC_VERSION,\n        assets.type,\n        assets.id || 'id'\n      ).then((remoteAssets: Asset[]) => {\n        if (remoteAssets.length > 0) {\n          remoteAssets[0].content.current = true;\n        }\n        this.setState({ revisions: remoteAssets });\n      });\n    }\n  }\n\n  public handleTabClicked(): void {\n    this.props.onToggled(!this.state.visible, PopTabType.REVISION_HISTORY);\n\n    this.setState(\n      (prevState: RevisionExplorerState) => {\n        return { visible: !prevState.visible };\n      },\n      () => {\n        if (this.state.visible) {\n          this.handleUpdateRevisions();\n        } else {\n          if (this.state.revision && this.state.revision.id !== this.state.revisions[0].id) {\n            getFlowDetails(this.props.assetStore.revisions, this.state.revisions[0].id).then(\n              (details: FlowDetails) => {\n                this.props.loadFlowDefinition(details, this.props.assetStore);\n                this.setState({ revision: null });\n              }\n            );\n          }\n        }\n      }\n    );\n  }\n\n  public onRevisionClicked = (\n    revision: Asset\n  ): ((event: React.MouseEvent<HTMLDivElement>) => void) => {\n    return (event: React.MouseEvent<HTMLDivElement>) => {\n      event.stopPropagation();\n      event.preventDefault();\n      getFlowDetails(this.props.assetStore.revisions, revision.id).then((details: FlowDetails) => {\n        this.props.loadFlowDefinition(details, this.props.assetStore);\n        this.setState({ revision });\n      });\n    };\n  };\n\n  public onRevertClicked = (\n    revision: Asset\n  ): ((event: React.MouseEvent<HTMLDivElement>) => void) => {\n    return (event: React.MouseEvent<HTMLDivElement>) => {\n      event.stopPropagation();\n      event.preventDefault();\n      this.props.createNewRevision();\n      this.setState({ visible: false, revision: null });\n    };\n  };\n\n  public render(): JSX.Element {\n    const classes = cx({\n      [styles.visible]: this.state.visible,\n      [styles.hidden]: this.props.popped && this.props.popped !== PopTabType.REVISION_HISTORY\n    });\n\n    return (\n      <div className={classes}>\n        <div className={styles.mask} />\n        <PopTab\n          header={i18n.t('revisions.header', 'Revisions')}\n          color=\"#8e5ea7\"\n          icon=\"fe-time\"\n          label={i18n.t('revisions.label', 'Revision History')}\n          top=\"360px\"\n          visible={this.state.visible}\n          onShow={this.handleTabClicked}\n          onHide={this.handleTabClicked}\n        >\n          <div className={styles.explorer_wrapper}>\n            <div className={styles.explorer}>\n              <div className={styles.revisions}>\n                {this.state.revisions.map((asset: Asset) => {\n                  const revision = asset.content as Revision;\n\n                  const isSelected = this.state.revision && asset.id === this.state.revision.id;\n\n                  const selectedClass = revision.current || isSelected ? styles.selected : '';\n\n                  return (\n                    <div\n                      className={styles.revision + ' ' + selectedClass}\n                      key={'revision_' + asset.id}\n                      onClick={this.onRevisionClicked(asset)}\n                    >\n                      {renderIf(revision.current)(\n                        <div className={styles.button + ' ' + styles.current}>current</div>\n                      )}\n\n                      {renderIf(revision.status === 'published')(\n                        <div className={styles.button + ' ' + styles.publish}> published </div>\n                      )}\n\n                      {renderIf(isSelected && !revision.current)(\n                        <div onClick={this.onRevertClicked(asset)} className={styles.button}>\n                          revert\n                        </div>\n                      )}\n                      <div className={styles.created_on}>\n                        {dateFormat(\n                          new Date(revision.created_on),\n                          'mmmm d, yyyy, h:MM TT',\n                          this.props.utc\n                        )}\n                      </div>\n                      <div className={styles.email}>\n                        {revision.user.name || revision.user.email}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          </div>\n        </PopTab>\n      </div>\n    );\n  }\n}\n","import { react as bindCallbacks } from 'auto-bind';\r\nimport classNames from 'classnames/bind';\r\nimport React from 'react';\r\nimport styles from './IssuesTab.module.scss';\r\nimport i18n from 'config/i18n';\r\nimport { FlowIssue, Action } from 'flowTypes';\r\nimport { PopTab } from 'components/poptab/PopTab';\r\nimport { renderIssue } from 'components/flow/actions/helpers';\r\nimport {\r\n  AssetMap,\r\n  RenderNode,\r\n  Asset,\r\n  RenderNodeMap,\r\n  RenderAction,\r\n  FlowIssueMap\r\n} from 'store/flowContext';\r\nimport { getTypeConfig } from 'config';\r\nimport { getType } from 'config/typeConfigs';\r\nimport { Type, PopTabType } from 'config/interfaces';\r\n\r\nconst cx: any = classNames.bind(styles);\r\n\r\nexport interface IssuesTabProps {\r\n  issues: FlowIssueMap;\r\n  languages: AssetMap;\r\n  nodes: RenderNodeMap;\r\n  onToggled: (visible: boolean, tab: PopTabType) => void;\r\n  onIssueClicked: (issueDetail: IssueDetail) => void;\r\n  onIssueOpened: (IssueDetail: IssueDetail) => void;\r\n  popped: string;\r\n}\r\n\r\nexport type IssueDetail = {\r\n  issues: FlowIssue[];\r\n  renderObjects: RenderObjects;\r\n  language: Asset;\r\n};\r\n\r\ntype IssueMap = {\r\n  [uuid: string]: IssueDetail;\r\n};\r\n\r\nexport interface IssuesTabState {\r\n  visible: boolean;\r\n  selectedIssue: FlowIssue;\r\n  issueDetails: IssueDetail[];\r\n}\r\n\r\nexport interface RenderObjects {\r\n  renderNode: RenderNode;\r\n  renderAction?: RenderAction;\r\n}\r\n\r\nconst getIssueKey = (issue: FlowIssue) => {\r\n  return (issue.action_uuid || issue.node_uuid) + (issue.language || '');\r\n};\r\n\r\nconst getRenderObjects = (issue: FlowIssue, nodes: RenderNodeMap): RenderObjects => {\r\n  const renderNode = nodes[issue.node_uuid];\r\n  let renderAction: RenderAction = null;\r\n\r\n  if (issue.action_uuid && renderNode) {\r\n    const actionIdx = issue.action_uuid\r\n      ? renderNode.node.actions.findIndex((action: Action) => action.uuid === issue.action_uuid)\r\n      : null;\r\n\r\n    if (actionIdx > -1) {\r\n      const action = renderNode.node.actions[actionIdx];\r\n      renderAction = {\r\n        action,\r\n        config: getTypeConfig(action.type),\r\n        index: actionIdx\r\n      };\r\n    }\r\n  }\r\n\r\n  return {\r\n    renderNode,\r\n    renderAction\r\n  };\r\n};\r\n\r\nexport class IssuesTab extends React.Component<IssuesTabProps, IssuesTabState> {\r\n  constructor(props: IssuesTabProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      visible: false,\r\n      selectedIssue: null,\r\n      issueDetails: this.buildIssueDetails()\r\n    };\r\n\r\n    bindCallbacks(this, {\r\n      include: [/^handle/, /^render/]\r\n    });\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: IssuesTabProps): void {\r\n    if (\r\n      this.props.issues !== prevProps.issues ||\r\n      prevProps.nodes !== this.props.nodes ||\r\n      this.props.languages !== prevProps.languages\r\n    ) {\r\n      this.setState({ issueDetails: this.buildIssueDetails() });\r\n    }\r\n  }\r\n\r\n  private buildIssueDetails(): IssueDetail[] {\r\n    const issueMap: IssueMap = {};\r\n    if (Object.keys(this.props.nodes).length > 0) {\r\n      for (const issues of Object.values(this.props.issues)) {\r\n        for (const issue of issues) {\r\n          const key = getIssueKey(issue);\r\n          let issueDetail = issueMap[key];\r\n          if (!issueDetail) {\r\n            let language = null;\r\n            if (issue.language && this.props.languages) {\r\n              language = this.props.languages[issue.language];\r\n            }\r\n\r\n            const renderObjects = getRenderObjects(issue, this.props.nodes);\r\n            if (renderObjects.renderNode && (!issue.action_uuid || renderObjects.renderAction)) {\r\n              issueDetail = {\r\n                issues: [issue],\r\n                renderObjects: renderObjects,\r\n                language\r\n              };\r\n            }\r\n          } else {\r\n            issueDetail.issues.push(issue);\r\n          }\r\n\r\n          if (issueDetail) {\r\n            issueMap[key] = issueDetail;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return Object.values(issueMap).sort((a: IssueDetail, b: IssueDetail) => {\r\n      if (a.language && !b.language) {\r\n        return 1;\r\n      }\r\n\r\n      if (!a.language && b.language) {\r\n        return -1;\r\n      }\r\n\r\n      if (a.language && b.language && a.language.name !== b.language.name) {\r\n        return a.language.name.localeCompare(b.language.name);\r\n      }\r\n\r\n      const nodeDifference =\r\n        a.renderObjects.renderNode.ui.position.top - b.renderObjects.renderNode.ui.position.top;\r\n\r\n      if (nodeDifference !== 0) {\r\n        return nodeDifference;\r\n      }\r\n\r\n      // if we are the same node and have actions sort by those\r\n      if (a.renderObjects.renderNode.node.uuid === b.renderObjects.renderNode.node.uuid) {\r\n        if (a.renderObjects.renderAction && b.renderObjects.renderAction) {\r\n          return a.renderObjects.renderAction.index - b.renderObjects.renderAction.index;\r\n        }\r\n      }\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  public handleTabClicked(): void {\r\n    this.props.onToggled(!this.state.visible, PopTabType.ISSUES_TAB);\r\n\r\n    this.setState((prevState: IssuesTabState) => {\r\n      return { visible: !prevState.visible };\r\n    });\r\n  }\r\n\r\n  private handleIssueClicked(issueDetail: IssueDetail) {\r\n    this.props.onIssueClicked(issueDetail);\r\n\r\n    window.setTimeout(() => {\r\n      this.props.onIssueOpened(issueDetail);\r\n    }, 750);\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    let issueCount = 0;\r\n\r\n    let lastLanguage: Asset = null;\r\n\r\n    const issues = this.state.issueDetails.map((details: IssueDetail) => {\r\n      issueCount += details.issues.length;\r\n\r\n      let languageHeader: JSX.Element = null;\r\n\r\n      if (details.language && details.language !== lastLanguage) {\r\n        languageHeader = <div className={styles.language}>{details.language.name}</div>;\r\n      }\r\n\r\n      lastLanguage = details.language;\r\n\r\n      let typeConfig: Type = null;\r\n\r\n      if (!details.renderObjects.renderNode) {\r\n        return null;\r\n      }\r\n\r\n      if (details.renderObjects.renderAction) {\r\n        typeConfig = details.renderObjects.renderAction.config;\r\n      } else {\r\n        typeConfig = getTypeConfig(getType(details.renderObjects.renderNode));\r\n      }\r\n\r\n      const locationHeader: JSX.Element = null;\r\n      const issues = details.issues.map((issue: FlowIssue, num: number) => (\r\n        <div key={getIssueKey(issue) + num} className={styles.message}>\r\n          <div className={styles.header}>{typeConfig.name}:</div> {renderIssue(issue)}\r\n        </div>\r\n      ));\r\n\r\n      return (\r\n        <div key={getIssueKey(details.issues[0]) + '_detail'}>\r\n          {languageHeader}\r\n          <div className={styles.details} onClick={() => this.handleIssueClicked(details)}>\r\n            {locationHeader}\r\n            <div className={styles.issues_code}>{issues}</div>\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n\r\n    const classes = cx({\r\n      [styles.visible]: this.state.visible,\r\n      [styles.hidden]: this.props.popped && this.props.popped !== PopTabType.ISSUES_TAB\r\n    });\r\n\r\n    return (\r\n      <div className={classes}>\r\n        <div className={styles.mask} />\r\n        <PopTab\r\n          header={`${i18n.t('issues.label', 'Flow Issues')} (${issueCount})`}\r\n          label={i18n.t('issues.header', 'Flow Issues')}\r\n          color=\"tomato\"\r\n          icon=\"fe-warning\"\r\n          top=\"416px\"\r\n          visible={this.state.visible}\r\n          onShow={this.handleTabClicked}\r\n          onHide={this.handleTabClicked}\r\n        >\r\n          <div className={styles.issues_wrapper}>{issues}</div>\r\n        </PopTab>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { combineReducers } from 'redux';\r\nimport editorState from 'store/editor';\r\nimport flowContext from 'store/flowContext';\r\nimport nodeEditor from 'store/nodeEditor';\r\n\r\nexport default combineReducers({\r\n  flowContext,\r\n  editorState,\r\n  nodeEditor\r\n});\r\n","import { EditorState, initialState as editorState } from 'store/editor';\r\nimport { FlowContext, initialState as flowContext } from 'store/flowContext';\r\nimport { initialState as nodeEditor, NodeEditor } from 'store/nodeEditor';\r\n\r\nexport default interface AppState {\r\n  flowContext: FlowContext;\r\n  editorState: EditorState;\r\n  nodeEditor: NodeEditor;\r\n}\r\n\r\nexport const initialState: AppState = {\r\n  flowContext,\r\n  editorState,\r\n  nodeEditor\r\n};\r\n","import { applyMiddleware, createStore, Middleware } from 'redux';\r\nimport { composeWithDevTools } from 'redux-devtools-extension';\r\nimport thunk from 'redux-thunk';\r\n\r\nimport rootReducer from 'store/rootReducer';\r\nimport AppState, { initialState } from 'store/state';\r\n\r\nconst middlewares: Middleware[] = [thunk];\r\n\r\nexport default (state: AppState = initialState) => {\r\n  const store = createStore(\r\n    rootReducer,\r\n    state,\r\n    composeWithDevTools(applyMiddleware(...middlewares))\r\n  );\r\n\r\n  /* istanbul ignore next */\r\n  if (module.hot) {\r\n    module.hot.accept('./rootReducer', () => {\r\n      const { default: nextRootReducer } = require('./rootReducer');\r\n      store.replaceReducer(nextRootReducer);\r\n    });\r\n  }\r\n\r\n  return store;\r\n};\r\n","import { react as bindCallbacks } from 'auto-bind';\nimport classNames from 'classnames/bind';\nimport React from 'react';\nimport styles from './TranslatorTab.module.scss';\nimport i18n from 'config/i18n';\nimport { PopTab } from 'components/poptab/PopTab';\nimport { AssetMap, Asset, RenderNodeMap } from 'store/flowContext';\nimport { PopTabType, Type } from 'config/interfaces';\nimport { Action, Category, Case } from 'flowTypes';\nimport { getTypeConfig } from 'config';\nimport {\n  findTranslations,\n  getMergedByType,\n  TranslationState,\n  getFriendlyAttribute,\n  getBundleKey\n} from './helpers';\nimport CheckboxElement from 'components/form/checkbox/CheckboxElement';\nimport { UpdateTranslationFilters } from 'store/thunks';\nimport { getSwitchRouter } from 'components/flow/routers/helpers';\nimport { getType } from 'config/typeConfigs';\nimport { fakePropType } from 'config/ConfigProvider';\n\nconst cx: any = classNames.bind(styles);\n\nexport enum TranslationType {\n  PROPERTY = 'property',\n  CATEGORY = 'category',\n  CASE = 'case'\n}\n\nexport interface TranslationBundle {\n  node_uuid: string;\n  action_uuid?: string;\n  translations: Translation[];\n  translated: number;\n  typeConfig: Type;\n}\n\nexport interface Translation {\n  type: TranslationType;\n  attribute: string;\n  from: string;\n  to: string;\n}\n\nexport interface TranslatorTabProps {\n  localization: { [uuid: string]: any };\n  language: Asset;\n  languages: AssetMap;\n\n  translationFilters: { categories: boolean; rules: boolean };\n\n  nodes: RenderNodeMap;\n  onToggled: (visible: boolean, tab: PopTabType) => void;\n  onTranslationClicked: (bundle: TranslationBundle) => void;\n  onTranslationOpened: (bundle: TranslationBundle) => void;\n  onTranslationFilterChanged: UpdateTranslationFilters;\n  popped: string;\n}\n\nexport interface TranslatorTabState {\n  visible: boolean;\n  selectedTranslation: Translation;\n  translationBundles: TranslationBundle[];\n  optionsVisible: boolean;\n  pctComplete: number;\n  translationFilters: { categories: boolean; rules: boolean };\n}\n\nexport class TranslatorTab extends React.Component<TranslatorTabProps, TranslatorTabState> {\n  public static contextTypes = {\n    config: fakePropType\n  };\n\n  constructor(props: TranslatorTabProps, context: any) {\n    super(props);\n\n    this.state = {\n      visible: false,\n      selectedTranslation: null,\n      translationBundles: [],\n      optionsVisible: false,\n      pctComplete: 0,\n      translationFilters: props.translationFilters || { categories: true, rules: true }\n    };\n\n    bindCallbacks(this, {\n      include: [/^handle/, /^render/, /^toggle/]\n    });\n  }\n\n  public componentWillUnmount(): void {\n    if (this.state.visible) {\n      this.handleTabClicked();\n    }\n  }\n\n  public componentDidUpdate(prevProps: TranslatorTabProps, prevState: TranslatorTabState): void {\n    // traceUpdate(this, prevProps, prevState);\n    if (\n      prevProps.translationFilters !== this.props.translationFilters ||\n      prevProps.localization !== this.props.localization ||\n      prevProps.language !== this.props.language ||\n      !prevState.visible ||\n      prevState.translationFilters !== this.state.translationFilters\n    ) {\n      this.handleUpdateTranslations();\n    }\n  }\n\n  private handleUpdateTranslations(): void {\n    const translationBundles: TranslationBundle[] = [];\n    Object.keys(this.props.nodes).forEach((node_uuid: string) => {\n      const renderNode = this.props.nodes[node_uuid];\n\n      // check for router level translations\n      if (\n        renderNode.node.router &&\n        (this.state.translationFilters.categories || this.state.translationFilters.rules)\n      ) {\n        const typeConfig = getTypeConfig(getType(renderNode));\n\n        let translations: Translation[] = [];\n        if (this.state.translationFilters.categories) {\n          const localizeableKeys = ['name'];\n          renderNode.node.router.categories.forEach((category: Category) => {\n            translations.push(\n              ...findTranslations(\n                TranslationType.CATEGORY,\n                localizeableKeys,\n                category,\n                this.props.localization\n              )\n            );\n          });\n        }\n\n        if (this.state.translationFilters.rules) {\n          const localizeableKeys = ['arguments'];\n          const switchRouter = getSwitchRouter(renderNode.node);\n          if (switchRouter) {\n            switchRouter.cases.forEach((kase: Case) => {\n              translations.push(\n                ...findTranslations(\n                  TranslationType.CASE,\n                  localizeableKeys,\n                  kase,\n                  this.props.localization\n                )\n              );\n            });\n          }\n        }\n\n        if (translations.length > 0) {\n          translationBundles.push({\n            typeConfig,\n            node_uuid,\n            translations,\n            translated: translations.filter((translation: Translation) => !!translation.to).length\n          });\n        }\n      } else {\n        // find attributes from each action\n        renderNode.node.actions.forEach((action: Action) => {\n          const typeConfig = getTypeConfig(action.type);\n          const translations = findTranslations(\n            TranslationType.PROPERTY,\n            typeConfig.localizeableKeys || [],\n            action,\n            this.props.localization\n          );\n\n          if (translations.length > 0) {\n            translationBundles.push({\n              typeConfig,\n              node_uuid,\n              action_uuid: action.uuid,\n              translations,\n              translated: translations.filter((translation: Translation) => !!translation.to).length\n            });\n          }\n        });\n      }\n    });\n\n    const counts = { total: 0, complete: 0 };\n    translationBundles.reduce((counts, bundle) => {\n      counts.total += bundle.translations.length;\n      counts.complete += bundle.translated;\n      return counts;\n    }, counts);\n\n    const pctComplete = counts.total > 0 ? Math.round((counts.complete / counts.total) * 100) : 0;\n\n    const bundles = translationBundles\n      .filter((bundle: TranslationBundle) => bundle.translated < bundle.translations.length)\n      .sort((a: TranslationBundle, b: TranslationBundle) => {\n        return b.translations.length - b.translated - (a.translations.length - a.translated);\n      });\n\n    if (\n      pctComplete !== this.state.pctComplete ||\n      bundles.length !== this.state.translationBundles.length\n    ) {\n      this.setState({\n        pctComplete,\n        translationBundles: bundles\n      });\n    }\n  }\n\n  public handleTabClicked(): void {\n    this.props.onToggled(!this.state.visible, PopTabType.TRANSLATOR_TAB);\n    this.setState((prevState: TranslatorTabState) => {\n      return { visible: !prevState.visible };\n    });\n  }\n\n  public toggleOptions(): void {\n    this.setState({ optionsVisible: !this.state.optionsVisible });\n  }\n\n  private toggleCategories(categories: boolean): void {\n    this.setState(\n      { translationFilters: { categories, rules: this.state.translationFilters.rules } },\n      () => {\n        this.props.onTranslationFilterChanged(this.state.translationFilters);\n      }\n    );\n  }\n  private toggleRules(rules: boolean): void {\n    this.setState(\n      { translationFilters: { rules, categories: this.state.translationFilters.categories } },\n      () => {\n        this.props.onTranslationFilterChanged(this.state.translationFilters);\n      }\n    );\n  }\n\n  private renderMissing(key: string, from: string, summary: string) {\n    if (from) {\n      return (\n        <div key={this.props.language.id + key} className={styles.item}>\n          <div className={styles.text + ' ' + styles.from_text}>{from}</div>\n          <div className={styles.text + ' ' + styles.attribute}>{summary}</div>\n        </div>\n      );\n    }\n    return null;\n  }\n\n  private handleTranslationClicked(bundle: TranslationBundle) {\n    this.props.onTranslationClicked(bundle);\n\n    window.setTimeout(() => {\n      this.props.onTranslationOpened(bundle);\n    }, 750);\n  }\n\n  private handleChangeLanguageClick(e: any): void {\n    this.context.config.onChangeLanguage(this.props.language.id, this.props.language.name);\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  public render(): JSX.Element {\n    // only show change button if container set up to handle it\n    const showChangeButton = this.state.optionsVisible && this.context.config.onChangeLanguage;\n\n    const classes = cx({\n      [styles.visible]: this.state.visible,\n      [styles.hidden]: this.props.popped && this.props.popped !== PopTabType.TRANSLATOR_TAB\n    });\n\n    const optionsClasses = cx({\n      [styles.options]: true,\n      [styles.options_visible]: this.state.optionsVisible,\n      [styles.change_visible]: showChangeButton\n    });\n\n    const filledClasses = cx({\n      [styles.filled]: true,\n      [styles.hundredpct]: this.state.pctComplete === 100\n    });\n\n    const wrapperClasses = cx({\n      [styles.translations_wrapper]: true,\n      [styles.complete]: this.state.translationBundles.length === 0\n    });\n\n    return (\n      <div className={classes}>\n        <PopTab\n          header={`${this.props.language.name} ${i18n.t('translation.label', 'Translations')}`}\n          label={i18n.t('translation.header', 'Flow Translation')}\n          color=\"#777\"\n          icon=\"fe-language\"\n          top=\"243px\"\n          visible={this.state.visible}\n          onShow={this.handleTabClicked}\n          onHide={this.handleTabClicked}\n        >\n          <div key={'translation_wrapper'} className={wrapperClasses}>\n            {this.state.translationBundles.map((bundle: TranslationBundle) => {\n              return (\n                <div\n                  key={this.props.language.id + getBundleKey(bundle)}\n                  className={styles.translate_block}\n                  onClick={() => {\n                    this.handleTranslationClicked(bundle);\n                  }}\n                >\n                  <div className={styles.needs_translation}>\n                    <div className={styles.type_name}>{bundle.typeConfig.name}</div>\n                    {this.renderMissing(\n                      getBundleKey(bundle) + 'categories',\n                      getMergedByType(bundle, TranslationState.MISSING, TranslationType.CATEGORY),\n                      getFriendlyAttribute('categories')\n                    )}\n\n                    {this.renderMissing(\n                      getBundleKey(bundle) + 'rules',\n\n                      getMergedByType(bundle, TranslationState.MISSING, TranslationType.CASE),\n                      getFriendlyAttribute('cases')\n                    )}\n                    {bundle.translations\n                      .filter(\n                        translation =>\n                          !translation.to && translation.type === TranslationType.PROPERTY\n                      )\n                      .map(translation =>\n                        this.renderMissing(\n                          getBundleKey(bundle) + translation.from,\n                          translation.from,\n                          getFriendlyAttribute(translation.attribute)\n                        )\n                      )}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n\n          <div className={optionsClasses} onClick={this.toggleOptions}>\n            <div className={styles.header}>\n              <div className={styles.progress_bar}>\n                <div\n                  style={{ width: `${this.state.pctComplete}%` }}\n                  className={filledClasses}\n                ></div>\n              </div>\n              <div className={styles.toggle}>\n                <span className=\"fe-arrow-up\"></span>\n              </div>\n            </div>\n            <div className={styles.filters}>\n              <div className={styles.checkboxes}>\n                <div>\n                  <CheckboxElement\n                    name={i18n.t('forms.categories', 'categories')}\n                    checked={this.state.translationFilters.categories}\n                    description={'Categories'}\n                    checkboxClassName={styles.checkbox}\n                    onChange={this.toggleCategories}\n                  />\n                </div>\n                <div>\n                  <CheckboxElement\n                    name={i18n.t('forms.rules', 'rules')}\n                    checked={this.state.translationFilters.rules}\n                    description={'Rule Arguments'}\n                    checkboxClassName={styles.checkbox}\n                    onChange={this.toggleRules}\n                  />\n                </div>\n              </div>\n              <div className={styles.pct_complete}>{this.state.pctComplete}%</div>\n            </div>\n            <div className={styles.changeLanguage}>\n              {showChangeButton && (\n                <button onClick={this.handleChangeLanguageClick}>\n                  {i18n.t('forms.use_as_default_language', 'Use as default language')}\n                </button>\n              )}\n            </div>\n          </div>\n        </PopTab>\n      </div>\n    );\n  }\n}\n","import { react as bindCallbacks } from 'auto-bind';\nimport Button, { ButtonTypes } from 'components/button/Button';\nimport Dialog from 'components/dialog/Dialog';\nimport { Fixy } from 'components/fixy/Fixy';\nimport ConnectedFlow from 'components/flow/Flow';\nimport styles from 'components/index.module.scss';\nimport ConnectedLanguageSelector from 'components/languageselector/LanguageSelector';\nimport Loading from 'components/loading/Loading';\nimport Modal from 'components/modal/Modal';\nimport { RevisionExplorer } from 'components/revisions/RevisionExplorer';\nimport { IssuesTab, IssueDetail } from 'components/issues/IssuesTab';\nimport ConfigProvider from 'config';\nimport { fakePropType } from 'config/ConfigProvider';\nimport { FlowDefinition, FlowEditorConfig, AnyAction } from 'flowTypes';\nimport * as React from 'react';\nimport { connect, Provider as ReduxProvider } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport createStore from 'store/createStore';\nimport { ModalMessage } from 'store/editor';\nimport { Asset, Assets, AssetStore, RenderNodeMap, FlowIssueMap } from 'store/flowContext';\nimport { getCurrentDefinition } from 'store/helpers';\nimport AppState from 'store/state';\nimport {\n  CreateNewRevision,\n  createNewRevision,\n  DispatchWithState,\n  FetchFlow,\n  fetchFlow,\n  LoadFlowDefinition,\n  loadFlowDefinition,\n  MergeEditorState,\n  mergeEditorState,\n  onOpenNodeEditor,\n  OnOpenNodeEditor,\n  handleLanguageChange,\n  HandleLanguageChange,\n  UpdateTranslationFilters,\n  updateTranslationFilters\n} from 'store/thunks';\nimport { ACTIVITY_INTERVAL, downloadJSON, renderIf, onNextRender } from 'utils';\nimport { PopTabType } from 'config/interfaces';\nimport { TranslatorTab, TranslationBundle } from './translator/TranslatorTab';\nimport i18n from 'config/i18n';\n\nconst { default: PageVisibility } = require('react-page-visibility');\n\nexport interface FlowEditorContainerProps {\n  config: FlowEditorConfig;\n}\n\nexport interface FlowEditorStoreProps {\n  assetStore: AssetStore;\n  baseLanguage: Asset;\n  language: Asset;\n  languages: Assets;\n  simulating: boolean;\n  translating: boolean;\n  fetchingFlow: boolean;\n  definition: FlowDefinition;\n  issues: FlowIssueMap;\n  fetchFlow: FetchFlow;\n  loadFlowDefinition: LoadFlowDefinition;\n  createNewRevision: CreateNewRevision;\n  mergeEditorState: MergeEditorState;\n  onOpenNodeEditor: OnOpenNodeEditor;\n  handleLanguageChange: HandleLanguageChange;\n  nodes: RenderNodeMap;\n  modalMessage: ModalMessage;\n  saving: boolean;\n  scrollToNode: string;\n  scrollToAction: string;\n  popped: string;\n  updateTranslationFilters: UpdateTranslationFilters;\n}\n\nconst hotStore = createStore();\n\nexport const getLabel = (): JSX.Element => {\n  return <div>testing</div>;\n};\n\n// Root container, wires up context-providers\nexport const FlowEditorContainer: React.SFC<FlowEditorContainerProps> = ({ config }) => {\n  return (\n    <ConfigProvider config={{ ...config }}>\n      <ReduxProvider store={hotStore as any}>\n        <ConnectedFlowEditor />\n      </ReduxProvider>\n    </ConfigProvider>\n  );\n};\n\nexport const contextTypes = {\n  config: fakePropType\n};\n\nexport const editorContainerSpecId = 'editor-container';\nexport const editorSpecId = 'editor';\n\n/**\n * The main editor view for editing a flow\n */\nexport class FlowEditor extends React.Component<FlowEditorStoreProps> {\n  public static contextTypes = contextTypes;\n\n  constructor(props: FlowEditorStoreProps) {\n    super(props);\n    bindCallbacks(this, {\n      include: [/^handle/]\n    });\n  }\n\n  public componentDidMount(): void {\n    const { endpoints, flow, forceSaveOnLoad } = this.context.config;\n    this.props.fetchFlow(endpoints, flow, forceSaveOnLoad);\n  }\n\n  private handleDownloadClicked(): void {\n    downloadJSON(getCurrentDefinition(this.props.definition, this.props.nodes), 'definition');\n  }\n\n  private handleVisibilityChanged(visible: boolean): void {\n    this.props.mergeEditorState({\n      visible,\n      activityInterval: ACTIVITY_INTERVAL\n    });\n  }\n\n  public getAlertModal(): JSX.Element {\n    if (!this.props.modalMessage) {\n      return null;\n    }\n\n    return (\n      <Modal width=\"600px\" show={true}>\n        <Dialog\n          className={styles.alert_modal}\n          title={this.props.modalMessage.title}\n          headerClass=\"alert\"\n          buttons={{\n            primary: {\n              name: 'Ok',\n              onClick: () => {\n                this.props.mergeEditorState({ modalMessage: null });\n              }\n            }\n          }}\n        >\n          <div className={styles.alert_body}>{this.props.modalMessage.body}</div>\n        </Dialog>\n      </Modal>\n    );\n  }\n\n  public getSavingIndicator(): JSX.Element {\n    if (!this.props.saving) {\n      return null;\n    }\n\n    return (\n      <div id=\"saving_animation\" className={styles.saving}>\n        <Fixy>\n          <Loading units={5} color=\"#3498db\" size={7} />\n        </Fixy>\n      </div>\n    );\n  }\n\n  public getFooter(): JSX.Element {\n    return !this.props.fetchingFlow && this.context.config.showDownload ? (\n      <div className={styles.footer}>\n        <div className={styles.download_button}>\n          <Button\n            name={i18n.t('buttons.download', 'Download')}\n            onClick={this.handleDownloadClicked}\n            type={ButtonTypes.primary}\n          />\n        </div>\n      </div>\n    ) : null;\n  }\n\n  private handleLanguageSetting(issueDetail: IssueDetail): void {\n    if (issueDetail.language) {\n      this.props.handleLanguageChange(issueDetail.language);\n    } else {\n      this.props.handleLanguageChange(this.props.baseLanguage);\n    }\n  }\n\n  public handleOpenIssue(issueDetail: IssueDetail): void {\n    this.handleLanguageSetting(issueDetail);\n    this.props.onOpenNodeEditor({\n      originalNode: issueDetail.renderObjects.renderNode,\n      originalAction: issueDetail.renderObjects.renderAction\n        ? (issueDetail.renderObjects.renderAction.action as AnyAction)\n        : null\n    });\n  }\n\n  private handleScrollToNode(node_uuid: string, action_uuid: string): void {\n    if (this.props.scrollToNode === node_uuid && this.props.scrollToAction === action_uuid) {\n      this.props.mergeEditorState({\n        scrollToNode: null,\n        scrollToAction: null\n      });\n    }\n\n    onNextRender(() => {\n      this.props.mergeEditorState({\n        scrollToNode: node_uuid,\n        scrollToAction: action_uuid\n      });\n    });\n  }\n\n  public handleScrollToTranslation(translation: TranslationBundle): void {\n    this.handleScrollToNode(translation.node_uuid, translation.action_uuid);\n  }\n\n  private handleOpenTranslation(translation: TranslationBundle): void {\n    const renderNode = this.props.nodes[translation.node_uuid];\n    const action = translation.action_uuid\n      ? renderNode.node.actions.find(action => action.uuid === translation.action_uuid)\n      : null;\n\n    this.props.onOpenNodeEditor({\n      originalNode: renderNode,\n      originalAction: action\n    });\n  }\n\n  public handleScrollToIssue(issueDetail: IssueDetail): void {\n    this.handleLanguageSetting(issueDetail);\n    const issue = issueDetail.issues[0];\n    this.handleScrollToNode(issue.node_uuid, issue.action_uuid);\n  }\n\n  private handleTabPopped(visible: boolean, tab: PopTabType): void {\n    if (visible) {\n      this.props.mergeEditorState({ popped: tab });\n    } else {\n      this.props.mergeEditorState({ popped: null });\n    }\n  }\n\n  public componentDidUpdate(prevProps: FlowEditorStoreProps): void {\n    // traceUpdate(this, prevProps);\n  }\n\n  public render(): JSX.Element {\n    return (\n      <PageVisibility onChange={this.handleVisibilityChanged}>\n        <div\n          id={editorContainerSpecId}\n          className={this.props.translating ? styles.translating : undefined}\n          data-spec={editorContainerSpecId}\n        >\n          {this.getFooter()}\n          {this.getAlertModal()}\n          <div className={styles.editor} data-spec={editorSpecId}>\n            {renderIf(\n              Object.keys(this.props.nodes || {}).length > 0 &&\n                this.props.languages &&\n                Object.keys(this.props.languages.items).length > 0\n            )(<ConnectedLanguageSelector />)}\n\n            {this.getSavingIndicator()}\n\n            {renderIf(this.props.definition && this.props.language && !this.props.fetchingFlow)(\n              <ConnectedFlow />\n            )}\n\n            {renderIf(this.props.definition && this.props.translating && !this.props.fetchingFlow)(\n              <TranslatorTab\n                language={this.props.language}\n                languages={this.props.languages ? this.props.languages.items : {}}\n                localization={\n                  this.props.definition && this.props.language\n                    ? this.props.definition.localization[this.props.language.id]\n                    : {}\n                }\n                onTranslationClicked={this.handleScrollToTranslation}\n                onTranslationOpened={this.handleOpenTranslation}\n                onTranslationFilterChanged={this.props.updateTranslationFilters}\n                translationFilters={\n                  this.props.definition ? this.props.definition._ui.translation_filters : null\n                }\n                nodes={this.props.nodes}\n                onToggled={this.handleTabPopped}\n                popped={this.props.popped}\n              />\n            )}\n\n            <RevisionExplorer\n              loadFlowDefinition={this.props.loadFlowDefinition}\n              createNewRevision={this.props.createNewRevision}\n              assetStore={this.props.assetStore}\n              onToggled={this.handleTabPopped}\n              popped={this.props.popped}\n            />\n\n            {renderIf(Object.keys(this.props.issues).length > 0)(\n              <IssuesTab\n                issues={this.props.issues}\n                onIssueClicked={this.handleScrollToIssue}\n                onIssueOpened={this.handleOpenIssue}\n                languages={this.props.languages ? this.props.languages.items : {}}\n                nodes={this.props.nodes}\n                onToggled={this.handleTabPopped}\n                popped={this.props.popped}\n              />\n            )}\n            <div id=\"portal-root\" />\n            <div id=\"canvas-portal\" />\n          </div>\n        </div>\n      </PageVisibility>\n    );\n  }\n}\n\nconst mapStateToProps = ({\n  flowContext: { definition, issues, nodes, assetStore, baseLanguage },\n  editorState: {\n    translating,\n    language,\n    fetchingFlow,\n    simulating,\n    modalMessage,\n    saving,\n    scrollToAction,\n    scrollToNode,\n    popped\n  }\n}: AppState) => {\n  const languages = assetStore ? assetStore.languages : null;\n\n  return {\n    popped,\n    baseLanguage,\n    modalMessage,\n    saving,\n    simulating,\n    assetStore,\n    translating,\n    language,\n    fetchingFlow,\n    definition,\n    issues,\n    nodes,\n    languages,\n    scrollToAction,\n    scrollToNode\n  };\n};\n\nconst mapDispatchToProps = (dispatch: DispatchWithState) =>\n  bindActionCreators(\n    {\n      fetchFlow,\n      loadFlowDefinition,\n      createNewRevision,\n      mergeEditorState,\n      onOpenNodeEditor,\n      handleLanguageChange,\n      updateTranslationFilters\n    },\n    dispatch\n  );\n\nexport const ConnectedFlowEditor = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(FlowEditor);\n\nexport default FlowEditorContainer;\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import './global.module.scss';\nimport 'static/fonts/floweditor/style.css';\n\nimport FlowEditor from 'components';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport * as serviceWorker from './serviceWorker';\nimport { setHTTPTimeout } from 'external';\n\n// bring in our temba-components if they aren't already registered\nif (typeof customElements !== 'undefined' && !customElements.get('temba-textinput')) {\n  import('@nyaruka/temba-components').then(() => {\n    console.log('Loading temba components');\n  });\n}\n\nwindow.showFlowEditor = (ele, config) => {\n  if (config.httpTimeout) {\n    setHTTPTimeout(config.httpTimeout);\n  }\n\n  ReactDOM.render(<FlowEditor config={config} />, ele);\n};\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}